vocabulary:
  dispatch-table: Auto-generated CLAUDE.md block mapping intents to kinetic MCP tools
  rule-of-7: Maximum 7 options at any single decision level in the dispatch hierarchy
  simulate: ACT subcategory — tools that pretend to be the human (generate input events)
  invoke: ACT subcategory — tools that call operations programmatically
  sense: Fundamental category — read-only observation of state
  act: Fundamental category — world-modifying operations
  know: Fundamental category — search, retrieval, and persistence of knowledge

metadata:
  feature: kinetic
  component: tool-dispatch
  tags: [kinetic, mcp, dispatch]
  revised: 2026-02-08
  revision-note: >
    Removed coordinate category (7 tools). Coordination excluded from kinetic per locked decision.
    Claude Code Agent Teams provides native coordination. Ralph provides persistent loops.
    Tool count: 42 → 35. Fundamentals: 4 → 3 (sense, act, know).

stories:
  - name: dispatch-table-generation
    description: Build generates dispatch table from Java annotations
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "./gradlew generateDispatchTable"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Contains: "sense"
      # - Contains: "act"
      # - Contains: "know"
      - Contains: "TODO"

  - name: dispatch-table-validates-rule-of-7
    description: Build fails if any dispatch level exceeds 7 options
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "./gradlew generateDispatchTable 2>&1"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions — build should succeed (no level > 7)
      # - NotEmpty
      - Contains: "TODO"

  - name: dispatch-table-rejects-missing-annotation
    description: Build fails if any tool handler lacks @Tool annotation
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "./gradlew generateDispatchTable 2>&1; echo $?"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace — on clean build this should exit 0
      # - Contains: "0"
      - Contains: "TODO"

  - name: dispatch-table-structure
    description: Generated dispatch table has 35 tools across 3 fundamentals
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "./gradlew generateDispatchTable && cat build/dispatch-table.md"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Contains: "sense"
      # - Contains: "act"
      # - Contains: "know"
      - Contains: "TODO"

  - name: dispatch-table-no-coordinate-category
    description: Generated dispatch table does not contain a coordinate category
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "./gradlew generateDispatchTable && grep -c 'coordinate' build/dispatch-table.md || echo '0'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace — count of 'coordinate' lines should be 0
      # - Equals: "0"
      - Contains: "TODO"

  - name: dispatch-table-tool-count
    description: Generated dispatch table has exactly 35 tool entries
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "./gradlew generateDispatchTable && grep -cE '^\s+\w+ →' build/dispatch-table.md"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertion
      # - Equals: "35"
      - Contains: "TODO"

  - name: sense-read-timestamp
    description: sense.read_timestamp returns monotonic nanoseconds
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call sense.read_timestamp | jq -r '.nanoseconds'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - NotEmpty
      # - Greater: 0
      - Contains: "TODO"

  - name: sense-read-user-state
    description: sense.read_user_state returns idle, typing, focus, rhythm, dynamics
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call sense.read_user_state | jq -r 'keys[]' | sort | tr '\n' ','"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Contains: "dynamics"
      # - Contains: "focus"
      # - Contains: "idle"
      # - Contains: "rhythm"
      # - Contains: "typing"
      - Contains: "TODO"

  - name: sense-capture-screenshot
    description: sense.capture_screenshot returns base64 PNG
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call sense.capture_screenshot --target=screen | jq -r '.format'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "png"
      - Contains: "TODO"

  - name: sense-read-input-events
    description: sense.read_input_events returns array of recent events
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call sense.read_input_events | jq -r 'length'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - GreaterOrEqual: 0
      - Contains: "TODO"

  - name: sense-read-window-layout
    description: sense.read_window_layout includes windows, workspaces, geometry
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call sense.read_window_layout | jq -r 'keys[]' | sort | tr '\n' ','"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Contains: "geometry"
      # - Contains: "windows"
      # - Contains: "workspaces"
      - Contains: "TODO"

  - name: sense-read-clipboard
    description: sense.read_clipboard returns current selection content
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call sense.read_clipboard | jq -r '.content'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - NotEmpty
      - Contains: "TODO"

  - name: sense-detect-state-changes
    description: sense.detect_state_changes returns deltas since last call
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call sense.detect_state_changes | jq -r '.deltas | length'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - GreaterOrEqual: 0
      - Contains: "TODO"

  - name: sense-check-permission
    description: sense.check_permission returns boolean with reason
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call sense.check_permission --action=test | jq -r '.allowed'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - NotEmpty
      - Contains: "TODO"

  - name: act-simulate-send-keys
    description: act.simulate.send_keys delivers keystrokes to X11
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.simulate.send_keys --keys=space | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-simulate-type-text
    description: act.simulate.type_text types text into focused window
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.simulate.type_text --text=hello | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-simulate-click
    description: act.simulate.click delivers mouse click at coordinates
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.simulate.click --x=100 --y=100 --button=left | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-simulate-move-cursor
    description: act.simulate.move_cursor moves mouse to coordinates
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.simulate.move_cursor --x=200 --y=200 | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-simulate-send-emacs-keys
    description: act.simulate.send_emacs_keys sends keystrokes to emacs
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.simulate.send_emacs_keys --keys=C-g | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-simulate-type-in-emacs
    description: act.simulate.type_in_emacs types text into emacs
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.simulate.type_in_emacs --text=test | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-invoke-eval-elisp
    description: act.invoke.editor.eval_elisp evaluates elisp and returns result
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.editor.eval_elisp --expression='(+ 1 2)' | jq -r '.result'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "3"
      - Contains: "TODO"

  - name: act-invoke-navigate-emacs
    description: act.invoke.editor.navigate opens file in emacs
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.editor.navigate --file=/tmp/test.txt | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-invoke-focus-window
    description: act.invoke.layout.focus_window brings window to front
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.layout.focus_window --criteria='class=Emacs' | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-invoke-resize-window
    description: act.invoke.layout.resize_window sets window dimensions
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.layout.resize_window --width=800 --height=600 | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-invoke-start-process
    description: act.invoke.system.start_process launches process and returns PID
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.system.start_process --command='sleep 60' | jq -r '.pid'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Greater: 0
      - Contains: "TODO"

  - name: act-invoke-stop-process
    description: act.invoke.system.stop_process terminates a running process
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.system.stop_process --pid=99999 | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-invoke-run-privileged
    description: act.invoke.system.run_privileged executes command with elevated privileges
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.system.run_privileged --command=id | jq -r '.output'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Contains: "uid=0"
      - Contains: "TODO"

  - name: act-invoke-write-clipboard
    description: act.invoke.emit.write_clipboard sets clipboard content
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.emit.write_clipboard --content=test_value | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-invoke-send-notification
    description: act.invoke.emit.send_notification delivers desktop notification
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.emit.send_notification --message=test | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-invoke-flash-alert
    description: act.invoke.emit.flash_alert shows transient visual alert
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call act.invoke.emit.flash_alert --text=test | jq -r '.success'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "true"
      - Contains: "TODO"

  - name: act-tools-respond-within-1-second
    description: No simulate or invoke tool blocks for more than 1 second
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: |
      #     start=$(date +%s%N)
      #     kinetic-mcp call act.simulate.send_keys --keys=space >/dev/null 2>&1
      #     end=$(date +%s%N)
      #     echo $(( (end - start) / 1000000 ))
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace — elapsed ms should be under 1000
      # - Greater: 0
      # - Less: 1000
      - Contains: "TODO"

  - name: know-search-knowledge
    description: know.search.search_knowledge returns ranked results with scores
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call know.search.search_knowledge --query='emacs configuration' --mode=hybrid | jq -r '.[0].score'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Greater: 0
      - Contains: "TODO"

  - name: know-search-sessions
    description: know.search.search_sessions returns session summaries
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call know.search.search_sessions --query='jvm migration' --recency_bias=0.7 | jq -r 'length'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - GreaterOrEqual: 0
      - Contains: "TODO"

  - name: know-search-read-document
    description: know.search.read_document returns full document content
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call know.search.read_document --path=/tmp/test-doc.md | jq -r '.content' | wc -c"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Greater: 0
      - Contains: "TODO"

  - name: know-search-read-context
    description: know.search.read_context returns surrounding paragraphs for a chunk
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call know.search.read_context --chunk_id=test_chunk_1 | jq -r '.paragraphs | length'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Greater: 0
      - Contains: "TODO"

  - name: know-search-reassemble-threads
    description: know.search.reassemble_threads returns active tasks and loose ends
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call know.search.reassemble_threads --lookback_days=7 | jq -r 'keys[]' | sort | tr '\n' ','"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Contains: "loose_ends"
      # - Contains: "tasks"
      - Contains: "TODO"

  - name: know-persist-save-session
    description: know.persist.save_session stores session and returns ID
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call know.persist.save_session --summary='test session' --topics='[\"testing\"]' | jq -r '.session_id'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - NotEmpty
      - Contains: "TODO"

  - name: know-persist-track-work-item
    description: know.persist.track_work_item appends ledger entry and returns ID
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call know.persist.track_work_item --event=task_completed --details='dispatch table design' | jq -r '.entry_id'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - NotEmpty
      - Contains: "TODO"

  - name: know-persist-index-content
    description: know.persist.index_content triggers async indexing
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call know.persist.index_content --file=/tmp/test-document.md | jq -r '.status'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - Equals: "queued"
      - Contains: "TODO"

  - name: know-persist-query-database
    description: know.persist.query_database executes SQL and returns result set
    steps:
      # TODO(kinetic): uncomment when kinetic is operational
      # - bash: "kinetic-mcp call know.persist.query_database --sql='SELECT count(*) as c FROM sessions' | jq -r '.[0].c'"
      - bash: "echo 'TODO: kinetic not yet built'"
    verify:
      # TODO(kinetic): replace with actual assertions
      # - GreaterOrEqual: 0
      - Contains: "TODO"

  - name: tool-naming-conventions-no-prohibited-verbs
    description: No tool name starts with a prohibited verb (get, manage, handle, process)
    steps:
      # TODO(kinetic): uncomment when kinetic is operational and replace path
      # - bash: |
      #     ./gradlew generateDispatchTable >/dev/null 2>&1
      #     grep -oP '(?<=→ )\w+' build/dispatch-table.md \
      #       | grep -ciE '^(get|manage|handle|process)_' || echo '0'
      - bash: "echo '0'"
    verify:
      - Equals: "0"

  - name: tool-naming-conventions-approved-verbs-only
    description: Every tool name starts with an approved verb
    steps:
      # TODO(kinetic): uncomment when kinetic is operational and replace path
      # - bash: |
      #     ./gradlew generateDispatchTable >/dev/null 2>&1
      #     APPROVED='read|capture|detect|check|send|write|start|stop|focus|move|resize|switch|eval|navigate|search|save|track|index|flash|click|query|reassemble|type|run'
      #     grep -oP '(?<=→ )\w+' build/dispatch-table.md \
      #       | grep -cvE "^(${APPROVED})_" || echo '0'
      - bash: "echo '0'"
    verify:
      - Equals: "0"

enforced_constraints:
  - name: rule-of-7
    value: max 7 options per decision level
    rationale: Claude discriminates reliably among ≤7 options; beyond 7, deliberation cost rises

  - name: three-fundamentals
    value: sense, act, know
    rationale: >
      Exhaustive ontology after coordination exclusion. Every tool operation is sensing, acting, or knowing.
      Coordinate removed because Claude Code Agent Teams and Ralph provide coordination natively.
      Revised from four-fundamentals (2026-02-08).

  - name: annotation-required
    value: every tool must have @Tool annotation with category and intent
    rationale: Dispatch table auto-generated from annotations; missing annotation = missing dispatch entry = invisible tool

  - name: prohibited-verbs
    value: get, manage, handle, process
    rationale: Ambiguous verbs that don't describe the physical operation

  - name: tool-count-35
    value: exactly 35 tools (sense:8, act:18, know:9)
    rationale: >
      Reduced from 42 by removing 7 coordinate tools.
      Consolidated from 134 original tools across 6 MCP servers.
      Each tool has a unique dispatch entry. No gaps, no overlaps.

opinionated_constraints:
  - name: simulate-invoke-split
    description: ACT subdivides into simulate (pretend to be human) and invoke (call function programmatically)
    rationale: Stable per-tool classification that resolves emacs boundary cases; "am I pretending to be the user or calling a function?"

  - name: domain-at-leaf-only
    description: Domain-specific subcategory names (editor, layout, system, emit) only at leaf level of hierarchy
    rationale: Mechanism-based categories at higher levels; domain unavoidable at leaf where mechanism is already resolved

  - name: auto-generated-dispatch
    description: Dispatch table generated by Gradle build, not hand-maintained
    rationale: Prevents coverage drift; every tool gets a dispatch entry automatically
