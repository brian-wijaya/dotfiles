vocabulary:
  dispatch-table: Manually maintained CLAUDE.md block mapping intents to kinetic MCP tools
  rule-of-7: Maximum 7 options at any single decision level in the dispatch hierarchy
  sense: Fundamental category — read-only observation of state
  act: Fundamental category — world-modifying operations
  recall: Fundamental category — search, retrieval, and persistence of knowledge

metadata:
  feature: kinetic
  component: tool-dispatch
  tags: [kinetic, mcp, dispatch]
  revised: 2026-02-10
  revision-note: >
    Kinetic is LIVE with 87 tools (35 native + 52 somatic proxy). MCP cutover complete.
    Fundamentals: sense, act, recall (NOT know). Tool names use underscores (act_send_keystroke).
    Dispatch table is manually maintained in CLAUDE.md — no auto-generation, no @Tool annotations,
    no Gradle generateDispatchTable task. The simulate/invoke ACT split does not exist in the actual
    implementation; tools are flat (act_send_keystroke, act_execute_command, etc.).
    Stories updated with status field: IMPLEMENTED, NOT_IMPLEMENTED, or STALE.

stories:
  - name: dispatch-table-generation
    status: NOT_IMPLEMENTED
    description: >
      Build generates dispatch table from Java annotations.
      REALITY: dispatch table is manually maintained in CLAUDE.md. No auto-generation exists.
    steps:
      # Auto-generation does not exist. Dispatch table is hand-maintained in CLAUDE.md.
      - bash: "echo 'NOT_IMPLEMENTED: dispatch table is manually maintained in CLAUDE.md'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: dispatch-table-validates-rule-of-7
    status: NOT_IMPLEMENTED
    description: >
      Build fails if any dispatch level exceeds 7 options.
      REALITY: no build-time validation. Rule-of-7 is enforced by manual review of CLAUDE.md dispatch table.
    steps:
      - bash: "echo 'NOT_IMPLEMENTED: rule-of-7 enforced by manual review'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: dispatch-table-rejects-missing-annotation
    status: NOT_IMPLEMENTED
    description: >
      Build fails if any tool handler lacks @Tool annotation.
      REALITY: no @Tool annotations exist. Tools are registered via MCP SDK Tool.builder() calls.
    steps:
      - bash: "echo 'NOT_IMPLEMENTED: no @Tool annotations, tools use MCP SDK builders'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: dispatch-table-structure
    status: STALE
    description: >
      Originally: generated dispatch table has 35 tools across 3 fundamentals.
      REALITY: 87 tools (35 native + 52 somatic proxy) across 3 fundamentals (sense, act, recall).
      Dispatch table is manually maintained in CLAUDE.md, not generated.
    steps:
      - bash: "echo 'STALE: 87 tools (35 native + 52 somatic), manually maintained'"
    verify:
      - Contains: "STALE"

  - name: dispatch-table-no-coordinate-category
    status: IMPLEMENTED
    description: >
      Dispatch table does not contain a coordinate category.
      Still true — coordinate was removed and never came back.
    steps:
      # TODO(kinetic): could grep CLAUDE.md dispatch table for 'coordinate'
      - bash: "echo 'IMPLEMENTED: coordinate category was removed'"
    verify:
      - Contains: "IMPLEMENTED"

  - name: dispatch-table-tool-count
    status: STALE
    description: >
      Originally: generated dispatch table has exactly 35 tool entries.
      REALITY: 87 tools total (35 native + 52 somatic proxy). Not auto-generated.
    steps:
      - bash: "echo 'STALE: actual count is 87 (35 native + 52 somatic proxy)'"
    verify:
      - Contains: "STALE"

  - name: sense-read-timestamp
    status: IMPLEMENTED
    description: somatic_now returns monotonic nanoseconds
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call somatic_now | jq -r '.nanoseconds'"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: sense-read-user-state
    status: IMPLEMENTED
    description: somatic_get_snapshot returns fused 14-dimension environment state vector
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call somatic_get_snapshot | jq -r 'keys[]' | sort"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: sense-capture-screenshot
    status: IMPLEMENTED
    description: sense_capture_screen_region returns base64 PNG
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call sense_capture_screen_region | jq -r '.format'"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: sense-read-input-events
    status: IMPLEMENTED
    description: somatic_get_events returns array of recent X11 events from ring buffer
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call somatic_get_events --count=50 | jq -r 'length'"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: sense-read-window-layout
    status: IMPLEMENTED
    description: sense_read_window_layout returns i3 tree with windows and workspaces
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call sense_read_window_layout --format=windows | jq -r 'length'"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: sense-read-clipboard
    status: IMPLEMENTED
    description: >
      somatic_get_latest returns clipboard metadata (hash, size, type, language hint).
      NOTE: kinetic never returns clipboard content, only metadata. Privacy by design.
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call somatic_get_latest | jq -r '.type'"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: sense-detect-state-changes
    status: NOT_IMPLEMENTED
    description: >
      Originally: sense.detect_state_changes returns deltas since last call.
      REALITY: no such tool exists. Use somatic_subscribe_changes for polling-based change detection,
      or somatic_get_events/somatic_get_anomalies for event-based observation.
    steps:
      - bash: "echo 'NOT_IMPLEMENTED: use somatic_subscribe_changes or somatic_get_events instead'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: sense-check-permission
    status: IMPLEMENTED
    description: somatic_check_permission returns allowed status, reason, and rate limit info
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call somatic_check_permission --category=READ_SENSOR --resource=test --rate_key=test:READ_SENSOR | jq -r '.allowed'"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-simulate-send-keys
    status: IMPLEMENTED
    description: act_send_keystroke delivers keystrokes to X11 via xdotool
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_send_keystroke --keys=space"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-simulate-type-text
    status: IMPLEMENTED
    description: act_send_text_input types text into focused window via xdotool
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_send_text_input --text=hello"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-simulate-click
    status: IMPLEMENTED
    description: act_send_click delivers mouse click at coordinates via X11
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_send_click --x=100 --y=100 --button=1"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-simulate-move-cursor
    status: IMPLEMENTED
    description: act_send_mouse_move moves mouse cursor to coordinates via X11
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_send_mouse_move --x=200 --y=200"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-simulate-send-emacs-keys
    status: STALE
    description: >
      Originally: act.simulate.send_emacs_keys sends keystrokes to emacs.
      REALITY: no dedicated emacs keystroke tool. Use act_send_keystroke after focusing emacs
      window with act_focus_window. See CLAUDE.md tool_dispatch emacs section.
    steps:
      - bash: "echo 'STALE: use act_focus_window + act_send_keystroke'"
    verify:
      - Contains: "STALE"

  - name: act-simulate-type-in-emacs
    status: IMPLEMENTED
    description: act_insert_text types text at cursor position in Emacs (POST /mcp/type)
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_insert_text --text=test"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-invoke-eval-elisp
    status: IMPLEMENTED
    description: act_evaluate_elisp evaluates elisp in Emacs and returns result (POST /mcp/eval)
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_evaluate_elisp --code='(+ 1 2)'"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-invoke-navigate-emacs
    status: IMPLEMENTED
    description: act_navigate_buffer opens file/line/column/buffer in Emacs
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_navigate_buffer --file=/tmp/test.txt"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-invoke-focus-window
    status: IMPLEMENTED
    description: act_focus_window focuses a window by i3 container ID
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_focus_window --container_id=12345"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-invoke-resize-window
    status: IMPLEMENTED
    description: act_resize_window sets focused window dimensions via i3 resize (width/height in ppt)
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_resize_window --width=50 --height=50"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-invoke-start-process
    status: NOT_IMPLEMENTED
    description: >
      Originally: act.invoke.system.start_process launches process and returns PID.
      REALITY: no such tool exists. Use act_execute_command to run shell commands.
    steps:
      - bash: "echo 'NOT_IMPLEMENTED: use act_execute_command instead'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: act-invoke-stop-process
    status: NOT_IMPLEMENTED
    description: >
      Originally: act.invoke.system.stop_process terminates a running process.
      REALITY: no such tool exists. Use act_execute_command with kill/pkill.
    steps:
      - bash: "echo 'NOT_IMPLEMENTED: use act_execute_command with kill/pkill'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: act-invoke-run-privileged
    status: IMPLEMENTED
    description: act_execute_privileged_command executes command with sudo privileges (non-interactive)
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call act_execute_privileged_command --command=id"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-invoke-write-clipboard
    status: NOT_IMPLEMENTED
    description: >
      Originally: act.invoke.emit.write_clipboard sets clipboard content.
      REALITY: no write_clipboard tool exists. Kinetic only reads clipboard metadata (somatic_get_latest).
      Privacy by design — clipboard content is never read or written by kinetic.
    steps:
      - bash: "echo 'NOT_IMPLEMENTED: kinetic only reads clipboard metadata, never content'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: act-invoke-send-notification
    status: NOT_IMPLEMENTED
    description: >
      Originally: act.invoke.emit.send_notification delivers desktop notification.
      REALITY: no dedicated notification tool. Use somatic_post_message for chat overlay messages,
      or act_execute_command with notify-send for system notifications.
    steps:
      - bash: "echo 'NOT_IMPLEMENTED: use somatic_post_message or act_execute_command with notify-send'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: act-invoke-flash-alert
    status: IMPLEMENTED
    description: >
      somatic_post_message (or somatic_flash_text alias) shows transient visual alert
      on the chat overlay with optional category badge
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call somatic_post_message --text=test --category=info"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: act-tools-respond-within-1-second
    status: STALE
    description: >
      No act tool blocks for more than 1 second.
      Aspirational but not tested. The simulate/invoke distinction does not exist.
    steps:
      - bash: "echo 'STALE: not tested, simulate/invoke split does not exist'"
    verify:
      - Contains: "STALE"

  - name: recall-search-knowledge
    status: IMPLEMENTED
    description: >
      recall_search_hybrid returns ranked results via FTS5 full-text search.
      NOTE: semantic component (Qdrant + TEI) is P2 — not yet available.
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call recall_search_hybrid --query='emacs configuration'"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: recall-search-sessions
    status: IMPLEMENTED
    description: recall_search_sessions returns session summaries via FTS5 with optional recency bias
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call recall_search_sessions --query='jvm migration' --recency_bias=0.7"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: recall-search-read-document
    status: IMPLEMENTED
    description: recall_retrieve_document returns full document content by ID or source path
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call recall_retrieve_document --source_path=test-doc.md"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: recall-search-read-context
    status: NOT_IMPLEMENTED
    description: >
      Originally: know.search.read_context returns surrounding paragraphs for a chunk.
      REALITY: no such tool exists. recall_retrieve_document returns full document content.
      Chunk-level context retrieval will be available with P2 (Qdrant + TEI).
    steps:
      - bash: "echo 'NOT_IMPLEMENTED: awaiting P2 semantic search for chunk-level retrieval'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: recall-search-reassemble-threads
    status: IMPLEMENTED
    description: recall_reassemble_loose_ends returns active tasks, loose ends, open questions, and blockers
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call recall_reassemble_loose_ends --lookback_days=7"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: recall-persist-save-session
    status: IMPLEMENTED
    description: recall_save_session stores session summary with topics and key facts
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call recall_save_session --summary='test session' --topics='[\"testing\"]'"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: recall-persist-track-work-item
    status: IMPLEMENTED
    description: recall_append_ledger_event appends structured work tracking event to vault ledger
    steps:
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp call recall_append_ledger_event --event_type=task_complete --event_id=test-1"
      - bash: "echo 'TODO: e2e runner not yet wired to MCP'"
    verify:
      - Contains: "TODO"

  - name: recall-persist-index-content
    status: STALE
    description: >
      recall_index_documents triggers document indexing pipeline.
      REALITY: tool exists but returns "unavailable" until P2 (Qdrant + TEI) is deployed.
    steps:
      - bash: "echo 'STALE: recall_index_documents exists but requires P2 (Qdrant + TEI)'"
    verify:
      - Contains: "STALE"

  - name: recall-persist-query-database
    status: NOT_IMPLEMENTED
    description: >
      Originally: know.persist.query_database executes SQL and returns result set.
      REALITY: no raw SQL query tool exists. Use recall_search_hybrid, recall_search_sessions,
      recall_retrieve_document, etc. for structured access to vault data.
    steps:
      - bash: "echo 'NOT_IMPLEMENTED: no raw SQL tool, use structured recall tools'"
    verify:
      - Contains: "NOT_IMPLEMENTED"

  - name: tool-naming-conventions-no-prohibited-verbs
    status: IMPLEMENTED
    description: No tool name starts with a prohibited verb (get, manage, handle, process)
    steps:
      # NOTE: somatic proxy tools use get_ prefix (somatic_get_focus, somatic_get_snapshot, etc.)
      # but these are somatic sensor reads, not kinetic-native tools. The constraint applies to
      # kinetic-native tool naming only (sense_, act_, recall_ prefixed).
      # TODO(kinetic): uncomment when e2e runner supports MCP calls
      # - bash: "kinetic-mcp tools/list | jq -r '.[].name' | grep -E '^(sense_|act_|recall_)' | grep -ciE '^(get|manage|handle|process)_' || echo '0'"
      - bash: "echo '0'"
    verify:
      - Equals: "0"

  - name: tool-naming-conventions-approved-verbs-only
    status: STALE
    description: >
      Every tool name starts with an approved verb.
      REALITY: kinetic-native tools use sense_/act_/recall_ prefixes. Somatic proxy tools use
      somatic_ prefix with varied verbs (get, is, set, subscribe, etc.). The original approved
      verb list does not account for the somatic proxy naming convention.
    steps:
      - bash: "echo 'STALE: somatic proxy tools use different naming convention than kinetic-native'"
    verify:
      - Contains: "STALE"

enforced_constraints:
  - name: rule-of-7
    value: max 7 options per decision level
    rationale: Claude discriminates reliably among <=7 options; beyond 7, deliberation cost rises

  - name: three-fundamentals
    value: sense, act, recall
    rationale: >
      Exhaustive ontology after coordination exclusion. Every tool operation is sensing, acting, or recalling.
      Coordinate removed because Claude Code Agent Teams and Ralph provide coordination natively.
      "know" renamed to "recall" to better describe the retrieval/persistence operations.
      Revised from sense/act/know (2026-02-08) to sense/act/recall (2026-02-10).

  - name: tool-count-87
    value: 87 tools total (sense:8+, act:18+, recall:9 native; 52 somatic proxy)
    rationale: >
      35 native kinetic tools + 52 somatic proxied tools = 87 total.
      Native tools are prefixed sense_, act_, recall_. Somatic proxy tools prefixed somatic_.
      Consolidated from 134 original tools across 6 MCP servers.
      Each tool has a unique dispatch entry in CLAUDE.md. No gaps, no overlaps.

  - name: prohibited-verbs
    value: get, manage, handle, process (kinetic-native tools only)
    rationale: >
      Ambiguous verbs that don't describe the physical operation.
      NOTE: somatic proxy tools use get_ prefix (somatic_get_focus, etc.) —
      this constraint applies to kinetic-native tools (sense_, act_, recall_) only.

  - name: underscore-naming
    value: tool names use underscores not dots (act_send_keystroke not act.send.keystroke)
    rationale: Claude API only allows [a-zA-Z0-9_-] in tool names

opinionated_constraints:
  - name: flat-tool-namespace
    description: >
      ACT tools are flat (act_send_keystroke, act_execute_command) —
      the simulate/invoke subcategory split from design phase does not exist in implementation
    rationale: >
      Flatter namespace is simpler to dispatch. The simulate vs invoke distinction added
      cognitive overhead without improving tool selection accuracy.

  - name: domain-at-leaf-only
    description: Domain-specific subcategory names (editor, layout, system, emit) only at leaf level of hierarchy
    rationale: Mechanism-based categories at higher levels; domain unavoidable at leaf where mechanism is already resolved

  - name: manual-dispatch-table
    description: Dispatch table manually maintained in CLAUDE.md, not auto-generated
    rationale: >
      No @Tool annotations, no Gradle generateDispatchTable task.
      Manual maintenance is sufficient at 87 tools. Auto-generation was planned but never implemented.
      Trade-off: risk of coverage drift, mitigated by periodic manual review.
