# Sensor Chaos Engineering/Fault Injection Server E2E Tests

vocabularies: [sensor, services]

metadata:
  feature: sensor
  component: core-chaos
  tags: [sensor, core]
  estimated_duration_ms: 5000

stories:
  - name: chaos-service-available
    description: Chaos engineering service is available
    steps:
      - service_active: sensor-chaos
      - sensor_get_status
    verify:
      - NotEmpty

  - name: delay-injection
    description: Artificial delays can be injected into events
    steps:
      - sensor_inject_delay
      - sensor_get_timing
    verify:
      - Contains: "injected_delay"

  - name: event-drop-injection
    description: Events can be dropped for testing
    steps:
      - sensor_inject_drop
      - sensor_get_anomalies
    verify:
      - Contains: "dropped"

  - name: chaos-policy-configuration
    description: Chaos policies can be configured
    steps:
      - bash: "sensor-cli chaos --set-policy drop_rate=0.1 --json"
      - sensor_get_policy
    verify:
      - Contains: "drop_rate"

  - name: chaos-reset
    description: Chaos state can be reset
    steps:
      - sensor_inject_delay
      - bash: "sensor-cli chaos --reset"
      - sensor_get_policy
    verify:
      - NotContains: "injected"

  - name: chaos-statistics
    description: Chaos injection statistics are tracked
    steps:
      - sensor_inject_delay
      - sensor_inject_drop
      - sensor_get_stats
    verify:
      - Contains: "chaos"
      - Contains: "total_injections"
