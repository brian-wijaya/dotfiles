#!/bin/bash
# Lock screen with betterlockscreen (X11)

# Reset keyboard layout
setxkbmap -layout us

# Lock 1Password if running
if pgrep -x "1password" >/dev/null; then
    1password --lock &
fi

# Kill screensaver if running
pkill -f org.bw.screensaver 2>/dev/null

# Pause orchestrator sessions before locking
python3 -c "
import socket, json
s = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
s.connect('$HOME/.claude/orchestrator/daemon.sock')
s.sendall(json.dumps({'method':'pause_all_sessions','params':{}}).encode() + b'\n')
s.close()
" 2>/dev/null

# Lock with blurred wallpaper
betterlockscreen -l blur
