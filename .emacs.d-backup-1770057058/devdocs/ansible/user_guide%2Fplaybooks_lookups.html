<section id="lookups"> <h1 id="playbooks-lookups">Lookups</h1> <p>Lookup plugins retrieve data from outside sources such as files, databases, key/value stores, APIs, and other services. Like all templating, lookups execute and are evaluated on the Ansible control machine. Ansible makes the data returned by a lookup plugin available using the standard templating system. Before Ansible 2.5, lookups were mostly used indirectly in <code>with_&lt;lookup&gt;</code> constructs for looping. Starting with Ansible 2.5, lookups are used more explicitly as part of Jinja2 expressions fed into the <code>loop</code> keyword.</p> <section id="the-lookup-function"> <h2 id="lookups-and-variables">The lookup function</h2> <p>You can use the <code>lookup</code> function to populate variables dynamically. Ansible evaluates the value each time it is executed in a task (or template).</p> <pre data-language="yaml+jinja">vars:
  motd_value: "{{ lookup('file', '/etc/motd') }}"
tasks:
  - debug:
      msg: "motd value is {{ motd_value }}"
</pre> <p>The first argument to the <code>lookup</code> function is required and specifies the name of the lookup plugin. If the lookup plugin is in a collection, the fully qualified name must be provided, since the <a class="reference internal" href="../collections_guide/collections_using_playbooks#collections-keyword"><span class="std std-ref">collections keyword</span></a> does not apply to lookup plugins.</p> <p>The <code>lookup</code> function also accepts an optional boolean keyword <code>wantlist</code>, which defaults to <code>False</code>. When <code>True</code>, the result of the lookup is ensured to be a list.</p> <p>Refer to the lookup pluginâ€™s documentation to see plugin-specific arguments and keywords.</p> </section> <section id="the-query-q-function"> <h2 id="lookups-and-variables-query">The query/q function</h2> <p>This function is shorthand for <code>lookup(..., wantlist=True)</code>. These are equivalent:</p> <pre data-language="yaml+jinja">block:
  - debug:
      msg: "{{ item }}"
    loop: "{{ lookup('ns.col.lookup_items', wantlist=True) }}"

  - debug:
      msg: "{{ item }}"
    loop: "{{ q('ns.col.lookup_items') }}"
</pre> <p>For more details and a list of lookup plugins in ansible-core, see <a class="reference internal" href="../plugins/plugins#plugins-lookup"><span class="std std-ref">Working with plugins</span></a>. You may also find lookup plugins in collections. You can review a list of lookup plugins installed on your control machine with the command <code>ansible-doc -l -t lookup</code>.</p> <div class="admonition seealso"> <p class="admonition-title">See also</p> <dl class="simple"> <dt><a class="reference internal" href="playbooks#working-with-playbooks"><span class="std std-ref">Working with playbooks</span></a></dt>
<dd>
<p>An introduction to playbooks</p> </dd> <dt><a class="reference internal" href="playbooks_conditionals#playbooks-conditionals"><span class="std std-ref">Conditionals</span></a></dt>
<dd>
<p>Conditional statements in playbooks</p> </dd> <dt><a class="reference internal" href="playbooks_variables#playbooks-variables"><span class="std std-ref">Using variables</span></a></dt>
<dd>
<p>All about variables</p> </dd> <dt><a class="reference internal" href="playbooks_loops#playbooks-loops"><span class="std std-ref">Loops</span></a></dt>
<dd>
<p>Looping in playbooks</p> </dd> <dt><a class="reference internal" href="https://docs.ansible.com/ansible/latest/community/communication.html#communication"><span class="std std-ref">Communication</span></a></dt>
<dd>
<p>Got questions? Need help? Want to share your ideas? Visit the Ansible communication guide</p> </dd> </dl> </div> </section> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2025 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_lookups.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/user_guide/playbooks_lookups.html</a>
  </p>
</div>
