<section id="working-with-playbooks"> <h1 id="id1">Working with playbooks</h1> <p>Playbooks record and execute Ansible’s configuration, deployment, and orchestration functions. They can describe a policy you want your remote systems to enforce, or a set of steps in a general IT process.</p> <p>If Ansible modules are the tools in your workshop, playbooks are your instruction manuals, and your inventory of hosts is your raw material.</p> <p>At a basic level, playbooks can be used to manage configurations of and deployments to remote machines. At a more advanced level, they can sequence multi-tier rollouts involving rolling updates and can delegate actions to other hosts, interacting with monitoring servers and load balancers along the way.</p> <p>Playbooks are designed to be human-readable and are developed in a basic text language. There are multiple ways to organize playbooks and the files they include, and we’ll offer up some suggestions on that and making the most out of Ansible.</p>  <ul> <li class="toctree-l1">
<a class="reference internal" href="playbooks_templating">Templating (Jinja2)</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_templating#jinja2-example">Jinja2 Example</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_filters">Using filters to manipulate data</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#handling-undefined-variables">Handling undefined variables</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#defining-different-values-for-true-false-null-ternary">Defining different values for true/false/null (ternary)</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#managing-data-types">Managing data types</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#formatting-data-yaml-and-json">Formatting data: YAML and JSON</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#combining-and-selecting-data">Combining and selecting data</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#randomizing-data">Randomizing data</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#managing-list-variables">Managing list variables</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#selecting-from-sets-or-lists-set-theory">Selecting from sets or lists (set theory)</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#calculating-numbers-math">Calculating numbers (math)</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#managing-network-interactions">Managing network interactions</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#hashing-and-encrypting-strings-and-passwords">Hashing and encrypting strings and passwords</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#manipulating-text">Manipulating text</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#manipulating-strings">Manipulating strings</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#managing-uuids">Managing UUIDs</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#handling-dates-and-times">Handling dates and times</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_filters#getting-kubernetes-resource-names">Getting Kubernetes resource names</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_tests">Tests</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#test-syntax">Test syntax</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#testing-strings">Testing strings</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#vault">Vault</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#testing-truthiness">Testing truthiness</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#comparing-versions">Comparing versions</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#set-theory-tests">Set theory tests</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#testing-if-a-list-contains-a-value">Testing if a list contains a value</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#testing-if-a-list-value-is-true">Testing if a list value is True</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#testing-paths">Testing paths</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#testing-size-formats">Testing size formats</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#testing-task-results">Testing task results</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_tests#type-tests">Type Tests</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_lookups">Lookups</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_lookups#the-lookup-function">The lookup function</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_lookups#the-query-q-function">The query/q function</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_python_version">Python3 in templates</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_python_version#dictionary-views">Dictionary views</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_python_version#dict-iteritems">dict.iteritems()</a></li> </ul> </li> <li class="toctree-l1"><a class="reference internal" href="playbooks_templating_now">The now function: get the current time</a></li> <li class="toctree-l1"><a class="reference internal" href="playbooks_templating_undef">The undef function: add hint for undefined variables</a></li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_loops">Loops</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_loops#comparing-loops">Comparing loops</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_loops#using-loops">Using loops</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_loops#ensuring-list-input-for-loop-using-query-rather-than-lookup">Ensuring list input for <code>loop</code>: using <code>query</code> rather than <code>lookup</code></a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_loops#adding-controls-to-loops">Adding controls to loops</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_loops#nested-loops">Nested Loops</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_loops#migrating-from-with-x-to-loop">Migrating from with_X to loop</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_delegation">Controlling where tasks run: delegation and local actions</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_delegation#tasks-that-cannot-be-delegated">Tasks that cannot be delegated</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_delegation#delegating-tasks">Delegating tasks</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_delegation#templating-in-delegation-context">Templating in delegation context</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_delegation#delegation-and-parallel-execution">Delegation and parallel execution</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_delegation#delegating-facts">Delegating facts</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_delegation#local-playbooks">Local playbooks</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_conditionals">Conditionals</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_conditionals#basic-conditionals-with-when">Basic conditionals with <code>when</code></a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_conditionals#debugging-conditionals">Debugging conditionals</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_conditionals#commonly-used-facts">Commonly-used facts</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_blocks">Blocks</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_blocks#grouping-tasks-with-blocks">Grouping tasks with blocks</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_blocks#handling-errors-with-blocks">Handling errors with blocks</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_handlers">Handlers: running operations on change</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#handler-example">Handler example</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#notifying-handlers">Notifying handlers</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#notifying-and-loops">Notifying and loops</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#naming-handlers">Naming handlers</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#handler-insertion-order-into-the-play">Handler insertion order into the play</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#controlling-when-handlers-run">Controlling when handlers run</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#defining-when-tasks-change">Defining when tasks change</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#using-variables-with-handlers">Using variables with handlers</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#handlers-in-roles">Handlers in roles</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#includes-and-imports-in-handlers">Includes and imports in handlers</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#meta-tasks-as-handlers">Meta tasks as handlers</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_handlers#limitations">Limitations</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_error_handling">Error handling in playbooks</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling#ignoring-failed-commands">Ignoring failed commands</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling#ignoring-unreachable-host-errors">Ignoring unreachable host errors</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling#resetting-unreachable-hosts">Resetting unreachable hosts</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling#handlers-and-failure">Handlers and failure</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling#defining-failure">Defining failure</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling#defining-changed">Defining “changed”</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling#ensuring-success-for-command-and-shell">Ensuring success for command and shell</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling#aborting-a-play-on-all-hosts">Aborting a play on all hosts</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_error_handling#controlling-errors-in-blocks">Controlling errors in blocks</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_environment">Setting the remote environment</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_environment#setting-the-remote-environment-in-a-task">Setting the remote environment in a task</a></li> </ul> </li> <li class="toctree-l1"><a class="reference internal" href="playbooks_environment#working-with-language-specific-version-managers">Working with language-specific version managers</a></li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_reuse">Reusing Ansible artifacts</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse#creating-reusable-files-and-roles">Creating reusable files and roles</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse#reusing-playbooks">Reusing playbooks</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse#when-to-turn-a-playbook-into-a-role">When to turn a playbook into a role</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse#reusing-files-and-roles">Reusing files and roles</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse#reusing-tasks-as-handlers">Reusing tasks as handlers</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_reuse_roles">Roles</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse_roles#role-directory-structure">Role directory structure</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse_roles#storing-and-finding-roles">Storing and finding roles</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse_roles#using-roles">Using roles</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse_roles#role-argument-validation">Role argument validation</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse_roles#running-a-role-multiple-times-in-one-play">Running a role multiple times in one play</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse_roles#using-role-dependencies">Using role dependencies</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse_roles#embedding-modules-and-plugins-in-roles">Embedding modules and plugins in roles</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_reuse_roles#sharing-roles-ansible-galaxy">Sharing roles: Ansible Galaxy</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_module_defaults">Module defaults</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_module_defaults#module-defaults-groups">Module defaults groups</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_prompts">Interactive input: prompts</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_prompts#hashing-values-supplied-by-vars-prompt">Hashing values supplied by <code>vars_prompt</code></a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_prompts#allowing-special-characters-in-vars-prompt-values">Allowing special characters in <code>vars_prompt</code> values</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_variables">Using variables</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#creating-valid-variable-names">Creating valid variable names</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#simple-variables">Simple variables</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#when-to-quote-variables-a-yaml-gotcha">When to quote variables (a YAML gotcha)</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#list-variables">List variables</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#dictionary-variables">Dictionary variables</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#combining-variables">Combining variables</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#registering-variables">Registering variables</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#referencing-nested-variables">Referencing nested variables</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#transforming-variables-with-jinja2-filters">Transforming variables with Jinja2 filters</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#where-to-set-variables">Where to set variables</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#variable-precedence-where-should-i-put-a-variable">Variable precedence: where should I put a variable?</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_variables#using-advanced-variable-syntax">Using advanced variable syntax</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="playbooks_vars_facts">Discovering variables: facts and magic variables</a><ul> <li class="toctree-l2"><a class="reference internal" href="playbooks_vars_facts#ansible-facts">Ansible facts</a></li> <li class="toctree-l2"><a class="reference internal" href="playbooks_vars_facts#information-about-ansible-magic-variables">Information about Ansible: magic variables</a></li> </ul> </li> <li class="toctree-l1">
<a class="reference internal" href="guide_rolling_upgrade">Playbook Example: Continuous Delivery and Rolling Upgrades</a><ul> <li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade#what-is-continuous-delivery">What is continuous delivery?</a></li> <li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade#site-deployment">Site deployment</a></li> <li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade#reusable-content-roles">Reusable content: roles</a></li> <li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade#configuration-group-variables">Configuration: group variables</a></li> <li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade#the-rolling-upgrade">The rolling upgrade</a></li> <li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade#managing-other-load-balancers">Managing other load balancers</a></li> <li class="toctree-l2"><a class="reference internal" href="guide_rolling_upgrade#continuous-delivery-end-to-end">Continuous delivery end-to-end</a></li> </ul> </li> </ul>  </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2012&ndash;2018 Michael DeHaan<br>&copy; 2018&ndash;2025 Red Hat, Inc.<br>Licensed under the GNU General Public License version 3.<br>
    <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks.html" class="_attribution-link">https://docs.ansible.com/ansible/latest/user_guide/playbooks.html</a>
  </p>
</div>
