<h1>Identity provider integration with FedCM</h1>    <p>This article details all the steps an <a href="https://developer.mozilla.org/en-US/docs/Glossary/Identity_provider">identity provider</a> (IdP) needs to take to integrate with the Federated Credential Management (FedCM) API.</p>     <mdn-survey></mdn-survey>  <h2 id="idp_integration_steps" class="heading">IdP integration steps</h2> <p>To integrate with FedCM, an IdP needs to do the following:</p> <ol> <li>
<a href="#provide_a_well-known_file">Provide a well-known file</a> to identify the IdP.</li> <li>
<a href="#provide_a_config_file_and_endpoints">Provide a config file and endpoints</a> for accounts list and assertion issuance (and optionally, client metadata).</li> <li>
<a href="#update_login_status_using_the_login_status_api">Update its login status</a> using the Login Status API.</li> </ol>  <h2 id="provide_a_well-known_file" class="heading">Provide a well-known file</h2> <p>There is a potential privacy issue whereby an <a href="https://github.com/w3c-fedid/FedCM/issues/230" target="_blank">IdP is able to discern whether a user visited a relying party (RP) without explicit consent</a>. This has tracking implications, so an IdP is required to provide a well-known file to verify its identity and mitigate this issue.</p> <p>The well-known file is requested via an uncredentialed <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Methods/GET"><code>GET</code></a> request, which doesn't follow redirects. This effectively prevents the IdP from learning who made the request and which <a href="https://developer.mozilla.org/en-US/docs/Glossary/Relying_party">RP</a> is attempting to connect.</p> <p>The well-known file must be served from the <a href="https://web.dev/articles/same-site-same-origin#site" target="_blank">eTLD+1</a> of the IdP at <code>/.well-known/web-identity</code>. For example, if the IdP endpoints are served under <code>https://accounts.idp.example/</code>, they must serve a well-known file at <code>https://idp.example/.well-known/web-identity</code>. The well-known file's content should have the following JSON structure:</p> <div class="code-example"><pre data-language="json">{
  "provider_urls": ["https://accounts.idp.example/config.json"]
}
</pre></div> <p>The <code>provider_urls</code> member should contain an array of URLs pointing to valid IdP config files that can be used by RPs to interact with the IdP. The array length is currently limited to one.</p>  <h2 id="the_sec-fetch-dest_http_header" class="heading">The <code>Sec-Fetch-Dest</code> HTTP header</h2> <p>All requests sent from the browser via FedCM include a <code><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Sec-Fetch-Dest"><code>Sec-Fetch-Dest</code></a>: webidentity</code> header. All IdP endpoints that receive credentialed requests (i.e., <code>accounts_endpoint</code> and <code>id_assertion_endpoint</code>) must confirm this header is included to protect against <a href="https://developer.mozilla.org/en-US/docs/Glossary/CSRF">CSRF</a> attacks.</p>  <h2 id="provide_a_config_file_and_endpoints" class="heading">Provide a config file and endpoints</h2> <p>The IdP config file provides a list of the endpoints the browser needs to process the identity federation flow and manage the sign-ins. The endpoints need to be same-origin with the config.</p> <p>The browser makes an uncredentialed request for the config file via the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Methods/GET"><code>GET</code></a> method, which doesn't follow redirects. This effectively prevents the IdP from learning who made the request and which RP is attempting to connect.</p> <p>The config file (hosted at <code>https://accounts.idp.example/config.json</code> in our example) should have the following JSON structure:</p> <div class="code-example"><pre data-language="json">{
  "accounts_endpoint": "/accounts.php",
  "account_label": "developer",
  "supports_use_other_account": true,
  "client_metadata_endpoint": "/client_metadata.php",
  "disconnect_endpoint": "/disconnect.php",
  "id_assertion_endpoint": "/assertion.php",
  "login_url": "/login",
  "branding": {
    "background_color": "green",
    "color": "0xFFEEAA",
    "icons": [
      {
        "url": "https://idp.example/icon.ico",
        "size": 25
      }
    ]
  }
}
</pre></div> <p>The properties are as follows:</p> <dl> <dt id="accounts_endpoint"><a href="#accounts_endpoint"><code>accounts_endpoint</code></a></dt> <dd> <p>The URL for the accounts list endpoint, which returns a list of accounts that the user is currently signed in to on the IdP. The browser uses these to create a list of sign-in choices to show to the user in the browser-provided FedCM UI.</p> </dd> <dt id="account_label"><a href="#account_label"><code>account_label</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>A string that, if included, specifies an identifier for a subset of accounts that should be returned when this IdP is used for federated authentication. When a <code>get()</code> request is made, only accounts matching this string in their <code>label_hints</code> parameters will be returned from the <a href="#the_accounts_list_endpoint">accounts endpoint</a>.</p> </dd> <dt id="supports_use_other_account"><a href="#supports_use_other_account"><code>supports_use_other_account</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>A boolean that defaults to <code>false</code>; if set to <code>true</code>, it means that users can sign in with an account different from the one they're currently logged in with (if the IdP supports multiple accounts). This only applies to <code>get()</code> calls that specify <a href="../identitycredentialrequestoptions#active">active mode</a>.</p> <div class="notecard note"> <p><strong>Note:</strong> In the browser sign-in UI, this will likely manifest as some kind of "Choose other account" button.</p> </div> </dd> <dt id="client_metadata_endpoint"><a href="#client_metadata_endpoint"><code>client_metadata_endpoint</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>The URL for the client metadata endpoint, which provides URLs pointing to the RP's metadata and terms of service pages, to be used in the FedCM UI.</p> </dd> <dt id="disconnect_endpoint"><a href="#disconnect_endpoint"><code>disconnect_endpoint</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>The URL for the disconnect endpoint, which is used by the RP to disconnect from the IdP, via the <a href="../identitycredential/disconnect_static"><code>IdentityCredential.disconnect()</code></a> method.</p> </dd> <dt id="id_assertion_endpoint"><a href="#id_assertion_endpoint"><code>id_assertion_endpoint</code></a></dt> <dd> <p>The URL for the ID assertion endpoint, which when sent valid user credentials should respond with a validation token that the RP can use to validate the authentication.</p> </dd> <dt id="login_url"><a href="#login_url"><code>login_url</code></a></dt> <dd> <p>The login page URL for the user to sign into the IdP.</p> </dd> <dt id="branding"><a href="#branding"><code>branding</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>Contains branding information that will be used in the browser-supplied FedCM UI to customize its appearance as desired by the IdP. The provided icon size must be greater than or equal to <code>25</code> (<code>25px</code>) in passive mode and greater than or equal to <code>40</code> (<code>40px</code>) in active mode (see <a href="rp_sign-in#active_versus_passive_mode">Active versus passive mode</a> for more details).</p> </dd> </dl> <p>The following table summarizes the different requests made by the FedCM API:</p> <figure class="table-container"><div class="_table"><table> <thead> <tr> <th>Endpoint/resource</th> <th>Method</th> <th>Credentialed (with cookies)</th> <th>Includes <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Origin"><code>Origin</code></a>
</th> </tr> </thead> <tbody> <tr> <td>
<code>well-known</code>/<code>config.json</code>
</td> <td><code>GET</code></td> <td>No</td> <td>No</td> </tr> <tr> <td><code>accounts_endpoint</code></td> <td><code>GET</code></td> <td>Yes</td> <td>No</td> </tr> <tr> <td><code>client_metadata_endpoint</code></td> <td><code>GET</code></td> <td>No</td> <td>Yes</td> </tr> <tr> <td><code>disconnect_endpoint</code></td> <td><code>POST</code></td> <td>Yes</td> <td>Yes</td> </tr> <tr> <td><code>id_assertion_endpoint</code></td> <td><code>POST</code></td> <td>Yes</td> <td>Yes</td> </tr> </tbody> </table></div></figure> <div class="notecard note"> <p><strong>Note:</strong> For a description of the FedCM flow in which these endpoints are accessed, see <a href="rp_sign-in#fedcm_sign-in_flow">FedCM sign-in flow</a>.</p> </div> <div class="notecard note"> <p><strong>Note:</strong> None of the requests made by the FedCM API to the endpoints detailed here allow for following redirects, for privacy purposes.</p> </div>  <h3 id="the_accounts_list_endpoint" class="heading">The accounts list endpoint</h3> <p>The browser sends credentialed requests (i.e., with a cookie that identifies the user that is signed in) to this endpoint via the <code>GET</code> method. The request has no <code>client_id</code> parameter, <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Origin"><code>Origin</code></a> header, or <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Referer"><code>Referer</code></a> header. This effectively prevents the IdP from learning which RP the user is trying to sign in to. The list of accounts returned is RP-agnostic.</p> <p>For example:</p> <div class="code-example"><pre data-language="http">GET /accounts.php HTTP/1.1
Host: idp.example
Accept: application/json
Cookie: 0x23223
Sec-Fetch-Dest: webidentity
</pre></div> <p>The response to a successful request returns a list of all the IdP accounts that the user is currently signed in with (not specific to any particular RP), with a JSON structure that matches the following:</p> <div class="code-example"><pre data-language="json">{
  "accounts": [
    {
      "id": "elaina_maduro",
      "given_name": "Elaina",
      "name": "Elaina Maduro",
      "email": "elaina_maduro@idp.example",
      "tel": "+491234567890",
      "username": "elaina420",
      "picture": "https://idp.example/profile/123",
      "approved_clients": ["123", "456", "789"],
      "domain_hints": ["rp1.example.com", "rp3.example.com"],
      "label_hints": ["developer", "admin"],
      "login_hints": ["elaina_maduro", "elaina_maduro@idp.example"]
    },
    {
      "id": "elly",
      "given_name": "Elly",
      "username": "elly123",
      "email": "Elly@idp.example",
      "picture": "https://idp.example/profile/456",
      "approved_clients": ["abc", "def", "ghi"],
      "domain_hints": ["rp1.example.com", "rp2.example.com"],
      "label_hints": ["developer", "test"],
      "login_hints": ["elly", "elly@idp.example"]
    }
  ]
}
</pre></div> <p>This includes the following information where <code>name</code>, <code>email</code>, <code>username</code>, and <code>tel</code> are optional but at least one of them must be present and nonempty.</p> <dl> <dt id="id"><a href="#id"><code>id</code></a></dt> <dd> <p>The unique ID of the user.</p> </dd> <dt id="name"><a href="#name"><code>name</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>The family name of the user.</p> </dd> <dt id="email"><a href="#email"><code>email</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>The email address of the user.</p> </dd> <dt id="tel"><a href="#tel"><code>tel</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>The telephone number of the user. Can be in any format.</p> </dd> <dt id="username"><a href="#username"><code>username</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>The username of the user.</p> </dd> <dt id="given_name"><a href="#given_name"><code>given_name</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>The given name of the user.</p> </dd> <dt id="picture"><a href="#picture"><code>picture</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>The URL of the user's avatar image.</p> </dd> <dt id="approved_clients"><a href="#approved_clients"><code>approved_clients</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>An array of RP clients that the user has registered with.</p> </dd> <dt id="domain_hints"><a href="#domain_hints"><code>domain_hints</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>An array of domains the account is associated with. The RP can make a <code>get()</code> call that includes a <a href="../identitycredentialrequestoptions#domainhint"><code>domainHint</code></a> property to filter the returned accounts by domain.</p> </dd> <dt id="label_hints"><a href="#label_hints"><code>label_hints</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>An array of strings specifying labels that define account types that the account is identified with. If the config file specifies an <a href="#account_label"><code>account_label</code></a>, only accounts that contain that label in their <code>label_hints</code> will be returned from the accounts list endpoint.</p> </dd> <dt id="login_hints"><a href="#login_hints"><code>login_hints</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>An array of strings representing the account. These strings are used to filter the list of account options that the browser offers for the user to sign-in. This occurs when the <code>loginHint</code> property is provided within <a href="../identitycredentialrequestoptions#providers"><code>identity.providers</code></a> in a related <code>get()</code> call. Any account with a string in its <code>login_hints</code> array that matches the provided <code>loginHint</code> is included.</p> </dd> </dl> <div class="notecard note"> <p><strong>Note:</strong> If the user is not signed in to any IdP accounts, the endpoint should respond with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Status/401">HTTP 401 (Unauthorized)</a>.</p> </div>  <h3 id="the_client_metadata_endpoint" class="heading">The client metadata endpoint</h3> <p>The browser sends uncredentialed requests to this endpoint via the <code>GET</code> method, with the <code>clientId</code> passed into the <code>get()</code> call as a parameter.</p> <p>For example:</p> <div class="code-example"><pre data-language="http">GET /client_metadata.php?client_id=1234 HTTP/1.1
Host: idp.example
Origin: https://rp.example/
Accept: application/json
Sec-Fetch-Dest: webidentity
</pre></div> <p>The response to a successful request includes URLs pointing to the RP's metadata and terms of service pages, to be used in the browser-supplied FedCM UI. This should follow the JSON structure seen below:</p> <div class="code-example"><pre data-language="json">{
  "privacy_policy_url": "https://rp.example/privacy_policy.html",
  "terms_of_service_url": "https://rp.example/terms_of_service.html"
}
</pre></div>  <h3 id="the_disconnect_endpoint" class="heading">The disconnect endpoint</h3> <p>By invoking <a href="../identitycredential/disconnect_static"><code>IdentityCredential.disconnect()</code></a>, the browser sends a cross-origin <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Methods/POST"><code>POST</code></a> request with cookies and a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Content-Type"><code>Content-Type</code></a> of <code>application/x-www-form-urlencoded</code> to the disconnect endpoint with the following information:</p> <dl> <dt id="account_hint"><a href="#account_hint"><code>account_hint</code></a></dt> <dd> <p>A string specifying an account hint that the IdP uses the identify the account to disconnect.</p> </dd> <dt id="client_id"><a href="#client_id"><code>client_id</code></a></dt> <dd> <p>A string specifying the RP's client identifier.</p> </dd> </dl> <p>For example:</p> <div class="code-example"><pre data-language="http">POST /disconnect HTTP/1.1
Host: idp.example
Origin: rp.example
Content-Type: application/x-www-form-urlencoded
Cookie: 0x123
Sec-Fetch-Dest: webidentity

account_hint=account456&amp;client_id=rp123
</pre></div> <p>Upon receiving the request, the IdP server should:</p> <ol> <li> <p>Respond to the request with <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CORS">CORS (Cross-Origin Resource Sharing)</a>.</p> </li> <li> <p>Verify that the request contains a <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Sec-Fetch-Dest"><code>Sec-Fetch-Dest</code></a> HTTP header with a directive of <code>webidentity</code>.</p> </li> <li> <p>Match the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Origin"><code>Origin</code></a> header against the RP origin determined by the <code>client_id</code>. Reject the promise if they don't match.</p> </li> <li> <p>Find the account that matches the <code>account_hint</code>.</p> </li> <li> <p>Disconnect the user account from the list of RP's connected accounts.</p> </li> <li> <p>Respond with the identified user's <code>account_id</code> in JSON format:</p> <div class="code-example"><pre data-language="json">{
  "account_id": "account456"
}
</pre></div> </li> </ol> <div class="notecard note"> <p><strong>Note:</strong> If the IdP wishes to disconnect all accounts associated with the RP, it can pass a string that does not match any <code>account_id</code>, for example <code>"account_id": "*"</code>.</p> </div>  <h3 id="the_id_assertion_endpoint" class="heading">The ID assertion endpoint</h3> <p>The browser sends credentialed requests to this endpoint via the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Methods/POST"><code>POST</code></a> method, with a content type of <code>application/x-www-form-urlencoded</code>. The request also includes a payload including details about the attempted sign-in and the account to be validated.</p> <p>It should look something like this:</p> <div class="code-example"><pre data-language="http">POST /assertion.php HTTP/1.1
Host: idp.example
Origin: https://rp.example/
Content-Type: application/x-www-form-urlencoded
Cookie: 0x23223
Sec-Fetch-Dest: webidentity
account_id=123&amp;client_id=client1234&amp;nonce=Ct60bD&amp;disclosure_text_shown=true&amp;is_auto_selected=true
</pre></div> <p>A request to this endpoint is sent as a result of the user choosing an account to sign in with from the relevant browser UI. When sent valid user credentials, this endpoint should respond with a validation token that the RP can use to validate the user on its own server, according to the usage instructions outlined by the IdP they are using for identity federation. Once the RP validates the user, they can sign them in, sign them up to their service, etc.</p> <div class="code-example"><pre data-language="json">{
  "token": "***********"
}
</pre></div> <p>The request payload contains the following params:</p> <dl> <dt id="client_id_2"><a href="#client_id_2"><code>client_id</code></a></dt> <dd> <p>The RP's client identifier (which matches the <code>clientId</code> from the original <code>get()</code> request).</p> </dd> <dt id="account_id"><a href="#account_id"><code>account_id</code></a></dt> <dd> <p>The unique ID of the user account to be signed in (which matches the user's <code>id</code> from the accounts list endpoint response).</p> </dd> <dt id="nonce"><a href="#nonce"><code>nonce</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>The request nonce, provided by the RP.</p> </dd> <dt id="disclosure_text_shown"><a href="#disclosure_text_shown"><code>disclosure_text_shown</code></a></dt> <dd> <p>A string of <code>"true"</code> or <code>"false"</code> indicating whether the disclosure text was shown or not. The disclosure text is the information shown to the user (which can include the terms of service and privacy policy links, if provided) if the user is signed in to the IdP but doesn't have an account specifically on the current RP (in which case they'd need to choose to "Continue as..." their IdP identity and then create a corresponding account on the RP).</p> </dd> <dt id="is_auto_selected"><a href="#is_auto_selected"><code>is_auto_selected</code></a></dt> <dd> <p>A string of <code>"true"</code> or <code>"false"</code> indicating whether the authentication validation request has been issued as a result of <a href="rp_sign-in#auto-reauthentication">auto-reauthentication</a>, i.e., without user mediation. This can occur when the <a href="../credentialscontainer/get"><code>get()</code></a> call is issued with a <a href="../credentialscontainer/get#mediation"><code>mediation</code></a> option value of <code>"optional"</code> or <code>"silent"</code>. It is useful for the IdP to know whether auto reauthentication occurred for performance evaluation and in case higher security is desired. For example, the IdP could return an error code telling the RP that it requires explicit user mediation (<code>mediation="required"</code>).</p> </dd> </dl> <div class="notecard note"> <p><strong>Note:</strong> If the <a href="../credentialscontainer/get"><code>get()</code></a> call succeeds, the <code>is_auto_selected</code> value is also communicated to the RP via the <a href="../identitycredential/isautoselected"><code>IdentityCredential.isAutoSelected</code></a> property.</p> </div> <h4 id="cors_headers_for_the_id_assertion_endpoint">CORS headers for the ID assertion endpoint</h4> <p>The ID assertion endpoint response must include the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Access-Control-Allow-Origin"><code>Access-Control-Allow-Origin</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Access-Control-Allow-Credentials"><code>Access-Control-Allow-Credentials</code></a> headers, and the <code>Access-Control-Allow-Origin</code> must include the requester's origin:</p> <div class="code-example"><pre data-language="http">Access-Control-Allow-Origin: https://rp.example
Access-Control-Allow-Credentials: true
</pre></div> <p>Note that the <code>Access-Control-Allow-Origin</code> must be set to the specific origin of the requester (the RP) and cannot be the wildcard value <code>*</code>.</p> <p>Without these headers, the request will fail with a network error.</p> <h4 id="id_assertion_error_responses">ID assertion error responses</h4> <p>If the IdP cannot issue a token — for example if the client is unauthorized — the ID assertion endpoint will respond with an error response containing information about the nature of the error. For example:</p> <div class="code-example"><pre data-language="json">{
  "error": {
    "code": "access_denied",
    "url": "https://idp.example/error?type=access_denied"
  }
}
</pre></div> <p>The error response fields are as follows:</p> <dl> <dt id="code"><a href="#code"><code>code</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>A string. This can be either a known error from the <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-4.1.2.1" target="_blank">OAuth 2.0 specified error list</a> or an arbitrary string.</p> </dd> <dt id="url"><a href="#url"><code>url</code> <span class="badge inline optional">Optional</span></a></dt> <dd> <p>A URL. This should be a web page containing human-readable information about the error to display to users, such as how to fix the error or contact customer service. The URL must be same-site with the IdP's config URL.</p> </dd> </dl> <p>This information can be used in a couple of different ways:</p> <ul> <li>The browser can display a custom UI to the user informing them of what went wrong (see the <a href="https://privacysandbox.google.com/blog/fedcm-chrome-120-updates#error-api" target="_blank">Chrome documentation</a> for an example). Bear in mind that if the request failed because the IdP server is unavailable, it obviously can't return any information. In such cases, the browser will report this via a generic message.</li> <li>The associated RP <a href="../credentialscontainer/get"><code>navigator.credentials.get()</code></a> call used to attempt sign-in will reject its promise with an <a href="../identitycredentialerror"><code>IdentityCredentialError</code></a>, which contains the error information. An RP can catch this error and then follow up the browser's custom UI with some information to help the user succeed in a future sign-in attempt.</li> </ul>  <h2 id="update_login_status_using_the_login_status_api" class="heading">Update login status using the Login Status API</h2> <p>The <strong>Login Status API</strong> allows an IdP to inform a browser of its login (sign-in) status in that particular browser — by this, we mean "whether any users are logged into the IdP on the current browser or not". The browser stores this state for each IdP; the FedCM API then uses it to reduce the number of requests it makes to the IdP (because it does not need to waste time requesting accounts when there are no users logged in to the IdP). It also mitigates <a href="https://github.com/w3c-fedid/FedCM/issues/447" target="_blank">potential timing attacks</a>.</p> <p>For each known IdP (identified by its config URL) the browser keeps a tri-state variable representing the login state with three possible values:</p> <ul> <li>
<code>"logged-in"</code>: The IdP has at least one user account signed in. Note that, at this stage, the RP and browser don't know which user that is. Information on specific users is returned from the IdP's <a href="#the_accounts_list_endpoint"><code>accounts_endpoint</code></a> at a later point in the FedCM flow.</li> <li>
<code>"logged-out"</code>: All IdP accounts are currently signed out.</li> <li>
<code>"unknown"</code>: The sign-in status of this IdP is not known. This is the default value.</li> </ul>  <h3 id="setting_login_status" class="heading">Setting login status</h3> <p>The IdP should update its login status when a user signs into or out of the IdP. This can be done in two different ways:</p> <ul> <li> <p>The <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Reference/Headers/Set-Login"><code>Set-Login</code></a> HTTP response header can be set in a top-level navigation or a same-origin subresource request:</p> <div class="code-example"><pre data-language="http">Set-Login: logged-in

Set-Login: logged-out
</pre></div> </li> <li> <p>The <a href="../navigatorlogin/setstatus"><code>Navigator.login.setStatus()</code></a> method can be called from the IdP origin:</p> <div class="code-example"><pre data-language="js">/* Set logged-in status */
navigator.login.setStatus("logged-in");

/* Set logged-out status */
navigator.login.setStatus("logged-out");
</pre></div> </li> </ul>  <h3 id="how_login_status_affects_federated_sign-in_flow" class="heading">How login status affects federated sign-in flow</h3> <p>When an <a href="rp_sign-in">RP attempts federated sign-in</a>, the login status is checked:</p> <ul> <li>If an IdP's login status is <code>"logged-in"</code>, a request is made to the <a href="#the_accounts_list_endpoint">accounts list endpoint</a> and available accounts for sign-in are displayed to the user in the browser-provided FedCM dialog.</li> <li>If all IdPs' login statuses are <code>"logged-out"</code>, the promise returned by the FedCM <code>get()</code> request rejects without making a request to the accounts list endpoint. In such a case, it is up to the developer to handle the flow, for example by prompting the user to go and sign in to a suitable IdP.</li> <li>If an IdP's login status is <code>"unknown"</code>, a request is made to the accounts list endpoint and the login status is updated depending on the response: <ul> <li>If the endpoint returns a list of available accounts for sign-in, update the status to <code>"logged-in"</code> and display the sign-in options to the user in the browser-provided FedCM dialog.</li> <li>If the endpoint returns no accounts, update the status to <code>"logged-out"</code>; the promise returned by the FedCM <code>get()</code> request will reject if no other <code>logged-in</code> IdPs are available.</li> </ul> </li> </ul>  <h3 id="what_if_the_browser_and_the_idp_login_status_become_out_of_sync" class="heading">What if the browser and the IdP login status become out of sync?</h3> <p>Despite the Login Status API informing the browser of IdP login status, it is possible for the browser and an IdP to become out of sync. For example, the IdP sessions might expire, meaning that all user accounts end up signed out but the login status is still set to <code>"logged-in"</code> (the application was not able to set the login status to <code>"logged-out"</code>). In such a case, when federated sign-in is attempted, a request will be made to the IdP's accounts list endpoint but no available accounts will be returned because the session is no longer available.</p> <p>When this occurs, the browser can dynamically let a user sign into an IdP by opening the IdP's sign-in page in a dialog (the sign-in URL is found in the IdP's <a href="#provide_a_config_file_and_endpoints">config file</a> <code>login_url</code>). The exact nature of this flow is up to the browser; for example, <a href="https://privacysandbox.google.com/blog/fedcm-chrome-120-updates#what_if_the_user_session_expires_let_the_user_sign_in_through_a_dynamic_login_flow" target="_blank">Chrome handles it like this</a>.</p> <p>Once the user is signed in to the IdP, the IdP should:</p> <ul> <li>Inform the browser that the user has signed in by <a href="#setting_login_status">setting login status</a> to <code>"logged-in"</code>.</li> <li>Close the sign-in dialog by calling the <a href="../identityprovider/close_static"><code>IdentityProvider.close()</code></a> method.</li> </ul>  <h2 id="see_also" class="heading">See also</h2> <ul> <li>
<a href="https://privacysandbox.google.com/cookies/fedcm" target="_blank">Federated Credential Management API</a> on privacysandbox.google.com (2023)</li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2025 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/FedCM_API/IDP_integration" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/FedCM_API/IDP_integration</a>
  </p>
</div>
