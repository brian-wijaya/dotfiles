<h1>Insertable Streams for MediaStreamTrack API</h1> <details class="baseline-indicator not" data-glean-toggle-open="baseline_toggle_open"> <summary>  <div class="status-title"> <span class="not-bold">Limited availability</span> </div>    </summary> <div class="extra"> <p>This feature is not Baseline because it does not work in some of the most widely-used browsers.</p>  <ul> <li> <a href="https://developer.mozilla.org/en-US/docs/Glossary/Baseline/Compatibility" data-glean-id="baseline_link_learn_more" target="_blank" class="learn-more"> Learn more </a> </li> <li> <a href="#browser_compatibility" data-glean-id="baseline_link_bcd_table"> See full compatibility </a> </li> <li> <a href="https://survey.alchemer.com/s3/7634825/MDN-baseline-feedback?page=%2Fen-US%2Fdocs%2FWeb%2FAPI%2FInsertable_Streams_for_MediaStreamTrack_API&amp;level=not" data-glean-id="baseline_link_feedback" class="feedback-link" target="_blank" rel="noreferrer"> Report feedback </a> </li> </ul> </div> </details>   <div class="notecard experimental"><p><strong>Experimental:</strong> <strong>This is an <a href="https://developer.mozilla.org/en-US/docs/MDN/Writing_guidelines/Experimental_deprecated_obsolete#experimental">experimental technology</a></strong><br>Check the <a href="#browser_compatibility">Browser compatibility table</a> carefully before using this in production.</p></div> <div class="notecard note"><p><strong>Note:</strong> This feature is only available in <a href="dedicatedworkerglobalscope">Dedicated Web Workers</a>.</p></div> <p>The <strong>Insertable Streams for MediaStreamTrack API</strong> provides a way to process the video frames of a <a href="mediastreamtrack"><code>MediaStreamTrack</code></a> as they are consumed.</p>     <mdn-survey></mdn-survey>  <h2 id="concepts_and_usage" class="heading">Concepts and Usage</h2> <p>When processing real-time video, you sometimes want to insert visual elements or otherwise process the stream of video frames. For example, an application might include two tracks that need to be combined, such as a weather map and video of a presenter explaining the map. Or, you may want to do processing on a track to blur backgrounds, or introduce other elements (such as adding funny hats to people, and so on). The APIs described here provide direct access to the video stream, allowing you to manipulate it in real time.</p> <p>To ensure optimal performance, the APIs are only available in <a href="dedicatedworkerglobalscope">dedicated workers</a> (unless otherwise stated).</p>  <h2 id="interfaces" class="heading">Interfaces</h2> <dl> <dt id="mediastreamtrackprocessor">
<a href="mediastreamtrackprocessor"><code>MediaStreamTrackProcessor</code></a> <abbr class="icon icon-experimental" title="Experimental. Expect behavior to change in the future."> <span class="visually-hidden">Experimental</span> </abbr>
</dt> <dd> <p>Consumes a <a href="mediastreamtrack"><code>MediaStreamTrack</code></a> object's source and produces a stream of video frames.</p> </dd> <dt id="videotrackgenerator">
<a href="videotrackgenerator"><code>VideoTrackGenerator</code></a> <abbr class="icon icon-experimental" title="Experimental. Expect behavior to change in the future."> <span class="visually-hidden">Experimental</span> </abbr>
</dt> <dd> <p>Creates a <a href="writablestream"><code>WritableStream</code></a> that acts as a <a href="mediastreamtrack"><code>MediaStreamTrack</code></a> video source.</p> </dd> <dt id="mediastreamtrackgenerator">
<a href="mediastreamtrackgenerator"><code>MediaStreamTrackGenerator</code></a> <abbr class="icon icon-experimental" title="Experimental. Expect behavior to change in the future."> <span class="visually-hidden">Experimental</span> </abbr> <abbr class="icon icon-nonstandard" title="Non-standard. Check cross-browser support before using."> <span class="visually-hidden">Non-standard</span> </abbr>
</dt> <dd> <p>Creates a <a href="writablestream"><code>WritableStream</code></a> that acts as a <a href="mediastreamtrack"><code>MediaStreamTrack</code></a> source for either video or audio. Only available on the <a href="https://developer.mozilla.org/en-US/docs/Glossary/Main_thread">main thread</a>.</p> </dd> </dl>  <h2 id="examples" class="heading">Examples</h2> <p>The following example is from the article <a href="https://blog.mozilla.org/webrtc/unbundling-mediastreamtrackprocessor-and-videotrackgenerator/" target="_blank">Unbundling MediaStreamTrackProcessor and VideoTrackGenerator</a>. It <a href="web_workers_api/transferable_objects">transfers</a> a camera <a href="mediastreamtrack"><code>MediaStreamTrack</code></a> to a worker for processing. The worker creates a pipeline that applies a sepia tone filter to the video frames and mirrors them. The pipeline culminates in a <a href="videotrackgenerator"><code>VideoTrackGenerator</code></a> whose <a href="mediastreamtrack"><code>MediaStreamTrack</code></a> is transferred back and played. The media now flows in real time through the transform off the <a href="https://developer.mozilla.org/en-US/docs/Glossary/Main_thread">main thread</a>.</p> <div class="code-example"><pre data-language="js">const stream = await navigator.mediaDevices.getUserMedia({ video: true });
const [track] = stream.getVideoTracks();
const worker = new Worker("worker.js");
worker.postMessage({ track }, [track]);
const { data } = await new Promise((r) =&gt; (worker.onmessage = r));
video.srcObject = new MediaStream([data.track]);
</pre></div> <p>worker.js:</p> <div class="code-example"><pre data-language="js">onmessage = async ({ data: { track } }) =&gt; {
  const vtg = new VideoTrackGenerator();
  self.postMessage({ track: vtg.track }, [vtg.track]);
  const { readable } = new MediaStreamTrackProcessor({ track });
  await readable
    .pipeThrough(new TransformStream({ transform }))
    .pipeTo(vtg.writable);
};
</pre></div>  <h2 id="specifications" class="heading">Specifications</h2> <div class="_table"><table> <thead> <tr> <th scope="col">Specification</th> </tr> </thead> <tbody> <tr> <td><a href="https://w3c.github.io/mediacapture-transform/" rel="noopener" target="_blank">MediaStreamTrack Insertable Media Processing using Streams&gt;</a></td> </tr> </tbody> </table></div>  <h2 id="browser_compatibility" class="heading">Browser compatibility</h2> <div class="_table"><table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="5">Desktop</th>
<th colspan="7">Mobile</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Opera</th>
<th>Safari</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
<th>WebView Android</th>
<th>WebView on iOS</th>
</tr>
</thead>
<tbody>
<tr>
<th><code>VideoTrackGenerator</code></th>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
</tr>
<tr>
<th><code>Insertable_Streams_for_MediaStreamTrack_API</code></th>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
</tr>
<tr>
<th><code>muted</code></th>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
</tr>
<tr>
<th><code>track</code></th>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
</tr>
<tr>
<th><code>writable</code></th>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes">18</td>
</tr>
</tbody>
</table></div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2025 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/API/Insertable_Streams_for_MediaStreamTrack_API" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/API/Insertable_Streams_for_MediaStreamTrack_API</a>
  </p>
</div>
