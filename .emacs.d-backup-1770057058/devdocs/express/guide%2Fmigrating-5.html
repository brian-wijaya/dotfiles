<main> <h1 id="moving-to-express-5" data-level="10">Moving to Express 5</h1> <h2 id="overview">Overview</h2> <p>Express 5 is not very different from Express 4; although it maintains the same basic API, there are still changes that break compatibility with the previous version. Therefore, an application built with Express 4 might not work if you update it to use Express 5.</p> <p>To install this version, you need to have a Node.js version 18 or higher. Then, execute the following command in your application directory:</p> <div class="highlight"><pre class="highlight" data-language="javascript">npm install "express@5"
</pre></div> <p>You can then run your automated tests to see what fails, and fix problems according to the updates listed below. After addressing test failures, run your app to see what errors occur. You’ll find out right away if the app uses any methods or properties that are not supported.</p> <h2 id="express-5-codemods">Express 5 Codemods</h2> <p>To help you migrate your express server, we have created a set of codemods that will help you automatically update your code to the latest version of Express.</p> <p>Run the following command for run all the codemods available:</p> <div class="highlight"><pre class="highlight" data-language="javascript">npx @expressjs/codemod upgrade
</pre></div> <p>If you want to run a specific codemod, you can run the following command:</p> <div class="highlight"><pre class="highlight" data-language="javascript">npx @expressjs/codemod name-of-the-codemod
</pre></div> <p>You can find the list of available codemods <a href="https://github.com/expressjs/codemod?tab=readme-ov-file#available-codemods">here</a>.</p> <h2 id="changes">Changes in Express 5</h2> <p><strong>Removed methods and properties</strong></p> <ul class="doclist"> <li><a href="#app.del">app.del()</a></li> <li><a href="#app.param">app.param(fn)</a></li> <li><a href="#plural">Pluralized method names</a></li> <li><a href="#leading">Leading colon in name argument to app.param(name, fn)</a></li> <li><a href="#req.param">req.param(name)</a></li> <li><a href="#res.json">res.json(obj, status)</a></li> <li><a href="#res.jsonp">res.jsonp(obj, status)</a></li> <li><a href="#magic-redirect">res.redirect('back') and res.location('back')</a></li> <li><a href="#res.redirect">res.redirect(url, status)</a></li> <li><a href="#res.send.body">res.send(body, status)</a></li> <li><a href="#res.send.status">res.send(status)</a></li> <li><a href="#res.sendfile">res.sendfile()</a></li> <li><a href="#router.param">router.param(fn)</a></li> <li><a href="#express.static.mime">express.static.mime</a></li> <li><a href="#express:router-debug-logs">express:router debug logs</a></li> </ul> <p><strong>Changed</strong></p> <ul class="doclist"> <li><a href="#path-syntax">Path route matching syntax</a></li> <li><a href="#rejected-promises">Rejected promises handled from middleware and handlers</a></li> <li><a href="#express.urlencoded">express.urlencoded</a></li> <li><a href="#express.static.dotfiles">express.static dotfiles</a></li> <li><a href="#app.listen">app.listen</a></li> <li><a href="#app.router">app.router</a></li> <li><a href="#req.body">req.body</a></li> <li><a href="#req.host">req.host</a></li> <li><a href="#req.query">req.query</a></li> <li><a href="#res.clearCookie">res.clearCookie</a></li> <li><a href="#res.status">res.status</a></li> <li><a href="#res.vary">res.vary</a></li> </ul> <p><strong>Improvements</strong></p> <ul class="doclist"> <li><a href="#res.render">res.render()</a></li> <li><a href="#brotli-support">Brotli encoding support</a></li> </ul> <h2 id="removed-methods-and-properties">Removed methods and properties</h2> <p>If you use any of these methods or properties in your app, it will crash. So, you’ll need to change your app after you update to version 5.</p> <h3 id="app.del">app.del()</h3> <p>Express 5 no longer supports the <code class="language-plaintext highlighter-rouge">app.del()</code> function. If you use this function, an error is thrown. For registering HTTP DELETE routes, use the <code class="language-plaintext highlighter-rouge">app.delete()</code> function instead.</p> <p>Initially, <code class="language-plaintext highlighter-rouge">del</code> was used instead of <code class="language-plaintext highlighter-rouge">delete</code>, because <code class="language-plaintext highlighter-rouge">delete</code> is a reserved keyword in JavaScript. However, as of ECMAScript 6, <code class="language-plaintext highlighter-rouge">delete</code> and other reserved keywords can legally be used as property names.</p> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod v4-deprecated-signatures
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.del('/user/:id', (req, res) =&gt; {
  res.send(`DELETE /user/${req.params.id}`)
})

// v5
app.delete('/user/:id', (req, res) =&gt; {
  res.send(`DELETE /user/${req.params.id}`)
})
</pre></div> <h3 id="app.param">app.param(fn)</h3> <p>The <code class="language-plaintext highlighter-rouge">app.param(fn)</code> signature was used for modifying the behavior of the <code class="language-plaintext highlighter-rouge">app.param(name, fn)</code> function. It has been deprecated since v4.11.0, and Express 5 no longer supports it at all.</p> <h3 id="plural">Pluralized method names</h3> <p>The following method names have been pluralized. In Express 4, using the old methods resulted in a deprecation warning. Express 5 no longer supports them at all:</p> <p><code class="language-plaintext highlighter-rouge">req.acceptsCharset()</code> is replaced by <code class="language-plaintext highlighter-rouge">req.acceptsCharsets()</code>.</p> <p><code class="language-plaintext highlighter-rouge">req.acceptsEncoding()</code> is replaced by <code class="language-plaintext highlighter-rouge">req.acceptsEncodings()</code>.</p> <p><code class="language-plaintext highlighter-rouge">req.acceptsLanguage()</code> is replaced by <code class="language-plaintext highlighter-rouge">req.acceptsLanguages()</code>.</p> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod pluralized-methods
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.all('/', (req, res) =&gt; {
  req.acceptsCharset('utf-8')
  req.acceptsEncoding('br')
  req.acceptsLanguage('en')

  // ...
})

// v5
app.all('/', (req, res) =&gt; {
  req.acceptsCharsets('utf-8')
  req.acceptsEncodings('br')
  req.acceptsLanguages('en')

  // ...
})
</pre></div> <h3 id="leading">Leading colon (:) in the name for app.param(name, fn)</h3> <p>A leading colon character (:) in the name for the <code class="language-plaintext highlighter-rouge">app.param(name, fn)</code> function is a remnant of Express 3, and for the sake of backwards compatibility, Express 4 supported it with a deprecation notice. Express 5 will silently ignore it and use the name parameter without prefixing it with a colon.</p> <p>This should not affect your code if you follow the Express 4 documentation of <a href="https://expressjs.com/en/index.html#app.param">app.param</a>, as it makes no mention of the leading colon.</p> <h3 id="req.param">req.param(name)</h3> <p>This potentially confusing and dangerous method of retrieving form data has been removed. You will now need to specifically look for the submitted parameter name in the <code class="language-plaintext highlighter-rouge">req.params</code>, <code class="language-plaintext highlighter-rouge">req.body</code>, or <code class="language-plaintext highlighter-rouge">req.query</code> object.</p> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod req-param
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.post('/user', (req, res) =&gt; {
  const id = req.param('id')
  const body = req.param('body')
  const query = req.param('query')

  // ...
})

// v5
app.post('/user', (req, res) =&gt; {
  const id = req.params.id
  const body = req.body
  const query = req.query

  // ...
})
</pre></div> <h3 id="res.json">res.json(obj, status)</h3> <p>Express 5 no longer supports the signature <code class="language-plaintext highlighter-rouge">res.json(obj, status)</code>. Instead, set the status and then chain it to the <code class="language-plaintext highlighter-rouge">res.json()</code> method like this: <code class="language-plaintext highlighter-rouge">res.status(status).json(obj)</code>.</p> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod v4-deprecated-signatures
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.post('/user', (req, res) =&gt; {
  res.json({ name: 'Ruben' }, 201)
})

// v5
app.post('/user', (req, res) =&gt; {
  res.status(201).json({ name: 'Ruben' })
})
</pre></div> <h3 id="res.jsonp">res.jsonp(obj, status)</h3> <p>Express 5 no longer supports the signature <code class="language-plaintext highlighter-rouge">res.jsonp(obj, status)</code>. Instead, set the status and then chain it to the <code class="language-plaintext highlighter-rouge">res.jsonp()</code> method like this: <code class="language-plaintext highlighter-rouge">res.status(status).jsonp(obj)</code>.</p> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod v4-deprecated-signatures
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.post('/user', (req, res) =&gt; {
  res.jsonp({ name: 'Ruben' }, 201)
})

// v5
app.post('/user', (req, res) =&gt; {
  res.status(201).jsonp({ name: 'Ruben' })
})
</pre></div> <h3 id="res.redirect">res.redirect(url, status)</h3> <p>Express 5 no longer supports the signature <code class="language-plaintext highlighter-rouge">res.redirect(url, status)</code>. Instead, use the following signature: <code class="language-plaintext highlighter-rouge">res.redirect(status, url)</code>.</p> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod v4-deprecated-signatures
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.get('/user', (req, res) =&gt; {
  res.redirect('/users', 301)
})

// v5
app.get('/user', (req, res) =&gt; {
  res.redirect(301, '/users')
})
</pre></div> <h3 id="magic-redirect">res.redirect('back') and res.location('back')</h3> <p>Express 5 no longer supports the magic string <code class="language-plaintext highlighter-rouge">back</code> in the <code class="language-plaintext highlighter-rouge">res.redirect()</code> and <code class="language-plaintext highlighter-rouge">res.location()</code> methods. Instead, use the <code class="language-plaintext highlighter-rouge">req.get('Referrer') || '/'</code> value to redirect back to the previous page. In Express 4, the <code class="language-plaintext highlighter-rouge">res.redirect('back')</code> and <code class="language-plaintext highlighter-rouge">res.location('back')</code> methods were deprecated.</p> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod magic-redirect
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.get('/user', (req, res) =&gt; {
  res.redirect('back')
})

// v5
app.get('/user', (req, res) =&gt; {
  res.redirect(req.get('Referrer') || '/')
})
</pre></div> <h3 id="res.send.body">res.send(body, status)</h3> <p>Express 5 no longer supports the signature <code class="language-plaintext highlighter-rouge">res.send(obj, status)</code>. Instead, set the status and then chain it to the <code class="language-plaintext highlighter-rouge">res.send()</code> method like this: <code class="language-plaintext highlighter-rouge">res.status(status).send(obj)</code>.</p> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod v4-deprecated-signatures
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.get('/user', (req, res) =&gt; {
  res.send({ name: 'Ruben' }, 200)
})

// v5
app.get('/user', (req, res) =&gt; {
  res.status(200).send({ name: 'Ruben' })
})
</pre></div> <h3 id="res.send.status">res.send(status)</h3> <p>Express 5 no longer supports the signature <code class="language-plaintext highlighter-rouge">res.send(status)</code>, where <code class="language-plaintext highlighter-rouge">status</code> is a number. Instead, use the <code class="language-plaintext highlighter-rouge">res.sendStatus(statusCode)</code> function, which sets the HTTP response header status code and sends the text version of the code: “Not Found”, “Internal Server Error”, and so on. If you need to send a number by using the <code class="language-plaintext highlighter-rouge">res.send()</code> function, quote the number to convert it to a string, so that Express does not interpret it as an attempt to use the unsupported old signature.</p> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod v4-deprecated-signatures
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.get('/user', (req, res) =&gt; {
  res.send(200)
})

// v5
app.get('/user', (req, res) =&gt; {
  res.sendStatus(200)
})
</pre></div> <h3 id="res.sendfile">res.sendfile()</h3> <p>The <code class="language-plaintext highlighter-rouge">res.sendfile()</code> function has been replaced by a camel-cased version <code class="language-plaintext highlighter-rouge">res.sendFile()</code> in Express 5.</p> <p><strong>Note:</strong> In Express 5, <code class="language-plaintext highlighter-rouge">res.sendFile()</code> uses the <code class="language-plaintext highlighter-rouge">mime-types</code> package for MIME type detection, which returns different Content-Type values than Express 4 for several common file types:</p> <ul> <li>JavaScript files (.js): now “text/javascript” instead of “application/javascript”</li> <li>JSON files (.json): now “application/json” instead of “text/json”</li> <li>CSS files (.css): now “text/css” instead of “text/plain”</li> <li>XML files (.xml): now “application/xml” instead of “text/xml”</li> <li>Font files (.woff): now “font/woff” instead of “application/font-woff”</li> <li>SVG files (.svg): now “image/svg+xml” instead of “application/svg+xml”</li> </ul> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p>You can replace the deprecated signatures with the following command:</p> <pre data-language="plain">npx @expressjs/codemod v4-deprecated-signatures
</pre> </div> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.get('/user', (req, res) =&gt; {
  res.sendfile('/path/to/file')
})

// v5
app.get('/user', (req, res) =&gt; {
  res.sendFile('/path/to/file')
})
</pre></div> <h3 id="router.param">router.param(fn)</h3> <p>The <code class="language-plaintext highlighter-rouge">router.param(fn)</code> signature was used for modifying the behavior of the <code class="language-plaintext highlighter-rouge">router.param(name, fn)</code> function. It has been deprecated since v4.11.0, and Express 5 no longer supports it at all.</p> <h3 id="express.static.mime">express.static.mime</h3> <p>In Express 5, <code class="language-plaintext highlighter-rouge">mime</code> is no longer an exported property of the <code class="language-plaintext highlighter-rouge">static</code> field. Use the <a href="https://github.com/jshttp/mime-types"><code class="language-plaintext highlighter-rouge">mime-types</code> package</a> to work with MIME type values.</p> <p><strong>Important:</strong> This change affects not only direct usage of <code class="language-plaintext highlighter-rouge">express.static.mime</code> but also other Express methods that rely on MIME type detection, such as <code class="language-plaintext highlighter-rouge">res.sendFile()</code>. The following MIME types have changed from Express 4:</p> <ul> <li>JavaScript files (.js): now served as “text/javascript” instead of “application/javascript”</li> <li>JSON files (.json): now served as “application/json” instead of “text/json”</li> <li>CSS files (.css): now served as “text/css” instead of “text/plain”</li> <li>HTML files (.html): now served as “text/html; charset=utf-8” instead of just “text/html”</li> <li>XML files (.xml): now served as “application/xml” instead of “text/xml”</li> <li>Font files (.woff): now served as “font/woff” instead of “application/font-woff”</li> </ul> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
express.static.mime.lookup('json')

// v5
const mime = require('mime-types')
mime.lookup('json')
</pre></div> <h3 id="express:router-debug-logs">express:router debug logs</h3> <p>In Express 5, router handling logic is performed by a dependency. Therefore, the debug logs for the router are no longer available under the <code class="language-plaintext highlighter-rouge">express:</code> namespace. In v4, the logs were available under the namespaces <code class="language-plaintext highlighter-rouge">express:router</code>, <code class="language-plaintext highlighter-rouge">express:router:layer</code>, and <code class="language-plaintext highlighter-rouge">express:router:route</code>. All of these were included under the namespace <code class="language-plaintext highlighter-rouge">express:*</code>. In v5.1+, the logs are available under the namespaces <code class="language-plaintext highlighter-rouge">router</code>, <code class="language-plaintext highlighter-rouge">router:layer</code>, and <code class="language-plaintext highlighter-rouge">router:route</code>. The logs from <code class="language-plaintext highlighter-rouge">router:layer</code> and <code class="language-plaintext highlighter-rouge">router:route</code> are included in the namespace <code class="language-plaintext highlighter-rouge">router:*</code>. To achieve the same detail of debug logging when using <code class="language-plaintext highlighter-rouge">express:*</code> in v4, use a conjunction of <code class="language-plaintext highlighter-rouge">express:*</code>, <code class="language-plaintext highlighter-rouge">router</code>, and <code class="language-plaintext highlighter-rouge">router:*</code>.</p> <div class="highlight"><pre class="highlight" data-language="javascript"># v4
DEBUG=express:* node index.js

# v5
DEBUG=express:*,router,router:* node index.js
</pre></div> <h2 id="changed">Changed</h2> <h3 id="path-syntax">Path route matching syntax</h3> <p>Path route matching syntax is when a string is supplied as the first parameter to the <code class="language-plaintext highlighter-rouge">app.all()</code>, <code class="language-plaintext highlighter-rouge">app.use()</code>, <code class="language-plaintext highlighter-rouge">app.METHOD()</code>, <code class="language-plaintext highlighter-rouge">router.all()</code>, <code class="language-plaintext highlighter-rouge">router.METHOD()</code>, and <code class="language-plaintext highlighter-rouge">router.use()</code> APIs. The following changes have been made to how the path string is matched to an incoming request:</p> <ul> <li>The wildcard <code class="language-plaintext highlighter-rouge">*</code> must have a name, matching the behavior of parameters <code class="language-plaintext highlighter-rouge">:</code>, use <code class="language-plaintext highlighter-rouge">/*splat</code> instead of <code class="language-plaintext highlighter-rouge">/*</code>
</li> </ul> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.get('/*', async (req, res) =&gt; {
  res.send('ok')
})

// v5
app.get('/*splat', async (req, res) =&gt; {
  res.send('ok')
})
</pre></div> <div class="doc-box doc-info"> <p class="doc-title"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1.5" height="24" width="24" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="m11.25 11.25.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9-3.75h.008v.008H12V8.25Z"></path></svg> Note </p> <p><code class="language-plaintext highlighter-rouge">*splat</code> matches any path without the root path. If you need to match the root path as well <code class="language-plaintext highlighter-rouge">/</code>, you can use <code class="language-plaintext highlighter-rouge">/{*splat}</code>, wrapping the wildcard in braces.</p> <div class="highlight"><pre class="highlight" data-language="javascript">// v5
app.get('/{*splat}', async (req, res) =&gt; {
  res.send('ok')
})
</pre></div>  </div> <ul> <li>The optional character <code class="language-plaintext highlighter-rouge">?</code> is no longer supported, use braces instead.</li> </ul> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.get('/:file.:ext?', async (req, res) =&gt; {
  res.send('ok')
})

// v5
app.get('/:file{.:ext}', async (req, res) =&gt; {
  res.send('ok')
})
</pre></div> <ul> <li>Regexp characters are not supported. For example: <div class="highlight"><pre class="highlight" data-language="javascript">app.get('/[discussion|page]/:slug', async (req, res) =&gt; {
res.status(200).send('ok')
})
</pre></div>  <p>should be changed to:</p> <div class="highlight"><pre class="highlight" data-language="javascript">app.get(['/discussion/:slug', '/page/:slug'], async (req, res) =&gt; {
res.status(200).send('ok')
})
</pre></div>  </li> <li>Some characters have been reserved to avoid confusion during upgrade (<code class="language-plaintext highlighter-rouge">()[]?+!</code>), use <code class="language-plaintext highlighter-rouge">\</code> to escape them.</li> <li>Parameter names now support valid JavaScript identifiers, or quoted like <code class="language-plaintext highlighter-rouge">:"this"</code>.</li> </ul> <h3 id="rejected-promises">Rejected promises handled from middleware and handlers</h3> <p>Request middleware and handlers that return rejected promises are now handled by forwarding the rejected value as an <code class="language-plaintext highlighter-rouge">Error</code> to the error handling middleware. This means that using <code class="language-plaintext highlighter-rouge">async</code> functions as middleware and handlers are easier than ever. When an error is thrown in an <code class="language-plaintext highlighter-rouge">async</code> function or a rejected promise is <code class="language-plaintext highlighter-rouge">await</code>ed inside an async function, those errors will be passed to the error handler as if calling <code class="language-plaintext highlighter-rouge">next(err)</code>.</p> <p>Details of how Express handles errors is covered in the <a href="error-handling">error handling documentation</a>.</p> <h3 id="express.urlencoded">express.urlencoded</h3> <p>The <code class="language-plaintext highlighter-rouge">express.urlencoded</code> method makes the <code class="language-plaintext highlighter-rouge">extended</code> option <code class="language-plaintext highlighter-rouge">false</code> by default.</p> <h3 id="express.static.dotfiles">express.static dotfiles</h3> <p>In Express 5, the <code class="language-plaintext highlighter-rouge">express.static</code> middleware’s <code class="language-plaintext highlighter-rouge">dotfiles</code> option now defaults to <code class="language-plaintext highlighter-rouge">"ignore"</code>. This is a change from Express 4, where dotfiles were served by default. As a result, files inside a directory that starts with a dot (<code class="language-plaintext highlighter-rouge">.</code>), such as <code class="language-plaintext highlighter-rouge">.well-known</code>, will no longer be accessible and will return a <strong>404 Not Found</strong> error. This can break functionality that depends on serving dot-directories, such as Android App Links, and Apple Universal Links.</p> <p>Example of breaking code:</p> <div class="highlight"><pre class="highlight" data-language="javascript">// v4
app.use(express.static('public'))
</pre></div> <p>After migrating to Express 5, a request to <code class="language-plaintext highlighter-rouge">/.well-known/assetlinks.json</code> will result in a <strong>404 Not Found</strong>.</p> <p>To fix this, serve specific dot-directories explicitly using the <code class="language-plaintext highlighter-rouge">dotfiles: "allow"</code> option:</p> <div class="highlight"><pre class="highlight" data-language="javascript">// v5
app.use('/.well-known', express.static('public/.well-known', { dotfiles: 'allow' }))
app.use(express.static('public'))
</pre></div> <p>This approach allows you to safely serve only the intended dot-directories while keeping the default secure behavior for other dotfiles, which remain inaccessible.</p> <h3 id="app.listen">app.listen</h3> <p>In Express 5, the <code class="language-plaintext highlighter-rouge">app.listen</code> method will invoke the user-provided callback function (if provided) when the server receives an error event. In Express 4, such errors would be thrown. This change shifts error-handling responsibility to the callback function in Express 5. If there is an error, it will be passed to the callback as an argument. For example:</p> <div class="highlight"><pre class="highlight" data-language="javascript">const server = app.listen(8080, '0.0.0.0', (error) =&gt; {
  if (error) {
    throw error // e.g. EADDRINUSE
  }
  console.log(`Listening on ${JSON.stringify(server.address())}`)
})
</pre></div> <h3 id="app.router">app.router</h3> <p>The <code class="language-plaintext highlighter-rouge">app.router</code> object, which was removed in Express 4, has made a comeback in Express 5. In the new version, this object is a just a reference to the base Express router, unlike in Express 3, where an app had to explicitly load it.</p> <h3 id="req.body">req.body</h3> <p>The <code class="language-plaintext highlighter-rouge">req.body</code> property returns <code class="language-plaintext highlighter-rouge">undefined</code> when the body has not been parsed. In Express 4, it returns <code class="language-plaintext highlighter-rouge">{}</code> by default.</p> <h3 id="req.host">req.host</h3> <p>In Express 4, the <code class="language-plaintext highlighter-rouge">req.host</code> function incorrectly stripped off the port number if it was present. In Express 5, the port number is maintained.</p> <h3 id="req.query">req.query</h3> <p>The <code class="language-plaintext highlighter-rouge">req.query</code> property is no longer a writable property and is instead a getter. The default query parser has been changed from “extended” to “simple”.</p> <h3 id="res.clearCookie">res.clearCookie</h3> <p>The <code class="language-plaintext highlighter-rouge">res.clearCookie</code> method ignores the <code class="language-plaintext highlighter-rouge">maxAge</code> and <code class="language-plaintext highlighter-rouge">expires</code> options provided by the user.</p> <h3 id="res.status">res.status</h3> <p>The <code class="language-plaintext highlighter-rouge">res.status</code> method only accepts integers in the range of <code class="language-plaintext highlighter-rouge">100</code> to <code class="language-plaintext highlighter-rouge">999</code>, following the behavior defined by Node.js, and it returns an error when the status code is not an integer.</p> <h3 id="res.query">res.vary</h3> <p>The <code class="language-plaintext highlighter-rouge">res.vary</code> throws an error when the <code class="language-plaintext highlighter-rouge">field</code> argument is missing. In Express 4, if the argument was omitted, it gave a warning in the console</p> <h2 id="improvements">Improvements</h2> <h3 id="res.render">res.render()</h3> <p>This method now enforces asynchronous behavior for all view engines, avoiding bugs caused by view engines that had a synchronous implementation and that violated the recommended interface.</p> <h3 id="brotli-support">Brotli encoding support</h3> <p>Express 5 supports Brotli encoding for requests received from clients that support it.</p>  <a role="button" class="edit-github-btn" href="https://github.com/expressjs/expressjs.com/edit/gh-pages/en/guide/migrating-5.md"> <svg viewbox="0 0 256 250" width="20" height="20" xmlns="http://www.w3.org/2000/svg" fill="currentColor"> <path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"></path> </svg> Edit this page </a> </main><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2017 StrongLoop, IBM, and other expressjs.com contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v3.0.<br>
    <a href="https://expressjs.com/en/guide/migrating-5.html" class="_attribution-link">https://expressjs.com/en/guide/migrating-5.html</a>
  </p>
</div>
