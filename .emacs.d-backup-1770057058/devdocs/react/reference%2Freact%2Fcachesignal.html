<h1>cacheSignal<a href="#undefined" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h1>
<h3>React Server Components</h3>
<div><p><code dir="ltr">cacheSignal</code> is currently only used with <a href="https://react.dev/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components">React Server Components</a>.</p></div> <div>
<p><code dir="ltr">cacheSignal</code> allows you to know when the <code dir="ltr">cache()</code> lifetime is over.</p>
<pre data-language="jsx"><code><span>const</span> <span>signal</span> = <span>cacheSignal</span><span>(</span><span>)</span><span>;</span></code></pre>
</div> <ul>
<li>
<a href="#reference">Reference </a><ul><li><a href="#cachesignal"><code dir="ltr">cacheSignal</code> </a></li></ul>
</li>
<li>
<a href="#usage">Usage </a><ul>
<li><a href="#cancel-in-flight-requests">Cancel in-flight requests </a></li>
<li><a href="#ignore-errors-after-react-has-finished-rendering">Ignore errors after React has finished rendering </a></li>
</ul>
</li>
</ul> <hr> <h2 id="reference">Reference <a href="#reference" aria-label="Link for Reference " title="Link for Reference "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <h3 id="cachesignal">
<code dir="ltr">cacheSignal</code> <a href="#cachesignal" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>Call <code dir="ltr">cacheSignal</code> to get an <code dir="ltr">AbortSignal</code>.</p> <pre data-language="jsx"><code><span>import</span> <span>{</span><span>cacheSignal</span><span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>async</span> <span>function</span> <span>Component</span><span>(</span><span>)</span> <span>{</span>
  <span>await</span> <span>fetch</span><span>(</span><span>url</span><span>,</span> <span>{</span> <span>signal</span><span>:</span> <span>cacheSignal</span><span>(</span><span>)</span> <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre> <p>When React has finished rendering, the <code dir="ltr">AbortSignal</code> will be aborted. This allows you to cancel any in-flight work that is no longer needed. Rendering is considered finished when:</p> <ul> <li>React has successfully completed rendering</li> <li>the render was aborted</li> <li>the render has failed</li> </ul> <h4 id="parameters">Parameters <a href="#parameters" aria-label="Link for Parameters " title="Link for Parameters "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4> <p>This function does not accept any parameters.</p> <h4 id="returns">Returns <a href="#returns" aria-label="Link for Returns " title="Link for Returns "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4> <p><code dir="ltr">cacheSignal</code> returns an <code dir="ltr">AbortSignal</code> if called during rendering. Otherwise <code dir="ltr">cacheSignal()</code> returns <code dir="ltr">null</code>.</p> <h4 id="caveats">Caveats <a href="#caveats" aria-label="Link for Caveats " title="Link for Caveats "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4> <ul> <li>
<code dir="ltr">cacheSignal</code> is currently for use in <a href="../rsc/server-components">React Server Components</a> only. In Client Components, it will always return <code dir="ltr">null</code>. In the future it will also be used for Client Component when a client cache refreshes or invalidates. You should not assume itâ€™ll always be null on the client.</li> <li>If called outside of rendering, <code dir="ltr">cacheSignal</code> will return <code dir="ltr">null</code> to make it clear that the current scope isnâ€™t cached forever.</li> </ul> <hr> <h2 id="usage">Usage <a href="#usage" aria-label="Link for Usage " title="Link for Usage "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <h3 id="cancel-in-flight-requests">Cancel in-flight requests <a href="#cancel-in-flight-requests" aria-label="Link for Cancel in-flight requests " title="Link for Cancel in-flight requests "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>Call <span data-step="1"><code dir="ltr">cacheSignal</code></span> to abort in-flight requests.</p> <pre data-language="jsx"><code><span>import</span> <span>{</span><span>cache</span><span>,</span> <span>cacheSignal</span><span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>const</span> <span>dedupedFetch</span> = <span>cache</span><span>(</span><span>fetch</span><span>)</span><span>;</span>
<span>async</span> <span>function</span> <span>Component</span><span>(</span><span>)</span> <span>{</span>
  <span>await</span> <span>dedupedFetch</span><span>(</span><span>url</span><span>,</span> <span>{</span> <span>signal</span><span>:</span> <span>cacheSignal()</span> <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre> <div class="note note-orange">
<h4>Pitfall</h4>
<div>
<p>You canâ€™t use <code dir="ltr">cacheSignal</code> to abort async work that was started outside of rendering e.g.</p>
<pre data-language="jsx"><code><span>import</span> <span>{</span><span>cacheSignal</span><span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>// ðŸš© Pitfall: The request will not actually be aborted if the rendering of `Component` is finished.</span>
<span>const</span> <span>response</span> = <span>fetch</span><span>(</span><span>url</span><span>,</span> <span>{</span> <span>signal</span><span>:</span> <span>cacheSignal</span><span>(</span><span>)</span> <span>}</span><span>)</span><span>;</span>
<span>async</span> <span>function</span> <span>Component</span><span>(</span><span>)</span> <span>{</span>
  <span>await</span> <span>response</span><span>;</span>
<span>}</span></code></pre>
</div>
</div> <h3 id="ignore-errors-after-react-has-finished-rendering">Ignore errors after React has finished rendering <a href="#ignore-errors-after-react-has-finished-rendering" aria-label="Link for Ignore errors after React has finished rendering " title="Link for Ignore errors after React has finished rendering "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>If a function throws, it may be due to cancellation (e.g. <span data-step="1">the Database connection</span> has been closed). You can use the <span data-step="2"><code dir="ltr">aborted</code> property</span> to check if the error was due to cancellation or a real error. You may want to <span data-step="3">ignore errors</span> that were due to cancellation.</p> <pre data-language="jsx"><code><span>import</span> <span>{</span><span>cacheSignal</span><span>}</span> <span>from</span> <span>"react"</span><span>;</span>
<span>import</span> <span>{</span><span>queryDatabase</span><span>,</span> <span>logError</span><span>}</span> <span>from</span> <span>"</span><span>./database</span><span>"</span><span>;</span>

<span>async</span> <span>function</span> <span>getData</span><span>(</span><span>id</span><span>)</span> <span>{</span>
  <span>try</span> <span>{</span>
     <span>return</span> <span>await</span> <span>queryDatabase</span><span>(</span><span>id</span><span>)</span><span>;</span>
  <span>}</span> <span>catch</span> <span>(</span><span>x</span><span>)</span> <span>{</span>
     <span>if</span> <span>(</span>!<span>cacheSignal()?.aborted</span><span>)</span> <span>{</span>
        <span>// only log if it's a real error and not due to cancellation</span>
       <span>logError</span><span>(</span><span>x</span><span>)</span><span>;</span>
     <span>}</span>
     <span>return null</span><span>;</span>
  <span>}</span>
<span>}</span>

<span>async</span> <span>function</span> <span>Component</span><span>(</span><span>{</span><span>id</span><span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>data</span> = <span>await</span> <span>getData</span><span>(</span><span>id</span><span>)</span><span>;</span>
  <span>if</span> <span>(</span><span>data</span> === <span>null</span><span>)</span> <span>{</span>
    <span>return</span> <span>&lt;</span><span>div</span><span>&gt;</span>No data available<span>&lt;/</span><span>div</span><span>&gt;</span><span>;</span>
  <span>}</span>
  <span>return</span> <span>&lt;</span><span>div</span><span>&gt;</span><span>{</span><span>data</span>.<span>name</span><span>}</span><span>&lt;/</span><span>div</span><span>&gt;</span><span>;</span>
<span>}</span></code></pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2013&ndash;present Facebook Inc.<br>Licensed under the Creative Commons Attribution 4.0 International Public License.<br>
    <a href="https://react.dev/reference/react/cacheSignal" class="_attribution-link">https://react.dev/reference/react/cacheSignal</a>
  </p>
</div>
