<h1>Extracting State Logic into a Reducer<a href="#undefined" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h1>
<div><p>Components with many state updates spread across many event handlers can get overwhelming. For these cases, you can consolidate all the state update logic outside your component in a single function, called a <em>reducer.</em></p></div> <div class="note">
<h4>You will learn</h4>
<ul> <li>What a reducer function is</li> <li>How to refactor <code dir="ltr">useState</code> to <code dir="ltr">useReducer</code>
</li> <li>When to use a reducer</li> <li>How to write one well</li> </ul>
</div> <h2 id="consolidate-state-logic-with-a-reducer">Consolidate state logic with a reducer <a href="#consolidate-state-logic-with-a-reducer" aria-label="Link for Consolidate state logic with a reducer " title="Link for Consolidate state logic with a reducer "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <p>As your components grow in complexity, it can get harder to see at a glance all the different ways in which a component’s state gets updated. For example, the <code dir="ltr">TaskApp</code> component below holds an array of <code dir="ltr">tasks</code> in state and uses three different event handlers to add, remove, and edit tasks:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>AddTask</span> <span>from</span> <span>'./AddTask.js'</span><span>;</span>
<span>import</span> <span>TaskList</span> <span>from</span> <span>'./TaskList.js'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>TaskApp</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>tasks</span><span>,</span> <span>setTasks</span><span>]</span> = <span>useState</span><span>(</span><span>initialTasks</span><span>)</span><span>;</span>

  <span>function</span> <span>handleAddTask</span><span>(</span><span>text</span><span>)</span> <span>{</span>
    <span>setTasks</span><span>(</span><span>[</span>
      <span>...</span><span>tasks</span><span>,</span>
      <span>{</span>
        <span>id</span><span>:</span> <span>nextId</span>++<span>,</span>
        <span>text</span><span>:</span> <span>text</span><span>,</span>
        <span>done</span><span>:</span> <span>false</span><span>,</span>
      <span>}</span><span>,</span>
    <span>]</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleChangeTask</span><span>(</span><span>task</span><span>)</span> <span>{</span>
    <span>setTasks</span><span>(</span>
      <span>tasks</span>.<span>map</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>if</span> <span>(</span><span>t</span>.<span>id</span> === <span>task</span>.<span>id</span><span>)</span> <span>{</span>
          <span>return</span> <span>task</span><span>;</span>
        <span>}</span> <span>else</span> <span>{</span>
          <span>return</span> <span>t</span><span>;</span>
        <span>}</span>
      <span>}</span><span>)</span>
    <span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleDeleteTask</span><span>(</span><span>taskId</span><span>)</span> <span>{</span>
    <span>setTasks</span><span>(</span><span>tasks</span>.<span>filter</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>t</span>.<span>id</span> !== <span>taskId</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Prague itinerary<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>AddTask</span> <span>onAddTask</span>=<span>{</span><span>handleAddTask</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>TaskList</span>
        <span>tasks</span>=<span>{</span><span>tasks</span><span>}</span>
        <span>onChangeTask</span>=<span>{</span><span>handleChangeTask</span><span>}</span>
        <span>onDeleteTask</span>=<span>{</span><span>handleDeleteTask</span><span>}</span>
      <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>let</span> <span>nextId</span> = <span>3</span><span>;</span>
<span>const</span> <span>initialTasks</span> = <span>[</span>
  <span>{</span><span>id</span><span>:</span> <span>0</span><span>,</span> <span>text</span><span>:</span> <span>'Visit Kafka Museum'</span><span>,</span> <span>done</span><span>:</span> <span>true</span><span>}</span><span>,</span>
  <span>{</span><span>id</span><span>:</span> <span>1</span><span>,</span> <span>text</span><span>:</span> <span>'Watch a puppet show'</span><span>,</span> <span>done</span><span>:</span> <span>false</span><span>}</span><span>,</span>
  <span>{</span><span>id</span><span>:</span> <span>2</span><span>,</span> <span>text</span><span>:</span> <span>'Lennon Wall pic'</span><span>,</span> <span>done</span><span>:</span> <span>false</span><span>}</span><span>,</span>
<span>]</span><span>;</span>

</pre> <p>Each of its event handlers calls <code dir="ltr">setTasks</code> in order to update the state. As this component grows, so does the amount of state logic sprinkled throughout it. To reduce this complexity and keep all your logic in one easy-to-access place, you can move that state logic into a single function outside your component, <strong>called a “reducer”.</strong></p> <p>Reducers are a different way to handle state. You can migrate from <code dir="ltr">useState</code> to <code dir="ltr">useReducer</code> in three steps:</p> <ol> <li>
<strong>Move</strong> from setting state to dispatching actions.</li> <li>
<strong>Write</strong> a reducer function.</li> <li>
<strong>Use</strong> the reducer from your component.</li> </ol> <h3 id="step-1-move-from-setting-state-to-dispatching-actions">Step 1: Move from setting state to dispatching actions <a href="#step-1-move-from-setting-state-to-dispatching-actions" aria-label="Link for Step 1: Move from setting state to dispatching actions " title="Link for Step 1: Move from setting state to dispatching actions "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>Your event handlers currently specify <em>what to do</em> by setting state:</p> <pre data-language="jsx"><code><span>function</span> <span>handleAddTask</span><span>(</span><span>text</span><span>)</span> <span>{</span>
  <span>setTasks</span><span>(</span><span>[</span>
    <span>...</span><span>tasks</span><span>,</span>
    <span>{</span>
      <span>id</span><span>:</span> <span>nextId</span>++<span>,</span>
      <span>text</span><span>:</span> <span>text</span><span>,</span>
      <span>done</span><span>:</span> <span>false</span><span>,</span>
    <span>}</span><span>,</span>
  <span>]</span><span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>handleChangeTask</span><span>(</span><span>task</span><span>)</span> <span>{</span>
  <span>setTasks</span><span>(</span>
    <span>tasks</span>.<span>map</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span><span>t</span>.<span>id</span> === <span>task</span>.<span>id</span><span>)</span> <span>{</span>
        <span>return</span> <span>task</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>return</span> <span>t</span><span>;</span>
      <span>}</span>
    <span>}</span><span>)</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>handleDeleteTask</span><span>(</span><span>taskId</span><span>)</span> <span>{</span>
  <span>setTasks</span><span>(</span><span>tasks</span>.<span>filter</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>t</span>.<span>id</span> !== <span>taskId</span><span>)</span><span>)</span><span>;</span>
<span>}</span></code></pre> <p>Remove all the state setting logic. What you are left with are three event handlers:</p> <ul> <li>
<code dir="ltr">handleAddTask(text)</code> is called when the user presses “Add”.</li> <li>
<code dir="ltr">handleChangeTask(task)</code> is called when the user toggles a task or presses “Save”.</li> <li>
<code dir="ltr">handleDeleteTask(taskId)</code> is called when the user presses “Delete”.</li> </ul> <p>Managing state with reducers is slightly different from directly setting state. Instead of telling React “what to do” by setting state, you specify “what the user just did” by dispatching “actions” from your event handlers. (The state update logic will live elsewhere!) So instead of “setting <code dir="ltr">tasks</code>” via an event handler, you’re dispatching an “added/changed/deleted a task” action. This is more descriptive of the user’s intent.</p> <pre data-language="jsx"><code><span>function</span> <span>handleAddTask</span><span>(</span><span>text</span><span>)</span> <span>{</span>
  <span>dispatch</span><span>(</span><span>{</span>
    <span>type</span><span>:</span> <span>'added'</span><span>,</span>
    <span>id</span><span>:</span> <span>nextId</span>++<span>,</span>
    <span>text</span><span>:</span> <span>text</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>handleChangeTask</span><span>(</span><span>task</span><span>)</span> <span>{</span>
  <span>dispatch</span><span>(</span><span>{</span>
    <span>type</span><span>:</span> <span>'changed'</span><span>,</span>
    <span>task</span><span>:</span> <span>task</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>handleDeleteTask</span><span>(</span><span>taskId</span><span>)</span> <span>{</span>
  <span>dispatch</span><span>(</span><span>{</span>
    <span>type</span><span>:</span> <span>'deleted'</span><span>,</span>
    <span>id</span><span>:</span> <span>taskId</span><span>,</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre> <p>The object you pass to <code dir="ltr">dispatch</code> is called an “action”:</p> <pre data-language="jsx"><code><span>function</span> <span>handleDeleteTask</span><span>(</span><span>taskId</span><span>)</span> <span>{</span>
  <span>dispatch</span><span>(</span>
    <span>// "action" object:</span>
    <span>{</span>
      <span>type</span><span>:</span> <span>'deleted'</span><span>,</span>
      <span>id</span><span>:</span> <span>taskId</span><span>,</span>
    <span>}</span>
  <span>)</span><span>;</span>
<span>}</span></code></pre> <p>It is a regular JavaScript object. You decide what to put in it, but generally it should contain the minimal information about <em>what happened</em>. (You will add the <code dir="ltr">dispatch</code> function itself in a later step.)</p> <div class="note note-green">
<h4>Note</h4>
<div>
<p>An action object can have any shape.</p>
<p>By convention, it is common to give it a string <code dir="ltr">type</code> that describes what happened, and pass any additional information in other fields. The <code dir="ltr">type</code> is specific to a component, so in this example either <code dir="ltr">'added'</code> or <code dir="ltr">'added_task'</code> would be fine. Choose a name that says what happened!</p>
<pre data-language="jsx"><code><span>dispatch</span><span>(</span><span>{</span>
  <span>// specific to component</span>
  <span>type</span><span>:</span> <span>'what_happened'</span><span>,</span>
  <span>// other fields go here</span>
<span>}</span><span>)</span><span>;</span></code></pre>
</div>
</div> <h3 id="step-2-write-a-reducer-function">Step 2: Write a reducer function <a href="#step-2-write-a-reducer-function" aria-label="Link for Step 2: Write a reducer function " title="Link for Step 2: Write a reducer function "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>A reducer function is where you will put your state logic. It takes two arguments, the current state and the action object, and it returns the next state:</p> <pre data-language="jsx"><code><span>function</span> <span>yourReducer</span><span>(</span><span>state</span><span>,</span> <span>action</span><span>)</span> <span>{</span>
  <span>// return next state for React to set</span>
<span>}</span></code></pre> <p>React will set the state to what you return from the reducer.</p> <p>To move your state setting logic from your event handlers to a reducer function in this example, you will:</p> <ol> <li>Declare the current state (<code dir="ltr">tasks</code>) as the first argument.</li> <li>Declare the <code dir="ltr">action</code> object as the second argument.</li> <li>Return the <em>next</em> state from the reducer (which React will set the state to).</li> </ol> <p>Here is all the state setting logic migrated to a reducer function:</p> <pre data-language="jsx"><code><span>function</span> <span>tasksReducer</span><span>(</span><span>tasks</span><span>,</span> <span>action</span><span>)</span> <span>{</span>
  <span>if</span> <span>(</span><span>action</span>.<span>type</span> === <span>'added'</span><span>)</span> <span>{</span>
    <span>return</span> <span>[</span>
      <span>...</span><span>tasks</span><span>,</span>
      <span>{</span>
        <span>id</span><span>:</span> <span>action</span>.<span>id</span><span>,</span>
        <span>text</span><span>:</span> <span>action</span>.<span>text</span><span>,</span>
        <span>done</span><span>:</span> <span>false</span><span>,</span>
      <span>}</span><span>,</span>
    <span>]</span><span>;</span>
  <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>action</span>.<span>type</span> === <span>'changed'</span><span>)</span> <span>{</span>
    <span>return</span> <span>tasks</span>.<span>map</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>if</span> <span>(</span><span>t</span>.<span>id</span> === <span>action</span>.<span>task</span>.<span>id</span><span>)</span> <span>{</span>
        <span>return</span> <span>action</span>.<span>task</span><span>;</span>
      <span>}</span> <span>else</span> <span>{</span>
        <span>return</span> <span>t</span><span>;</span>
      <span>}</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>action</span>.<span>type</span> === <span>'deleted'</span><span>)</span> <span>{</span>
    <span>return</span> <span>tasks</span>.<span>filter</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>t</span>.<span>id</span> !== <span>action</span>.<span>id</span><span>)</span><span>;</span>
  <span>}</span> <span>else</span> <span>{</span>
    <span>throw</span> <span>Error</span><span>(</span><span>'Unknown action: '</span> + <span>action</span>.<span>type</span><span>)</span><span>;</span>
  <span>}</span>
<span>}</span></code></pre> <p>Because the reducer function takes state (<code dir="ltr">tasks</code>) as an argument, you can <strong>declare it outside of your component.</strong> This decreases the indentation level and can make your code easier to read.</p> <div class="note note-green">
<h4>Note</h4>
<div>
<p>The code above uses if/else statements, but it’s a convention to use <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/switch" target="_blank" rel="nofollow noopener noreferrer">switch statements</a> inside reducers. The result is the same, but it can be easier to read switch statements at a glance.</p>
<p>We’ll be using them throughout the rest of this documentation like so:</p>
<pre data-language="jsx"><code><span>function</span> <span>tasksReducer</span><span>(</span><span>tasks</span><span>,</span> <span>action</span><span>)</span> <span>{</span>
  <span>switch</span> <span>(</span><span>action</span>.<span>type</span><span>)</span> <span>{</span>
    <span>case</span> <span>'added'</span><span>:</span> <span>{</span>
      <span>return</span> <span>[</span>
        <span>...</span><span>tasks</span><span>,</span>
        <span>{</span>
          <span>id</span><span>:</span> <span>action</span>.<span>id</span><span>,</span>
          <span>text</span><span>:</span> <span>action</span>.<span>text</span><span>,</span>
          <span>done</span><span>:</span> <span>false</span><span>,</span>
        <span>}</span><span>,</span>
      <span>]</span><span>;</span>
    <span>}</span>
    <span>case</span> <span>'changed'</span><span>:</span> <span>{</span>
      <span>return</span> <span>tasks</span>.<span>map</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>if</span> <span>(</span><span>t</span>.<span>id</span> === <span>action</span>.<span>task</span>.<span>id</span><span>)</span> <span>{</span>
          <span>return</span> <span>action</span>.<span>task</span><span>;</span>
        <span>}</span> <span>else</span> <span>{</span>
          <span>return</span> <span>t</span><span>;</span>
        <span>}</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span>
    <span>case</span> <span>'deleted'</span><span>:</span> <span>{</span>
      <span>return</span> <span>tasks</span>.<span>filter</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>t</span>.<span>id</span> !== <span>action</span>.<span>id</span><span>)</span><span>;</span>
    <span>}</span>
    <span>default</span><span>:</span> <span>{</span>
      <span>throw</span> <span>Error</span><span>(</span><span>'Unknown action: '</span> + <span>action</span>.<span>type</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span></code></pre>
<p>We recommend wrapping each <code dir="ltr">case</code> block into the <code dir="ltr">{</code> and <code dir="ltr">}</code> curly braces so that variables declared inside of different <code dir="ltr">case</code>s don’t clash with each other. Also, a <code dir="ltr">case</code> should usually end with a <code dir="ltr">return</code>. If you forget to <code dir="ltr">return</code>, the code will “fall through” to the next <code dir="ltr">case</code>, which can lead to mistakes!</p>
<p>If you’re not yet comfortable with switch statements, using if/else is completely fine.</p>
</div>
</div> <details class="note note-blue"><summary tabindex="-1"><h5>
<svg width="1.5em" height="1.5em" viewbox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M34.7409 59.7228L32.9567 58.9094C27.2672 56.3157 20.7328 56.3157 15.0433 58.9094C12.6018 60.0224 9.39163 59.0275 8.44602 56.0621C7.45647 52.9589 5.99975 46.5898 6 35.9997C6.00029 23.5648 8.00803 18.3599 9.11099 16.4196C9.67795 15.4222 10.5255 14.8455 11.2254 14.5264L12.0179 14.1651C19.6351 10.6926 28.4011 10.6738 36 14.1733C43.5989 10.6738 52.3649 10.6926 59.9821 14.1651L60.7746 14.5264C61.4745 14.8455 62.3221 15.4222 62.889 16.4196C63.992 18.3599 65.9997 23.5648 66 35.9997C66.0002 46.5898 64.5435 52.9589 63.554 56.0621C62.6084 59.0275 59.3982 60.0224 56.9567 58.9094C51.2672 56.3157 44.7328 56.3157 39.0433 58.9094L37.2591 59.7228C37.1986 59.7508 37.1373 59.7767 37.0753 59.8004C36.4484 60.0411 35.7556 60.0653 35.1102 59.8648C34.9847 59.8258 34.8613 59.7784 34.7409 59.7228ZM14.5068 19.6246C20.3733 16.9501 27.0874 16.8775 33 19.4067V52.473C26.7613 50.32 19.9378 50.471 13.7811 52.9261C13.0005 49.9843 11.9998 44.547 12 35.9998C12.0002 25.5786 13.4879 21.1893 14.1179 19.8018L14.5068 19.6246ZM39 52.473C45.2387 50.32 52.0622 50.471 58.2189 52.9261C58.9995 49.9843 60.0002 44.547 60 35.9998C59.9998 25.5786 58.5121 21.1893 57.8821 19.8018L57.4932 19.6246C51.6267 16.9501 44.9126 16.8775 39 19.4067V52.473Z" fill="currentColor"></path></svg>Deep Dive</h5>
<h4 id="why-are-reducers-called-this-way">Why are reducers called this way? <a href="#why-are-reducers-called-this-way" aria-label="Link for Why are reducers called this way? " title="Link for Why are reducers called this way? "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4></summary><div>
<p>Although reducers can “reduce” the amount of code inside your component, they are actually named after the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/Reduce" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">reduce()</code></a> operation that you can perform on arrays.</p>
<p>The <code dir="ltr">reduce()</code> operation lets you take an array and “accumulate” a single value out of many:</p>
<pre data-language="jsx"><code><span>const</span> <span>arr</span> = <span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>3</span><span>,</span> <span>4</span><span>,</span> <span>5</span><span>]</span><span>;</span>
<span>const</span> <span>sum</span> = <span>arr</span>.<span>reduce</span><span>(</span>
  <span>(</span><span>result</span><span>,</span> <span>number</span><span>)</span> <span>=&gt;</span> <span>result</span> + <span>number</span>
<span>)</span><span>;</span> <span>// 1 + 2 + 3 + 4 + 5</span></code></pre>
<p>The function you pass to <code dir="ltr">reduce</code> is known as a “reducer”. It takes the <em>result so far</em> and the <em>current item,</em> then it returns the <em>next result.</em> React reducers are an example of the same idea: they take the <em>state so far</em> and the <em>action</em>, and return the <em>next state.</em> In this way, they accumulate actions over time into state.</p>
<p>You could even use the <code dir="ltr">reduce()</code> method with an <code dir="ltr">initialState</code> and an array of <code dir="ltr">actions</code> to calculate the final state by passing your reducer function to it:</p>

<pre data-language="jsx"><span>import</span> <span>tasksReducer</span> <span>from</span> <span>'./tasksReducer.js'</span><span>;</span>

<span>let</span> <span>initialState</span> = <span>[</span><span>]</span><span>;</span>
<span>let</span> <span>actions</span> = <span>[</span>
  <span>{</span><span>type</span><span>:</span> <span>'added'</span><span>,</span> <span>id</span><span>:</span> <span>1</span><span>,</span> <span>text</span><span>:</span> <span>'Visit Kafka Museum'</span><span>}</span><span>,</span>
  <span>{</span><span>type</span><span>:</span> <span>'added'</span><span>,</span> <span>id</span><span>:</span> <span>2</span><span>,</span> <span>text</span><span>:</span> <span>'Watch a puppet show'</span><span>}</span><span>,</span>
  <span>{</span><span>type</span><span>:</span> <span>'deleted'</span><span>,</span> <span>id</span><span>:</span> <span>1</span><span>}</span><span>,</span>
  <span>{</span><span>type</span><span>:</span> <span>'added'</span><span>,</span> <span>id</span><span>:</span> <span>3</span><span>,</span> <span>text</span><span>:</span> <span>'Lennon Wall pic'</span><span>}</span><span>,</span>
<span>]</span><span>;</span>

<span>let</span> <span>finalState</span> = <span>actions</span>.<span>reduce</span><span>(</span><span>tasksReducer</span><span>,</span> <span>initialState</span><span>)</span><span>;</span>

<span>const</span> <span>output</span> = <span>document</span>.<span>getElementById</span><span>(</span><span>'output'</span><span>)</span><span>;</span>
<span>output</span>.<span>textContent</span> = <span>JSON</span>.<span>stringify</span><span>(</span><span>finalState</span><span>,</span> <span>null</span><span>,</span> <span>2</span><span>)</span><span>;</span>

</pre>
<p>You probably won’t need to do this yourself, but this is similar to what React does!</p>
</div></details> <h3 id="step-3-use-the-reducer-from-your-component">Step 3: Use the reducer from your component <a href="#step-3-use-the-reducer-from-your-component" aria-label="Link for Step 3: Use the reducer from your component " title="Link for Step 3: Use the reducer from your component "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>Finally, you need to hook up the <code dir="ltr">tasksReducer</code> to your component. Import the <code dir="ltr">useReducer</code> Hook from React:</p> <pre data-language="jsx"><code><span>import</span> <span>{</span> <span>useReducer</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span></code></pre> <p>Then you can replace <code dir="ltr">useState</code>:</p> <pre data-language="jsx"><code><span>const</span> <span>[</span><span>tasks</span><span>,</span> <span>setTasks</span><span>]</span> = <span>useState</span><span>(</span><span>initialTasks</span><span>)</span><span>;</span></code></pre> <p>with <code dir="ltr">useReducer</code> like so:</p> <pre data-language="jsx"><code><span>const</span> <span>[</span><span>tasks</span><span>,</span> <span>dispatch</span><span>]</span> = <span>useReducer</span><span>(</span><span>tasksReducer</span><span>,</span> <span>initialTasks</span><span>)</span><span>;</span></code></pre> <p>The <code dir="ltr">useReducer</code> Hook is similar to <code dir="ltr">useState</code>—you must pass it an initial state and it returns a stateful value and a way to set state (in this case, the dispatch function). But it’s a little different.</p> <p>The <code dir="ltr">useReducer</code> Hook takes two arguments:</p> <ol> <li>A reducer function</li> <li>An initial state</li> </ol> <p>And it returns:</p> <ol> <li>A stateful value</li> <li>A dispatch function (to “dispatch” user actions to the reducer)</li> </ol> <p>Now it’s fully wired up! Here, the reducer is declared at the bottom of the component file:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useReducer</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>AddTask</span> <span>from</span> <span>'./AddTask.js'</span><span>;</span>
<span>import</span> <span>TaskList</span> <span>from</span> <span>'./TaskList.js'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>TaskApp</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>tasks</span><span>,</span> <span>dispatch</span><span>]</span> = <span>useReducer</span><span>(</span><span>tasksReducer</span><span>,</span> <span>initialTasks</span><span>)</span><span>;</span>

  <span>function</span> <span>handleAddTask</span><span>(</span><span>text</span><span>)</span> <span>{</span>
    <span>dispatch</span><span>(</span><span>{</span>
      <span>type</span><span>:</span> <span>'added'</span><span>,</span>
      <span>id</span><span>:</span> <span>nextId</span>++<span>,</span>
      <span>text</span><span>:</span> <span>text</span><span>,</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleChangeTask</span><span>(</span><span>task</span><span>)</span> <span>{</span>
    <span>dispatch</span><span>(</span><span>{</span>
      <span>type</span><span>:</span> <span>'changed'</span><span>,</span>
      <span>task</span><span>:</span> <span>task</span><span>,</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleDeleteTask</span><span>(</span><span>taskId</span><span>)</span> <span>{</span>
    <span>dispatch</span><span>(</span><span>{</span>
      <span>type</span><span>:</span> <span>'deleted'</span><span>,</span>
      <span>id</span><span>:</span> <span>taskId</span><span>,</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Prague itinerary<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>AddTask</span> <span>onAddTask</span>=<span>{</span><span>handleAddTask</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>TaskList</span>
        <span>tasks</span>=<span>{</span><span>tasks</span><span>}</span>
        <span>onChangeTask</span>=<span>{</span><span>handleChangeTask</span><span>}</span>
        <span>onDeleteTask</span>=<span>{</span><span>handleDeleteTask</span><span>}</span>
      <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>tasksReducer</span><span>(</span><span>tasks</span><span>,</span> <span>action</span><span>)</span> <span>{</span>
  <span>switch</span> <span>(</span><span>action</span>.<span>type</span><span>)</span> <span>{</span>
    <span>case</span> <span>'added'</span><span>:</span> <span>{</span>
      <span>return</span> <span>[</span>
        <span>...</span><span>tasks</span><span>,</span>
        <span>{</span>
          <span>id</span><span>:</span> <span>action</span>.<span>id</span><span>,</span>
          <span>text</span><span>:</span> <span>action</span>.<span>text</span><span>,</span>
          <span>done</span><span>:</span> <span>false</span><span>,</span>
        <span>}</span><span>,</span>
      <span>]</span><span>;</span>
    <span>}</span>
    <span>case</span> <span>'changed'</span><span>:</span> <span>{</span>
      <span>return</span> <span>tasks</span>.<span>map</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>{</span>
        <span>if</span> <span>(</span><span>t</span>.<span>id</span> === <span>action</span>.<span>task</span>.<span>id</span><span>)</span> <span>{</span>
          <span>return</span> <span>action</span>.<span>task</span><span>;</span>
        <span>}</span> <span>else</span> <span>{</span>
          <span>return</span> <span>t</span><span>;</span>
        <span>}</span>
      <span>}</span><span>)</span><span>;</span>
    <span>}</span>
    <span>case</span> <span>'deleted'</span><span>:</span> <span>{</span>
      <span>return</span> <span>tasks</span>.<span>filter</span><span>(</span><span>(</span><span>t</span><span>)</span> <span>=&gt;</span> <span>t</span>.<span>id</span> !== <span>action</span>.<span>id</span><span>)</span><span>;</span>
    <span>}</span>
    <span>default</span><span>:</span> <span>{</span>
      <span>throw</span> <span>Error</span><span>(</span><span>'Unknown action: '</span> + <span>action</span>.<span>type</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span>
<span>}</span>

<span>let</span> <span>nextId</span> = <span>3</span><span>;</span>
<span>const</span> <span>initialTasks</span> = <span>[</span>
  <span>{</span><span>id</span><span>:</span> <span>0</span><span>,</span> <span>text</span><span>:</span> <span>'Visit Kafka Museum'</span><span>,</span> <span>done</span><span>:</span> <span>true</span><span>}</span><span>,</span>
  <span>{</span><span>id</span><span>:</span> <span>1</span><span>,</span> <span>text</span><span>:</span> <span>'Watch a puppet show'</span><span>,</span> <span>done</span><span>:</span> <span>false</span><span>}</span><span>,</span>
  <span>{</span><span>id</span><span>:</span> <span>2</span><span>,</span> <span>text</span><span>:</span> <span>'Lennon Wall pic'</span><span>,</span> <span>done</span><span>:</span> <span>false</span><span>}</span><span>,</span>
<span>]</span><span>;</span>

</pre> <p>If you want, you can even move the reducer to a different file:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useReducer</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>AddTask</span> <span>from</span> <span>'./AddTask.js'</span><span>;</span>
<span>import</span> <span>TaskList</span> <span>from</span> <span>'./TaskList.js'</span><span>;</span>
<span>import</span> <span>tasksReducer</span> <span>from</span> <span>'./tasksReducer.js'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>TaskApp</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>tasks</span><span>,</span> <span>dispatch</span><span>]</span> = <span>useReducer</span><span>(</span><span>tasksReducer</span><span>,</span> <span>initialTasks</span><span>)</span><span>;</span>

  <span>function</span> <span>handleAddTask</span><span>(</span><span>text</span><span>)</span> <span>{</span>
    <span>dispatch</span><span>(</span><span>{</span>
      <span>type</span><span>:</span> <span>'added'</span><span>,</span>
      <span>id</span><span>:</span> <span>nextId</span>++<span>,</span>
      <span>text</span><span>:</span> <span>text</span><span>,</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleChangeTask</span><span>(</span><span>task</span><span>)</span> <span>{</span>
    <span>dispatch</span><span>(</span><span>{</span>
      <span>type</span><span>:</span> <span>'changed'</span><span>,</span>
      <span>task</span><span>:</span> <span>task</span><span>,</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleDeleteTask</span><span>(</span><span>taskId</span><span>)</span> <span>{</span>
    <span>dispatch</span><span>(</span><span>{</span>
      <span>type</span><span>:</span> <span>'deleted'</span><span>,</span>
      <span>id</span><span>:</span> <span>taskId</span><span>,</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>h1</span><span>&gt;</span>Prague itinerary<span>&lt;/</span><span>h1</span><span>&gt;</span>
      <span>&lt;</span><span>AddTask</span> <span>onAddTask</span>=<span>{</span><span>handleAddTask</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>TaskList</span>
        <span>tasks</span>=<span>{</span><span>tasks</span><span>}</span>
        <span>onChangeTask</span>=<span>{</span><span>handleChangeTask</span><span>}</span>
        <span>onDeleteTask</span>=<span>{</span><span>handleDeleteTask</span><span>}</span>
      <span>/&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>let</span> <span>nextId</span> = <span>3</span><span>;</span>
<span>const</span> <span>initialTasks</span> = <span>[</span>
  <span>{</span><span>id</span><span>:</span> <span>0</span><span>,</span> <span>text</span><span>:</span> <span>'Visit Kafka Museum'</span><span>,</span> <span>done</span><span>:</span> <span>true</span><span>}</span><span>,</span>
  <span>{</span><span>id</span><span>:</span> <span>1</span><span>,</span> <span>text</span><span>:</span> <span>'Watch a puppet show'</span><span>,</span> <span>done</span><span>:</span> <span>false</span><span>}</span><span>,</span>
  <span>{</span><span>id</span><span>:</span> <span>2</span><span>,</span> <span>text</span><span>:</span> <span>'Lennon Wall pic'</span><span>,</span> <span>done</span><span>:</span> <span>false</span><span>}</span><span>,</span>
<span>]</span><span>;</span>

</pre> <p>Component logic can be easier to read when you separate concerns like this. Now the event handlers only specify <em>what happened</em> by dispatching actions, and the reducer function determines <em>how the state updates</em> in response to them.</p> <h2 id="comparing-usestate-and-usereducer">Comparing <code dir="ltr">useState</code> and <code dir="ltr">useReducer</code> <a href="#comparing-usestate-and-usereducer" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <p>Reducers are not without downsides! Here’s a few ways you can compare them:</p> <ul> <li>
<strong>Code size:</strong> Generally, with <code dir="ltr">useState</code> you have to write less code upfront. With <code dir="ltr">useReducer</code>, you have to write both a reducer function <em>and</em> dispatch actions. However, <code dir="ltr">useReducer</code> can help cut down on the code if many event handlers modify state in a similar way.</li> <li>
<strong>Readability:</strong> <code dir="ltr">useState</code> is very easy to read when the state updates are simple. When they get more complex, they can bloat your component’s code and make it difficult to scan. In this case, <code dir="ltr">useReducer</code> lets you cleanly separate the <em>how</em> of update logic from the <em>what happened</em> of event handlers.</li> <li>
<strong>Debugging:</strong> When you have a bug with <code dir="ltr">useState</code>, it can be difficult to tell <em>where</em> the state was set incorrectly, and <em>why</em>. With <code dir="ltr">useReducer</code>, you can add a console log into your reducer to see every state update, and <em>why</em> it happened (due to which <code dir="ltr">action</code>). If each <code dir="ltr">action</code> is correct, you’ll know that the mistake is in the reducer logic itself. However, you have to step through more code than with <code dir="ltr">useState</code>.</li> <li>
<strong>Testing:</strong> A reducer is a pure function that doesn’t depend on your component. This means that you can export and test it separately in isolation. While generally it’s best to test components in a more realistic environment, for complex state update logic it can be useful to assert that your reducer returns a particular state for a particular initial state and action.</li> <li>
<strong>Personal preference:</strong> Some people like reducers, others don’t. That’s okay. It’s a matter of preference. You can always convert between <code dir="ltr">useState</code> and <code dir="ltr">useReducer</code> back and forth: they are equivalent!</li> </ul> <p>We recommend using a reducer if you often encounter bugs due to incorrect state updates in some component, and want to introduce more structure to its code. You don’t have to use reducers for everything: feel free to mix and match! You can even <code dir="ltr">useState</code> and <code dir="ltr">useReducer</code> in the same component.</p> <h2 id="writing-reducers-well">Writing reducers well <a href="#writing-reducers-well" aria-label="Link for Writing reducers well " title="Link for Writing reducers well "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <p>Keep these two tips in mind when writing reducers:</p> <ul> <li>
<strong>Reducers must be pure.</strong> Similar to <a href="queueing-a-series-of-state-updates">state updater functions</a>, reducers run during rendering! (Actions are queued until the next render.) This means that reducers <a href="keeping-components-pure">must be pure</a>—same inputs always result in the same output. They should not send requests, schedule timeouts, or perform any side effects (operations that impact things outside the component). They should update <a href="updating-objects-in-state">objects</a> and <a href="updating-arrays-in-state">arrays</a> without mutations.</li> <li>
<strong>Each action describes a single user interaction, even if that leads to multiple changes in the data.</strong> For example, if a user presses “Reset” on a form with five fields managed by a reducer, it makes more sense to dispatch one <code dir="ltr">reset_form</code> action rather than five separate <code dir="ltr">set_field</code> actions. If you log every action in a reducer, that log should be clear enough for you to reconstruct what interactions or responses happened in what order. This helps with debugging!</li> </ul> <h2 id="writing-concise-reducers-with-immer">Writing concise reducers with Immer <a href="#writing-concise-reducers-with-immer" aria-label="Link for Writing concise reducers with Immer " title="Link for Writing concise reducers with Immer "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <p>Just like with <a href="updating-objects-in-state#write-concise-update-logic-with-immer">updating objects</a> and <a href="updating-arrays-in-state#write-concise-update-logic-with-immer">arrays</a> in regular state, you can use the Immer library to make reducers more concise. Here, <a href="https://github.com/immerjs/use-immer#useimmerreducer" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">useImmerReducer</code></a> lets you mutate the state with <code dir="ltr">push</code> or <code dir="ltr">arr[i] =</code> assignment:</p> 
<pre data-language="jsx"><span>{</span>
  <span>"dependencies"</span><span>:</span> <span>{</span>
    <span>"immer"</span><span>:</span> <span>"1.7.3"</span><span>,</span>
    <span>"react"</span><span>:</span> <span>"latest"</span><span>,</span>
    <span>"react-dom"</span><span>:</span> <span>"latest"</span><span>,</span>
    <span>"react-scripts"</span><span>:</span> <span>"latest"</span><span>,</span>
    <span>"use-immer"</span><span>:</span> <span>"0.5.1"</span>
  <span>}</span><span>,</span>
  <span>"scripts"</span><span>:</span> <span>{</span>
    <span>"start"</span><span>:</span> <span>"react-scripts start"</span><span>,</span>
    <span>"build"</span><span>:</span> <span>"react-scripts build"</span><span>,</span>
    <span>"test"</span><span>:</span> <span>"react-scripts test --env=jsdom"</span><span>,</span>
    <span>"eject"</span><span>:</span> <span>"react-scripts eject"</span>
  <span>}</span><span>,</span>
  <span>"devDependencies"</span><span>:</span> <span>{</span><span>}</span>
<span>}</span></pre> <p>Reducers must be pure, so they shouldn’t mutate state. But Immer provides you with a special <code dir="ltr">draft</code> object which is safe to mutate. Under the hood, Immer will create a copy of your state with the changes you made to the <code dir="ltr">draft</code>. This is why reducers managed by <code dir="ltr">useImmerReducer</code> can mutate their first argument and don’t need to return state.</p> <section><h2 id="recap">Recap<a href="#recap" aria-label="Link for Recap" title="Link for Recap"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2>
<ul> <li>To convert from <code dir="ltr">useState</code> to <code dir="ltr">useReducer</code>: <ol> <li>Dispatch actions from event handlers.</li> <li>Write a reducer function that returns the next state for a given state and action.</li> <li>Replace <code dir="ltr">useState</code> with <code dir="ltr">useReducer</code>.</li> </ol> </li> <li>Reducers require you to write a bit more code, but they help with debugging and testing.</li> <li>Reducers must be pure.</li> <li>Each action describes a single user interaction.</li> <li>Use Immer if you want to write reducers in a mutating style.</li> </ul></section> <div class="note">
<h4>Try out some challenges</h4>

<div>
<h4 id="dispatch-actions-from-event-handlers">
<div>Challenge 1 of 4<span>: </span>
</div>Dispatch actions from event handlers <a href="#dispatch-actions-from-event-handlers" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4>
<p>Currently, the event handlers in <code dir="ltr">ContactList.js</code> and <code dir="ltr">Chat.js</code> have <code dir="ltr">// TODO</code> comments. This is why typing into the input doesn’t work, and clicking on the buttons doesn’t change the selected recipient.</p>
<p>Replace these two <code dir="ltr">// TODO</code>s with the code to <code dir="ltr">dispatch</code> the corresponding actions. To see the expected shape and the type of the actions, check the reducer in <code dir="ltr">messengerReducer.js</code>. The reducer is already written so you won’t need to change it. You only need to dispatch the actions in <code dir="ltr">ContactList.js</code> and <code dir="ltr">Chat.js</code>.</p>

<pre data-language="jsx"><span>import</span> <span>{</span> <span>useReducer</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>Chat</span> <span>from</span> <span>'./Chat.js'</span><span>;</span>
<span>import</span> <span>ContactList</span> <span>from</span> <span>'./ContactList.js'</span><span>;</span>
<span>import</span> <span>{</span> <span>initialState</span><span>,</span> <span>messengerReducer</span> <span>}</span> <span>from</span> <span>'./messengerReducer'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Messenger</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>state</span><span>,</span> <span>dispatch</span><span>]</span> = <span>useReducer</span><span>(</span><span>messengerReducer</span><span>,</span> <span>initialState</span><span>)</span><span>;</span>
  <span>const</span> <span>message</span> = <span>state</span>.<span>message</span><span>;</span>
  <span>const</span> <span>contact</span> = <span>contacts</span>.<span>find</span><span>(</span><span>(</span><span>c</span><span>)</span> <span>=&gt;</span> <span>c</span>.<span>id</span> === <span>state</span>.<span>selectedId</span><span>)</span><span>;</span>
  <span>return</span> <span>(</span>
    <span>&lt;</span><span>div</span><span>&gt;</span>
      <span>&lt;</span><span>ContactList</span>
        <span>contacts</span>=<span>{</span><span>contacts</span><span>}</span>
        <span>selectedId</span>=<span>{</span><span>state</span>.<span>selectedId</span><span>}</span>
        <span>dispatch</span>=<span>{</span><span>dispatch</span><span>}</span>
      <span>/&gt;</span>
      <span>&lt;</span><span>Chat</span>
        <span>key</span>=<span>{</span><span>contact</span>.<span>id</span><span>}</span>
        <span>message</span>=<span>{</span><span>message</span><span>}</span>
        <span>contact</span>=<span>{</span><span>contact</span><span>}</span>
        <span>dispatch</span>=<span>{</span><span>dispatch</span><span>}</span>
      <span>/&gt;</span>
    <span>&lt;/</span><span>div</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>const</span> <span>contacts</span> = <span>[</span>
  <span>{</span><span>id</span><span>:</span> <span>0</span><span>,</span> <span>name</span><span>:</span> <span>'Taylor'</span><span>,</span> <span>email</span><span>:</span> <span>'taylor@mail.com'</span><span>}</span><span>,</span>
  <span>{</span><span>id</span><span>:</span> <span>1</span><span>,</span> <span>name</span><span>:</span> <span>'Alice'</span><span>,</span> <span>email</span><span>:</span> <span>'alice@mail.com'</span><span>}</span><span>,</span>
  <span>{</span><span>id</span><span>:</span> <span>2</span><span>,</span> <span>name</span><span>:</span> <span>'Bob'</span><span>,</span> <span>email</span><span>:</span> <span>'bob@mail.com'</span><span>}</span><span>,</span>
<span>]</span><span>;</span>

</pre>
</div>

</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2013&ndash;present Facebook Inc.<br>Licensed under the Creative Commons Attribution 4.0 International Public License.<br>
    <a href="https://react.dev/learn/extracting-state-logic-into-a-reducer" class="_attribution-link">https://react.dev/learn/extracting-state-logic-into-a-reducer</a>
  </p>
</div>
