<h1>Manipulating the DOM with Refs<a href="#undefined" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h1>
<div><p>React automatically updates the <a href="https://developer.mozilla.org/docs/Web/API/Document_Object_Model/Introduction" target="_blank" rel="nofollow noopener noreferrer">DOM</a> to match your render output, so your components won’t often need to manipulate it. However, sometimes you might need access to the DOM elements managed by React—for example, to focus a node, scroll to it, or measure its size and position. There is no built-in way to do those things in React, so you will need a <em>ref</em> to the DOM node.</p></div> <div class="note">
<h4>You will learn</h4>
<ul> <li>How to access a DOM node managed by React with the <code dir="ltr">ref</code> attribute</li> <li>How the <code dir="ltr">ref</code> JSX attribute relates to the <code dir="ltr">useRef</code> Hook</li> <li>How to access another component’s DOM node</li> <li>In which cases it’s safe to modify the DOM managed by React</li> </ul>
</div> <h2 id="getting-a-ref-to-the-node">Getting a ref to the node <a href="#getting-a-ref-to-the-node" aria-label="Link for Getting a ref to the node " title="Link for Getting a ref to the node "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <p>To access a DOM node managed by React, first, import the <code dir="ltr">useRef</code> Hook:</p> <pre data-language="jsx"><code><span>import</span> <span>{</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span></code></pre> <p>Then, use it to declare a ref inside your component:</p> <pre data-language="jsx"><code><span>const</span> <span>myRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span></code></pre> <p>Finally, pass your ref as the <code dir="ltr">ref</code> attribute to the JSX tag for which you want to get the DOM node:</p> <pre data-language="jsx"><code><span>&lt;</span><span>div</span> <span>ref</span>=<span>{</span><span>myRef</span><span>}</span><span>&gt;</span></code></pre> <p>The <code dir="ltr">useRef</code> Hook returns an object with a single property called <code dir="ltr">current</code>. Initially, <code dir="ltr">myRef.current</code> will be <code dir="ltr">null</code>. When React creates a DOM node for this <code dir="ltr">&lt;div&gt;</code>, React will put a reference to this node into <code dir="ltr">myRef.current</code>. You can then access this DOM node from your <a href="responding-to-events">event handlers</a> and use the built-in <a href="https://developer.mozilla.org/docs/Web/API/Element" target="_blank" rel="nofollow noopener noreferrer">browser APIs</a> defined on it.</p> <pre data-language="jsx"><code><span>// You can use any browser APIs, for example:</span>
<span>myRef</span>.<span>current</span>.<span>scrollIntoView</span><span>(</span><span>)</span><span>;</span></code></pre> <h3 id="example-focusing-a-text-input">Example: Focusing a text input <a href="#example-focusing-a-text-input" aria-label="Link for Example: Focusing a text input " title="Link for Example: Focusing a text input "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>In this example, clicking the button will focus the input:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Form</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>inputRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>

  <span>function</span> <span>handleClick</span><span>(</span><span>)</span> <span>{</span>
    <span>inputRef</span>.<span>current</span>.<span>focus</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>input</span> <span>ref</span>=<span>{</span><span>inputRef</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleClick</span><span>}</span><span>&gt;</span>
        Focus the input
      <span>&lt;/</span><span>button</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>To implement this:</p> <ol> <li>Declare <code dir="ltr">inputRef</code> with the <code dir="ltr">useRef</code> Hook.</li> <li>Pass it as <code dir="ltr">&lt;input ref={inputRef}&gt;</code>. This tells React to <strong>put this <code dir="ltr">&lt;input&gt;</code>’s DOM node into <code dir="ltr">inputRef.current</code>.</strong>
</li> <li>In the <code dir="ltr">handleClick</code> function, read the input DOM node from <code dir="ltr">inputRef.current</code> and call <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/focus" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">focus()</code></a> on it with <code dir="ltr">inputRef.current.focus()</code>.</li> <li>Pass the <code dir="ltr">handleClick</code> event handler to <code dir="ltr">&lt;button&gt;</code> with <code dir="ltr">onClick</code>.</li> </ol> <p>While DOM manipulation is the most common use case for refs, the <code dir="ltr">useRef</code> Hook can be used for storing other things outside React, like timer IDs. Similarly to state, refs remain between renders. Refs are like state variables that don’t trigger re-renders when you set them. Read about refs in <a href="referencing-values-with-refs">Referencing Values with Refs.</a></p> <h3 id="example-scrolling-to-an-element">Example: Scrolling to an element <a href="#example-scrolling-to-an-element" aria-label="Link for Example: Scrolling to an element " title="Link for Example: Scrolling to an element "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>You can have more than a single ref in a component. In this example, there is a carousel of three images. Each button centers an image by calling the browser <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoView" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">scrollIntoView()</code></a> method on the corresponding DOM node:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>CatFriends</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>firstCatRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>
  <span>const</span> <span>secondCatRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>
  <span>const</span> <span>thirdCatRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>

  <span>function</span> <span>handleScrollToFirstCat</span><span>(</span><span>)</span> <span>{</span>
    <span>firstCatRef</span>.<span>current</span>.<span>scrollIntoView</span><span>(</span><span>{</span>
      <span>behavior</span><span>:</span> <span>'smooth'</span><span>,</span>
      <span>block</span><span>:</span> <span>'nearest'</span><span>,</span>
      <span>inline</span><span>:</span> <span>'center'</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleScrollToSecondCat</span><span>(</span><span>)</span> <span>{</span>
    <span>secondCatRef</span>.<span>current</span>.<span>scrollIntoView</span><span>(</span><span>{</span>
      <span>behavior</span><span>:</span> <span>'smooth'</span><span>,</span>
      <span>block</span><span>:</span> <span>'nearest'</span><span>,</span>
      <span>inline</span><span>:</span> <span>'center'</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>handleScrollToThirdCat</span><span>(</span><span>)</span> <span>{</span>
    <span>thirdCatRef</span>.<span>current</span>.<span>scrollIntoView</span><span>(</span><span>{</span>
      <span>behavior</span><span>:</span> <span>'smooth'</span><span>,</span>
      <span>block</span><span>:</span> <span>'nearest'</span><span>,</span>
      <span>inline</span><span>:</span> <span>'center'</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>nav</span><span>&gt;</span>
        <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleScrollToFirstCat</span><span>}</span><span>&gt;</span>
          Neo
        <span>&lt;/</span><span>button</span><span>&gt;</span>
        <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleScrollToSecondCat</span><span>}</span><span>&gt;</span>
          Millie
        <span>&lt;/</span><span>button</span><span>&gt;</span>
        <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleScrollToThirdCat</span><span>}</span><span>&gt;</span>
          Bella
        <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;/</span><span>nav</span><span>&gt;</span>
      <span>&lt;</span><span>div</span><span>&gt;</span>
        <span>&lt;</span><span>ul</span><span>&gt;</span>
          <span>&lt;</span><span>li</span><span>&gt;</span>
            <span>&lt;</span><span>img</span>
              <span>src</span>=<span>"https://placecats.com/neo/300/200"</span>
              <span>alt</span>=<span>"Neo"</span>
              <span>ref</span>=<span>{</span><span>firstCatRef</span><span>}</span>
            <span>/&gt;</span>
          <span>&lt;/</span><span>li</span><span>&gt;</span>
          <span>&lt;</span><span>li</span><span>&gt;</span>
            <span>&lt;</span><span>img</span>
              <span>src</span>=<span>"https://placecats.com/millie/200/200"</span>
              <span>alt</span>=<span>"Millie"</span>
              <span>ref</span>=<span>{</span><span>secondCatRef</span><span>}</span>
            <span>/&gt;</span>
          <span>&lt;/</span><span>li</span><span>&gt;</span>
          <span>&lt;</span><span>li</span><span>&gt;</span>
            <span>&lt;</span><span>img</span>
              <span>src</span>=<span>"https://placecats.com/bella/199/200"</span>
              <span>alt</span>=<span>"Bella"</span>
              <span>ref</span>=<span>{</span><span>thirdCatRef</span><span>}</span>
            <span>/&gt;</span>
          <span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>&lt;/</span><span>ul</span><span>&gt;</span>
      <span>&lt;/</span><span>div</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <details class="note note-blue"><summary tabindex="-1"><h5>
<svg width="1.5em" height="1.5em" viewbox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M34.7409 59.7228L32.9567 58.9094C27.2672 56.3157 20.7328 56.3157 15.0433 58.9094C12.6018 60.0224 9.39163 59.0275 8.44602 56.0621C7.45647 52.9589 5.99975 46.5898 6 35.9997C6.00029 23.5648 8.00803 18.3599 9.11099 16.4196C9.67795 15.4222 10.5255 14.8455 11.2254 14.5264L12.0179 14.1651C19.6351 10.6926 28.4011 10.6738 36 14.1733C43.5989 10.6738 52.3649 10.6926 59.9821 14.1651L60.7746 14.5264C61.4745 14.8455 62.3221 15.4222 62.889 16.4196C63.992 18.3599 65.9997 23.5648 66 35.9997C66.0002 46.5898 64.5435 52.9589 63.554 56.0621C62.6084 59.0275 59.3982 60.0224 56.9567 58.9094C51.2672 56.3157 44.7328 56.3157 39.0433 58.9094L37.2591 59.7228C37.1986 59.7508 37.1373 59.7767 37.0753 59.8004C36.4484 60.0411 35.7556 60.0653 35.1102 59.8648C34.9847 59.8258 34.8613 59.7784 34.7409 59.7228ZM14.5068 19.6246C20.3733 16.9501 27.0874 16.8775 33 19.4067V52.473C26.7613 50.32 19.9378 50.471 13.7811 52.9261C13.0005 49.9843 11.9998 44.547 12 35.9998C12.0002 25.5786 13.4879 21.1893 14.1179 19.8018L14.5068 19.6246ZM39 52.473C45.2387 50.32 52.0622 50.471 58.2189 52.9261C58.9995 49.9843 60.0002 44.547 60 35.9998C59.9998 25.5786 58.5121 21.1893 57.8821 19.8018L57.4932 19.6246C51.6267 16.9501 44.9126 16.8775 39 19.4067V52.473Z" fill="currentColor"></path></svg>Deep Dive</h5>
<h4 id="how-to-manage-a-list-of-refs-using-a-ref-callback">How to manage a list of refs using a ref callback <a href="#how-to-manage-a-list-of-refs-using-a-ref-callback" aria-label="Link for How to manage a list of refs using a ref callback " title="Link for How to manage a list of refs using a ref callback "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4></summary><div>
<p>In the above examples, there is a predefined number of refs. However, sometimes you might need a ref to each item in the list, and you don’t know how many you will have. Something like this <strong>wouldn’t work</strong>:</p>
<pre data-language="jsx"><code><span>&lt;</span><span>ul</span><span>&gt;</span>
  <span>{</span><span>items</span>.<span>map</span><span>(</span><span>(</span><span>item</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>// Doesn't work!</span>
    <span>const</span> <span>ref</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>
    <span>return</span> <span>&lt;</span><span>li</span> <span>ref</span>=<span>{</span><span>ref</span><span>}</span> <span>/&gt;</span><span>;</span>
  <span>}</span><span>)</span><span>}</span>
<span>&lt;/</span><span>ul</span><span>&gt;</span></code></pre>
<p>This is because <strong>Hooks must only be called at the top-level of your component.</strong> You can’t call <code dir="ltr">useRef</code> in a loop, in a condition, or inside a <code dir="ltr">map()</code> call.</p>
<p>One possible way around this is to get a single ref to their parent element, and then use DOM manipulation methods like <a href="https://developer.mozilla.org/en-US/docs/Web/API/Document/querySelectorAll" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">querySelectorAll</code></a> to “find” the individual child nodes from it. However, this is brittle and can break if your DOM structure changes.</p>
<p>Another solution is to <strong>pass a function to the <code dir="ltr">ref</code> attribute.</strong> This is called a <a href="../reference/react-dom/components/common#ref-callback"><code dir="ltr">ref</code> callback.</a> React will call your ref callback with the DOM node when it’s time to set the ref, and call the cleanup function returned from the callback when it’s time to clear it. This lets you maintain your own array or a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="nofollow noopener noreferrer">Map</a>, and access any ref by its index or some kind of ID.</p>
<p>This example shows how you can use this approach to scroll to an arbitrary node in a long list:</p>

<pre data-language="jsx"><span>import</span> <span>{</span> <span>useRef</span><span>,</span> <span>useState</span> <span>}</span> <span>from</span> <span>"react"</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>CatFriends</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>itemsRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>catList</span><span>,</span> <span>setCatList</span><span>]</span> = <span>useState</span><span>(</span><span>setupCatList</span><span>)</span><span>;</span>

  <span>function</span> <span>scrollToCat</span><span>(</span><span>cat</span><span>)</span> <span>{</span>
    <span>const</span> <span>map</span> = <span>getMap</span><span>(</span><span>)</span><span>;</span>
    <span>const</span> <span>node</span> = <span>map</span>.<span>get</span><span>(</span><span>cat</span><span>)</span><span>;</span>
    <span>node</span>.<span>scrollIntoView</span><span>(</span><span>{</span>
      <span>behavior</span><span>:</span> <span>"smooth"</span><span>,</span>
      <span>block</span><span>:</span> <span>"nearest"</span><span>,</span>
      <span>inline</span><span>:</span> <span>"center"</span><span>,</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>getMap</span><span>(</span><span>)</span> <span>{</span>
    <span>if</span> <span>(</span>!<span>itemsRef</span>.<span>current</span><span>)</span> <span>{</span>
      <span>// Initialize the Map on first usage.</span>
      <span>itemsRef</span>.<span>current</span> = <span>new</span> <span>Map</span><span>(</span><span>)</span><span>;</span>
    <span>}</span>
    <span>return</span> <span>itemsRef</span>.<span>current</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>nav</span><span>&gt;</span>
        <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>scrollToCat</span><span>(</span><span>catList</span><span>[</span><span>0</span><span>]</span><span>)</span><span>}</span><span>&gt;</span>Neo<span>&lt;/</span><span>button</span><span>&gt;</span>
        <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>scrollToCat</span><span>(</span><span>catList</span><span>[</span><span>5</span><span>]</span><span>)</span><span>}</span><span>&gt;</span>Millie<span>&lt;/</span><span>button</span><span>&gt;</span>
        <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>scrollToCat</span><span>(</span><span>catList</span><span>[</span><span>8</span><span>]</span><span>)</span><span>}</span><span>&gt;</span>Bella<span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;/</span><span>nav</span><span>&gt;</span>
      <span>&lt;</span><span>div</span><span>&gt;</span>
        <span>&lt;</span><span>ul</span><span>&gt;</span>
          <span>{</span><span>catList</span>.<span>map</span><span>(</span><span>(</span><span>cat</span><span>)</span> <span>=&gt;</span> <span>(</span>
            <span>&lt;</span><span>li</span>
              <span>key</span>=<span>{</span><span>cat</span>.<span>id</span><span>}</span>
              <span>ref</span>=<span>{</span><span>(</span><span>node</span><span>)</span> <span>=&gt;</span> <span>{</span>
                <span>const</span> <span>map</span> = <span>getMap</span><span>(</span><span>)</span><span>;</span>
                <span>map</span>.<span>set</span><span>(</span><span>cat</span><span>,</span> <span>node</span><span>)</span><span>;</span>

                <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
                  <span>map</span>.<span>delete</span><span>(</span><span>cat</span><span>)</span><span>;</span>
                <span>}</span><span>;</span>
              <span>}</span><span>}</span>
            <span>&gt;</span>
              <span>&lt;</span><span>img</span> <span>src</span>=<span>{</span><span>cat</span>.<span>imageUrl</span><span>}</span> <span>/&gt;</span>
            <span>&lt;/</span><span>li</span><span>&gt;</span>
          <span>)</span><span>)</span><span>}</span>
        <span>&lt;/</span><span>ul</span><span>&gt;</span>
      <span>&lt;/</span><span>div</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>function</span> <span>setupCatList</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>catCount</span> = <span>10</span><span>;</span>
  <span>const</span> <span>catList</span> = <span>new</span> <span>Array</span><span>(</span><span>catCount</span><span>)</span>
  <span>for</span> <span>(</span><span>let</span> <span>i</span> = <span>0</span><span>;</span> <span>i</span> &lt; <span>catCount</span><span>;</span> <span>i</span>++<span>)</span> <span>{</span>
    <span>let</span> <span>imageUrl</span> = <span>''</span><span>;</span>
    <span>if</span> <span>(</span><span>i</span> &lt; <span>5</span><span>)</span> <span>{</span>
      <span>imageUrl</span> = <span>"https://placecats.com/neo/320/240"</span><span>;</span>
    <span>}</span> <span>else</span> <span>if</span> <span>(</span><span>i</span> &lt; <span>8</span><span>)</span> <span>{</span>
      <span>imageUrl</span> = <span>"https://placecats.com/millie/320/240"</span><span>;</span>
    <span>}</span> <span>else</span> <span>{</span>
      <span>imageUrl</span> = <span>"https://placecats.com/bella/320/240"</span><span>;</span>
    <span>}</span>
    <span>catList</span><span>[</span><span>i</span><span>]</span> = <span>{</span>
      <span>id</span><span>:</span> <span>i</span><span>,</span>
      <span>imageUrl</span><span>,</span>
    <span>}</span><span>;</span>
  <span>}</span>
  <span>return</span> <span>catList</span><span>;</span>
<span>}</span>

</pre>
<p>In this example, <code dir="ltr">itemsRef</code> doesn’t hold a single DOM node. Instead, it holds a <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Map" target="_blank" rel="nofollow noopener noreferrer">Map</a> from item ID to a DOM node. (<a href="referencing-values-with-refs">Refs can hold any values!</a>) The <a href="../reference/react-dom/components/common#ref-callback"><code dir="ltr">ref</code> callback</a> on every list item takes care to update the Map:</p>
<pre data-language="jsx"><code><span>&lt;</span><span>li</span>
  <span>key</span>=<span>{</span><span>cat</span>.<span>id</span><span>}</span>
  <span>ref</span>=<span>{</span><span>node</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>map</span> = <span>getMap</span><span>(</span><span>)</span><span>;</span>
    <span>// Add to the Map</span>
    <span>map</span>.<span>set</span><span>(</span><span>cat</span><span>,</span> <span>node</span><span>)</span><span>;</span>

    <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>// Remove from the Map</span>
      <span>map</span>.<span>delete</span><span>(</span><span>cat</span><span>)</span><span>;</span>
    <span>}</span><span>;</span>
  <span>}</span><span>}</span>
<span>&gt;</span></code></pre>
<p>This lets you read individual DOM nodes from the Map later.</p>
<div class="note note-green">
<h4>Note</h4>
<div>
<p>When Strict Mode is enabled, ref callbacks will run twice in development.</p>
<p>Read more about <a href="../reference/react/strictmode#fixing-bugs-found-by-re-running-ref-callbacks-in-development">how this helps find bugs</a> in callback refs.</p>
</div>
</div>
</div></details> <h2 id="accessing-another-components-dom-nodes">Accessing another component’s DOM nodes <a href="#accessing-another-components-dom-nodes" aria-label="Link for Accessing another component’s DOM nodes " title="Link for Accessing another component’s DOM nodes "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <div class="note note-orange">
<h4>Pitfall</h4>
<div><p>Refs are an escape hatch. Manually manipulating <em>another</em> component’s DOM nodes can make your code fragile.</p></div>
</div> <p>You can pass refs from parent component to child components <a href="passing-props-to-a-component">just like any other prop</a>.</p> <pre data-language="jsx"><code><span>import</span> <span>{</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>function</span> <span>MyInput</span><span>(</span><span>{</span> <span>ref</span> <span>}</span><span>)</span> <span>{</span>
  <span>return</span> <span>&lt;</span><span>input</span> <span>ref</span>=<span>{</span><span>ref</span><span>}</span> <span>/&gt;</span><span>;</span>
<span>}</span>

<span>function</span> <span>MyForm</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>inputRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>
  <span>return</span> <span>&lt;</span><span>MyInput</span> <span>ref</span>=<span>{</span><span>inputRef</span><span>}</span> <span>/&gt;</span>
<span>}</span></code></pre> <p>In the above example, a ref is created in the parent component, <code dir="ltr">MyForm</code>, and is passed to the child component, <code dir="ltr">MyInput</code>. <code dir="ltr">MyInput</code> then passes the ref to <code dir="ltr">&lt;input&gt;</code>. Because <code dir="ltr">&lt;input&gt;</code> is a <a href="../reference/react-dom/components/common">built-in component</a> React sets the <code dir="ltr">.current</code> property of the ref to the <code dir="ltr">&lt;input&gt;</code> DOM element.</p> <p>The <code dir="ltr">inputRef</code> created in <code dir="ltr">MyForm</code> now points to the <code dir="ltr">&lt;input&gt;</code> DOM element returned by <code dir="ltr">MyInput</code>. A click handler created in <code dir="ltr">MyForm</code> can access <code dir="ltr">inputRef</code> and call <code dir="ltr">focus()</code> to set the focus on <code dir="ltr">&lt;input&gt;</code>.</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>function</span> <span>MyInput</span><span>(</span><span>{</span> <span>ref</span> <span>}</span><span>)</span> <span>{</span>
  <span>return</span> <span>&lt;</span><span>input</span> <span>ref</span>=<span>{</span><span>ref</span><span>}</span> <span>/&gt;</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>function</span> <span>MyForm</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>inputRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>

  <span>function</span> <span>handleClick</span><span>(</span><span>)</span> <span>{</span>
    <span>inputRef</span>.<span>current</span>.<span>focus</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>MyInput</span> <span>ref</span>=<span>{</span><span>inputRef</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleClick</span><span>}</span><span>&gt;</span>
        Focus the input
      <span>&lt;/</span><span>button</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <details class="note note-blue"><summary tabindex="-1"><h5>
<svg width="1.5em" height="1.5em" viewbox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M34.7409 59.7228L32.9567 58.9094C27.2672 56.3157 20.7328 56.3157 15.0433 58.9094C12.6018 60.0224 9.39163 59.0275 8.44602 56.0621C7.45647 52.9589 5.99975 46.5898 6 35.9997C6.00029 23.5648 8.00803 18.3599 9.11099 16.4196C9.67795 15.4222 10.5255 14.8455 11.2254 14.5264L12.0179 14.1651C19.6351 10.6926 28.4011 10.6738 36 14.1733C43.5989 10.6738 52.3649 10.6926 59.9821 14.1651L60.7746 14.5264C61.4745 14.8455 62.3221 15.4222 62.889 16.4196C63.992 18.3599 65.9997 23.5648 66 35.9997C66.0002 46.5898 64.5435 52.9589 63.554 56.0621C62.6084 59.0275 59.3982 60.0224 56.9567 58.9094C51.2672 56.3157 44.7328 56.3157 39.0433 58.9094L37.2591 59.7228C37.1986 59.7508 37.1373 59.7767 37.0753 59.8004C36.4484 60.0411 35.7556 60.0653 35.1102 59.8648C34.9847 59.8258 34.8613 59.7784 34.7409 59.7228ZM14.5068 19.6246C20.3733 16.9501 27.0874 16.8775 33 19.4067V52.473C26.7613 50.32 19.9378 50.471 13.7811 52.9261C13.0005 49.9843 11.9998 44.547 12 35.9998C12.0002 25.5786 13.4879 21.1893 14.1179 19.8018L14.5068 19.6246ZM39 52.473C45.2387 50.32 52.0622 50.471 58.2189 52.9261C58.9995 49.9843 60.0002 44.547 60 35.9998C59.9998 25.5786 58.5121 21.1893 57.8821 19.8018L57.4932 19.6246C51.6267 16.9501 44.9126 16.8775 39 19.4067V52.473Z" fill="currentColor"></path></svg>Deep Dive</h5>
<h4 id="exposing-a-subset-of-the-api-with-an-imperative-handle">Exposing a subset of the API with an imperative handle <a href="#exposing-a-subset-of-the-api-with-an-imperative-handle" aria-label="Link for Exposing a subset of the API with an imperative handle " title="Link for Exposing a subset of the API with an imperative handle "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4></summary><div>
<p>In the above example, the ref passed to <code dir="ltr">MyInput</code> is passed on to the original DOM input element. This lets the parent component call <code dir="ltr">focus()</code> on it. However, this also lets the parent component do something else—for example, change its CSS styles. In uncommon cases, you may want to restrict the exposed functionality. You can do that with <a href="../reference/react/useimperativehandle"><code dir="ltr">useImperativeHandle</code></a>:</p>

<pre data-language="jsx"><span>import</span> <span>{</span> <span>useRef</span><span>,</span> <span>useImperativeHandle</span> <span>}</span> <span>from</span> <span>"react"</span><span>;</span>

<span>function</span> <span>MyInput</span><span>(</span><span>{</span> <span>ref</span> <span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>realInputRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>
  <span>useImperativeHandle</span><span>(</span><span>ref</span><span>,</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>(</span><span>{</span>
    <span>// Only expose focus and nothing else</span>
    <span>focus</span><span>(</span><span>)</span> <span>{</span>
      <span>realInputRef</span>.<span>current</span>.<span>focus</span><span>(</span><span>)</span><span>;</span>
    <span>}</span><span>,</span>
  <span>}</span><span>)</span><span>)</span><span>;</span>
  <span>return</span> <span>&lt;</span><span>input</span> <span>ref</span>=<span>{</span><span>realInputRef</span><span>}</span> <span>/&gt;</span><span>;</span>
<span>}</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Form</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>inputRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>

  <span>function</span> <span>handleClick</span><span>(</span><span>)</span> <span>{</span>
    <span>inputRef</span>.<span>current</span>.<span>focus</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>MyInput</span> <span>ref</span>=<span>{</span><span>inputRef</span><span>}</span> <span>/&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleClick</span><span>}</span><span>&gt;</span>Focus the input<span>&lt;/</span><span>button</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre>
<p>Here, <code dir="ltr">realInputRef</code> inside <code dir="ltr">MyInput</code> holds the actual input DOM node. However, <a href="../reference/react/useimperativehandle"><code dir="ltr">useImperativeHandle</code></a> instructs React to provide your own special object as the value of a ref to the parent component. So <code dir="ltr">inputRef.current</code> inside the <code dir="ltr">Form</code> component will only have the <code dir="ltr">focus</code> method. In this case, the ref “handle” is not the DOM node, but the custom object you create inside <a href="../reference/react/useimperativehandle"><code dir="ltr">useImperativeHandle</code></a> call.</p>
</div></details> <h2 id="when-react-attaches-the-refs">When React attaches the refs <a href="#when-react-attaches-the-refs" aria-label="Link for When React attaches the refs " title="Link for When React attaches the refs "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <p>In React, every update is split in <a href="render-and-commit#step-3-react-commits-changes-to-the-dom">two phases</a>:</p> <ul> <li>During <strong>render,</strong> React calls your components to figure out what should be on the screen.</li> <li>During <strong>commit,</strong> React applies changes to the DOM.</li> </ul> <p>In general, you <a href="referencing-values-with-refs#best-practices-for-refs">don’t want</a> to access refs during rendering. That goes for refs holding DOM nodes as well. During the first render, the DOM nodes have not yet been created, so <code dir="ltr">ref.current</code> will be <code dir="ltr">null</code>. And during the rendering of updates, the DOM nodes haven’t been updated yet. So it’s too early to read them.</p> <p>React sets <code dir="ltr">ref.current</code> during the commit. Before updating the DOM, React sets the affected <code dir="ltr">ref.current</code> values to <code dir="ltr">null</code>. After updating the DOM, React immediately sets them to the corresponding DOM nodes.</p> <p><strong>Usually, you will access refs from event handlers.</strong> If you want to do something with a ref, but there is no particular event to do it in, you might need an Effect. We will discuss Effects on the next pages.</p> <details class="note note-blue"><summary tabindex="-1"><h5>
<svg width="1.5em" height="1.5em" viewbox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M34.7409 59.7228L32.9567 58.9094C27.2672 56.3157 20.7328 56.3157 15.0433 58.9094C12.6018 60.0224 9.39163 59.0275 8.44602 56.0621C7.45647 52.9589 5.99975 46.5898 6 35.9997C6.00029 23.5648 8.00803 18.3599 9.11099 16.4196C9.67795 15.4222 10.5255 14.8455 11.2254 14.5264L12.0179 14.1651C19.6351 10.6926 28.4011 10.6738 36 14.1733C43.5989 10.6738 52.3649 10.6926 59.9821 14.1651L60.7746 14.5264C61.4745 14.8455 62.3221 15.4222 62.889 16.4196C63.992 18.3599 65.9997 23.5648 66 35.9997C66.0002 46.5898 64.5435 52.9589 63.554 56.0621C62.6084 59.0275 59.3982 60.0224 56.9567 58.9094C51.2672 56.3157 44.7328 56.3157 39.0433 58.9094L37.2591 59.7228C37.1986 59.7508 37.1373 59.7767 37.0753 59.8004C36.4484 60.0411 35.7556 60.0653 35.1102 59.8648C34.9847 59.8258 34.8613 59.7784 34.7409 59.7228ZM14.5068 19.6246C20.3733 16.9501 27.0874 16.8775 33 19.4067V52.473C26.7613 50.32 19.9378 50.471 13.7811 52.9261C13.0005 49.9843 11.9998 44.547 12 35.9998C12.0002 25.5786 13.4879 21.1893 14.1179 19.8018L14.5068 19.6246ZM39 52.473C45.2387 50.32 52.0622 50.471 58.2189 52.9261C58.9995 49.9843 60.0002 44.547 60 35.9998C59.9998 25.5786 58.5121 21.1893 57.8821 19.8018L57.4932 19.6246C51.6267 16.9501 44.9126 16.8775 39 19.4067V52.473Z" fill="currentColor"></path></svg>Deep Dive</h5>
<h4 id="flushing-state-updates-synchronously-with-flush-sync">Flushing state updates synchronously with flushSync <a href="#flushing-state-updates-synchronously-with-flush-sync" aria-label="Link for Flushing state updates synchronously with flushSync " title="Link for Flushing state updates synchronously with flushSync "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4></summary><div>
<p>Consider code like this, which adds a new todo and scrolls the screen down to the last child of the list. Notice how, for some reason, it always scrolls to the todo that was <em>just before</em> the last added one:</p>

<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>TodoList</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>listRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>text</span><span>,</span> <span>setText</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>todos</span><span>,</span> <span>setTodos</span><span>]</span> = <span>useState</span><span>(</span>
    <span>initialTodos</span>
  <span>)</span><span>;</span>

  <span>function</span> <span>handleAdd</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> <span>newTodo</span> = <span>{</span> <span>id</span><span>:</span> <span>nextId</span>++<span>,</span> <span>text</span><span>:</span> <span>text</span> <span>}</span><span>;</span>
    <span>setText</span><span>(</span><span>''</span><span>)</span><span>;</span>
    <span>setTodos</span><span>(</span><span>[</span> <span>...</span><span>todos</span><span>,</span> <span>newTodo</span><span>]</span><span>)</span><span>;</span>
    <span>listRef</span>.<span>current</span>.<span>lastChild</span>.<span>scrollIntoView</span><span>(</span><span>{</span>
      <span>behavior</span><span>:</span> <span>'smooth'</span><span>,</span>
      <span>block</span><span>:</span> <span>'nearest'</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleAdd</span><span>}</span><span>&gt;</span>
        Add
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;</span><span>input</span>
        <span>value</span>=<span>{</span><span>text</span><span>}</span>
        <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setText</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
      <span>/&gt;</span>
      <span>&lt;</span><span>ul</span> <span>ref</span>=<span>{</span><span>listRef</span><span>}</span><span>&gt;</span>
        <span>{</span><span>todos</span>.<span>map</span><span>(</span><span>todo</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>todo</span>.<span>id</span><span>}</span><span>&gt;</span><span>{</span><span>todo</span>.<span>text</span><span>}</span><span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>let</span> <span>nextId</span> = <span>0</span><span>;</span>
<span>let</span> <span>initialTodos</span> = <span>[</span><span>]</span><span>;</span>
<span>for</span> <span>(</span><span>let</span> <span>i</span> = <span>0</span><span>;</span> <span>i</span> &lt; <span>20</span><span>;</span> <span>i</span>++<span>)</span> <span>{</span>
  <span>initialTodos</span>.<span>push</span><span>(</span><span>{</span>
    <span>id</span><span>:</span> <span>nextId</span>++<span>,</span>
    <span>text</span><span>:</span> <span>'Todo #'</span> + <span>(</span><span>i</span> + <span>1</span><span>)</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

</pre>
<p>The issue is with these two lines:</p>
<pre data-language="jsx"><code><span>setTodos</span><span>(</span><span>[</span> <span>...</span><span>todos</span><span>,</span> <span>newTodo</span><span>]</span><span>)</span><span>;</span>
<span>listRef</span>.<span>current</span>.<span>lastChild</span>.<span>scrollIntoView</span><span>(</span><span>)</span><span>;</span></code></pre>
<p>In React, <a href="queueing-a-series-of-state-updates">state updates are queued.</a> Usually, this is what you want. However, here it causes a problem because <code dir="ltr">setTodos</code> does not immediately update the DOM. So the time you scroll the list to its last element, the todo has not yet been added. This is why scrolling always “lags behind” by one item.</p>
<p>To fix this issue, you can force React to update (“flush”) the DOM synchronously. To do this, import <code dir="ltr">flushSync</code> from <code dir="ltr">react-dom</code> and <strong>wrap the state update</strong> into a <code dir="ltr">flushSync</code> call:</p>
<pre data-language="jsx"><code><span>flushSync</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
  <span>setTodos</span><span>(</span><span>[</span> <span>...</span><span>todos</span><span>,</span> <span>newTodo</span><span>]</span><span>)</span><span>;</span>
<span>}</span><span>)</span><span>;</span>
<span>listRef</span>.<span>current</span>.<span>lastChild</span>.<span>scrollIntoView</span><span>(</span><span>)</span><span>;</span></code></pre>
<p>This will instruct React to update the DOM synchronously right after the code wrapped in <code dir="ltr">flushSync</code> executes. As a result, the last todo will already be in the DOM by the time you try to scroll to it:</p>

<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>flushSync</span> <span>}</span> <span>from</span> <span>'react-dom'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>TodoList</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>listRef</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>text</span><span>,</span> <span>setText</span><span>]</span> = <span>useState</span><span>(</span><span>''</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>todos</span><span>,</span> <span>setTodos</span><span>]</span> = <span>useState</span><span>(</span>
    <span>initialTodos</span>
  <span>)</span><span>;</span>

  <span>function</span> <span>handleAdd</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> <span>newTodo</span> = <span>{</span> <span>id</span><span>:</span> <span>nextId</span>++<span>,</span> <span>text</span><span>:</span> <span>text</span> <span>}</span><span>;</span>
    <span>flushSync</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>setText</span><span>(</span><span>''</span><span>)</span><span>;</span>
      <span>setTodos</span><span>(</span><span>[</span> <span>...</span><span>todos</span><span>,</span> <span>newTodo</span><span>]</span><span>)</span><span>;</span>
    <span>}</span><span>)</span><span>;</span>
    <span>listRef</span>.<span>current</span>.<span>lastChild</span>.<span>scrollIntoView</span><span>(</span><span>{</span>
      <span>behavior</span><span>:</span> <span>'smooth'</span><span>,</span>
      <span>block</span><span>:</span> <span>'nearest'</span>
    <span>}</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleAdd</span><span>}</span><span>&gt;</span>
        Add
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;</span><span>input</span>
        <span>value</span>=<span>{</span><span>text</span><span>}</span>
        <span>onChange</span>=<span>{</span><span>e</span> <span>=&gt;</span> <span>setText</span><span>(</span><span>e</span>.<span>target</span>.<span>value</span><span>)</span><span>}</span>
      <span>/&gt;</span>
      <span>&lt;</span><span>ul</span> <span>ref</span>=<span>{</span><span>listRef</span><span>}</span><span>&gt;</span>
        <span>{</span><span>todos</span>.<span>map</span><span>(</span><span>todo</span> <span>=&gt;</span> <span>(</span>
          <span>&lt;</span><span>li</span> <span>key</span>=<span>{</span><span>todo</span>.<span>id</span><span>}</span><span>&gt;</span><span>{</span><span>todo</span>.<span>text</span><span>}</span><span>&lt;/</span><span>li</span><span>&gt;</span>
        <span>)</span><span>)</span><span>}</span>
      <span>&lt;/</span><span>ul</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

<span>let</span> <span>nextId</span> = <span>0</span><span>;</span>
<span>let</span> <span>initialTodos</span> = <span>[</span><span>]</span><span>;</span>
<span>for</span> <span>(</span><span>let</span> <span>i</span> = <span>0</span><span>;</span> <span>i</span> &lt; <span>20</span><span>;</span> <span>i</span>++<span>)</span> <span>{</span>
  <span>initialTodos</span>.<span>push</span><span>(</span><span>{</span>
    <span>id</span><span>:</span> <span>nextId</span>++<span>,</span>
    <span>text</span><span>:</span> <span>'Todo #'</span> + <span>(</span><span>i</span> + <span>1</span><span>)</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span>

</pre>
</div></details> <h2 id="best-practices-for-dom-manipulation-with-refs">Best practices for DOM manipulation with refs <a href="#best-practices-for-dom-manipulation-with-refs" aria-label="Link for Best practices for DOM manipulation with refs " title="Link for Best practices for DOM manipulation with refs "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <p>Refs are an escape hatch. You should only use them when you have to “step outside React”. Common examples of this include managing focus, scroll position, or calling browser APIs that React does not expose.</p> <p>If you stick to non-destructive actions like focusing and scrolling, you shouldn’t encounter any problems. However, if you try to <strong>modify</strong> the DOM manually, you can risk conflicting with the changes React is making.</p> <p>To illustrate this problem, this example includes a welcome message and two buttons. The first button toggles its presence using <a href="conditional-rendering">conditional rendering</a> and <a href="state-a-components-memory">state</a>, as you would usually do in React. The second button uses the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/remove" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">remove()</code> DOM API</a> to forcefully remove it from the DOM outside of React’s control.</p> <p>Try pressing “Toggle with setState” a few times. The message should disappear and appear again. Then press “Remove from the DOM”. This will forcefully remove it. Finally, press “Toggle with setState”:</p> 
<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>Counter</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>show</span><span>,</span> <span>setShow</span><span>]</span> = <span>useState</span><span>(</span><span>true</span><span>)</span><span>;</span>
  <span>const</span> <span>ref</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>div</span><span>&gt;</span>
      <span>&lt;</span><span>button</span>
        <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
          <span>setShow</span><span>(</span>!<span>show</span><span>)</span><span>;</span>
        <span>}</span><span>}</span><span>&gt;</span>
        Toggle with setState
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;</span><span>button</span>
        <span>onClick</span>=<span>{</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
          <span>ref</span>.<span>current</span>.<span>remove</span><span>(</span><span>)</span><span>;</span>
        <span>}</span><span>}</span><span>&gt;</span>
        Remove from the DOM
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>{</span><span>show</span> &amp;&amp; <span>&lt;</span><span>p</span> <span>ref</span>=<span>{</span><span>ref</span><span>}</span><span>&gt;</span>Hello world<span>&lt;/</span><span>p</span><span>&gt;</span><span>}</span>
    <span>&lt;/</span><span>div</span><span>&gt;</span>
  <span>)</span><span>;</span>
<span>}</span>

</pre> <p>After you’ve manually removed the DOM element, trying to use <code dir="ltr">setState</code> to show it again will lead to a crash. This is because you’ve changed the DOM, and React doesn’t know how to continue managing it correctly.</p> <p><strong>Avoid changing DOM nodes managed by React.</strong> Modifying, adding children to, or removing children from elements that are managed by React can lead to inconsistent visual results or crashes like above.</p> <p>However, this doesn’t mean that you can’t do it at all. It requires caution. <strong>You can safely modify parts of the DOM that React has <em>no reason</em> to update.</strong> For example, if some <code dir="ltr">&lt;div&gt;</code> is always empty in the JSX, React won’t have a reason to touch its children list. Therefore, it is safe to manually add or remove elements there.</p> <section><h2 id="recap">Recap<a href="#recap" aria-label="Link for Recap" title="Link for Recap"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2>
<ul> <li>Refs are a generic concept, but most often you’ll use them to hold DOM elements.</li> <li>You instruct React to put a DOM node into <code dir="ltr">myRef.current</code> by passing <code dir="ltr">&lt;div ref={myRef}&gt;</code>.</li> <li>Usually, you will use refs for non-destructive actions like focusing, scrolling, or measuring DOM elements.</li> <li>A component doesn’t expose its DOM nodes by default. You can opt into exposing a DOM node by using the <code dir="ltr">ref</code> prop.</li> <li>Avoid changing DOM nodes managed by React.</li> <li>If you do modify DOM nodes managed by React, modify parts that React has no reason to update.</li> </ul></section> <div class="note">
<h4>Try out some challenges</h4>

<div>
<h4 id="play-and-pause-the-video">
<div>Challenge 1 of 4<span>: </span>
</div>Play and pause the video <a href="#play-and-pause-the-video" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4>
<p>In this example, the button toggles a state variable to switch between a playing and a paused state. However, in order to actually play or pause the video, toggling state is not enough. You also need to call <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/play" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">play()</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/pause" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">pause()</code></a> on the DOM element for the <code dir="ltr">&lt;video&gt;</code>. Add a ref to it, and make the button work.</p>

<pre data-language="jsx"><span>import</span> <span>{</span> <span>useState</span><span>,</span> <span>useRef</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>VideoPlayer</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>isPlaying</span><span>,</span> <span>setIsPlaying</span><span>]</span> = <span>useState</span><span>(</span><span>false</span><span>)</span><span>;</span>

  <span>function</span> <span>handleClick</span><span>(</span><span>)</span> <span>{</span>
    <span>const</span> <span>nextIsPlaying</span> = !<span>isPlaying</span><span>;</span>
    <span>setIsPlaying</span><span>(</span><span>nextIsPlaying</span><span>)</span><span>;</span>
  <span>}</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>&gt;</span>
      <span>&lt;</span><span>button</span> <span>onClick</span>=<span>{</span><span>handleClick</span><span>}</span><span>&gt;</span>
        <span>{</span><span>isPlaying</span> ? <span>'Pause'</span> : <span>'Play'</span><span>}</span>
      <span>&lt;/</span><span>button</span><span>&gt;</span>
      <span>&lt;</span><span>video</span> <span>width</span>=<span>"250"</span><span>&gt;</span>
        <span>&lt;</span><span>source</span>
          <span>src</span>=<span>"https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"</span>
          <span>type</span>=<span>"video/mp4"</span>
        <span>/&gt;</span>
      <span>&lt;/</span><span>video</span><span>&gt;</span>
    <span>&lt;/</span><span>&gt;</span>
  <span>)</span>
<span>}</span>

</pre>
<p>For an extra challenge, keep the “Play” button in sync with whether the video is playing even if the user right-clicks the video and plays it using the built-in browser media controls. You might want to listen to <code dir="ltr">onPlay</code> and <code dir="ltr">onPause</code> on the video to do that.</p>
</div>

</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2013&ndash;present Facebook Inc.<br>Licensed under the Creative Commons Attribution 4.0 International Public License.<br>
    <a href="https://react.dev/learn/manipulating-the-dom-with-refs" class="_attribution-link">https://react.dev/learn/manipulating-the-dom-with-refs</a>
  </p>
</div>
