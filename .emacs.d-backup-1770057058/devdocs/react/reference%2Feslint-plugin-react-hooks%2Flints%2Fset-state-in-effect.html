<h1>set-state-in-effect<a href="#undefined" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h1>
<div><p>Validates against calling setState synchronously in an effect, which can lead to re-renders that degrade performance.</p></div> <h2 id="rule-details">Rule Details <a href="#rule-details" aria-label="Link for Rule Details " title="Link for Rule Details "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <p>Setting state immediately inside an effect forces React to restart the entire render cycle. When you update state in an effect, React must re-render your component, apply changes to the DOM, and then run effects again. This creates an extra render pass that could have been avoided by transforming data directly during render or deriving state from props. Transform data at the top level of your component instead. This code will naturally re-run when props or state change without triggering additional render cycles.</p> <p>Synchronous <code dir="ltr">setState</code> calls in effects trigger immediate re-renders before the browser can paint, causing performance issues and visual jank. React has to render twice: once to apply the state update, then again after effects run. This double rendering is wasteful when the same result could be achieved with a single render.</p> <p>In many cases, you may also not need an effect at all. Please see <a href="../../../learn/you-might-not-need-an-effect">You Might Not Need an Effect</a> for more information.</p> <h2 id="common-violations">Common Violations <a href="#common-violations" aria-label="Link for Common Violations " title="Link for Common Violations "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <p>This rule catches several patterns where synchronous setState is used unnecessarily:</p> <ul> <li>Setting loading state synchronously</li> <li>Deriving state from props in effects</li> <li>Transforming data in effects instead of render</li> </ul> <h3 id="invalid">Invalid <a href="#invalid" aria-label="Link for Invalid " title="Link for Invalid "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>Examples of incorrect code for this rule:</p> <pre data-language="jsx"><code><span>// ❌ Synchronous setState in effect</span>
<span>function</span> <span>Component</span><span>(</span><span>{</span><span>data</span><span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>items</span><span>,</span> <span>setItems</span><span>]</span> = <span>useState</span><span>(</span><span>[</span><span>]</span><span>)</span><span>;</span>

  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>setItems</span><span>(</span><span>data</span><span>)</span><span>;</span> <span>// Extra render, use initial state instead</span>
  <span>}</span><span>,</span> <span>[</span><span>data</span><span>]</span><span>)</span><span>;</span>
<span>}</span>

<span>// ❌ Setting loading state synchronously</span>
<span>function</span> <span>Component</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>loading</span><span>,</span> <span>setLoading</span><span>]</span> = <span>useState</span><span>(</span><span>false</span><span>)</span><span>;</span>

  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>setLoading</span><span>(</span><span>true</span><span>)</span><span>;</span> <span>// Synchronous, causes extra render</span>
    <span>fetchData</span><span>(</span><span>)</span>.<span>then</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>setLoading</span><span>(</span><span>false</span><span>)</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>]</span><span>)</span><span>;</span>
<span>}</span>

<span>// ❌ Transforming data in effect</span>
<span>function</span> <span>Component</span><span>(</span><span>{</span><span>rawData</span><span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>processed</span><span>,</span> <span>setProcessed</span><span>]</span> = <span>useState</span><span>(</span><span>[</span><span>]</span><span>)</span><span>;</span>

  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>setProcessed</span><span>(</span><span>rawData</span>.<span>map</span><span>(</span><span>transform</span><span>)</span><span>)</span><span>;</span> <span>// Should derive in render</span>
  <span>}</span><span>,</span> <span>[</span><span>rawData</span><span>]</span><span>)</span><span>;</span>
<span>}</span>

<span>// ❌ Deriving state from props</span>
<span>function</span> <span>Component</span><span>(</span><span>{</span><span>selectedId</span><span>,</span> <span>items</span><span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>[</span><span>selected</span><span>,</span> <span>setSelected</span><span>]</span> = <span>useState</span><span>(</span><span>null</span><span>)</span><span>;</span>

  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>setSelected</span><span>(</span><span>items</span>.<span>find</span><span>(</span><span>i</span> <span>=&gt;</span> <span>i</span>.<span>id</span> === <span>selectedId</span><span>)</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>selectedId</span><span>,</span> <span>items</span><span>]</span><span>)</span><span>;</span>
<span>}</span></code></pre> <h3 id="valid">Valid <a href="#valid" aria-label="Link for Valid " title="Link for Valid "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>Examples of correct code for this rule:</p> <pre data-language="jsx"><code><span>// ✅ setState in an effect is fine if the value comes from a ref</span>
<span>function</span> <span>Tooltip</span><span>(</span><span>)</span> <span>{</span>
  <span>const</span> <span>ref</span> = <span>useRef</span><span>(</span><span>null</span><span>)</span><span>;</span>
  <span>const</span> <span>[</span><span>tooltipHeight</span><span>,</span> <span>setTooltipHeight</span><span>]</span> = <span>useState</span><span>(</span><span>0</span><span>)</span><span>;</span>

  <span>useLayoutEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>{</span> <span>height</span> <span>}</span> = <span>ref</span>.<span>current</span>.<span>getBoundingClientRect</span><span>(</span><span>)</span><span>;</span>
    <span>setTooltipHeight</span><span>(</span><span>height</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>]</span><span>)</span><span>;</span>
<span>}</span>

<span>// ✅ Calculate during render</span>
<span>function</span> <span>Component</span><span>(</span><span>{</span><span>selectedId</span><span>,</span> <span>items</span><span>}</span><span>)</span> <span>{</span>
  <span>const</span> <span>selected</span> = <span>items</span>.<span>find</span><span>(</span><span>i</span> <span>=&gt;</span> <span>i</span>.<span>id</span> === <span>selectedId</span><span>)</span><span>;</span>
  <span>return</span> <span>&lt;</span><span>div</span><span>&gt;</span><span>{</span><span>selected</span>?.<span>name</span><span>}</span><span>&lt;/</span><span>div</span><span>&gt;</span><span>;</span>
<span>}</span></code></pre> <p><strong>When something can be calculated from the existing props or state, don’t put it in state.</strong> Instead, calculate it during rendering. This makes your code faster, simpler, and less error-prone. Learn more in <a href="../../../learn/you-might-not-need-an-effect">You Might Not Need an Effect</a>.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2013&ndash;present Facebook Inc.<br>Licensed under the Creative Commons Attribution 4.0 International Public License.<br>
    <a href="https://react.dev/reference/eslint-plugin-react-hooks/lints/set-state-in-effect" class="_attribution-link">https://react.dev/reference/eslint-plugin-react-hooks/lints/set-state-in-effect</a>
  </p>
</div>
