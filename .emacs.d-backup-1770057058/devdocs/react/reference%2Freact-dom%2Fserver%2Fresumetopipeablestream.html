<h1>resumeToPipeableStream<a href="#undefined" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h1>
<div>
<p><code dir="ltr">resumeToPipeableStream</code> streams a pre-rendered React tree to a pipeable <a href="https://nodejs.org/api/stream.html" target="_blank" rel="nofollow noopener noreferrer">Node.js Stream.</a></p>
<pre data-language="jsx"><code><span>const</span> <span>{</span><span>pipe</span><span>,</span> <span>abort</span><span>}</span> = <span>await</span> <span>resumeToPipeableStream</span><span>(</span><span>reactNode</span><span>,</span> <span>postponedState</span><span>,</span> <span>options</span>?<span>)</span></code></pre>
</div> <ul>
<li>
<a href="#reference">Reference </a><ul><li><a href="#resume-to-pipeable-stream"><code dir="ltr">resumeToPipeableStream(node, postponed, options?)</code> </a></li></ul>
</li>
<li>
<a href="#usage">Usage </a><ul><li><a href="#further-reading">Further reading </a></li></ul>
</li>
</ul> <div class="note note-green">
<h4>Note</h4>
<div><p>This API is specific to Node.js. Environments with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Streams_API" target="_blank" rel="nofollow noopener noreferrer">Web Streams,</a> like Deno and modern edge runtimes, should use <a href="rendertoreadablestream"><code dir="ltr">resume</code></a> instead.</p></div>
</div> <hr> <h2 id="reference">Reference <a href="#reference" aria-label="Link for Reference " title="Link for Reference "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <h3 id="resume-to-pipeable-stream">
<code dir="ltr">resumeToPipeableStream(node, postponed, options?)</code> <a href="#resume-to-pipeable-stream" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>Call <code dir="ltr">resume</code> to resume rendering a pre-rendered React tree as HTML into a <a href="https://nodejs.org/api/stream.html#writable-streams" target="_blank" rel="nofollow noopener noreferrer">Node.js Stream.</a></p> <pre data-language="jsx"><code><span>import</span> <span>{</span> <span>resume</span> <span>}</span> <span>from</span> <span>'react-dom/server'</span><span>;</span>
<span>import</span> <span>{</span><span>getPostponedState</span><span>}</span> <span>from</span> <span>'./storage'</span><span>;</span>

<span>async</span> <span>function</span> <span>handler</span><span>(</span><span>request</span><span>,</span> <span>response</span><span>)</span> <span>{</span>
  <span>const</span> <span>postponed</span> = <span>await</span> <span>getPostponedState</span><span>(</span><span>request</span><span>)</span><span>;</span>
  <span>const</span> <span>{</span><span>pipe</span><span>}</span> = <span>resumeToPipeableStream</span><span>(</span><span>&lt;</span><span>App</span> <span>/&gt;</span><span>,</span> <span>postponed</span><span>,</span> <span>{</span>
    <span>onShellReady</span><span>:</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>pipe</span><span>(</span><span>response</span><span>)</span><span>;</span>
    <span>}</span>
  <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre> <p><a href="#usage">See more examples below.</a></p> <h4 id="parameters">Parameters <a href="#parameters" aria-label="Link for Parameters " title="Link for Parameters "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4> <ul> <li>
<code dir="ltr">reactNode</code>: The React node you called <code dir="ltr">prerender</code> with. For example, a JSX element like <code dir="ltr">&lt;App /&gt;</code>. It is expected to represent the entire document, so the <code dir="ltr">App</code> component should render the <code dir="ltr">&lt;html&gt;</code> tag.</li> <li>
<code dir="ltr">postponedState</code>: The opaque <code dir="ltr">postpone</code> object returned from a <a href="../static/index">prerender API</a>, loaded from wherever you stored it (e.g. redis, a file, or S3).</li> <li>
<strong>optional</strong> <code dir="ltr">options</code>: An object with streaming options. <ul> <li>
<strong>optional</strong> <code dir="ltr">nonce</code>: A <a target="_blank" rel="nofollow noopener noreferrer" href="http://developer.mozilla.org/en-US/docs/Web/HTML/Element/script#nonce"><code dir="ltr">nonce</code></a> string to allow scripts for <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">script-src</code> Content-Security-Policy</a>.</li> <li>
<strong>optional</strong> <code dir="ltr">signal</code>: An <a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal" target="_blank" rel="nofollow noopener noreferrer">abort signal</a> that lets you <a href="#aborting-server-rendering">abort server rendering</a> and render the rest on the client.</li> <li>
<strong>optional</strong> <code dir="ltr">onError</code>: A callback that fires whenever there is a server error, whether <a href="rendertoreadablestream#recovering-from-errors-outside-the-shell">recoverable</a> or <a href="rendertoreadablestream#recovering-from-errors-inside-the-shell">not.</a> By default, this only calls <code dir="ltr">console.error</code>. If you override it to <a href="rendertoreadablestream#logging-crashes-on-the-server">log crash reports,</a> make sure that you still call <code dir="ltr">console.error</code>.</li> <li>
<strong>optional</strong> <code dir="ltr">onShellReady</code>: A callback that fires right after the <a href="#specifying-what-goes-into-the-shell">shell</a> has finished. You can call <code dir="ltr">pipe</code> here to start streaming. React will <a href="#streaming-more-content-as-it-loads">stream the additional content</a> after the shell along with the inline <code dir="ltr">&lt;script&gt;</code> tags that replace the HTML loading fallbacks with the content.</li> <li>
<strong>optional</strong> <code dir="ltr">onShellError</code>: A callback that fires if there was an error rendering the shell. It receives the error as an argument. No bytes were emitted from the stream yet, and neither <code dir="ltr">onShellReady</code> nor <code dir="ltr">onAllReady</code> will get called, so you can <a href="#recovering-from-errors-inside-the-shell">output a fallback HTML shell</a> or use the prelude.</li> </ul> </li> </ul> <h4 id="returns">Returns <a href="#returns" aria-label="Link for Returns " title="Link for Returns "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4> <p><code dir="ltr">resume</code> returns an object with two methods:</p> <ul> <li>
<code dir="ltr">pipe</code> outputs the HTML into the provided <a href="https://nodejs.org/api/stream.html#writable-streams" target="_blank" rel="nofollow noopener noreferrer">Writable Node.js Stream.</a> Call <code dir="ltr">pipe</code> in <code dir="ltr">onShellReady</code> if you want to enable streaming, or in <code dir="ltr">onAllReady</code> for crawlers and static generation.</li> <li>
<code dir="ltr">abort</code> lets you <a href="#aborting-server-rendering">abort server rendering</a> and render the rest on the client.</li> </ul> <h4 id="caveats">Caveats <a href="#caveats" aria-label="Link for Caveats " title="Link for Caveats "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4> <ul> <li>
<code dir="ltr">resumeToPipeableStream</code> does not accept options for <code dir="ltr">bootstrapScripts</code>, <code dir="ltr">bootstrapScriptContent</code>, or <code dir="ltr">bootstrapModules</code>. Instead, you need to pass these options to the <code dir="ltr">prerender</code> call that generates the <code dir="ltr">postponedState</code>. You can also inject bootstrap content into the writable stream manually.</li> <li>
<code dir="ltr">resumeToPipeableStream</code> does not accept <code dir="ltr">identifierPrefix</code> since the prefix needs to be the same in both <code dir="ltr">prerender</code> and <code dir="ltr">resumeToPipeableStream</code>.</li> <li>Since <code dir="ltr">nonce</code> cannot be provided to prerender, you should only provide <code dir="ltr">nonce</code> to <code dir="ltr">resumeToPipeableStream</code> if youâ€™re not providing scripts to prerender.</li> <li>
<code dir="ltr">resumeToPipeableStream</code> re-renders from the root until it finds a component that was not fully pre-rendered. Only fully prerendered Components (the Component and its children finished prerendering) are skipped entirely.</li> </ul> <h2 id="usage">Usage <a href="#usage" aria-label="Link for Usage " title="Link for Usage "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <h3 id="further-reading">Further reading <a href="#further-reading" aria-label="Link for Further reading " title="Link for Further reading "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>Resuming behaves like <code dir="ltr">renderToReadableStream</code>. For more examples, check out the <a href="rendertoreadablestream#usage">usage section of <code dir="ltr">renderToReadableStream</code></a>. The <a href="../static/prerender#usage">usage section of <code dir="ltr">prerender</code></a> includes examples of how to use <code dir="ltr">prerenderToNodeStream</code> specifically.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2013&ndash;present Facebook Inc.<br>Licensed under the Creative Commons Attribution 4.0 International Public License.<br>
    <a href="https://react.dev/reference/react-dom/server/resumeToPipeableStream" class="_attribution-link">https://react.dev/reference/react-dom/server/resumeToPipeableStream</a>
  </p>
</div>
