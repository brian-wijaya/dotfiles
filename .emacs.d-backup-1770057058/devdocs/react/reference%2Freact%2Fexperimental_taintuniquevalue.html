<h1>experimental_taintUniqueValue<svg width="20px" height="20px" viewbox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg"><title> - This feature is available in the latest Experimental version of React</title>
<g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g id="noun-labs-1201738-(2)" transform="translate(2, 0)" fill="currentColor" fill-rule="nonzero"><path d="M10.2865804,5.55665262 L10.2865804,2.22331605 L10.8591544,2.22331605 C11.0103911,2.22244799 11.1551447,2.16342155 11.2617505,2.05914367 C11.3684534,1.95486857 11.4282767,1.81370176 11.4282767,1.66667106 L11.4282767,0.556642208 C11.4282767,0.40907262 11.3678934,0.26747526 11.2605218,0.16308627 C11.1531503,0.0587028348 11.0074938,0 10.8556998,0 L5.14338868,0 C4.9915947,0 4.84594391,0.0587028348 4.73856664,0.16308627 C4.63119507,0.267469704 4.57081178,0.40907262 4.57081178,0.556642208 L4.57081178,1.66667106 C4.57081178,1.81434899 4.63119507,1.95594912 4.73856664,2.06033811 C4.8459382,2.16472155 4.9915947,2.22331605 5.14338868,2.22331605 L5.71596273,2.22331605 L5.71596273,5.55665262 C5.71596273,8.38665538 2.97295619,9.88999017 0.651686904,15.5566623 C-0.0957823782,17.360053 -2.00560068,20 7.99951567,20 C18.004632,20 16.0948137,17.3600252 15.3507732,15.5566623 C13.0124432,9.88999017 10.2865804,8.38665538 10.2865804,5.55665262 Z M9.89570197,10.709991 C10.0921412,10.709991 10.2805515,10.7858383 10.4193876,10.9209301 C10.5583466,11.0559135 10.6363652,11.2390693 10.6363652,11.4300417 C10.6363652,11.6210141 10.5583466,11.8040698 10.4193876,11.9391533 C10.2805401,12.0741367 10.0921412,12.1499813 9.89570197,12.1499813 C9.6992627,12.1499813 9.51096673,12.074134 9.37201631,11.9391533 C9.23316875,11.8040615 9.15515307,11.6210141 9.15515307,11.4300417 C9.15515307,11.2390693 9.2331716,11.0559024 9.37201631,10.9209301 C9.57264221,10.7258996 9.61239426,10.709991 9.89570197,10.709991 Z M8.98919546,9.04212824 C9.09790709,9.14792278 9.15884755,9.29158681 9.1585213,9.44110085 C9.15829001,9.59073155 9.09678989,9.73407335 8.98763252,9.83954568 C8.87847514,9.945018 8.73069852,10.0039347 8.57678157,10.0033977 C8.42286747,10.0027392 8.27565088,9.94273467 8.16727355,9.83639845 C8.05900765,9.73006224 7.99873866,9.58628988 7.99963013,9.43664806 C8.00052304,9.28788403 8.0620221,9.14542556 8.17051087,9.04048101 C8.27911107,8.93555591 8.42599335,8.87663641 8.57913312,8.87663641 C8.73291864,8.87665585 8.88047525,8.93622535 8.98919546,9.04212824 Z M7.99965585,17.9999981 C4.91377349,17.9999981 3.29882839,17.7332867 2.51364277,17.4999976 C2.37780966,17.4476975 2.26954376,17.3439641 2.21396931,17.2125528 C2.15838628,17.0811499 2.16006066,16.9334692 2.21876871,16.8033858 C2.6144474,15.5921346 3.14916224,14.4280501 3.81316983,13.3333824 C5.980145,9.82337899 8.22941036,13.8867718 10.0980836,13.8867718 C11.9666996,13.8867718 11.4695868,12.1534924 12.1827971,13.3333824 C12.8511505,14.4269112 13.3916656,15.5896902 13.794259,16.8000524 C13.8533022,16.9322137 13.8537479,17.0822749 13.7952635,17.2147751 C13.7368889,17.3472613 13.6248314,17.4504531 13.4856467,17.5000531 C12.6833967,17.7332867 11.0855382,17.9999981 7.99965585,17.9999981 Z" id="Shape"></path></g></g></svg><a href="#undefined" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h1>
<div class="note note-green">
<h4>Experimental Feature</h4>
<div>
<p><strong>This API is experimental and is not available in a stable version of React yet.</strong></p>
<p>You can try it by upgrading React packages to the most recent experimental version:</p>
<ul> <li><code dir="ltr">react@experimental</code></li> <li><code dir="ltr">react-dom@experimental</code></li> <li><code dir="ltr">eslint-plugin-react-hooks@experimental</code></li> </ul>
<p>Experimental versions of React may contain bugs. Don’t use them in production.</p>
<p>This API is only available inside <a href="../rsc/use-client">React Server Components</a>.</p>
</div>
</div> <div>
<p><code dir="ltr">taintUniqueValue</code> lets you prevent unique values from being passed to Client Components like passwords, keys, or tokens.</p>
<pre data-language="jsx"><code><span>taintUniqueValue</span><span>(</span><span>errMessage</span><span>,</span> <span>lifetime</span><span>,</span> <span>value</span><span>)</span></code></pre>
<p>To prevent passing an object containing sensitive data, see <a href="experimental_taintobjectreference"><code dir="ltr">taintObjectReference</code></a>.</p>
</div> <ul>
<li>
<a href="#reference">Reference </a><ul><li><a href="#taintuniquevalue"><code dir="ltr">taintUniqueValue(message, lifetime, value)</code> </a></li></ul>
</li>
<li>
<a href="#usage">Usage </a><ul><li><a href="#prevent-a-token-from-being-passed-to-client-components">Prevent a token from being passed to Client Components </a></li></ul>
</li>
</ul> <hr> <h2 id="reference">Reference <a href="#reference" aria-label="Link for Reference " title="Link for Reference "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <h3 id="taintuniquevalue">
<code dir="ltr">taintUniqueValue(message, lifetime, value)</code> <a href="#taintuniquevalue" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>Call <code dir="ltr">taintUniqueValue</code> with a password, token, key or hash to register it with React as something that should not be allowed to be passed to the Client as is:</p> <pre data-language="jsx"><code><span>import</span> <span>{</span><span>experimental_taintUniqueValue</span><span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>experimental_taintUniqueValue</span><span>(</span>
  <span>'Do not pass secret keys to the client.'</span><span>,</span>
  <span>process</span><span>,</span>
  <span>process</span>.<span>env</span>.<span>SECRET_KEY</span>
<span>)</span><span>;</span></code></pre> <p><a href="#usage">See more examples below.</a></p> <h4 id="parameters">Parameters <a href="#parameters" aria-label="Link for Parameters " title="Link for Parameters "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4> <ul> <li> <p><code dir="ltr">message</code>: The message you want to display if <code dir="ltr">value</code> is passed to a Client Component. This message will be displayed as a part of the Error that will be thrown if <code dir="ltr">value</code> is passed to a Client Component.</p> </li> <li> <p><code dir="ltr">lifetime</code>: Any object that indicates how long <code dir="ltr">value</code> should be tainted. <code dir="ltr">value</code> will be blocked from being sent to any Client Component while this object still exists. For example, passing <code dir="ltr">globalThis</code> blocks the value for the lifetime of an app. <code dir="ltr">lifetime</code> is typically an object whose properties contains <code dir="ltr">value</code>.</p> </li> <li> <p><code dir="ltr">value</code>: A string, bigint or TypedArray. <code dir="ltr">value</code> must be a unique sequence of characters or bytes with high entropy such as a cryptographic token, private key, hash, or a long password. <code dir="ltr">value</code> will be blocked from being sent to any Client Component.</p> </li> </ul> <h4 id="returns">Returns <a href="#returns" aria-label="Link for Returns " title="Link for Returns "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4> <p><code dir="ltr">experimental_taintUniqueValue</code> returns <code dir="ltr">undefined</code>.</p> <h4 id="caveats">Caveats <a href="#caveats" aria-label="Link for Caveats " title="Link for Caveats "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4> <ul> <li>Deriving new values from tainted values can compromise tainting protection. New values created by uppercasing tainted values, concatenating tainted string values into a larger string, converting tainted values to base64, substringing tainted values, and other similar transformations are not tainted unless you explicitly call <code dir="ltr">taintUniqueValue</code> on these newly created values.</li> <li>Do not use <code dir="ltr">taintUniqueValue</code> to protect low-entropy values such as PIN codes or phone numbers. If any value in a request is controlled by an attacker, they could infer which value is tainted by enumerating all possible values of the secret.</li> </ul> <hr> <h2 id="usage">Usage <a href="#usage" aria-label="Link for Usage " title="Link for Usage "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h2> <h3 id="prevent-a-token-from-being-passed-to-client-components">Prevent a token from being passed to Client Components <a href="#prevent-a-token-from-being-passed-to-client-components" aria-label="Link for Prevent a token from being passed to Client Components " title="Link for Prevent a token from being passed to Client Components "><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h3> <p>To ensure that sensitive information such as passwords, session tokens, or other unique values do not inadvertently get passed to Client Components, the <code dir="ltr">taintUniqueValue</code> function provides a layer of protection. When a value is tainted, any attempt to pass it to a Client Component will result in an error.</p> <p>The <code dir="ltr">lifetime</code> argument defines the duration for which the value remains tainted. For values that should remain tainted indefinitely, objects like <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/globalThis" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">globalThis</code></a> or <code dir="ltr">process</code> can serve as the <code dir="ltr">lifetime</code> argument. These objects have a lifespan that spans the entire duration of your app’s execution.</p> <pre data-language="jsx"><code><span>import</span> <span>{</span><span>experimental_taintUniqueValue</span><span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>experimental_taintUniqueValue</span><span>(</span>
  <span>'Do not pass a user password to the client.'</span><span>,</span>
  <span>globalThis</span><span>,</span>
  <span>process</span>.<span>env</span>.<span>SECRET_KEY</span>
<span>)</span><span>;</span></code></pre> <p>If the tainted value’s lifespan is tied to a object, the <code dir="ltr">lifetime</code> should be the object that encapsulates the value. This ensures the tainted value remains protected for the lifetime of the encapsulating object.</p> <pre data-language="jsx"><code><span>import</span> <span>{</span><span>experimental_taintUniqueValue</span><span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>export</span> <span>async</span> <span>function</span> <span>getUser</span><span>(</span><span>id</span><span>)</span> <span>{</span>
  <span>const</span> <span>user</span> = <span>await</span> <span>db</span><span>`SELECT * FROM users WHERE id = </span><span>${</span><span>id</span><span>}</span><span>`</span><span>;</span>
  <span>experimental_taintUniqueValue</span><span>(</span>
    <span>'Do not pass a user session token to the client.'</span><span>,</span>
    <span>user</span><span>,</span>
    <span>user</span>.<span>session</span>.<span>token</span>
  <span>)</span><span>;</span>
  <span>return</span> <span>user</span><span>;</span>
<span>}</span></code></pre> <p>In this example, the <code dir="ltr">user</code> object serves as the <code dir="ltr">lifetime</code> argument. If this object gets stored in a global cache or is accessible by another request, the session token remains tainted.</p> <div class="note note-orange">
<h4>Pitfall</h4>
<div>
<p><strong>Do not rely solely on tainting for security.</strong> Tainting a value doesn’t block every possible derived value. For example, creating a new value by upper casing a tainted string will not taint the new value.</p>
<pre data-language="jsx"><code><span>import</span> <span>{</span><span>experimental_taintUniqueValue</span><span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>const</span> <span>password</span> = <span>'correct horse battery staple'</span><span>;</span>

<span>experimental_taintUniqueValue</span><span>(</span>
  <span>'Do not pass the password to the client.'</span><span>,</span>
  <span>globalThis</span><span>,</span>
  <span>password</span>
<span>)</span><span>;</span>

<span>const</span> <span>uppercasePassword</span> = <span>password</span>.<span>toUpperCase</span><span>(</span><span>)</span> <span>// `uppercasePassword` is not tainted</span></code></pre>
<p>In this example, the constant <code dir="ltr">password</code> is tainted. Then <code dir="ltr">password</code> is used to create a new value <code dir="ltr">uppercasePassword</code> by calling the <code dir="ltr">toUpperCase</code> method on <code dir="ltr">password</code>. The newly created <code dir="ltr">uppercasePassword</code> is not tainted.</p>
<p>Other similar ways of deriving new values from tainted values like concatenating it into a larger string, converting it to base64, or returning a substring create untained values.</p>
<p>Tainting only protects against simple mistakes like explicitly passing secret values to the client. Mistakes in calling the <code dir="ltr">taintUniqueValue</code> like using a global store outside of React, without the corresponding lifetime object, can cause the tainted value to become untainted. Tainting is a layer of protection; a secure app will have multiple layers of protection, well designed APIs, and isolation patterns.</p>
</div>
</div> <details class="note note-blue"><summary tabindex="-1"><h5>
<svg width="1.5em" height="1.5em" viewbox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M34.7409 59.7228L32.9567 58.9094C27.2672 56.3157 20.7328 56.3157 15.0433 58.9094C12.6018 60.0224 9.39163 59.0275 8.44602 56.0621C7.45647 52.9589 5.99975 46.5898 6 35.9997C6.00029 23.5648 8.00803 18.3599 9.11099 16.4196C9.67795 15.4222 10.5255 14.8455 11.2254 14.5264L12.0179 14.1651C19.6351 10.6926 28.4011 10.6738 36 14.1733C43.5989 10.6738 52.3649 10.6926 59.9821 14.1651L60.7746 14.5264C61.4745 14.8455 62.3221 15.4222 62.889 16.4196C63.992 18.3599 65.9997 23.5648 66 35.9997C66.0002 46.5898 64.5435 52.9589 63.554 56.0621C62.6084 59.0275 59.3982 60.0224 56.9567 58.9094C51.2672 56.3157 44.7328 56.3157 39.0433 58.9094L37.2591 59.7228C37.1986 59.7508 37.1373 59.7767 37.0753 59.8004C36.4484 60.0411 35.7556 60.0653 35.1102 59.8648C34.9847 59.8258 34.8613 59.7784 34.7409 59.7228ZM14.5068 19.6246C20.3733 16.9501 27.0874 16.8775 33 19.4067V52.473C26.7613 50.32 19.9378 50.471 13.7811 52.9261C13.0005 49.9843 11.9998 44.547 12 35.9998C12.0002 25.5786 13.4879 21.1893 14.1179 19.8018L14.5068 19.6246ZM39 52.473C45.2387 50.32 52.0622 50.471 58.2189 52.9261C58.9995 49.9843 60.0002 44.547 60 35.9998C59.9998 25.5786 58.5121 21.1893 57.8821 19.8018L57.4932 19.6246C51.6267 16.9501 44.9126 16.8775 39 19.4067V52.473Z" fill="currentColor"></path></svg>Deep Dive</h5>
<h4 id="using-server-only-and-taintuniquevalue-to-prevent-leaking-secrets">Using <code dir="ltr">server-only</code> and <code dir="ltr">taintUniqueValue</code> to prevent leaking secrets <a href="#using-server-only-and-taintuniquevalue-to-prevent-leaking-secrets" aria-label="Link for this heading" title="Link for this heading"><svg width="1em" height="1em" viewbox="0 0 13 13" xmlns="http://www.w3.org/2000/svg"><g fill="currentColor" fill-rule="evenodd"><path d="M7.778 7.975a2.5 2.5 0 0 0 .347-3.837L6.017 2.03a2.498 2.498 0 0 0-3.542-.007 2.5 2.5 0 0 0 .006 3.543l1.153 1.15c.07-.29.154-.563.25-.773.036-.077.084-.16.14-.25L3.18 4.85a1.496 1.496 0 0 1 .002-2.12 1.496 1.496 0 0 1 2.12 0l2.124 2.123a1.496 1.496 0 0 1-.333 2.37c.16.246.42.504.685.752z"></path><path d="M5.657 4.557a2.5 2.5 0 0 0-.347 3.837l2.108 2.108a2.498 2.498 0 0 0 3.542.007 2.5 2.5 0 0 0-.006-3.543L9.802 5.815c-.07.29-.154.565-.25.774-.036.076-.084.16-.14.25l.842.84c.585.587.59 1.532 0 2.122-.587.585-1.532.59-2.12 0L6.008 7.68a1.496 1.496 0 0 1 .332-2.372c-.16-.245-.42-.503-.685-.75z"></path></g></svg></a>
</h4></summary><div>
<p>If you’re running a Server Components environment that has access to private keys or passwords such as database passwords, you have to be careful not to pass that to a Client Component.</p>
<pre data-language="jsx"><code><span>export</span> <span>async</span> <span>function</span> <span>Dashboard</span><span>(</span><span>props</span><span>)</span> <span>{</span>
  <span>// DO NOT DO THIS</span>
  <span>return</span> <span>&lt;</span><span>Overview</span> <span>password</span>=<span>{</span><span>process</span>.<span>env</span>.<span>API_PASSWORD</span><span>}</span> <span>/&gt;</span><span>;</span>
<span>}</span></code></pre>
<pre data-language="jsx"><code><span>"use client"</span><span>;</span>

<span>import</span> <span>{</span><span>useEffect</span><span>}</span> <span>from</span> <span>'...'</span>

<span>export</span> <span>async</span> <span>function</span> <span>Overview</span><span>(</span><span>{</span> <span>password</span> <span>}</span><span>)</span> <span>{</span>
  <span>useEffect</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>headers</span> = <span>{</span> <span>Authorization</span><span>:</span> <span>password</span> <span>}</span><span>;</span>
    <span>fetch</span><span>(</span><span>url</span><span>,</span> <span>{</span> <span>headers</span> <span>}</span><span>)</span>.<span>then</span><span>(</span><span>...</span><span>)</span><span>;</span>
  <span>}</span><span>,</span> <span>[</span><span>password</span><span>]</span><span>)</span><span>;</span>
  <span>...</span>
<span>}</span></code></pre>
<p>This example would leak the secret API token to the client. If this API token can be used to access data this particular user shouldn’t have access to, it could lead to a data breach.</p>
<p>Ideally, secrets like this are abstracted into a single helper file that can only be imported by trusted data utilities on the server. The helper can even be tagged with <a href="https://www.npmjs.com/package/server-only" target="_blank" rel="nofollow noopener noreferrer"><code dir="ltr">server-only</code></a> to ensure that this file isn’t imported on the client.</p>
<pre data-language="jsx"><code><span>import</span> <span>"server-only"</span><span>;</span>

<span>export</span> <span>function</span> <span>fetchAPI</span><span>(</span><span>url</span><span>)</span> <span>{</span>
  <span>const</span> <span>headers</span> = <span>{</span> <span>Authorization</span><span>:</span> <span>process</span>.<span>env</span>.<span>API_PASSWORD</span> <span>}</span><span>;</span>
  <span>return</span> <span>fetch</span><span>(</span><span>url</span><span>,</span> <span>{</span> <span>headers</span> <span>}</span><span>)</span><span>;</span>
<span>}</span></code></pre>
<p>Sometimes mistakes happen during refactoring and not all of your colleagues might know about this. To protect against this mistakes happening down the line we can “taint” the actual password:</p>
<pre data-language="jsx"><code><span>import</span> <span>"server-only"</span><span>;</span>
<span>import</span> <span>{</span><span>experimental_taintUniqueValue</span><span>}</span> <span>from</span> <span>'react'</span><span>;</span>

<span>experimental_taintUniqueValue</span><span>(</span>
  <span>'Do not pass the API token password to the client. '</span> +
    <span>'Instead do all fetches on the server.'</span>
  <span>process</span><span>,</span>
  <span>process</span>.<span>env</span>.<span>API_PASSWORD</span>
<span>)</span><span>;</span></code></pre>
<p>Now whenever anyone tries to pass this password to a Client Component, or send the password to a Client Component with a Server Function, an error will be thrown with message you defined when you called <code dir="ltr">taintUniqueValue</code>.</p>
</div></details> <hr>
<div class="_attribution">
  <p class="_attribution-p">
    &copy; 2013&ndash;present Facebook Inc.<br>Licensed under the Creative Commons Attribution 4.0 International Public License.<br>
    <a href="https://react.dev/reference/react/experimental_taintUniqueValue" class="_attribution-link">https://react.dev/reference/react/experimental_taintUniqueValue</a>
  </p>
</div>
