<mdn-survey></mdn-survey> <h1>DisposableStack.prototype.adopt()</h1> <details class="baseline-indicator not" data-glean-toggle-open="baseline_toggle_open"> <summary>  <div class="status-title"> <span class="not-bold">Limited availability</span> </div>   </summary> <div class="extra"> <p>This feature is not Baseline because it does not work in some of the most widely-used browsers.</p> <ul> <li> <a href="https://developer.mozilla.org/en-US/docs/Glossary/Baseline/Compatibility" data-glean-id="baseline_link_learn_more" target="_blank" class="learn-more"> Learn more </a> </li> <li> <a href="#browser_compatibility" data-glean-id="baseline_link_bcd_table"> See full compatibility </a> </li> <li> <a href="https://survey.alchemer.com/s3/7634825/MDN-baseline-feedback?page=%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FDisposableStack%2Fadopt&amp;level=not" data-glean-id="baseline_link_feedback" class="feedback-link" target="_blank" rel="noreferrer"> Report feedback </a> </li> </ul> </div> </details><section class="content-section"> <p>The <code>adopt()</code> method of <a href="../disposablestack"><code>DisposableStack</code></a> instances registers a value that doesn't implement the disposable protocol to the stack by providing a custom disposer function.</p> </section>    <section class="content-section" aria-labelledby="syntax"> <h2 id="syntax" class="heading">Syntax</h2> <div class="code-example"><pre data-language="js">adopt(value, onDispose)
</pre></div> </section><section class="content-section" aria-labelledby="parameters"> <h3 id="parameters" class="heading">Parameters</h3> <dl> <dt id="value"><a href="#value"><code>value</code></a></dt> <dd> <p>Any value to be registered to the stack.</p> </dd> <dt id="ondispose"><a href="#ondispose"><code>onDispose</code></a></dt> <dd> <p>A function that will be called when the stack is disposed. The function receives <code>value</code> as its only argument.</p> </dd> </dl> </section><section class="content-section" aria-labelledby="return_value"> <h3 id="return_value" class="heading">Return value</h3> <p>The same <code>value</code> that was passed in.</p> </section><section class="content-section" aria-labelledby="exceptions"> <h3 id="exceptions" class="heading">Exceptions</h3> <dl> <dt id="typeerror"><a href="../typeerror"><code>TypeError</code></a></dt> <dd> <p>Thrown if <code>onDispose</code> is not a function.</p> </dd> <dt id="referenceerror"><a href="../referenceerror"><code>ReferenceError</code></a></dt> <dd> <p>Thrown if the stack is already disposed.</p> </dd> </dl> </section><section class="content-section" aria-labelledby="description"> <h2 id="description" class="heading">Description</h2> <p>The primary purpose of <code>adopt()</code> is to register a value that doesn't implement the disposable protocol to the stack. If the value is already disposable, you can use <a href="use"><code>use()</code></a> instead, which automatically uses the value's <code>[Symbol.dispose]()</code> method as the disposer.</p> <p><code>adopt(value, onDispose)</code> is almost the same as <code>defer(() =&gt; onDispose(value))</code>, but it allows you to declare the resource and register it on the same line. This way, there's minimal chance of an error happening between the resource creation and registration, which will cause the resource to leak.</p> <div class="code-example"><pre data-language="js">using disposer = new DisposableStack();
const reader = disposer.adopt(stream.getReader(), (reader) =&gt;
  reader.releaseLock(),
);
</pre></div> <div class="code-example"><pre data-language="js">using disposer = new DisposableStack();
const reader = stream.getReader();
// If someone adds code in between these lines and an error occurs,
// the stream will be locked forever.
disposer.defer(() =&gt; reader.close());
</pre></div> <p>In the same spirit of "make your resource registered as soon as it's declared", you should always wrap your resource acquisition expression in <code>adopt()</code>, instead of extracting it to a separate statement.</p> <div class="code-example"><pre data-language="js">using disposer = new DisposableStack();
const reader = stream.getReader();
disposer.adopt(reader, (reader) =&gt; reader.close());
</pre></div> </section><section class="content-section" aria-labelledby="examples"> <h2 id="examples" class="heading">Examples</h2> &gt; </section><section class="content-section" aria-labelledby="using_adopt"> <h3 id="using_adopt" class="heading">Using adopt()</h3> <p>This code consumes a <a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream"><code>ReadableStream</code></a> via a <a href="https://developer.mozilla.org/en-US/docs/Web/API/ReadableStreamDefaultReader"><code>ReadableStreamDefaultReader</code></a>. The reader does not implement the disposable protocol, so we use <code>adopt()</code> to register it to the stack.</p> <div class="code-example"><pre data-language="js">{
  using disposer = new DisposableStack();
  const reader = disposer.adopt(stream.getReader(), (reader) =&gt;
    reader.releaseLock(),
  );
  const { value, done } = reader.read();
  if (!done) {
    // Process the value
  }
  // The reader.releaseLock() method is called here before exiting
}
</pre></div> </section><section class="content-section" aria-labelledby="specifications"> <h2 id="specifications" class="heading">Specifications</h2> <div class="_table"><table> <thead> <tr> <th scope="col">Specification</th> </tr> </thead> <tbody> <tr> <td><a href="https://tc39.es/proposal-async-explicit-resource-management/#sec-asyncdisposablestack.prototype.adopt" rel="noopener" target="_blank">ECMAScript Async Explicit Resource Management&gt;<br># sec-asyncdisposablestack.prototype.adopt&gt;</a></td> </tr> </tbody> </table></div> </section><section class="content-section" aria-labelledby="browser_compatibility"> <h2 id="browser_compatibility" class="heading">Browser compatibility</h2> <div class="_table"><table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="5">Desktop</th>
<th colspan="7">Mobile</th>
<th colspan="3">Server</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Opera</th>
<th>Safari</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
<th>WebView Android</th>
<th>WebView on iOS</th>
<th>Bun</th>
<th>Deno</th>
<th>Node.js</th>
</tr>
</thead>
<tbody><tr>
<th><code>adopt</code></th>
<td class="bc-supports-yes"><abbr title="Release date: 2025-03-04">134</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-03-06">134</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-07-22">141</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-05-13">119</abbr></td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-03-04">134</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-07-22">141</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-03-19">88</abbr></td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-10-25">29.0</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-03-04">134</abbr></td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-10-10">1.3.0</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-04-15">2.2.10</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-05-06">24.0.0</abbr></td>
</tr></tbody>
</table></div> </section><section class="content-section" aria-labelledby="see_also"> <h2 id="see_also" class="heading">See also</h2> <ul> <li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Resource_management">JavaScript resource management</a></li> <li><a href="../disposablestack"><code>DisposableStack</code></a></li> <li><a href="defer"><code>DisposableStack.prototype.defer()</code></a></li> <li><a href="use"><code>DisposableStack.prototype.use()</code></a></li> </ul> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2025 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DisposableStack/adopt" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/DisposableStack/adopt</a>
  </p>
</div>
