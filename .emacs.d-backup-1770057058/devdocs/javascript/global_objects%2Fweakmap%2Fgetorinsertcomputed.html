<mdn-survey></mdn-survey> <h1>WeakMap.prototype.getOrInsertComputed()</h1> <details class="baseline-indicator not" data-glean-toggle-open="baseline_toggle_open"> <summary>  <div class="status-title"> <span class="not-bold">Limited availability</span> </div>   </summary> <div class="extra"> <p>This feature is not Baseline because it does not work in some of the most widely-used browsers.</p> <ul> <li> <a href="https://developer.mozilla.org/en-US/docs/Glossary/Baseline/Compatibility" data-glean-id="baseline_link_learn_more" target="_blank" class="learn-more"> Learn more </a> </li> <li> <a href="#browser_compatibility" data-glean-id="baseline_link_bcd_table"> See full compatibility </a> </li> <li> <a href="https://survey.alchemer.com/s3/7634825/MDN-baseline-feedback?page=%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FWeakMap%2FgetOrInsertComputed&amp;level=not" data-glean-id="baseline_link_feedback" class="feedback-link" target="_blank" rel="noreferrer"> Report feedback </a> </li> </ul> </div> </details><section class="content-section"> <p>The <code>getOrInsertComputed()</code> method of <a href="../weakmap"><code>WeakMap</code></a> instances returns the value corresponding to the specified key in this <code>WeakMap</code>. If the key is not present, it inserts a new entry with the key and a default value computed from a given callback, and returns the inserted value.</p> <p>Use this method instead of <a href="getorinsert"><code>WeakMap.prototype.getOrInsert()</code></a> when the default value is expensive to compute, and you want to avoid computing it unless it's actually needed.</p> </section>    <section class="content-section" aria-labelledby="try_it"> <h2 id="try_it" class="heading">Try it</h2> <interactive-example name="JavaScript Demo: WeakMap.prototype.getOrInsertComputed()"></interactive-example> <div class="code-example"><pre data-language="js">const alan = { name: "Alan" };
const map = new WeakMap([[alan, 35]]);
const defaultCreator = (obj) =&gt; `${obj.name}'s age is unknown`;

console.log(map.getOrInsertComputed(alan, defaultCreator));
// Expected output: 35

const brett = { name: "Brett" };
console.log(map.getOrInsertComputed(brett, defaultCreator));
// Expected output: "Brett's age is unknown"
</pre></div> </section><section class="content-section" aria-labelledby="syntax"> <h2 id="syntax" class="heading">Syntax</h2> <div class="code-example"><pre data-language="js">getOrInsertComputed(key, callback)
</pre></div> </section><section class="content-section" aria-labelledby="parameters"> <h3 id="parameters" class="heading">Parameters</h3> <dl> <dt id="key"><a href="#key"><code>key</code></a></dt> <dd> <p>The key of the element to return from the <code>Map</code> object. Must be either an object or a <a href="../symbol#shared_symbols_in_the_global_symbol_registry">non-registered symbol</a>. Object keys are compared by <a href="https://developer.mozilla.org/en-US/docs/Glossary/Object_reference">reference</a>, not by value.</p> </dd> <dt id="callback"><a href="#callback"><code>callback</code></a></dt> <dd> <p>A function that returns the value to insert and return if the key is not already present in the <code>Map</code> object. The function is called with the following argument:</p> <dl> <dt id="key_2"><a href="#key_2"><code>key</code></a></dt> <dd> <p>The same key that was passed to <code>getOrInsertComputed()</code>.</p> </dd> </dl> </dd> </dl> </section><section class="content-section" aria-labelledby="return_value"> <h3 id="return_value" class="heading">Return value</h3> <p>The value associated with the specified key in the <code>WeakMap</code> object. If the key can't be found, the result of <code>callback(key)</code> is inserted and returned.</p> </section><section class="content-section" aria-labelledby="examples"> <h2 id="examples" class="heading">Examples</h2> &gt; </section><section class="content-section" aria-labelledby="caching"> <h3 id="caching" class="heading">Caching</h3> <p>Caching involves building a mapping from the parameter of an expensive function to its return value, so that future calls with the same parameter can return the cached value instead of recomputing it. When no cached value exists, it needs to be computed and inserted into the cache.</p> <p>We use a <code>WeakMap</code> here instead of a <code>Map</code>, so that the cached argument values do not prevent them from being garbage-collected if they are no longer needed elsewhere in the program. If your cached function takes non-object arguments, you can use a <code>Map</code> instead.</p> <div class="code-example"><pre data-language="js">// Any expensive function you want to cache
function computeExpensiveValue(requestOptions) {
  // Imagine expensive computation, like fetching data or complex calculations
  console.log(`Fetching from ${requestOptions.url}`);
  return new Response("Fake response");
}

// A higher-order function that adds caching to any function
function withCache(fn) {
  const cache = new WeakMap();
  return (param) =&gt; cache.getOrInsertComputed(param, fn);
}

const computeWithCache = withCache(computeExpensiveValue);
const options = { url: "https://example.com/a", method: "GET" };
const value1 = computeWithCache(options); // Logs "Fetching from https://example.com/a"
const value2 = computeWithCache(options); // No log
</pre></div> </section><section class="content-section" aria-labelledby="specifications"> <h2 id="specifications" class="heading">Specifications</h2> <div class="_table"><table> <thead> <tr> <th scope="col">Specification</th> </tr> </thead> <tbody> <tr> <td><a href="https://tc39.es/proposal-upsert/#sec-weakmap.prototype.getOrInsertComputed" rel="noopener" target="_blank">Upsert&gt;<br># sec-weakmap.prototype.getOrInsertComputed&gt;</a></td> </tr> </tbody> </table></div> </section><section class="content-section" aria-labelledby="browser_compatibility"> <h2 id="browser_compatibility" class="heading">Browser compatibility</h2> <div class="_table"><table>
<thead>
<tr id="bct-browser-type">
<th></th>
<th colspan="5">Desktop</th>
<th colspan="7">Mobile</th>
<th colspan="3">Server</th>
</tr>
<tr id="bct-browsers">
<th></th>
<th>Chrome</th>
<th>Edge</th>
<th>Firefox</th>
<th>Opera</th>
<th>Safari</th>
<th>Chrome Android</th>
<th>Firefox for Android</th>
<th>Opera Android</th>
<th>Safari on IOS</th>
<th>Samsung Internet</th>
<th>WebView Android</th>
<th>WebView on iOS</th>
<th>Bun</th>
<th>Deno</th>
<th>Node.js</th>
</tr>
</thead>
<tbody><tr>
<th><code>getOrInsertComputed</code></th>
<td class="bc-supports-preview"><abbr title="Release date: 2026-02-10">145</abbr></td>
<td class="bc-supports-preview"><abbr title="Release date: 2026-02-12">145</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-10-14">144</abbr></td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-12-12">26.2</abbr></td>
<td class="bc-supports-preview"><abbr title="Release date: 2026-02-10">145</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-10-14">144</abbr></td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-12-12">26.2</abbr></td>
<td class="bc-supports-no">No</td>
<td class="bc-supports-preview"><abbr title="Release date: 2026-02-10">145</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-12-12">26.2</abbr></td>
<td class="bc-supports-yes"><abbr title="Release date: 2025-08-10">1.2.20</abbr></td>
<td>?</td>
<td>?</td>
</tr></tbody>
</table></div> </section><section class="content-section" aria-labelledby="see_also"> <h2 id="see_also" class="heading">See also</h2> <ul> <li><a href="https://github.com/zloirock/core-js#map-upsert" target="_blank">Polyfill of <code>WeakMap.prototype.getOrInsertComputed</code> in <code>core-js</code></a></li> <li><a href="https://www.npmjs.com/package/weakmap.prototype.getorinsertcomputed" target="_blank">es-shims polyfill of <code>WeakMap.prototype.getOrInsertComputed</code></a></li> <li><a href="../weakmap"><code>WeakMap</code></a></li> <li><a href="get"><code>WeakMap.prototype.get()</code></a></li> <li><a href="set"><code>WeakMap.prototype.set()</code></a></li> <li><a href="has"><code>WeakMap.prototype.has()</code></a></li> <li><a href="getorinsert"><code>WeakMap.prototype.getOrInsert()</code></a></li> </ul> </section><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2005&ndash;2025 MDN contributors.<br>Licensed under the Creative Commons Attribution-ShareAlike License v2.5 or later.<br>
    <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap/getOrInsertComputed" class="_attribution-link">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap/getOrInsertComputed</a>
  </p>
</div>
