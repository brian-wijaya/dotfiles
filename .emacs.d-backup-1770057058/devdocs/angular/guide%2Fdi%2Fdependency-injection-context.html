<h1 tabindex="-1">Injection context</h1> <header class="docs-header"> <docs-breadcrumb ng-version="21.0.3" _nghost-ng-c3945279308 ngh="8"></docs-breadcrumb>   </header> <p>The dependency injection (DI) system relies internally on a runtime context where the current injector is available.</p> <p>This means that injectors can only work when code is executed in such a context.</p> <p>The injection context is available in these situations:</p> <ul class="docs-list"> <li>During construction (via the <code>constructor</code>) of a class being instantiated by the DI system, such as an <a href="../../api/core/injectable"><code>@Injectable</code></a> or <a href="../../api/core/component"><code>@Component</code></a>.</li> <li>In the initializer for fields of such classes.</li> <li>In the factory function specified for <code>useFactory</code> of a <a href="../../api/core/provider"><code>Provider</code></a> or an <a href="../../api/core/injectable"><code>@Injectable</code></a>.</li> <li>In the <code>factory</code> function specified for an <a href="../../api/core/injectiontoken"><code>InjectionToken</code></a>.</li> <li>Within a stack frame that runs in an injection context.</li> </ul> <p>Knowing when you are in an injection context will allow you to use the <a href="../../api/core/inject"><code>inject</code></a> function to inject instances.</p> 
<div class="docs-alert docs-alert-note"> <p><strong>NOTE:</strong> For basic examples of using <code>inject()</code> in class constructors and field initializers, see the <a href="../di#where-can-inject-be-used">overview guide</a>.</p> </div>  <h2 id="stack-frame-in-context"> Stack frame in context </h2> <p>Some APIs are designed to be run in an injection context. This is the case, for example, with router guards. This allows the use of <a href="../../api/core/inject"><code>inject</code></a> within the guard function to access a service.</p> <p>Here is an example for <a href="../../api/router/canactivatefn"><code>CanActivateFn</code></a></p> <pre data-language="ts">const canActivateTeam: CanActivateFn =
  (route: ActivatedRouteSnapshot, state: RouterStateSnapshot) =&gt; {
    return inject(PermissionsService).canActivate(inject(UserToken), route.params.id);
  };</pre> <h2 id="run-within-an-injection-context"> Run within an injection context </h2> <p>When you want to run a given function in an injection context without already being in one, you can do so with <a href="../../api/core/runininjectioncontext"><code>runInInjectionContext</code></a>. This requires access to a given injector, like the <a href="../../api/core/environmentinjector"><code>EnvironmentInjector</code></a>, for example:</p> <pre data-language="ts">@Injectable({
  providedIn: 'root'
})
export class HeroService {
  private environmentInjector = inject(EnvironmentInjector);

  someMethod() {
    runInInjectionContext(this.environmentInjector, () =&gt; {
      inject(SomeService); // Do what you need with the injected service
    });
  }
}</pre>
<p>Note that <a href="../../api/core/inject"><code>inject</code></a> will return an instance only if the injector can resolve the required token.</p> <h2 id="asserts-the-context"> Asserts the context </h2> <p>Angular provides the <a href="../../api/core/assertininjectioncontext"><code>assertInInjectionContext</code></a> helper function to assert that the current context is an injection context and throws a clear error if not. Pass a reference to the calling function so the error message points to the correct API entry point. This produces a clearer, more actionable message than the default generic injection error.</p> <pre data-language="ts">import { ElementRef, assertInInjectionContext, inject } from '@angular/core';

export function injectNativeElement&lt;T extends Element&gt;(): T {
    assertInInjectionContext(injectNativeElement);
    return inject(ElementRef).nativeElement;
}</pre>
<p>You can then call this helper <strong>from an injection context</strong> (constructor, field initializer, provider factory, or code executed via <a href="../../api/core/runininjectioncontext"><code>runInInjectionContext</code></a>):</p> <pre data-language="ts">import { Component, inject } from '@angular/core';
import { injectNativeElement } from './dom-helpers';

@Component({ /* â€¦ */ })
export class PreviewCard {
  readonly hostEl = injectNativeElement&lt;HTMLElement&gt;(); // Field initializer runs in an injection context.

  onAction() {
    const anotherRef = injectNativeElement&lt;HTMLElement&gt;(); // Fails: runs outside an injection context.
  }
}</pre> <h2 id="using-di-outside-of-a-context"> Using DI outside of a context </h2> <p>Calling <a href="../../api/core/inject"><code>inject</code></a> or calling <a href="../../api/core/assertininjectioncontext"><code>assertInInjectionContext</code></a> outside of an injection context will throw <a href="https://angular.dev/errors/NG0203">error NG0203</a>.</p><div class="_attribution">
  <p class="_attribution-p">
    Super-powered by Google &copy;2010&ndash;2025.<br />Code licensed under an MIT-style License. Documentation licensed under CC BY 4.0.<br>
    <a href="https://angular.dev/guide/di/dependency-injection-context" class="_attribution-link">https://angular.dev/guide/di/dependency-injection-context</a>
  </p>
</div>
