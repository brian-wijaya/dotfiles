<h1 tabindex="-1">Migrating from Karma to Vitest</h1> <header class="docs-header"> <docs-breadcrumb ng-version="21.0.3" _nghost-ng-c3945279308 ngh="8"></docs-breadcrumb>   </header> <p>The Angular CLI uses <a href="https://vitest.dev/" target="_blank">Vitest</a> as the default unit test runner for new projects. This guide provides instructions for migrating an existing project from Karma and Jasmine to Vitest.</p> 
<div class="docs-alert docs-alert-important"> <p><strong>IMPORTANT:</strong> Migrating an existing project to Vitest is considered experimental. This process also requires the use of the <code>application</code> build system, which is the default for all newly created projects.</p> </div>  <h2 id="manual-migration-steps"> Manual migration steps </h2> <p>Before using the automated refactoring schematic, you must manually update your project to use the Vitest test runner.</p> <h3 id="1-install-dependencies"> 1. Install dependencies </h3> <p>Install <code>vitest</code> and a DOM emulation library. While browser testing is still possible (see <a href="#5-configure-browser-mode-optional">step 5</a>), Vitest uses a DOM emulation library by default to simulate a browser environment within Node.js for faster test execution. The CLI automatically detects and uses <code>happy-dom</code> if it's installed; otherwise, it falls back to <code>jsdom</code>. You must have one of these packages installed.</p> <div class="docs-code-multifile" style="display: none"> <pre data-language="ts">npm install --save-dev vitest jsdom</pre>
<pre data-language="ts">yarn add --dev vitest jsdom</pre>
<pre data-language="ts">pnpm add -D vitest jsdom</pre>
<pre data-language="ts">bun add --dev vitest jsdom</pre> </div> <h3 id="2-update-angularjson"> 2. Update angular.json </h3> <p>In your <code>angular.json</code> file, find the <code>test</code> target for your project and change the <code>builder</code> to <code>@angular/build:unit-test</code>.</p> <pre data-language="ts">{
  "projects": {
    "your-project-name": {
      "architect": {
        "test": {
          "builder": "@angular/build:unit-test"
        }
      }
    }
  }
}</pre>
<p>The <code>unit-test</code> builder defaults to <code>"tsConfig": "tsconfig.spec.json"</code> and <code>"buildTarget": "::development"</code>. You can explicitly set these options if your project requires different values. For example, if the <code>development</code> build configuration is missing or you need different options for testing, you can create and use a <code>testing</code> or similarly named build configuration for <code>buildTarget</code>.</p> <p>The <code>@angular/build:karma</code> builder previously allowed build options (like <code>polyfills</code>, <code>assets</code>, or <code>styles</code>) to be configured directly within the <code>test</code> target. The new <code>@angular/build:unit-test</code> builder does not support this. If your test-specific build options differ from your existing <code>development</code> build configuration, you must move them to a dedicated build target configuration. If your test build options already match your <code>development</code> build configuration, no action is needed.</p> <h3 id="3-handle-custom-karmaconfjs-configurations"> 3. Handle custom karma.conf.js configurations </h3> <p>Custom configurations in <code>karma.conf.js</code> are not automatically migrated. Before deleting your <code>karma.conf.js</code> file, review it for any custom settings that need to be migrated.</p> <p>Many Karma options have equivalents in Vitest that can be set in a custom Vitest configuration file (e.g., <code>vitest.config.ts</code>) and linked to your <code>angular.json</code> via the <code>runnerConfig</code> option.</p> <p>Common migration paths include:</p> <ul class="docs-list"> <li>
<strong>Reporters</strong>: Karma reporters must be replaced with Vitest-compatible reporters. These can often be configured directly in your <code>angular.json</code> under the <code>test.options.reporters</code> property. For more advanced configurations, use a custom <code>vitest.config.ts</code> file.</li> <li>
<strong>Plugins</strong>: Karma plugins may have Vitest equivalents that you will need to find and install. Note that code coverage is a first-class feature in the Angular CLI and can be enabled with <code>ng test --coverage</code>.</li> <li>
<strong>Custom Browser Launchers</strong>: These are replaced by the <code>browsers</code> option in <code>angular.json</code> and the installation of a browser provider like <code>@vitest/browser-playwright</code>.</li> </ul> <p>For other settings, consult the official <a href="https://vitest.dev/config/" target="_blank">Vitest documentation</a>.</p> <h3 id="4-remove-karma-and-testts-files"> 4. Remove Karma and test.ts files </h3> <p>You can now delete <code>karma.conf.js</code> and <code>src/test.ts</code> from your project and uninstall the Karma-related packages. The following commands are based on the packages installed in a new Angular CLI project; your project may have other Karma-related packages to remove.</p> <div class="docs-code-multifile" style="display: none"> <pre data-language="ts">npm uninstall karma karma-chrome-launcher karma-coverage karma-jasmine karma-jasmine-html-reporter</pre>
<pre data-language="ts">yarn remove karma karma-chrome-launcher karma-coverage karma-jasmine karma-jasmine-html-reporter</pre>
<pre data-language="ts">pnpm remove karma karma-chrome-launcher karma-coverage karma-jasmine karma-jasmine-html-reporter</pre>
<pre data-language="ts">bun remove karma karma-chrome-launcher karma-coverage karma-jasmine karma-jasmine-html-reporter</pre> </div> <h3 id="5-configure-browser-mode-optional"> 5. Configure browser mode (optional) </h3> <p>If you need to run tests in a real browser, you must install a browser provider and configure your <code>angular.json</code>.</p> <p><strong>Install a browser provider:</strong></p> <p>Choose one of the following browser providers based on your needs:</p> <ul class="docs-list"> <li>
<strong>Playwright</strong>: <code>@vitest/browser-playwright</code> for Chromium, Firefox, and WebKit.</li> <li>
<strong>WebdriverIO</strong>: <code>@vitest/browser-webdriverio</code> for Chrome, Firefox, Safari, and Edge.</li> <li>
<strong>Preview</strong>: <code>@vitest/browser-preview</code> for Webcontainer environments (like StackBlitz).</li> </ul> <div class="docs-code-multifile" style="display: none"> <pre data-language="ts">npm install --save-dev @vitest/browser-playwright</pre>
<pre data-language="ts">yarn add --dev @vitest/browser-playwright</pre>
<pre data-language="ts">pnpm add -D @vitest/browser-playwright</pre>
<pre data-language="ts">bun add --dev @vitest/browser-playwright</pre> </div>
<p><strong>Update <code>angular.json</code> for browser mode:</strong></p> <p>Add the <code>browsers</code> option to your <code>test</code> target's options. The browser name depends on the provider you installed (e.g., <code>chromium</code> for Playwright, <code>chrome</code> for WebdriverIO).</p> <pre data-language="ts">{
  "projects": {
    "your-project-name": {
      "architect": {
        "test": {
          "builder": "@angular/build:unit-test",
          "options": {
            "browsers": ["chromium"]
          }
        }
      }
    }
  }
}</pre>
<p>Headless mode is enabled automatically if the <code>CI</code> environment variable is set or if a browser name includes "Headless" (e.g., <code>ChromeHeadless</code>). Otherwise, tests will run in a headed browser.</p> <h2 id="automated-test-refactoring-with-schematics"> Automated test refactoring with schematics </h2> 
<div class="docs-alert docs-alert-important"> <p><strong>IMPORTANT:</strong> The <code>refactor-jasmine-vitest</code> schematic is experimental and may not cover all possible test patterns. Always review the changes made by the schematic.</p> </div>  <p>The Angular CLI provides the <code>refactor-jasmine-vitest</code> schematic to automatically refactor your Jasmine tests to use Vitest.</p> <h3 id="overview"> Overview </h3> <p>The schematic automates the following transformations in your test files (<code>.spec.ts</code>):</p> <ul class="docs-list"> <li>Converts <code>fit</code> and <code>fdescribe</code> to <code>it.only</code> and <code>describe.only</code>.</li> <li>Converts <code>xit</code> and <code>xdescribe</code> to <code>it.skip</code> and <code>describe.skip</code>.</li> <li>Converts <code>spyOn</code> calls to the equivalent <code>vi.spyOn</code>.</li> <li>Replaces <code>jasmine.objectContaining</code> with <code>expect.objectContaining</code>.</li> <li>Replaces <code>jasmine.any</code> with <code>expect.any</code>.</li> <li>Replaces <code>jasmine.createSpy</code> with <code>vi.fn</code>.</li> <li>Updates <code>beforeAll</code>, <code>beforeEach</code>, <code>afterAll</code>, and <code>afterEach</code> to their Vitest equivalents.</li> <li>Converts <code>fail()</code> to Vitest's <code>vi.fail()</code>.</li> <li>Adjusts expectations to match Vitest APIs</li> <li>Adds TODO comments for code that cannot be automatically converted</li> </ul> <p>The schematic <strong>does not</strong> perform the following actions:</p> <ul class="docs-list"> <li>It does not install <code>vitest</code> or other related dependencies.</li> <li>It does not change your <code>angular.json</code> to use the Vitest builder or migrate any build options (like <code>polyfills</code> or <code>styles</code>) from the <code>test</code> target.</li> <li>It does not remove <code>karma.conf.js</code> or <code>test.ts</code> files.</li> <li>It does not handle complex or nested spy scenarios, which may require manual refactoring.</li> </ul> <h3 id="running-the-schematic"> Running the schematic </h3> <p>Once your project is configured for Vitest, you can run the schematic to refactor your test files.</p> <p>To refactor <strong>all</strong> test files in your default project, run:</p> <pre data-language="ts">ng g @schematics/angular:refactor-jasmine-vitest</pre> <h3 id="options"> Options </h3> <p>You can use the following options to customize the schematic's behavior:</p> <div class="docs-table docs-scroll-track-transparent"> <table> <thead> <tr> <th align="left">Option</th> <th align="left">Description</th> </tr> </thead> <tbody> <tr> <td align="left"><code>--project &lt;name&gt;</code></td> <td align="left">Specify the project to refactor in a multi-project workspace. <br> Example: <code>--project=my-lib</code>
</td> </tr> <tr> <td align="left"><code>--include &lt;path&gt;</code></td> <td align="left">Refactor only a specific file or directory. <br> Example: <code>--include=src/app/app.component.spec.ts</code>
</td> </tr> <tr> <td align="left"><code>--file-suffix &lt;suffix&gt;</code></td> <td align="left">Specify a different file suffix for test files. <br> Example: <code>--file-suffix=.test.ts</code>
</td> </tr> <tr> <td align="left"><code>--add-imports</code></td> <td align="left">Add explicit <code>vitest</code> imports if you have disabled globals in your Vitest configuration.</td> </tr> <tr> <td align="left"><code>--verbose</code></td> <td align="left">See detailed logging of all transformations applied.</td> </tr> </tbody> </table> </div> <h3 id="after-migrating"> After migrating </h3> <p>After the schematic completes, it's a good practice to:</p> <ol class="docs-ordered-list"> <li>
<strong>Run your tests</strong>: Execute <code>ng test</code> to ensure that all tests still pass after the refactoring.</li> <li>
<strong>Review the changes</strong>: Look over the changes made by the schematic, paying close attention to any complex tests, especially those with intricate spies or mocks, as they may require further manual adjustments.</li> </ol> <p>The <code>ng test</code> command builds the application in <em>watch mode</em> and launches the configured runner. Watch mode is enabled by default when using an interactive terminal and not running on CI.</p> <h2 id="configuration"> Configuration </h2> <p>The Angular CLI takes care of the Vitest configuration for you, constructing the full configuration in memory based on options in <code>angular.json</code>.</p> <h3 id="custom-vitest-configuration"> Custom Vitest configuration </h3> 
<div class="docs-alert docs-alert-important"> <p><strong>IMPORTANT:</strong> While using a custom configuration enables advanced options, the Angular team does not provide direct support for the specific contents of the configuration file or for any third-party plugins used within it. The CLI will also override certain properties (<code>test.projects</code>, <code>test.include</code>) to ensure proper operation.</p> </div>  <p>You can provide a custom Vitest configuration file to override the default settings. For a full list of available options, see the official <a href="https://vitest.dev/config/" target="_blank">Vitest documentation</a>.</p> <p><strong>1. Direct path:</strong> Provide a direct path to a Vitest configuration file in your <code>angular.json</code>:</p> <pre data-language="ts">{
  "projects": {
    "your-project-name": {
      "architect": {
        "test": {
          "builder": "@angular/build:unit-test",
          "options": { "runnerConfig": "vitest.config.ts" }
        }
      }
    }
  }
}</pre>
<p><strong>2. Automatic search for base configuration:</strong> If you set <code>runnerConfig</code> to <code>true</code>, the builder will automatically search for a shared <code>vitest-base.config.*</code> file in your project and workspace roots.</p> <h2 id="bug-reports"> Bug reports </h2> <p>Report issues and feature requests on <a href="https://github.com/angular/angular-cli/issues" target="_blank">GitHub</a>.</p> <p>Please provide a minimal reproduction where possible to aid the team in addressing issues.</p><div class="_attribution">
  <p class="_attribution-p">
    Super-powered by Google &copy;2010&ndash;2025.<br />Code licensed under an MIT-style License. Documentation licensed under CC BY 4.0.<br>
    <a href="https://angular.dev/guide/testing/migrating-to-vitest" class="_attribution-link">https://angular.dev/guide/testing/migrating-to-vitest</a>
  </p>
</div>
