<header><h1>Workspaces</h1></header><h2 class="anchor anchorWithStickyNavbar_hhKX" id="what-are-workspaces">What are workspaces?<a href="#what-are-workspaces" class="hash-link" aria-label="Direct link to What are workspaces?" title="Direct link to What are workspaces?">​</a>
</h2> <p>Workspaces are the name of individual packages that are part of the same project and that Yarn will install and link together to simplify cross-references.</p> <p>This pattern is often called monorepo when used in conjunction with a repository. Workspaces were initially popularized by projects like Lerna, but Yarn was the first package manager to provide native support for them - support which never stopped improving over years as we build more features around them.</p> <div class="theme-admonition theme-admonition-info admonition_w2cE alert alert--info">
<div class="admonitionHeading_zjKb">
<span class="admonitionIcon_xnvX"><svg viewbox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div>
<div class="admonitionContent_SoUl"><p>We always try to dogfood the features we offer, and workspaces are a prime example: Yarn is composed of a couple of dozens of packages that can each be deployed independently if needed!</p></div>
</div> <h2 class="anchor anchorWithStickyNavbar_hhKX" id="when-should-i-use-workspaces">When should I use workspaces?<a href="#when-should-i-use-workspaces" class="hash-link" aria-label="Direct link to When should I use workspaces?" title="Direct link to When should I use workspaces?">​</a>
</h2> <p>Workspaces shine in many situations, with the main ones being:</p> <ul> <li> <p>When a project has a core package surrounded with various add-ons; this is for example the case for Babel.</p> </li> <li> <p>When you need to publish multiple packages and want to avoid your contributors having to open PRs on many separate repositories whenever they want to make a change. This is for example the case for Jest.</p> </li> <li> <p>Or when projects want to keep strict boundaries within their code and avoid becoming an entangled monolith. This is for example the case for Yarn itself, or many enterprise codebases.</p> </li> </ul> <p>There's been a significant amount of discussions about whether monorepos are good or bad, with decent arguments on both side. Our team worked with monorepos for years at this point, and with the tooling Yarn provides, the value has always outweighed the cons by a large margin. If you need to create another package for your project, consider whether grouping them together makes sense.</p> <div class="theme-admonition theme-admonition-tip admonition_w2cE alert alert--success">
<div class="admonitionHeading_zjKb">
<span class="admonitionIcon_xnvX"><svg viewbox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div>
<div class="admonitionContent_SoUl"><p>You don't need to split your code in many workspaces for them to become useful. For instance, the <a href="https://github.com/arcanis/clipanion" target="_blank" rel="noopener noreferrer">Clipanion repository</a> uses only two workspaces, one for the library and one for its website. This patterns avoids mixing dependencies while also making it easy to author PRs that affect both the code and the documentation.</p></div>
</div> <h2 class="anchor anchorWithStickyNavbar_hhKX" id="how-are-workspaces-declared">How are workspaces declared?<a href="#how-are-workspaces-declared" class="hash-link" aria-label="Direct link to How are workspaces declared?" title="Direct link to How are workspaces declared?">​</a>
</h2> <p>To declare a workspace, all you have to do is add a <code data-tooltip-id="tooltip" data-tooltip-content="Array of folder glob patterns referencing the workspaces of the project."><a class="key_FEvO" href="../configuration/manifest#workspaces">workspaces</a></code> array to the root <code>package.json</code> file, and list relative glob patterns pointing to your workspaces' folders. In the following example, all subdirectories in the <code>packages</code> folder will become workspaces.</p> <div class="language-json codeBlockContainer_iUqV theme-code-block"><div class="codeBlockContent_Xs1n">
<pre tabindex="0" class="prism-code language-json codeBlock_hDG7 thin-scrollbar" data-language="json">{
  "workspaces": [
    "packages/*"
  ]
}</pre>
<div class="buttonGroup_ipu6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FbbJ" aria-hidden="true"><svg viewbox="0 0 24 24" class="copyButtonIcon_Nh6j"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewbox="0 0 24 24" class="copyButtonSuccessIcon_wXPl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div>
</div></div> <h2 class="anchor anchorWithStickyNavbar_hhKX" id="workspace-related-features">Workspace-related features<a href="#workspace-related-features" class="hash-link" aria-label="Direct link to Workspace-related features" title="Direct link to Workspace-related features">​</a>
</h2> <h3 class="anchor anchorWithStickyNavbar_hhKX" id="constraints">Constraints<a href="#constraints" class="hash-link" aria-label="Direct link to Constraints" title="Direct link to Constraints">​</a>
</h3> <p>Constraints are to monorepos what Eslint is to your source code. They let you declare rules that must apply to specific workspaces in your project. For example, you can use constraints to enforce that all dependencies in your project are synchronized, to prevent some dependencies from being used, or to enforce that some fields such as <code data-tooltip-id="tooltip" data-tooltip-content="SPDX identifier defining the license under which the package is distributed."><a class="key_FEvO" href="../configuration/manifest#license">license</a></code> or <code>engines.node</code> are properly set everywhere.</p> <p>For more information and examples about constraints, check the <a href="constraints">dedicated article</a>.</p> <h3 class="anchor anchorWithStickyNavbar_hhKX" id="cross-references">Cross-references<a href="#cross-references" class="hash-link" aria-label="Direct link to Cross-references" title="Direct link to Cross-references">​</a>
</h3> <p>Packages from monorepos often need to depend on each other - for example when you have an app package depending on a separate library. Yarn makes it very easy thanks to the special <code>workspace:</code> protocol, which lets you instruct Yarn to resolve the dependency using the workspace of the same name in the project. For example:</p> <div class="language-json codeBlockContainer_iUqV theme-code-block"><div class="codeBlockContent_Xs1n">
<pre tabindex="0" class="prism-code language-json codeBlock_hDG7 thin-scrollbar" data-language="json">{
  "dependencies": {
    "@my-org/utils": "workspace:^"
  }
}</pre>
<div class="buttonGroup_ipu6"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_FbbJ" aria-hidden="true"><svg viewbox="0 0 24 24" class="copyButtonIcon_Nh6j"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewbox="0 0 24 24" class="copyButtonSuccessIcon_wXPl"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div>
</div></div> <p>The <code>workspace:</code> protocol accepts either a regular semver range, or the special <code>^</code> / <code>~</code> / <code>*</code> tokens. Whatever the value is won't change how Yarn will resolve the dependency (it will only ever care about the dependency name), but it will affect what the dependency will look like after the package gets published via <span class="inline_hdsZ"><code><span class="token_Ye2a" data-type="binary">yarn</span> <a class="path_tCL7" data-tooltip-id="tooltip" data-tooltip-content="Publish the active workspace to the npm registry
" href="../cli/npm/publish"><span class="token_Ye2a" data-type="path">npm</span> <span class="token_Ye2a" data-type="path">publish</span></a></code></span>. For example, if the following ranges are used against a workspace whose <code data-tooltip-id="tooltip" data-tooltip-content="Version of the package."><a class="key_FEvO" href="../configuration/manifest#version">version</a></code> field is set to <code>3.2.1</code>:</p> <table>
<thead><tr>
<th>Initial range</th>
<th>Range after publish</th>
</tr></thead>
<tbody>
<tr>
<td><code>workspace:^3.0.0</code></td>
<td><code>^3.0.0</code></td>
</tr>
<tr>
<td><code>workspace:^</code></td>
<td><code>^3.2.1</code></td>
</tr>
<tr>
<td><code>workspace:~</code></td>
<td><code>~3.2.1</code></td>
</tr>
<tr>
<td><code>workspace:*</code></td>
<td><code>=3.2.1</code></td>
</tr>
</tbody>
</table> <h3 class="anchor anchorWithStickyNavbar_hhKX" id="focused-installs">Focused installs<a href="#focused-installs" class="hash-link" aria-label="Direct link to Focused installs" title="Direct link to Focused installs">​</a>
</h3> <p>A common concern when discovering workspaces is how you need to install all of their dependencies whenever you wish to work on a single one of them. Yarn provides a solution via <span class="inline_hdsZ"><code><span class="token_Ye2a" data-type="binary">yarn</span> <a class="path_tCL7" data-tooltip-id="tooltip" data-tooltip-content="Install a single workspace and its dependencies
" href="../cli/workspaces/focus"><span class="token_Ye2a" data-type="path">workspaces</span> <span class="token_Ye2a" data-type="path">focus</span></a></code></span>.</p> <p>This command takes a list of workspaces, extend the list to include transitive dependencies, and exclude everything else from the install. For example, the following would let you install only the dependencies required for your main app to be built and deployed:</p>  <p>If you wish to also skip installing <code data-tooltip-id="tooltip" data-tooltip-content="Set of dependencies that must be made available to the current package in order for it to work properly as a workspace."><a class="key_FEvO" href="../configuration/manifest#devDependencies">devDependencies</a></code>, set the <span class="inline_hdsZ"><code><span class="token_Ye2a" data-type="dash">--</span><span class="token_Ye2a" data-type="option" data-tooltip-id="tooltip" data-tooltip-content="Only install regular dependencies by omitting dev dependencies">production</span></code></span> flag. In the following example, Yarn will install the dependencies from all workspaces, but only the production ones:</p>  <h3 class="anchor anchorWithStickyNavbar_hhKX" id="global-scripts">Global scripts<a href="#global-scripts" class="hash-link" aria-label="Direct link to Global scripts" title="Direct link to Global scripts">​</a>
</h3> <p>Scripts defined in the <code data-tooltip-id="tooltip" data-tooltip-content="Set of scripts to expose via `yarn run script-name`, or as lifecycle hooks."><a class="key_FEvO" href="../configuration/manifest#scripts">scripts</a></code> field from the <code>package.json</code> files can be run using <span class="inline_hdsZ"><code><span class="token_Ye2a" data-type="binary">yarn</span> <a class="path_tCL7" data-tooltip-id="tooltip" data-tooltip-content="Run a script defined in the package.json
" href="../cli/run"><span class="token_Ye2a" data-type="path">run</span></a> <span class="token_Ye2a" data-type="positional">name</span></code></span>, but only if you run the command from within the workspaces that declare them. That is, unless they are global scripts.</p> <p>Global scripts are characterized by at least one colon (<code>:</code>) in the script name. They can be run from anywhere within the project, as long as there are no duplicates (if two workspaces define scripts with the same names, they won't be upgraded into global scripts).</p> <h3 class="anchor anchorWithStickyNavbar_hhKX" id="parallel-execution">Parallel execution<a href="#parallel-execution" class="hash-link" aria-label="Direct link to Parallel execution" title="Direct link to Parallel execution">​</a>
</h3> <p>Scripts from multiple workspaces can be run in parallel if they share the same name, by using <span class="inline_hdsZ"><code><span class="token_Ye2a" data-type="binary">yarn</span> <a class="path_tCL7" data-tooltip-id="tooltip" data-tooltip-content="Run a command on all workspaces
" href="../cli/workspaces/foreach"><span class="token_Ye2a" data-type="path">workspaces</span> <span class="token_Ye2a" data-type="path">foreach</span></a></code></span>. The following example shows you how to publish all packages in your project in parallel, but respecting topological order (so that a workspace only gets published once all other workspaces it depends on did):</p>  <p>The <span class="inline_hdsZ"><code><span class="token_Ye2a" data-type="dash">--</span><span class="token_Ye2a" data-type="option" data-tooltip-id="tooltip" data-tooltip-content="Run the command on all workspaces of a project">all</span></code></span> flag will run the provided command on every workspace in the project, but it can be tweaked. In this example we use the <span class="inline_hdsZ"><code><span class="token_Ye2a" data-type="dash">--</span><span class="token_Ye2a" data-type="option" data-tooltip-id="tooltip" data-tooltip-content="Only include workspaces that have been changed since the specified ref.">since</span></code></span> flag to instead only select workspaces that were modified in the current branch compared to the <a href="https://yarnpkg.com/">main branch</a>:</p>  <p>Similarly, the <span class="inline_hdsZ"><code><span class="token_Ye2a" data-type="dash">--</span><span class="token_Ye2a" data-type="option" data-tooltip-id="tooltip" data-tooltip-content="An array of glob pattern idents or paths from which to base any recursion">from</span> <span class="token_Ye2a" data-type="value">pattern</span></code></span> flag will instead select all workspaces matching the provided glob pattern. As for all other Yarn commands, this flag will be applied to both workspace names and paths relative to the current working directory. For example, this command will run the <code>build</code> script on the current workspace and all other workspaces it depends on:</p> <div class="_attribution">
  <p class="_attribution-p">
    &copy; 2016&ndash;present Yarn Contributors<br>Licensed under the BSD License.<br>
    <a href="https://yarnpkg.com/features/workspaces" class="_attribution-link">https://yarnpkg.com/features/workspaces</a>
  </p>
</div>
