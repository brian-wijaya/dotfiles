<h1 id="header">DNS</h1>
<div data-page-title="DNS" data-page-href="/runtime/networking/dns" id="content">
<span data-as="p">Bun implements it’s own <code>dns</code> module, and the <code>node:dns</code> module.</span> <pre numberoflines="5" language="typescript" data-language="typescript">import * as dns from "node:dns";

const addrs = await dns.promises.resolve4("bun.com", { ttl: true });
console.log(addrs);
// =&gt; [{ address: "172.67.161.226", family: 4, ttl: 0 }, ...]
</pre> <pre numberoflines="3" language="typescript" data-language="typescript">import { dns } from "bun";

dns.prefetch("bun.com", 443);
</pre> <hr> <h2 id="dns-caching-in-bun"><span>DNS caching in Bun</span></h2> <span data-as="p">Bun supports DNS caching. This cache makes repeated connections to the same hosts faster.</span> <span data-as="p">At the time of writing, we cache up to 255 entries for a maximum of 30 seconds (each). If any connections to a host fail, we remove the entry from the cache. When multiple connections are made to the same host simultaneously, DNS lookups are deduplicated to avoid making multiple requests for the same host.</span> <span data-as="p">This cache is automatically used by:</span> <ul> <li><code>bun install</code></li> <li><code>fetch()</code></li> <li>
<code>node:http</code> (client)</li> <li><code>Bun.connect</code></li> <li><code>node:net</code></li> <li><code>node:tls</code></li> </ul> <h3 id="when-should-i-prefetch-a-dns-entry"><span>When should I prefetch a DNS entry?</span></h3> <span data-as="p">Web browsers expose <a href="https://developer.mozilla.org/en-US/docs/Web/Performance/dns-prefetch" target="_blank" rel="noreferrer"><code>&lt;link rel="dns-prefetch"&gt;</code></a> to allow developers to prefetch DNS entries. This is useful when you know you’ll need to connect to a host in the near future and want to avoid the initial DNS lookup.</span> <span data-as="p">In Bun, you can use the <code>dns.prefetch</code> API to achieve the same effect.</span> <pre numberoflines="3" language="typescript" data-language="typescript">import { dns } from "bun";

dns.prefetch("my.database-host.com", 5432);
</pre> <span data-as="p">An example where you might want to use this is a database driver. When your application first starts up, you can prefetch the DNS entry for the database host so that by the time it finishes loading everything, the DNS query to resolve the database host may already be completed.</span> <h3 id="dns-prefetch"><span><code>dns.prefetch</code></span></h3> <div data-callout-type="warning">

<div data-component-part="callout-content">This API is experimental and may change in the future.</div>
</div> <span data-as="p">To prefetch a DNS entry, you can use the <code>dns.prefetch</code> API. This API is useful when you know you’ll need to connect to a host soon and want to avoid the initial DNS lookup.</span> <pre numberoflines="1" language="typescript" data-language="typescript">dns.prefetch(hostname: string, port: number): void;
</pre> <span data-as="p">Here’s an example:</span> <pre numberoflines="6" language="typescript" data-language="typescript">import { dns } from "bun";

dns.prefetch("bun.com", 443);
//
// ... sometime later ...
await fetch("https://bun.com");
</pre> <h3 id="dns-getcachestats"><span><code>dns.getCacheStats()</code></span></h3> <div data-callout-type="warning">

<div data-component-part="callout-content">This API is experimental and may change in the future.</div>
</div> <span data-as="p">To get the current cache stats, you can use the <code>dns.getCacheStats</code> API. This API returns an object with the following properties:</span> <pre numberoflines="8" language="typescript" data-language="typescript">{
  cacheHitsCompleted: number; // Cache hits completed
  cacheHitsInflight: number; // Cache hits in flight
  cacheMisses: number; // Cache misses
  size: number; // Number of items in the DNS cache
  errors: number; // Number of times a connection failed
  totalCount: number; // Number of times a connection was requested at all (including cache hits and misses)
}
</pre> <span data-as="p">Example:</span> <pre numberoflines="5" language="typescript" data-language="typescript">import { dns } from "bun";

const stats = dns.getCacheStats();
console.log(stats);
// =&gt; { cacheHitsCompleted: 0, cacheHitsInflight: 0, cacheMisses: 0, size: 0, errors: 0, totalCount: 0 }
</pre> <h3 id="configuring-dns-cache-ttl"><span>Configuring DNS cache TTL</span></h3> <span data-as="p">Bun defaults to 30 seconds for the TTL of DNS cache entries. To change this, you can set the environment variable <code>$BUN_CONFIG_DNS_TIME_TO_LIVE_SECONDS</code>. For example, to set the TTL to 5 seconds:</span> <pre numberoflines="1" language="shellscript" data-language="typescript">BUN_CONFIG_DNS_TIME_TO_LIVE_SECONDS=5 bun run my-script.ts
</pre> <h4 id="why-is-30-seconds-the-default"><span>Why is 30 seconds the default?</span></h4> <span data-as="p">Unfortunately, the system API underneath (<code>getaddrinfo</code>) does not provide a way to get the TTL of a DNS entry. This means we have to pick a number arbitrarily. We chose 30 seconds because it’s long enough to see the benefits of caching, and short enough to be unlikely to cause issues if a DNS entry changes. <a href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/jvm-ttl-dns.html" target="_blank" rel="noreferrer">Amazon Web Services recommends 5 seconds</a> for the Java Virtual Machine, however the JVM defaults to cache indefinitely.</span>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/runtime/networking/dns" class="_attribution-link">https://bun.com/docs/runtime/networking/dns</a>
  </p>
</div>
