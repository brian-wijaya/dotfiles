<h1 id="header">Define and replace static globals &amp; constants</h1>
<div data-page-title="Define and replace static globals &amp; constants" data-page-href="/guides/runtime/define-constant" id="content">
<span data-as="p">The <code>--define</code> flag lets you declare statically-analyzable constants and globals. It replace all usages of an identifier or property in a JavaScript or TypeScript file with a constant value. This feature is supported at runtime and also in <code>bun build</code>. This is sort of similar to <code>#define</code> in C/C++, except for JavaScript.</span> <pre numberoflines="2" language="shellscript" data-language="typescript">bun --define process.env.NODE_ENV="'production'" src/index.ts # Runtime
bun build --define process.env.NODE_ENV="'production'" src/index.ts # Build
</pre> <hr> <span data-as="p">These statically-known values are used by Bun for dead code elimination and other optimizations.</span> <pre numberoflines="5" language="typescript" data-language="typescript">if (process.env.NODE_ENV === "production") {
  console.log("Production mode");
} else {
  console.log("Development mode");
}
</pre> <hr> <span data-as="p">Before the code reaches the JavaScript engine, Bun replaces <code>process.env.NODE_ENV</code> with <code>"production"</code>.</span> <pre numberoflines="5" language="typescript" data-language="typescript">if ("production" === "production") { 
  console.log("Production mode");
} else {
  console.log("Development mode");
}
</pre> <hr> <span data-as="p">It doesn’t stop there. Bun’s optimizing transpiler is smart enough to do some basic constant folding.</span> <span data-as="p">Since <code>"production" === "production"</code> is always <code>true</code>, Bun replaces the entire expression with the <code>true</code> value.</span> <pre numberoflines="5" language="typescript" data-language="typescript">if (true) { 
  console.log("Production mode");
} else {
  console.log("Development mode");
}
</pre> <hr> <span data-as="p">And finally, Bun detects the <code>else</code> branch is not reachable, and eliminates it.</span> <pre numberoflines="1" language="typescript" data-language="typescript">console.log("Production mode");
</pre> <hr> <h2 id="what-types-of-values-are-supported"><span>What types of values are supported?</span></h2> <span data-as="p">Values can be strings, identifiers, properties, or JSON.</span> <h3 id="replace-global-identifiers"><span>Replace global identifiers</span></h3> <span data-as="p">To make all usages of <code>window</code> be <code>undefined</code>, you can use the following command.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun --define window="undefined" src/index.ts
</pre> <span data-as="p">This can be useful when Server-Side Rendering (SSR) or when you want to make sure that the code doesn’t depend on the <code>window</code> object.</span> <pre numberoflines="5" language="javascript" data-language="typescript">if (typeof window !== "undefined") {
  console.log("Client-side code");
} else {
  console.log("Server-side code");
}
</pre> <span data-as="p">You can also set the value to be another identifier. For example, to make all usages of <code>global</code> be <code>globalThis</code>, you can use the following command.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun --define global="globalThis" src/index.ts
</pre> <span data-as="p"><code>global</code> is a global object in Node.js, but not in web browsers. So, you can use this to fix some cases where the code assumes that <code>global</code> is available.</span> <h3 id="replace-values-with-json"><span>Replace values with JSON</span></h3> <span data-as="p"><code>--define</code> can also be used to replace values with JSON objects and arrays.</span> <span data-as="p">To replace all usages of <code>AWS</code> with the JSON object <code>{"ACCESS_KEY":"abc","SECRET_KEY":"def"}</code>, you can use the following command.</span> <pre numberoflines="2" language="shellscript" data-language="typescript"># JSON
bun --define AWS='{"ACCESS_KEY":"abc","SECRET_KEY":"def"}' src/index.ts
</pre> <span data-as="p">Those will be transformed into the equivalent JavaScript code.</span> <span data-as="p">From:</span> <pre numberoflines="1" language="typescript" data-language="typescript">console.log(AWS.ACCESS_KEY); // =&gt; "abc"
</pre> <span data-as="p">To:</span> <pre numberoflines="1" language="typescript" data-language="typescript">console.log("abc");
</pre> <h3 id="replace-values-with-other-properties"><span>Replace values with other properties</span></h3> <span data-as="p">You can also pass properties to the <code>--define</code> flag.</span> <span data-as="p">For example, to replace all usages of <code>console.write</code> with <code>console.log</code>, you can use the following command</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun --define console.write=console.log src/index.ts
</pre> <span data-as="p">That transforms the following input:</span> <pre numberoflines="1" language="typescript" data-language="typescript">console.write("Hello, world!");
</pre> <span data-as="p">Into the following output:</span> <pre numberoflines="1" language="typescript" data-language="typescript">console.log("Hello, world!");
</pre> <h2 id="how-is-this-different-than-setting-a-variable"><span>How is this different than setting a variable?</span></h2> <span data-as="p">You can also set <code>process.env.NODE_ENV</code> to <code>"production"</code> in your code, but that won’t help with dead code elimination. In JavaScript, property accesses can have side effects. Getters &amp; setters can be functions, and even dynamically defined (due to prototype chains and Proxy). Even if you set <code>process.env.NODE_ENV</code> to <code>"production"</code>, on the next line, it is not safe for static analysis tools to assume that <code>process.env.NODE_ENV</code>is<code>"production"</code>.</span> <h2 id="how-is-this-different-than-find-and-replace-or-string-replacement"><span>How is this different than find-and-replace or string replacement?</span></h2> <span data-as="p">The <code>--define</code> flag operates on the AST (Abstract Syntax Tree) level, not on the text level. It happens during the transpilation process, which means it can be used in optimizations like dead code elimination.</span> <span data-as="p">String replacement tools tend to have escaping issues and replace unintended parts of the code.</span>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/guides/runtime/define-constant" class="_attribution-link">https://bun.com/docs/guides/runtime/define-constant</a>
  </p>
</div>
