<h1 id="header">Code coverage</h1>
<div data-page-title="Code coverage" data-page-href="/test/code-coverage" id="content">
<span data-as="p">Bun’s test runner now supports built-in code coverage reporting. This makes it easy to see how much of the codebase is covered by tests, and find areas that are not currently well-tested.</span> <h2 id="enabling-coverage"><span>Enabling Coverage</span></h2> <span data-as="p"><code>bun:test</code> supports seeing which lines of code are covered by tests. To use this feature, pass <code>--coverage</code> to the CLI. It will print out a coverage report to the console:</span> <pre numberoflines="19" language="shellscript" data-language="typescript">bun test --coverage

-------------|---------|---------|-------------------
File         | % Funcs | % Lines | Uncovered Line #s
-------------|---------|---------|-------------------
All files    |   38.89 |   42.11 |
 index-0.ts  |   33.33 |   36.84 | 10-15,19-24
 index-1.ts  |   33.33 |   36.84 | 10-15,19-24
 index-10.ts |   33.33 |   36.84 | 10-15,19-24
 index-2.ts  |   33.33 |   36.84 | 10-15,19-24
 index-3.ts  |   33.33 |   36.84 | 10-15,19-24
 index-4.ts  |   33.33 |   36.84 | 10-15,19-24
 index-5.ts  |   33.33 |   36.84 | 10-15,19-24
 index-6.ts  |   33.33 |   36.84 | 10-15,19-24
 index-7.ts  |   33.33 |   36.84 | 10-15,19-24
 index-8.ts  |   33.33 |   36.84 | 10-15,19-24
 index-9.ts  |   33.33 |   36.84 | 10-15,19-24
 index.ts    |  100.00 |  100.00 |
-------------|---------|---------|-------------------
</pre> <h3 id="enable-by-default"><span>Enable by Default</span></h3> <span data-as="p">To always enable coverage reporting by default, add the following line to your <code>bunfig.toml</code>:</span> <pre numberoflines="3" language="toml" data-language="typescript">[test]
# Always enable coverage
coverage = true
</pre> <span data-as="p">By default coverage reports will include test files and exclude sourcemaps. This is usually what you want, but it can be configured otherwise in <code>bunfig.toml</code>.</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
coverageSkipTestFiles = true  # default false
</pre> <h2 id="coverage-thresholds"><span>Coverage Thresholds</span></h2> <span data-as="p">It is possible to specify a coverage threshold in <code>bunfig.toml</code>. If your test suite does not meet or exceed this threshold, <code>bun test</code> will exit with a non-zero exit code to indicate the failure.</span> <h3 id="simple-threshold"><span>Simple Threshold</span></h3> <pre numberoflines="3" language="toml" data-language="typescript">[test]
# To require 90% line-level and function-level coverage
coverageThreshold = 0.9
</pre> <h3 id="detailed-thresholds"><span>Detailed Thresholds</span></h3> <pre numberoflines="3" language="toml" data-language="typescript">[test]
# To set different thresholds for lines and functions
coverageThreshold = { lines = 0.9, functions = 0.9, statements = 0.9 }
</pre> <span data-as="p">Setting any of these thresholds enables <code>fail_on_low_coverage</code>, causing the test run to fail if coverage is below the threshold.</span> <h2 id="coverage-reporters"><span>Coverage Reporters</span></h2> <span data-as="p">By default, coverage reports will be printed to the console.</span> <span data-as="p">For persistent code coverage reports in CI environments and for other tools, you can pass a <code>--coverage-reporter=lcov</code> CLI option or <code>coverageReporter</code> option in <code>bunfig.toml</code>.</span> <pre numberoflines="3" language="toml" data-language="typescript">[test]
coverageReporter = ["text", "lcov"]  # default ["text"]
coverageDir = "path/to/somewhere"    # default "coverage"
</pre> <h3 id="available-reporters"><span>Available Reporters</span></h3> <div data-table-wrapper="true"><div><table> <thead><tr>
<th>Reporter</th>
<th>Description</th>
</tr></thead> <tbody>
<tr>
<td><code>text</code></td>
<td>Prints a text summary of the coverage to the console</td>
</tr>
<tr>
<td><code>lcov</code></td>
<td>Save coverage in lcov format</td>
</tr>
</tbody> </table></div></div> <h3 id="lcov-coverage-reporter"><span>LCOV Coverage Reporter</span></h3> <span data-as="p">To generate an lcov report, you can use the lcov reporter. This will generate an <code>lcov.info</code> file in the coverage directory.</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
coverageReporter = "lcov"
</pre> <pre numberoflines="2" language="shellscript" data-language="typescript"># Or via CLI
bun test --coverage --coverage-reporter=lcov
</pre> <span data-as="p">The LCOV format is widely supported by various tools and services:</span> <ul> <li>
<strong>Code editors</strong>: VS Code extensions can show coverage inline</li> <li>
<strong>CI/CD services</strong>: GitHub Actions, GitLab CI, CircleCI</li> <li>
<strong>Coverage services</strong>: Codecov, Coveralls</li> <li>
<strong>IDEs</strong>: WebStorm, IntelliJ IDEA</li> </ul> <h4 id="using-lcov-with-github-actions"><span>Using LCOV with GitHub Actions</span></h4> <pre numberoflines="15" language="yaml" data-language="typescript">name: Test with Coverage
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: oven-sh/setup-bun@v2
      - run: bun install
      - run: bun test --coverage --coverage-reporter=lcov
      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
</pre> <h2 id="excluding-files-from-coverage"><span>Excluding Files from Coverage</span></h2> <h3 id="skip-test-files"><span>Skip Test Files</span></h3> <span data-as="p">By default, test files themselves are included in coverage reports. You can exclude them with:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
coverageSkipTestFiles = true  # default false
</pre> <span data-as="p">This will exclude files matching test patterns (e.g., <code>*.test.ts</code>, <code>*.spec.js</code>) from the coverage report.</span> <h3 id="ignore-specific-paths-and-patterns"><span>Ignore Specific Paths and Patterns</span></h3> <span data-as="p">You can exclude specific files or file patterns from coverage reports using <code>coveragePathIgnorePatterns</code>:</span> <pre numberoflines="11" language="toml" data-language="typescript">[test]
# Single pattern
coveragePathIgnorePatterns = "**/*.spec.ts"

# Multiple patterns
coveragePathIgnorePatterns = [
  "**/*.spec.ts",
  "**/*.test.ts",
  "src/utils/**",
  "*.config.js"
]
</pre> <span data-as="p">This option accepts glob patterns and works similarly to Jest’s <code>collectCoverageFrom</code> ignore patterns. Files matching any of these patterns will be excluded from coverage calculation and reporting in both text and LCOV outputs.</span> <h4 id="common-use-cases"><span>Common Use Cases</span></h4> <pre numberoflines="26" language="toml" data-language="typescript">[test]
coveragePathIgnorePatterns = [
  # Exclude utility files
  "src/utils/**",

  # Exclude configuration files
  "*.config.js",
  "webpack.config.ts",
  "vite.config.ts",

  # Exclude specific test patterns
  "**/*.spec.ts",
  "**/*.e2e.ts",

  # Exclude build artifacts
  "dist/**",
  "build/**",

  # Exclude generated files
  "src/generated/**",
  "**/*.generated.ts",

  # Exclude vendor/third-party code
  "vendor/**",
  "third-party/**"
]
</pre> <h2 id="sourcemaps"><span>Sourcemaps</span></h2> <span data-as="p">Internally, Bun transpiles all files by default, so Bun automatically generates an internal source map that maps lines of your original source code onto Bun’s internal representation. If for any reason you want to disable this, set <code>test.coverageIgnoreSourcemaps</code> to <code>true</code>; this will rarely be desirable outside of advanced use cases.</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
coverageIgnoreSourcemaps = true  # default false
</pre> <div data-callout-type="warning">

<div data-component-part="callout-content"><span data-as="p">When using this option, you probably want to stick a <code>// @bun</code> comment at the top of the source file to opt out of the transpilation process.</span></div>
</div> <h2 id="coverage-defaults"><span>Coverage Defaults</span></h2> <span data-as="p">By default, coverage reports:</span> <ul> <li>
<strong>Exclude</strong> <code>node_modules</code> directories</li> <li>
<strong>Exclude</strong> files loaded via non-JS/TS loaders (e.g., <code>.css</code>, <code>.txt</code>) unless a custom JS loader is specified</li> <li>
<strong>Include</strong> test files themselves (can be disabled with <code>coverageSkipTestFiles = true</code>)</li> <li>Can exclude additional files with <code>coveragePathIgnorePatterns</code>
</li> </ul> <h2 id="advanced-configuration"><span>Advanced Configuration</span></h2> <h3 id="custom-coverage-directory"><span>Custom Coverage Directory</span></h3> <pre numberoflines="2" language="toml" data-language="typescript">[test]
coverageDir = "coverage-reports"  # default "coverage"
</pre> <h3 id="multiple-reporters"><span>Multiple Reporters</span></h3> <pre numberoflines="2" language="toml" data-language="typescript">[test]
coverageReporter = ["text", "lcov"]
</pre> <h3 id="coverage-with-specific-test-patterns"><span>Coverage with Specific Test Patterns</span></h3> <pre numberoflines="5" language="shellscript" data-language="typescript"># Run coverage only on specific test files
bun test --coverage src/components/*.test.ts

# Run coverage with name pattern
bun test --coverage --test-name-pattern="API"
</pre> <h2 id="ci/cd-integration"><span>CI/CD Integration</span></h2> <h3 id="github-actions-example"><span>GitHub Actions Example</span></h3> <pre numberoflines="24" language="yaml" data-language="typescript">name: Coverage Report
on: [push, pull_request]

jobs:
  coverage:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2

      - name: Install dependencies
        run: bun install

      - name: Run tests with coverage
        run: bun test --coverage --coverage-reporter=lcov

      - name: Upload to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/lcov.info
          fail_ci_if_error: true
</pre> <h3 id="gitlab-ci-example"><span>GitLab CI Example</span></h3> <pre numberoflines="11" language="yaml" data-language="typescript">test:coverage:
  stage: test
  script:
    - bun install
    - bun test --coverage --coverage-reporter=lcov
  coverage: '/Lines\s*:\s*(\d+.\d+)%/'
  artifacts:
    reports:
      coverage_report:
        coverage_format: cobertura
        path: coverage/lcov.info
</pre> <h2 id="interpreting-coverage-reports"><span>Interpreting Coverage Reports</span></h2> <h3 id="text-output-explanation"><span>Text Output Explanation</span></h3> <pre numberoflines="10" language="text" data-language="typescript">-------------|---------|---------|-------------------
File         | % Funcs | % Lines | Uncovered Line #s
-------------|---------|---------|-------------------
All files    |   85.71 |   90.48 |
 src/        |   85.71 |   90.48 |
  utils.ts   |  100.00 |  100.00 |
  api.ts     |   75.00 |   85.71 | 15-18,25
  main.ts    |   80.00 |   88.89 | 42,50-52
-------------|---------|---------|-------------------
</pre> <ul> <li>
<strong>% Funcs</strong>: Percentage of functions that were called during tests</li> <li>
<strong>% Lines</strong>: Percentage of executable lines that were run during tests</li> <li>
<strong>Uncovered Line #s</strong>: Specific line numbers that were not executed</li> </ul> <h3 id="what-to-aim-for"><span>What to Aim For</span></h3> <ul> <li>
<strong>80%+ overall coverage</strong>: Generally considered good</li> <li>
<strong>90%+ critical paths</strong>: Important business logic should be well-tested</li> <li>
<strong>100% utility functions</strong>: Pure functions and utilities are easy to test completely</li> <li>
<strong>Lower coverage for UI components</strong>: Often acceptable as they may require integration tests</li> </ul> <h2 id="best-practices"><span>Best Practices</span></h2> <h3 id="focus-on-quality,-not-just-quantity"><span>Focus on Quality, Not Just Quantity</span></h3> <pre numberoflines="11" language="typescript" data-language="typescript">// Good: Test actual functionality
test("calculateTax should handle different tax rates", () =&gt; {
  expect(calculateTax(100, 0.08)).toBe(8);
  expect(calculateTax(100, 0.1)).toBe(10);
  expect(calculateTax(0, 0.08)).toBe(0);
});

// Avoid: Just hitting lines for coverage
test("calculateTax exists", () =&gt; {
  calculateTax(100, 0.08); // No assertions!
});
</pre> <h3 id="test-edge-cases"><span>Test Edge Cases</span></h3> <pre numberoflines="9" language="typescript" data-language="typescript">test("user input validation", () =&gt; {
  // Test normal case
  expect(validateEmail("user@example.com")).toBe(true);

  // Test edge cases that improve coverage meaningfully
  expect(validateEmail("")).toBe(false);
  expect(validateEmail("invalid")).toBe(false);
  expect(validateEmail(null)).toBe(false);
});
</pre> <h3 id="use-coverage-to-find-missing-tests"><span>Use Coverage to Find Missing Tests</span></h3> <pre numberoflines="5" language="shellscript" data-language="typescript"># Run coverage to identify untested code
bun test --coverage

# Look at specific files that need attention
bun test --coverage src/critical-module.ts
</pre> <h3 id="combine-with-other-quality-metrics"><span>Combine with Other Quality Metrics</span></h3> <span data-as="p">Coverage is just one metric. Also consider:</span> <ul> <li><strong>Code review quality</strong></li> <li><strong>Integration test coverage</strong></li> <li><strong>Error handling tests</strong></li> <li><strong>Performance tests</strong></li> <li><strong>Type safety</strong></li> </ul> <h2 id="troubleshooting"><span>Troubleshooting</span></h2> <h3 id="coverage-not-showing-for-some-files"><span>Coverage Not Showing for Some Files</span></h3> <span data-as="p">If files aren’t appearing in coverage reports, they might not be imported by your tests. Coverage only tracks files that are actually loaded.</span> <pre numberoflines="6" language="typescript" data-language="typescript">// Make sure to import the modules you want to test
import { myFunction } from "../src/my-module";

test("my function works", () =&gt; {
  expect(myFunction()).toBeDefined();
});
</pre> <h3 id="false-coverage-reports"><span>False Coverage Reports</span></h3> <span data-as="p">If you see coverage reports that don’t match your expectations:</span> <ol> <li>Check if source maps are working correctly</li> <li>Verify file patterns in <code>coveragePathIgnorePatterns</code>
</li> <li>Ensure test files are actually importing the code to test</li> </ol> <h3 id="performance-issues-with-large-codebases"><span>Performance Issues with Large Codebases</span></h3> <span data-as="p">For large projects, coverage collection can slow down tests:</span> <pre numberoflines="7" language="toml" data-language="typescript">[test]
# Exclude large directories you don't need coverage for
coveragePathIgnorePatterns = [
  "node_modules/**",
  "vendor/**",
  "generated/**"
]
</pre> <span data-as="p">Consider running coverage only on CI or specific branches rather than every test run during development.</span>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/test/code-coverage" class="_attribution-link">https://bun.com/docs/test/code-coverage</a>
  </p>
</div>
