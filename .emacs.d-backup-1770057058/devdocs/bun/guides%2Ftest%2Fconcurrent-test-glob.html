<h1 id="header">Selectively run tests concurrently with glob patterns</h1>
<div data-page-title="Selectively run tests concurrently with glob patterns" data-page-href="/guides/test/concurrent-test-glob" id="content">
<span data-as="p">This guide demonstrates how to use the <code>concurrentTestGlob</code> option to selectively run tests concurrently based on file naming patterns.</span> <h2 id="project-structure"><span>Project Structure</span></h2> <pre numberoflines="9" language="shellscript" data-language="typescript">my-project/
├── bunfig.toml
├── tests/
│   ├── unit/
│   │   ├── math.test.ts          # Sequential
│   │   └── utils.test.ts         # Sequential
│   └── integration/
│       ├── concurrent-api.test.ts     # Concurrent
│       └── concurrent-database.test.ts # Concurrent
</pre> <h2 id="configuration"><span>Configuration</span></h2> <span data-as="p">Configure your <code>bunfig.toml</code> to run test files with “concurrent-” prefix concurrently:</span> <pre numberoflines="3" language="toml" data-language="typescript">[test]
# Run all test files with "concurrent-" prefix concurrently
concurrentTestGlob = "**/concurrent-*.test.ts"
</pre> <h2 id="test-files"><span>Test Files</span></h2> <h3 id="unit-test-sequential"><span>Unit Test (Sequential)</span></h3> <span data-as="p">Sequential tests are good for tests that share state or have specific ordering requirements:</span> <pre numberoflines="14" language="typescript" data-language="typescript">import { test, expect } from "bun:test";

// These tests run sequentially by default
let sharedState = 0;

test("addition", () =&gt; {
  sharedState = 5 + 3;
  expect(sharedState).toBe(8);
});

test("uses previous state", () =&gt; {
  // This test depends on the previous test's state
  expect(sharedState).toBe(8);
});
</pre> <h3 id="integration-test-concurrent"><span>Integration Test (Concurrent)</span></h3> <span data-as="p">Tests in files matching the glob pattern automatically run concurrently:</span> <pre numberoflines="22" language="typescript" data-language="typescript">import { test, expect } from "bun:test";

// These tests automatically run concurrently due to filename matching the glob pattern.
// Using test() is equivalent to test.concurrent() when the file matches concurrentTestGlob.
// Each test is independent and can run in parallel.

test("fetch user data", async () =&gt; {
  const response = await fetch("/api/user/1");
  expect(response.ok).toBe(true);
});

// can also use test.concurrent() for explicitly marking it as concurrent
test.concurrent("fetch posts", async () =&gt; {
  const response = await fetch("/api/posts");
  expect(response.ok).toBe(true);
});

// can also use test.serial() for explicitly marking it as sequential
test.serial("fetch comments", async () =&gt; {
  const response = await fetch("/api/comments");
  expect(response.ok).toBe(true);
});
</pre> <h2 id="running-tests"><span>Running Tests</span></h2> <pre numberoflines="12" language="shellscript" data-language="typescript"># Run all tests - concurrent-*.test.ts files will run concurrently
bun test

# Override: Force ALL tests to run concurrently
# Note: This overrides bunfig.toml and runs all tests concurrently, regardless of glob
bun test --concurrent

# Run only unit tests (sequential)
bun test tests/unit

# Run only integration tests (concurrent due to glob pattern)
bun test tests/integration
</pre> <h2 id="benefits"><span>Benefits</span></h2> <ol> <li>
<strong>Gradual Migration</strong>: Migrate to concurrent tests file by file by renaming them</li> <li>
<strong>Clear Organization</strong>: File naming convention indicates execution mode</li> <li>
<strong>Performance</strong>: Integration tests run faster in parallel</li> <li>
<strong>Safety</strong>: Unit tests remain sequential where needed</li> <li>
<strong>Flexibility</strong>: Easy to change execution mode by renaming files</li> </ol> <h2 id="migration-strategy"><span>Migration Strategy</span></h2> <span data-as="p">To migrate existing tests to concurrent execution:</span> <ol> <li>
<strong>Start with independent integration tests</strong> - These typically don’t share state</li> <li>
<strong>Rename files to match the glob pattern</strong>: <code>mv api.test.ts concurrent-api.test.ts</code>
</li> <li>
<strong>Verify tests still pass</strong> - Run <code>bun test</code> to ensure no race conditions</li> <li>
<strong>Monitor for shared state issues</strong> - Watch for flaky tests or unexpected failures</li> <li>
<strong>Continue migrating stable tests incrementally</strong> - Don’t rush the migration</li> </ol> <h2 id="tips"><span>Tips</span></h2> <ul> <li>
<strong>Use descriptive prefixes</strong>: <code>concurrent-</code>, <code>parallel-</code>, <code>async-</code>
</li> <li>
<strong>Keep related sequential tests together</strong> in the same directory</li> <li>
<strong>Document why certain tests must remain sequential</strong> with comments</li> <li>
<strong>Use <code>test.concurrent()</code> for fine-grained control</strong> in sequential files (Note: In files matched by <code>concurrentTestGlob</code>, plain <code>test()</code> already runs concurrently)</li> </ul> <h2 id="multiple-patterns"><span>Multiple Patterns</span></h2> <span data-as="p">You can specify multiple patterns for different test categories:</span> <pre numberoflines="6" language="toml" data-language="typescript">[test]
concurrentTestGlob = [
  "**/integration/*.test.ts",
  "**/e2e/*.test.ts",
  "**/concurrent-*.test.ts"
]
</pre> <span data-as="p">This configuration will run tests concurrently if they match any of these patterns:</span> <ul> <li>All tests in <code>integration/</code> directories</li> <li>All tests in <code>e2e/</code> directories</li> <li>All tests with <code>concurrent-</code> prefix anywhere in the project</li> </ul>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/guides/test/concurrent-test-glob" class="_attribution-link">https://bun.com/docs/guides/test/concurrent-test-glob</a>
  </p>
</div>
