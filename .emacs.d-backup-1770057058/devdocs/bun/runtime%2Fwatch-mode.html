<h1 id="header">Watch Mode</h1>
<div data-page-title="Watch Mode" data-page-href="/runtime/watch-mode" id="content">
<span data-as="p">Bun supports two kinds of automatic reloading via CLI flags:</span> <ul> <li>
<code>--watch</code> mode, which hard restarts Bun’s process when imported files change.</li> <li>
<code>--hot</code> mode, which soft reloads the code (without restarting the process) when imported files change.</li> </ul> <hr> <h2 id="watch-mode"><span><code>--watch</code> mode</span></h2> <span data-as="p">Watch mode can be used with <code>bun test</code> or when running TypeScript, JSX, and JavaScript files.</span> <span data-as="p">To run a file in <code>--watch</code> mode:</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun --watch index.tsx
</pre> <span data-as="p">To run your tests in <code>--watch</code> mode:</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun --watch test
</pre> <span data-as="p">In <code>--watch</code> mode, Bun keeps track of all imported files and watches them for changes. When a change is detected, Bun restarts the process, preserving the same set of CLI arguments and environment variables used in the initial run. If Bun crashes, <code>--watch</code> will attempt to automatically restart the process.</span> <div data-callout-type="note">

<div data-component-part="callout-content">
<span data-as="p"><strong>⚡️ Reloads are fast.</strong> The filesystem watchers you’re probably used to have several layers of libraries wrapping the native APIs or worse, rely on polling.</span><span data-as="p">Instead, Bun uses operating system native filesystem watcher APIs like kqueue or inotify to detect changes to files. Bun also does a number of optimizations to enable it scale to larger projects (such as setting a high rlimit for file descriptors, statically allocated file path buffers, reuse file descriptors when possible, etc).</span>
</div>
</div> <span data-as="p">The following examples show Bun live-reloading a file as it is edited, with VSCode configured to save the file <a href="https://code.visualstudio.com/docs/editor/codebasics#_save-auto-save" target="_blank" rel="noreferrer">on each keystroke</a>.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun run --watch watchy.tsx
</pre> <pre numberoflines="10" language="tsx" data-language="typescript">import { serve } from "bun";

console.log("I restarted at:", Date.now());

serve({
  port: 4003,
  fetch(request) {
    return new Response("Sup");
  },
});
</pre> <span data-as="p">In this example, Bun is</span>  <span data-as="p">Running <code>bun test</code> in watch mode and <code>save-on-keypress</code> enabled:</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun --watch test
</pre>  <div data-callout-type="note">

<div data-component-part="callout-content"><span data-as="p">The <strong><code>--no-clear-screen</code></strong> flag is useful in scenarios where you don’t want the terminal to clear, such as when running multiple <code>bun build --watch</code> commands simultaneously using tools like <code>concurrently</code>. Without this flag, the output of one instance could clear the output of others, potentially hiding errors from one instance beneath the output of another. The <code>--no-clear-screen</code> flag, similar to TypeScript’s <code>--preserveWatchOutput</code>, prevents this issue. It can be used in combination with <code>--watch</code>, for example: <code>bun build --watch --no-clear-screen</code>.</span></div>
</div> <hr> <h2 id="hot-mode"><span><code>--hot</code> mode</span></h2> <span data-as="p">Use <code>bun --hot</code> to enable hot reloading when executing code with Bun. This is distinct from <code>--watch</code> mode in that Bun does not hard-restart the entire process. Instead, it detects code changes and updates its internal module cache with the new code.</span> <div data-callout-type="note">

<div data-component-part="callout-content"><span data-as="p">This is not the same as hot reloading in the browser! Many frameworks provide a “hot reloading” experience, where you can edit &amp; save your frontend code (say, a React component) and see the changes reflected in the browser without refreshing the page. Bun’s <code>--hot</code> is the server-side equivalent of this experience. To get hot reloading in the browser, use a framework like <a href="https://vite.dev" target="_blank" rel="noreferrer">Vite</a>.</span></div>
</div> <pre numberoflines="1" language="shellscript" data-language="typescript">bun --hot server.ts
</pre> <span data-as="p">Starting from the entrypoint (<code>server.ts</code> in the example above), Bun builds a registry of all imported source files (excluding those in <code>node_modules</code>) and watches them for changes. When a change is detected, Bun performs a “soft reload”. All files are re-evaluated, but all global state (notably, the <code>globalThis</code> object) is persisted.</span> <pre numberoflines="11" language="typescript" data-language="typescript">// make TypeScript happy
declare global {
  var count: number;
}

globalThis.count ??= 0;
console.log(`Reloaded ${globalThis.count} times`);
globalThis.count++;

// prevent `bun run` from exiting
setInterval(function () {}, 1000000);
</pre> <span data-as="p">If you run this file with <code>bun --hot server.ts</code>, you’ll see the reload count increment every time you save the file.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun --hot index.ts
</pre> <pre numberoflines="4" language="text" data-language="typescript">Reloaded 1 times
Reloaded 2 times
Reloaded 3 times
</pre> <span data-as="p">Traditional file watchers like <code>nodemon</code> restart the entire process, so HTTP servers and other stateful objects are lost. By contrast, <code>bun --hot</code> is able to reflect the updated code without restarting the process.</span> <h3 id="http-servers"><span>HTTP servers</span></h3> <span data-as="p">This makes it possible, for instance, to update your HTTP request handler without shutting down the server itself. When you save the file, your HTTP server will be reloaded with the updated code without the process being restarted. This results in seriously fast refresh speeds.</span> <pre numberoflines="9" language="typescript" data-language="typescript">globalThis.count ??= 0;
globalThis.count++;

Bun.serve({
  fetch(req: Request) {
    return new Response(`Reloaded ${globalThis.count} times`);
  },
  port: 3000,
});
</pre> <div data-callout-type="note">

<div data-component-part="callout-content"><span data-as="p"><strong>Note</strong> — In a future version of Bun, support for Vite’s <code>import.meta.hot</code> is planned to enable better lifecycle management for hot reloading and to align with the ecosystem.</span></div>
</div> <details><summary aria-controls="implementation-details accordion children" aria-expanded="false" data-component-part="accordion-button">

<div contenteditable="false" data-component-part="accordion-title-container"><p data-component-part="accordion-title">Implementation details</p></div></summary><div id="implementation-details accordion children" role="region" aria-labelledby="implementation-details" data-component-part="accordion-content">
<span data-as="p">On hot reload, Bun:</span><ul> <li>Resets the internal <code>require</code> cache and ES module registry (<code>Loader.registry</code>)</li> <li>Runs the garbage collector synchronously (to minimize memory leaks, at the cost of runtime performance)</li> <li>Re-transpiles all of your code from scratch (including sourcemaps)</li> <li>Re-evaluates the code with JavaScriptCore</li> </ul>
<span data-as="p">This implementation isn’t particularly optimized. It re-transpiles files that haven’t changed. It makes no attempt at incremental compilation. It’s a starting point.</span>
</div></details>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/runtime/watch-mode" class="_attribution-link">https://bun.com/docs/runtime/watch-mode</a>
  </p>
</div>
