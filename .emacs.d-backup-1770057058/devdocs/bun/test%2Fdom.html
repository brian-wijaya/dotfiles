<h1 id="header">DOM testing</h1>
<div data-page-title="DOM testing" data-page-href="/test/dom" id="content">
<span data-as="p">Bun’s test runner plays well with existing component and DOM testing libraries, including React Testing Library and happy-dom.</span> <h2 id="happy-dom"><span>happy-dom</span></h2> <span data-as="p">For writing headless tests for your frontend code and components, we recommend happy-dom. Happy DOM implements a complete set of HTML and DOM APIs in plain JavaScript, making it possible to simulate a browser environment with high fidelity.</span> <span data-as="p">To get started install the <code>@happy-dom/global-registrator</code> package as a dev dependency.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun add -d @happy-dom/global-registrator
</pre> <span data-as="p">We’ll be using Bun’s preload functionality to register the happy-dom globals before running our tests. This step will make browser APIs like <code>document</code> available in the global scope. Create a file called <code>happydom.ts</code> in the root of your project and add the following code:</span> <pre numberoflines="3" language="typescript" data-language="typescript">import { GlobalRegistrator } from "@happy-dom/global-registrator";

GlobalRegistrator.register();
</pre> <span data-as="p">To preload this file before <code>bun test</code>, open or create a <code>bunfig.toml</code> file and add the following lines.</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
preload = ["./happydom.ts"]
</pre> <span data-as="p">This will execute <code>happydom.ts</code> when you run <code>bun test</code>. Now you can write tests that use browser APIs like <code>document</code> and <code>window</code>.</span> <pre numberoflines="7" language="typescript" data-language="typescript">import { test, expect } from "bun:test";

test("dom test", () =&gt; {
  document.body.innerHTML = `&lt;button&gt;My button&lt;/button&gt;`;
  const button = document.querySelector("button");
  expect(button?.innerText).toEqual("My button");
});
</pre> <h3 id="typescript-support"><span>TypeScript Support</span></h3> <span data-as="p">Depending on your <code>tsconfig.json</code> setup, you may see a “Cannot find name ‘document’” type error in the code above. To “inject” the types for <code>document</code> and other browser APIs, add the following triple-slash directive to the top of any test file.</span> <pre numberoflines="9" language="typescript" data-language="typescript">/// &lt;reference lib="dom" /&gt;

import { test, expect } from "bun:test";

test("dom test", () =&gt; {
  document.body.innerHTML = `&lt;button&gt;My button&lt;/button&gt;`;
  const button = document.querySelector("button");
  expect(button?.innerText).toEqual("My button");
});
</pre> <span data-as="p">Let’s run this test with <code>bun test</code>:</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun test
</pre> <pre numberoflines="10" language="text" data-language="typescript">bun test v1.3.3

dom.test.ts:
✓ dom test [0.82ms]

 1 pass
 0 fail
 1 expect() calls
Ran 1 tests across 1 files. 1 total [125.00ms]
</pre> <h2 id="react-testing-library"><span>React Testing Library</span></h2> <span data-as="p">Bun works seamlessly with React Testing Library for testing React components. After setting up happy-dom as shown above, you can install and use React Testing Library normally.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun add -d @testing-library/react @testing-library/jest-dom
</pre> <pre numberoflines="14" language="typescript" data-language="typescript">/// &lt;reference lib="dom" /&gt;

import { test, expect } from 'bun:test';
import { render, screen } from '@testing-library/react';
import '@testing-library/jest-dom';

function Button({ children }: { children: React.ReactNode }) {
  return &lt;button&gt;{children}&lt;/button&gt;;
}

test('renders button', () =&gt; {
  render(&lt;Button&gt;Click me&lt;/Button&gt;);
  expect(screen.getByRole('button')).toHaveTextContent('Click me');
});
</pre> <h2 id="advanced-dom-testing"><span>Advanced DOM Testing</span></h2> <h3 id="custom-elements"><span>Custom Elements</span></h3> <span data-as="p">You can test custom elements and web components using the same setup:</span> <pre numberoflines="20" language="typescript" data-language="typescript">/// &lt;reference lib="dom" /&gt;

import { test, expect } from "bun:test";

test("custom element", () =&gt; {
  // Define a custom element
  class MyElement extends HTMLElement {
    constructor() {
      super();
      this.innerHTML = "&lt;p&gt;Custom element content&lt;/p&gt;";
    }
  }

  customElements.define("my-element", MyElement);

  // Use it in tests
  document.body.innerHTML = "&lt;my-element&gt;&lt;/my-element&gt;";
  const element = document.querySelector("my-element");
  expect(element?.innerHTML).toBe("&lt;p&gt;Custom element content&lt;/p&gt;");
});
</pre> <h3 id="event-testing"><span>Event Testing</span></h3> <span data-as="p">Test DOM events and user interactions:</span> <pre numberoflines="17" language="typescript" data-language="typescript">/// &lt;reference lib="dom" /&gt;

import { test, expect } from "bun:test";

test("button click event", () =&gt; {
  let clicked = false;

  document.body.innerHTML = '&lt;button id="test-btn"&gt;Click me&lt;/button&gt;';
  const button = document.getElementById("test-btn");

  button?.addEventListener("click", () =&gt; {
    clicked = true;
  });

  button?.click();
  expect(clicked).toBe(true);
});
</pre> <h2 id="configuration-tips"><span>Configuration Tips</span></h2> <h3 id="global-setup"><span>Global Setup</span></h3> <span data-as="p">For more complex DOM testing setups, you can create a more comprehensive preload file:</span> <pre numberoflines="27" language="typescript" data-language="typescript">import { GlobalRegistrator } from "@happy-dom/global-registrator";
import "@testing-library/jest-dom";

// Register happy-dom globals
GlobalRegistrator.register();

// Add any global test configuration here
global.ResizeObserver = class ResizeObserver {
  observe() {}
  unobserve() {}
  disconnect() {}
};

// Mock other APIs as needed
Object.defineProperty(window, "matchMedia", {
  writable: true,
  value: jest.fn().mockImplementation(query =&gt; ({
    matches: false,
    media: query,
    onchange: null,
    addListener: jest.fn(),
    removeListener: jest.fn(),
    addEventListener: jest.fn(),
    removeEventListener: jest.fn(),
    dispatchEvent: jest.fn(),
  })),
});
</pre> <span data-as="p">Then update your <code>bunfig.toml</code>:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
preload = ["./test-setup.ts"]
</pre> <h2 id="troubleshooting"><span>Troubleshooting</span></h2> <h3 id="common-issues"><span>Common Issues</span></h3> <span data-as="p"><strong>TypeScript errors for DOM APIs</strong>: Make sure to include the <code>/// &lt;reference lib="dom" /&gt;</code> directive at the top of your test files.</span> <span data-as="p"><strong>Missing globals</strong>: Ensure that <code>@happy-dom/global-registrator</code> is properly imported and registered in your preload file.</span> <span data-as="p"><strong>React component rendering issues</strong>: Make sure you’ve installed both <code>@testing-library/react</code> and have happy-dom set up correctly.</span> <h3 id="performance-considerations"><span>Performance Considerations</span></h3> <span data-as="p">Happy-dom is fast, but for very large test suites, you might want to:</span> <ul> <li>Use <code>beforeEach</code> to reset the DOM state between tests</li> <li>Avoid creating too many DOM elements in a single test</li> <li>Consider using <code>cleanup</code> functions from testing libraries</li> </ul> <pre numberoflines="7" language="typescript" data-language="typescript">import { afterEach } from "bun:test";
import { cleanup } from "@testing-library/react";

afterEach(() =&gt; {
  cleanup();
  document.body.innerHTML = "";
});
</pre>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/test/dom" class="_attribution-link">https://bun.com/docs/test/dom</a>
  </p>
</div>
