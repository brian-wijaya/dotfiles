<h1 id="header">Build a publish-subscribe WebSocket server</h1>
<div data-page-title="Build a publish-subscribe WebSocket server" data-page-href="/guides/websocket/pubsub" id="content">
<span data-as="p">Bunâ€™s server-side <code>WebSocket</code> API provides a native pub-sub API. Sockets can be subscribed to a set of named channels using <code>socket.subscribe(&lt;name&gt;)</code>; messages can be published to a channel using <code>socket.publish(&lt;name&gt;, &lt;message&gt;)</code>.</span> <span data-as="p">This code snippet implements a simple single-channel chat server.</span> <pre numberoflines="31" language="typescript" data-language="typescript">const server = Bun.serve({
  fetch(req, server) {
    const cookies = req.headers.get("cookie");
    const username = getUsernameFromCookies(cookies);
    const success = server.upgrade(req, { data: { username } });
    if (success) return undefined;

    return new Response("Hello world");
  },
  websocket: {
    // TypeScript: specify the type of ws.data like this
    data: {} as { username: string },

    open(ws) {
      const msg = `${ws.data.username} has entered the chat`;
      ws.subscribe("the-group-chat");
      server.publish("the-group-chat", msg);
    },
    message(ws, message) {
      // the server re-broadcasts incoming messages to everyone
      server.publish("the-group-chat", `${ws.data.username}: ${message}`);
    },
    close(ws) {
      const msg = `${ws.data.username} has left the chat`;
      server.publish("the-group-chat", msg);
      ws.unsubscribe("the-group-chat");
    },
  },
});

console.log(`Listening on ${server.hostname}:${server.port}`);
</pre>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/guides/websocket/pubsub" class="_attribution-link">https://bun.com/docs/guides/websocket/pubsub</a>
  </p>
</div>
