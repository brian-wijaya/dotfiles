<h1 id="header">Start a cluster of HTTP servers</h1>
<div data-page-title="Start a cluster of HTTP servers" data-page-href="/guides/http/cluster" id="content">
<span data-as="p">To run multiple HTTP servers concurrently, use the <code>reusePort</code> option in <code>Bun.serve()</code> which shares the same port across multiple processes.</span> <span data-as="p">This automatically load balances incoming requests across multiple instances of Bun.</span> <pre numberoflines="16" language="typescript" data-language="typescript">import { serve } from "bun";

const id = Math.random().toString(36).slice(2);

serve({
  port: process.env.PORT || 8080,
  development: false,

  // Share the same port across multiple processes
  // This is the important part!
  reusePort: true,

  async fetch(request) {
    return new Response("Hello from Bun #" + id + "!\n");
  },
});
</pre> <hr> <div data-callout-type="note">

<div data-component-part="callout-content"><span data-as="p"><strong>Linux only</strong> â€” Windows and macOS ignore the <code>reusePort</code> option. This is an operating system limitation with <code>SO_REUSEPORT</code>, unfortunately.</span></div>
</div> <span data-as="p">After saving the file, start your servers on the same port.</span> <span data-as="p">Under the hood, this uses the Linux <code>SO_REUSEPORT</code> and <code>SO_REUSEADDR</code> socket options to ensure fair load balancing across multiple processes. <a href="https://lwn.net/Articles/542629/" target="_blank" rel="noreferrer">Learn more about <code>SO_REUSEPORT</code> and <code>SO_REUSEADDR</code></a></span> <pre numberoflines="22" language="typescript" data-language="typescript">import { spawn } from "bun";

const cpus = navigator.hardwareConcurrency; // Number of CPU cores
const buns = new Array(cpus);

for (let i = 0; i &lt; cpus; i++) {
  buns[i] = spawn({
    cmd: ["bun", "./server.ts"],
    stdout: "inherit",
    stderr: "inherit",
    stdin: "inherit",
  });
}

function kill() {
  for (const bun of buns) {
    bun.kill();
  }
}

process.on("SIGINT", kill);
process.on("exit", kill);
</pre> <hr> <span data-as="p">Bun has also implemented the <code>node:cluster</code> module, but this is a faster, simple, and limited alternative.</span>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/guides/http/cluster" class="_attribution-link">https://bun.com/docs/guides/http/cluster</a>
  </p>
</div>
