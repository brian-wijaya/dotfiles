<h1 id="header">import, require, and test Svelte components with bun test</h1>
<div data-page-title="import, require, and test Svelte components with bun test" data-page-href="/guides/test/svelte-test" id="content">
<span data-as="p">Bunâ€™s <a href="../../runtime/plugins">Plugin API</a> lets you add custom loaders to your project. The <code>test.preload</code> option in <code>bunfig.toml</code> lets you configure your loader to start before your tests run.</span> <span data-as="p">Firstly, install <code>@testing-library/svelte</code>, <code>svelte</code>, and <code>@happy-dom/global-registrator</code>.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun add @testing-library/svelte svelte@4 @happy-dom/global-registrator
</pre> <span data-as="p">Then, save this plugin in your project.</span> <pre numberoflines="37" language="typescript" data-language="typescript">import { plugin } from "bun";
import { compile } from "svelte/compiler";
import { readFileSync } from "fs";
import { beforeEach, afterEach } from "bun:test";
import { GlobalRegistrator } from "@happy-dom/global-registrator";

beforeEach(async () =&gt; {
  await GlobalRegistrator.register();
});

afterEach(async () =&gt; {
  await GlobalRegistrator.unregister();
});

plugin({
  title: "svelte loader",
  setup(builder) {
    builder.onLoad({ filter: /\.svelte(\?[^.]+)?$/ }, ({ path }) =&gt; {
      try {
        const source = readFileSync(path.substring(0, path.includes("?") ? path.indexOf("?") : path.length), "utf-8");

        const result = compile(source, {
          filetitle: path,
          generate: "client",
          dev: false,
        });

        return {
          contents: result.js.code,
          loader: "js",
        };
      } catch (err) {
        throw new Error(`Failed to compile Svelte component: ${err.message}`);
      }
    });
  },
});
</pre> <hr> <span data-as="p">Add this to <code>bunfig.toml</code> to tell Bun to preload the plugin, so it loads before your tests run.</span> <pre numberoflines="6" language="toml" data-language="typescript">[test]
# Tell Bun to load this plugin before your tests run
preload = ["./svelte-loader.ts"]

# This also works:
# test.preload = ["./svelte-loader.ts"]
</pre> <hr> <span data-as="p">Add an example <code>.svelte</code> file in your project.</span> <pre numberoflines="6" language="html" data-language="typescript">&lt;script&gt;
  export let initialCount = 0;
  let count = initialCount;
&lt;/script&gt;

&lt;button on:click="{()" =""&gt;(count += 1)}&gt;+1&lt;/button&gt;
</pre> <hr> <span data-as="p">Now you can <code>import</code> or <code>require</code> <code>*.svelte</code> files in your tests, and it will load the Svelte component as a JavaScript module.</span> <pre numberoflines="17" language="typescript" data-language="typescript">import { test, expect } from "bun:test";
import { render, fireEvent } from "@testing-library/svelte";
import Counter from "./Counter.svelte";

test("Counter increments when clicked", async () =&gt; {
  const { getByText, component } = render(Counter);
  const button = getByText("+1");

  // Initial state
  expect(component.$$.ctx[0]).toBe(0); // initialCount is the first prop

  // Click the increment button
  await fireEvent.click(button);

  // Check the new state
  expect(component.$$.ctx[0]).toBe(1);
});
</pre> <hr> <span data-as="p">Use <code>bun test</code> to run your tests.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun test
</pre>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/guides/test/svelte-test" class="_attribution-link">https://bun.com/docs/guides/test/svelte-test</a>
  </p>
</div>
