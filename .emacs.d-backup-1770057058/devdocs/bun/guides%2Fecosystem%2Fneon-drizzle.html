<h1 id="header">Use Neon Postgres through Drizzle ORM</h1>
<div data-page-title="Use Neon Postgres through Drizzle ORM" data-page-href="/guides/ecosystem/neon-drizzle" id="content">
<span data-as="p"><a href="https://neon.tech/" target="_blank" rel="noreferrer">Neon</a> is a fully managed serverless Postgres, separating compute and storage to offer features like autoscaling, branching and bottomless storage. Neon can be used from Bun directly using the <code>@neondatabase/serverless</code> driver or through an ORM like <code>Drizzle</code>.</span> <span data-as="p">Drizzle ORM supports both a SQL-like “query builder” API and an ORM-like <a href="https://orm.drizzle.team/docs/rqb" target="_blank" rel="noreferrer">Queries API</a>. Get started by creating a project directory, initializing the directory using <code>bun init</code>, and installing Drizzle and the <a href="https://github.com/neondatabase/serverless/" target="_blank" rel="noreferrer">Neon serverless driver</a>.</span> <pre numberoflines="5" language="shellscript" data-language="typescript">mkdir bun-drizzle-neon
cd bun-drizzle-neon
bun init -y
bun add drizzle-orm @neondatabase/serverless
bun add -D drizzle-kit
</pre> <hr> <span data-as="p">Create a <code>.env.local</code> file and add your <a href="https://neon.tech/docs/connect/connect-from-any-app" target="_blank" rel="noreferrer">Neon Postgres connection string</a> to it.</span> <pre numberoflines="1" language="ini" data-language="typescript">DATABASE_URL=postgresql://usertitle:password@ep-adj-noun-guid.us-east-1.aws.neon.tech/neondb?sslmode=require
</pre> <hr> <span data-as="p">We will connect to the Neon database using the Neon serverless driver, wrapped in a Drizzle database instance.</span> <pre numberoflines="8" language="typescript" data-language="typescript">import { neon } from "@neondatabase/serverless";
import { drizzle } from "drizzle-orm/neon-http";

// Bun automatically loads the DATABASE_URL from .env.local
// Refer to: https://bun.com/docs/runtime/environment-variables for more information
const sql = neon(process.env.DATABASE_URL!);

export const db = drizzle(sql);
</pre> <hr> <span data-as="p">To see the database in action, add these lines to <code>index.ts</code>.</span> <pre numberoflines="6" language="typescript" data-language="typescript">import { db } from "./db";
import { sql } from "drizzle-orm";

const query = sql`select 'hello world' as text`;
const result = await db.execute(query);
console.log(result.rows);
</pre> <hr> <span data-as="p">Then run <code>index.ts</code> with Bun.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun run index.ts
</pre> <pre numberoflines="6" language="text" data-language="typescript">[
  {
    text: "hello world",
  }
]
</pre> <hr> <span data-as="p">We can define a schema for our database using Drizzle ORM primitives. Create a <code>schema.ts</code> file and add this code.</span> <pre numberoflines="8" language="typescript" data-language="typescript">import { pgTable, integer, serial, text, timestamp } from "drizzle-orm/pg-core";

export const authors = pgTable("authors", {
  id: serial("id").primaryKey(),
  title: text("name").notNull(),
  bio: text("bio"),
  createdAt: timestamp("created_at").notNull().defaultNow(),
});
</pre> <hr> <span data-as="p">We then use the <code>drizzle-kit</code> CLI to generate an initial SQL migration.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bunx drizzle-kit generate --dialect postgresql --schema ./schema.ts --out ./drizzle
</pre> <hr> <span data-as="p">This creates a new <code>drizzle</code> directory containing a <code>.sql</code> migration file and <code>meta</code> directory.</span> <pre numberoflines="6" language="text" data-language="typescript">drizzle
├── 0000_aspiring_post.sql
└── meta
    ├── 0000_snapshot.json
    └── _journal.json
</pre> <hr> <span data-as="p">We can execute these migrations with a simple <code>migrate.ts</code> script. This script creates a new connection to the Neon database and executes all unexecuted migrations in the <code>drizzle</code> directory.</span> <pre numberoflines="14" language="typescript" data-language="typescript">import { db } from "./db";
import { migrate } from "drizzle-orm/neon-http/migrator";

const main = async () =&gt; {
  try {
    await migrate(db, { migrationsFolder: "drizzle" });
    console.log("Migration completed");
  } catch (error) {
    console.error("Error during migration:", error);
    process.exit(1);
  }
};

main();
</pre> <hr> <span data-as="p">We can run this script with <code>bun</code> to execute the migration.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun run migrate.ts
</pre> <pre numberoflines="2" language="text" data-language="typescript">Migration completed
</pre> <hr> <span data-as="p">We can now add some data to our database. Create a <code>seed.ts</code> file with the following contents.</span> <pre numberoflines="31" language="typescript" data-language="typescript">import { db } from "./db";
import * as schema from "./schema";

async function seed() {
  await db.insert(schema.authors).values([
    {
      title: "J.R.R. Tolkien",
      bio: "The creator of Middle-earth and author of The Lord of the Rings.",
    },
    {
      title: "George R.R. Martin",
      bio: "The author of the epic fantasy series A Song of Ice and Fire.",
    },
    {
      title: "J.K. Rowling",
      bio: "The creator of the Harry Potter series.",
    },
  ]);
}

async function main() {
  try {
    await seed();
    console.log("Seeding completed");
  } catch (error) {
    console.error("Error during seeding:", error);
    process.exit(1);
  }
}

main();
</pre> <hr> <span data-as="p">Then run this file.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun run seed.ts
</pre> <pre numberoflines="2" language="text" data-language="typescript">Seeding completed
</pre> <hr> <span data-as="p">We now have a database with a schema and sample data. We can use Drizzle to query it. Replace the contents of <code>index.ts</code> with the following.</span> <pre numberoflines="5" language="typescript" data-language="typescript">import * as schema from "./schema";
import { db } from "./db";

const result = await db.select().from(schema.authors);
console.log(result);
</pre> <hr> <span data-as="p">Then run the file. You should see the three authors we inserted.</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun run index.ts
</pre> <pre numberoflines="19" language="text" data-language="typescript">[
  {
    id: 1,
    title: "J.R.R. Tolkien",
    bio: "The creator of Middle-earth and author of The Lord of the Rings.",
    createdAt: 2024-05-11T10:28:46.029Z,
  }, {
    id: 2,
    title: "George R.R. Martin",
    bio: "The author of the epic fantasy series A Song of Ice and Fire.",
    createdAt: 2024-05-11T10:28:46.029Z,
  }, {
    id: 3,
    title: "J.K. Rowling",
    bio: "The creator of the Harry Potter series.",
    createdAt: 2024-05-11T10:28:46.029Z,
  }
]
</pre> <hr> <span data-as="p">This example used the Neon serverless driver’s SQL-over-HTTP functionality. Neon’s serverless driver also exposes <code>Client</code> and <code>Pool</code> constructors to enable sessions, interactive transactions, and node-postgres compatibility. Refer to <a href="https://neon.tech/docs/serverless/serverless-driver" target="_blank" rel="noreferrer">Neon’s documentation</a> for a complete overview.</span> <span data-as="p">Refer to the <a href="https://orm.drizzle.team/docs/overview" target="_blank" rel="noreferrer">Drizzle website</a> for more documentation on using the Drizzle ORM.</span>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/guides/ecosystem/neon-drizzle" class="_attribution-link">https://bun.com/docs/guides/ecosystem/neon-drizzle</a>
  </p>
</div>
