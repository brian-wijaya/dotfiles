<h1 id="header">Test configuration</h1>
<div data-page-title="Test configuration" data-page-href="/test/configuration" id="content">
<span data-as="p">Configure <code>bun test</code> via <code>bunfig.toml</code> file and command-line options. This page documents the available configuration options for <code>bun test</code>.</span> <h2 id="configuration-file"><span>Configuration File</span></h2> <span data-as="p">You can configure <code>bun test</code> behavior by adding a <code>[test]</code> section to your <code>bunfig.toml</code> file:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
# Options go here
</pre> <h2 id="test-discovery"><span>Test Discovery</span></h2> <h3 id="root"><span>root</span></h3> <span data-as="p">The <code>root</code> option specifies a root directory for test discovery, overriding the default behavior of scanning from the project root.</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
root = "src"  # Only scan for tests in the src directory
</pre> <span data-as="p">This is useful when you want to:</span> <ul> <li>Limit test discovery to specific directories</li> <li>Exclude certain parts of your project from test scanning</li> <li>Organize tests in a specific subdirectory structure</li> </ul> <h4 id="examples"><span>Examples</span></h4> <pre numberoflines="9" language="toml" data-language="typescript">[test]
# Only run tests in the src directory
root = "src"

# Run tests in a specific test directory
root = "tests"

# Run tests in multiple specific directories (not currently supported - use patterns instead)
# root = ["src", "lib"]  # This syntax is not supported
</pre> <h3 id="preload-scripts"><span>Preload Scripts</span></h3> <span data-as="p">Load scripts before running tests using the <code>preload</code> option:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
preload = ["./test-setup.ts", "./global-mocks.ts"]
</pre> <span data-as="p">This is equivalent to using <code>--preload</code> on the command line:</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun test --preload ./test-setup.ts --preload ./global-mocks.ts
</pre> <h4 id="common-preload-use-cases"><span>Common Preload Use Cases</span></h4> <pre numberoflines="12" language="typescript" data-language="typescript">// Global test setup
import { beforeAll, afterAll } from "bun:test";

beforeAll(() =&gt; {
  // Set up test database
  setupTestDatabase();
});

afterAll(() =&gt; {
  // Clean up
  cleanupTestDatabase();
});
</pre> <pre numberoflines="11" language="typescript" data-language="typescript">// Global mocks
import { mock } from "bun:test";

// Mock environment variables
process.env.NODE_ENV = "test";
process.env.API_URL = "http://localhost:3001";

// Mock external dependencies
mock.module("./external-api", () =&gt; ({
  fetchData: mock(() =&gt; Promise.resolve({ data: "test" })),
}));
</pre> <h2 id="timeouts"><span>Timeouts</span></h2> <h3 id="default-timeout"><span>Default Timeout</span></h3> <span data-as="p">Set the default timeout for all tests:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
timeout = 10000  # 10 seconds (default is 5000ms)
</pre> <span data-as="p">This applies to all tests unless overridden by individual test timeouts:</span> <pre numberoflines="9" language="typescript" data-language="typescript">// This test will use the default timeout from bunfig.toml
test("uses default timeout", () =&gt; {
  // test implementation
});

// This test overrides the default timeout
test("custom timeout", () =&gt; {
  // test implementation
}, 30000); // 30 seconds
</pre> <h2 id="reporters"><span>Reporters</span></h2> <h3 id="junit-reporter"><span>JUnit Reporter</span></h3> <span data-as="p">Configure the JUnit reporter output file path directly in the config file:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test.reporter]
junit = "path/to/junit.xml"  # Output path for JUnit XML report
</pre> <span data-as="p">This complements the <code>--reporter=junit</code> and <code>--reporter-outfile</code> CLI flags:</span> <pre numberoflines="2" language="shellscript" data-language="typescript"># Equivalent command line usage
bun test --reporter=junit --reporter-outfile=./junit.xml
</pre> <h4 id="multiple-reporters"><span>Multiple Reporters</span></h4> <span data-as="p">You can use multiple reporters simultaneously:</span> <pre numberoflines="4" language="shellscript" data-language="typescript"># CLI approach
bun test --reporter=junit --reporter-outfile=./junit.xml

# Config file approach
</pre> <pre numberoflines="7" language="toml" data-language="typescript">[test.reporter]
junit = "./reports/junit.xml"

[test]
# Also enable coverage reporting
coverage = true
coverageReporter = ["text", "lcov"]
</pre> <h2 id="memory-usage"><span>Memory Usage</span></h2> <h3 id="smol-mode"><span>smol Mode</span></h3> <span data-as="p">Enable the <code>--smol</code> memory-saving mode specifically for the test runner:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
smol = true  # Reduce memory usage during test runs
</pre> <span data-as="p">This is equivalent to using the <code>--smol</code> flag on the command line:</span> <pre numberoflines="1" language="shellscript" data-language="typescript">bun test --smol
</pre> <span data-as="p">The <code>smol</code> mode reduces memory usage by:</span> <ul> <li>Using less memory for the JavaScript heap</li> <li>Being more aggressive about garbage collection</li> <li>Reducing buffer sizes where possible</li> </ul> <span data-as="p">This is useful for:</span> <ul> <li>CI environments with limited memory</li> <li>Large test suites that consume significant memory</li> <li>Development environments with memory constraints</li> </ul> <h2 id="test-execution"><span>Test execution</span></h2> <h3 id="concurrenttestglob"><span>concurrentTestGlob</span></h3> <span data-as="p">Automatically run test files matching a glob pattern with concurrent test execution enabled. This is useful for gradually migrating test suites to concurrent execution or for running specific test types concurrently.</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
concurrentTestGlob = "**/concurrent-*.test.ts"  # Run files matching this pattern concurrently
</pre> <span data-as="p">Test files matching this pattern will behave as if the <code>--concurrent</code> flag was passed, running all tests within those files concurrently. This allows you to:</span> <ul> <li>Gradually migrate your test suite to concurrent execution</li> <li>Run integration tests concurrently while keeping unit tests sequential</li> <li>Separate fast concurrent tests from tests that require sequential execution</li> </ul> <span data-as="p">The <code>--concurrent</code> CLI flag will override this setting when specified, forcing all tests to run concurrently regardless of the glob pattern.</span> <h4 id="randomize"><span>randomize</span></h4> <span data-as="p">Run tests in random order to identify tests with hidden dependencies:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
randomize = true
</pre> <h4 id="seed"><span>seed</span></h4> <span data-as="p">Specify a seed for reproducible random test order. Requires <code>randomize = true</code>:</span> <pre numberoflines="3" language="toml" data-language="typescript">[test]
randomize = true
seed = 2444615283
</pre> <h4 id="reruneach"><span>rerunEach</span></h4> <span data-as="p">Re-run each test file multiple times to identify flaky tests:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
rerunEach = 3
</pre> <h2 id="coverage-options"><span>Coverage Options</span></h2> <h3 id="basic-coverage-settings"><span>Basic Coverage Settings</span></h3> <pre numberoflines="9" language="toml" data-language="typescript">[test]
# Enable coverage by default
coverage = true

# Set coverage reporter
coverageReporter = ["text", "lcov"]

# Set coverage output directory
coverageDir = "./coverage"
</pre> <h3 id="skip-test-files-from-coverage"><span>Skip Test Files from Coverage</span></h3> <span data-as="p">Exclude files matching test patterns (e.g., <code>*.test.ts</code>) from the coverage report:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
coverageSkipTestFiles = true  # Exclude test files from coverage reports
</pre> <h3 id="coverage-thresholds"><span>Coverage Thresholds</span></h3> <span data-as="p">The coverage threshold can be specified either as a number or as an object with specific thresholds:</span> <pre numberoflines="6" language="toml" data-language="typescript">[test]
# Simple threshold - applies to lines, functions, and statements
coverageThreshold = 0.8

# Detailed thresholds
coverageThreshold = { lines = 0.9, functions = 0.8, statements = 0.85 }
</pre> <span data-as="p">Setting any of these enables <code>fail_on_low_coverage</code>, causing the test run to fail if coverage is below the threshold.</span> <h4 id="threshold-examples"><span>Threshold Examples</span></h4> <pre numberoflines="10" language="toml" data-language="typescript">[test]
# Require 90% coverage across the board
coverageThreshold = 0.9

# Different requirements for different metrics
coverageThreshold = {
  lines = 0.85,      # 85% line coverage
  functions = 0.90,  # 90% function coverage
  statements = 0.80  # 80% statement coverage
}
</pre> <h3 id="coverage-path-ignore-patterns"><span>Coverage Path Ignore Patterns</span></h3> <span data-as="p">Exclude specific files or file patterns from coverage reports using glob patterns:</span> <pre numberoflines="13" language="toml" data-language="typescript">[test]
# Single pattern
coveragePathIgnorePatterns = "**/*.spec.ts"

# Multiple patterns
coveragePathIgnorePatterns = [
  "**/*.spec.ts",
  "**/*.test.ts",
  "src/utils/**",
  "*.config.js",
  "generated/**",
  "vendor/**"
]
</pre> <span data-as="p">Files matching any of these patterns will be excluded from coverage calculation and reporting. See the <a href="code-coverage">coverage documentation</a> for more details and examples.</span> <h4 id="common-ignore-patterns"><span>Common Ignore Patterns</span></h4> <pre numberoflines="30" language="toml" data-language="typescript">[test]
coveragePathIgnorePatterns = [
  # Test files
  "**/*.test.ts",
  "**/*.spec.ts",
  "**/*.e2e.ts",

  # Configuration files
  "*.config.js",
  "*.config.ts",
  "webpack.config.*",
  "vite.config.*",

  # Build output
  "dist/**",
  "build/**",
  ".next/**",

  # Generated code
  "generated/**",
  "**/*.generated.ts",

  # Vendor/third-party
  "vendor/**",
  "third-party/**",

  # Utilities that don't need testing
  "src/utils/constants.ts",
  "src/types/**"
]
</pre> <h3 id="sourcemap-handling"><span>Sourcemap Handling</span></h3> <span data-as="p">Internally, Bun transpiles every file. That means code coverage must also go through sourcemaps before they can be reported. We expose this as a flag to allow you to opt out of this behavior, but it will be confusing because during the transpilation process, Bun may move code around and change variable names. This option is mostly useful for debugging coverage issues.</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
coverageIgnoreSourcemaps = true  # Don't use sourcemaps for coverage analysis
</pre> <div data-callout-type="warning">

<div data-component-part="callout-content"><span data-as="p">When using this option, you probably want to stick a <code>// @bun</code> comment at the top of the source file to opt out of the transpilation process.</span></div>
</div> <h2 id="install-settings-inheritance"><span>Install Settings Inheritance</span></h2> <span data-as="p">The <code>bun test</code> command inherits relevant network and installation configuration (registry, cafile, prefer, exact, etc.) from the <code>[install]</code> section of <code>bunfig.toml</code>. This is important if tests need to interact with private registries or require specific install behaviors triggered during the test run.</span> <pre numberoflines="10" language="toml" data-language="typescript">[install]
# These settings are inherited by bun test
registry = "https://npm.company.com/"
exact = true
prefer = "offline"

[test]
# Test-specific configuration
coverage = true
timeout = 10000
</pre> <h2 id="environment-variables"><span>Environment Variables</span></h2> <span data-as="p">You can also set environment variables in your configuration that affect test behavior:</span> <pre numberoflines="7" language="toml" data-language="typescript">[env]
NODE_ENV = "test"
DATABASE_URL = "postgresql://localhost:5432/test_db"
LOG_LEVEL = "error"

[test]
coverage = true
</pre> <h2 id="complete-configuration-example"><span>Complete Configuration Example</span></h2> <span data-as="p">Hereâ€™s a comprehensive example showing all available test configuration options:</span> <pre numberoflines="40" language="toml" data-language="typescript">[install]
# Install settings inherited by tests
registry = "https://registry.npmjs.org/"
exact = true

[env]
# Environment variables for tests
NODE_ENV = "test"
DATABASE_URL = "postgresql://localhost:5432/test_db"
API_URL = "http://localhost:3001"
LOG_LEVEL = "error"

[test]
# Test discovery
root = "src"
preload = ["./test-setup.ts", "./global-mocks.ts"]

# Execution settings
timeout = 10000
smol = true

# Coverage configuration
coverage = true
coverageReporter = ["text", "lcov"]
coverageDir = "./coverage"
coverageThreshold = { lines = 0.85, functions = 0.90, statements = 0.80 }
coverageSkipTestFiles = true
coveragePathIgnorePatterns = [
  "**/*.spec.ts",
  "src/utils/**",
  "*.config.js",
  "generated/**"
]

# Advanced coverage settings
coverageIgnoreSourcemaps = false

# Reporter configuration
[test.reporter]
junit = "./reports/junit.xml"
</pre> <h2 id="cli-override-behavior"><span>CLI Override Behavior</span></h2> <span data-as="p">Command-line options always override configuration file settings:</span> <pre numberoflines="3" language="toml" data-language="typescript">[test]
timeout = 5000
coverage = false
</pre> <pre numberoflines="3" language="shellscript" data-language="typescript"># These CLI flags override the config file
bun test --timeout 10000 --coverage
# timeout will be 10000ms and coverage will be enabled
</pre> <h2 id="conditional-configuration"><span>Conditional Configuration</span></h2> <span data-as="p">You can use different configurations for different environments:</span> <pre numberoflines="10" language="toml" data-language="typescript">[test]
# Default test configuration
coverage = false
timeout = 5000

# Override for CI environment
[test.ci]
coverage = true
coverageThreshold = 0.8
timeout = 30000
</pre> <span data-as="p">Then in CI:</span> <pre numberoflines="2" language="shellscript" data-language="typescript"># Use CI-specific settings
bun test --config=ci
</pre> <h2 id="validation-and-troubleshooting"><span>Validation and Troubleshooting</span></h2> <h3 id="invalid-configuration"><span>Invalid Configuration</span></h3> <span data-as="p">Bun will warn about invalid configuration options:</span> <pre numberoflines="2" language="toml" data-language="typescript">[test]
invalidOption = true  # This will generate a warning
</pre> <h3 id="common-configuration-issues"><span>Common Configuration Issues</span></h3> <ol> <li>
<strong>Path Resolution</strong>: Relative paths in config are resolved relative to the config file location</li> <li>
<strong>Pattern Matching</strong>: Glob patterns use standard glob syntax</li> <li>
<strong>Type Mismatches</strong>: Ensure numeric values are not quoted unless they should be strings</li> </ol> <pre numberoflines="6" language="toml" data-language="typescript">[test]
# Correct
timeout = 10000

# Incorrect - will be treated as string
timeout = "10000"
</pre> <h3 id="debugging-configuration"><span>Debugging Configuration</span></h3> <span data-as="p">To see what configuration is being used:</span> <pre numberoflines="5" language="shellscript" data-language="typescript"># Show effective configuration
bun test --dry-run

# Verbose output to see configuration loading
bun test --verbose
</pre>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; bun.com, oven-sh, Jarred Sumner<br>Licensed under the MIT License.<br>
    <a href="https://bun.com/docs/test/configuration" class="_attribution-link">https://bun.com/docs/test/configuration</a>
  </p>
</div>
