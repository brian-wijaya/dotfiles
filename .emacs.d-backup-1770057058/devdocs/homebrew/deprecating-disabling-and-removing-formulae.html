<h1 id="deprecating-disabling-and-removing-formulae">Deprecating, Disabling and Removing Formulae</h1> <p>There are many reasons why formulae may be deprecated, disabled or removed. This document explains the differences between each method as well as explaining when one method should be used over another.</p> <h2 id="overview">Overview</h2> <p>These general rules of thumb can be followed:</p> <ol> <li>
<code class="language-plaintext highlighter-rouge">deprecate!</code> should be used for formulae that <em>should</em> no longer be used.</li> <li>
<code class="language-plaintext highlighter-rouge">disable!</code> should be used for formulae that <em>cannot</em> be used.</li> <li>Formulae that are no longer acceptable in <code class="language-plaintext highlighter-rouge">homebrew/core</code> or have been disabled for over a year <em>should</em> be removed.</li> </ol> <h2 id="deprecation">Deprecation</h2> <p>If a user attempts to install a deprecated formula, they will be shown a warning message but the install will proceed.</p> <p>A formula should be deprecated to indicate to users that the formula should not be used and will be disabled in the future. Deprecated formulae should continue to be maintained by the Homebrew maintainers so they still build from source and their bottles continue to work (even if unmaintained upstream). If this is not possible, they should be disabled.</p> <p>The most common reasons for deprecation are when the upstream project is deprecated, unmaintained or archived.</p> <p>Formulae should only be deprecated if at least one of the following are true:</p> <ul> <li>the formula does not build on any supported OS versions</li> <li>the software installed by the formula has outstanding CVEs</li> <li>the software installed by the formula has been discontinued or abandoned upstream</li> <li>the formula has <a href="https://formulae.brew.sh/analytics/install/90d/">zero installs in the last 90 days</a>
</li> </ul> <p>Formulae with dependents should not be deprecated unless all dependents are also deprecated.</p> <p>To deprecate a formula, add a <code class="language-plaintext highlighter-rouge">deprecate!</code> call. This call should include a deprecation date in the ISO 8601 format and a deprecation reason:</p> <pre data-language="ruby">deprecate! date: "YYYY-MM-DD", because: :reason</pre> <p>The <code class="language-plaintext highlighter-rouge">date</code> parameter should be set to the date that the deprecation period should begin, which is usually today’s date. If the <code class="language-plaintext highlighter-rouge">date</code> parameter is set to a date in the future, the formula will not become deprecated until that date. This can be useful if the upstream developers have indicated a date when the project or version will stop being supported. Do not backdate the <code class="language-plaintext highlighter-rouge">date</code> parameter as it causes confusion for users and maintainers.</p> <p>The <code class="language-plaintext highlighter-rouge">because</code> parameter can be a preset reason (using a symbol) or a custom reason. See the <a href="#deprecate-and-disable-reasons">Deprecate and Disable Reasons</a> section below for more details about the <code class="language-plaintext highlighter-rouge">because</code> parameter.</p> <p>An optional <code class="language-plaintext highlighter-rouge">replacement_formula</code> or <code class="language-plaintext highlighter-rouge">replacement_cask</code> parameter may also be specified to suggest a replacement formula or cask to the user. The value for the parameter is a string.</p> <pre data-language="ruby">deprecate! date: "YYYY-MM-DD", because: :reason, replacement_formula: "foo"</pre> <h2 id="disabling">Disabling</h2> <p>If a user attempts to install a disabled formula, they will be shown an error message and the install will fail.</p> <p>A formula should be disabled to indicate to users that the formula cannot be used and will be removed in the future. Disabled formulae may no longer build from source or have working bottles.</p> <p>The most common reasons for disabling a formula are:</p> <ul> <li>it cannot be built from source on any supported OS versions (meaning no new bottles can be built)</li> <li>it has been deprecated for a long time</li> <li>the project has no license</li> </ul> <p>Popular formulae (e.g. have more than 1000 <a href="https://formulae.brew.sh/analytics/install/90d/">analytics installs in the last 90 days</a>) should not be disabled without a deprecation period of at least six months even if e.g. they do not build from source and do not have a license.</p> <p>Unpopular formulae (e.g. have fewer than 1000 <a href="https://formulae.brew.sh/analytics/install/90d/">analytics installs in the last 90 days</a>) can be disabled immediately for any of the reasons above, e.g. they cannot be built from source on any supported macOS version or Linux. They can be manually removed three months after their disable date.</p> <p>To disable a formula, add a <code class="language-plaintext highlighter-rouge">disable!</code> call. This call should include a deprecation date in the ISO 8601 format and a deprecation reason:</p> <pre data-language="ruby">disable! date: "YYYY-MM-DD", because: :reason</pre> <p>The <code class="language-plaintext highlighter-rouge">date</code> parameter should be set to the date that the reason for disabling came into effect. If there is no clear date but the formula needs to be disabled, use today’s date. If the <code class="language-plaintext highlighter-rouge">date</code> parameter is set to a date in the future, the formula will be deprecated until that date (upon which the formula will become disabled).</p> <p>The <code class="language-plaintext highlighter-rouge">because</code> parameter can be a preset reason (using a symbol) or a custom reason. See the <a href="#deprecate-and-disable-reasons">Deprecate and Disable Reasons</a> section below for more details about the <code class="language-plaintext highlighter-rouge">because</code> parameter.</p> <p>Similar to deprecated formulae, an optional <code class="language-plaintext highlighter-rouge">replacement_formula</code> or <code class="language-plaintext highlighter-rouge">replacement_cask</code> parameter may also be specified for disabled formulae to suggest a replacement formula or cask to the user. The value for the parameter is a string.</p> <pre data-language="ruby">disable! date: "YYYY-MM-DD", because: :reason, replacement_cask: "foo"</pre> <h2 id="removal">Removal</h2> <p>A formula should be removed if it does not meet our criteria for <a href="acceptable-formulae">acceptable formulae</a> or <a href="versions">versioned formulae</a>, has a non-open-source license, or has been disabled for over a year.</p> <p><strong>Note: disabled formulae in <code class="language-plaintext highlighter-rouge">homebrew/core</code> will be automatically removed one year after their disable date.</strong></p> <h2 id="deprecate-and-disable-reasons">Deprecate and Disable Reasons</h2> <p>When a formula is deprecated or disabled, a reason explaining the action must be provided.</p> <p>There are two ways to indicate the reason. The preferred way is to use a pre-existing symbol to indicate the reason. The available symbols are listed below and can be found in the <a href="https://rubydoc.brew.sh/DeprecateDisable.html"><code class="language-plaintext highlighter-rouge">DeprecateDisable</code> module</a>:</p> <ul> <li>
<code class="language-plaintext highlighter-rouge">:does_not_build</code>: the formula cannot be built from source on any supported macOS version or Linux.</li> <li>
<code class="language-plaintext highlighter-rouge">:no_license</code>: we cannot identify a license for the formula</li> <li>
<code class="language-plaintext highlighter-rouge">:repo_archived</code>: the upstream repository has been archived and no replacement is pointed to that we can use</li> <li>
<code class="language-plaintext highlighter-rouge">:repo_removed</code>: the upstream repository has been removed and no replacement is mentioned on the homepage that we can use</li> <li>
<code class="language-plaintext highlighter-rouge">:unmaintained</code>: the project appears to be abandoned, i.e. it has had no commits for at least a year and has critical bugs or CVEs that have been reported and left unresolved for longer. <strong>Note:</strong> some software is “done”; a lack of activity does not imply a need for removal.</li> <li>
<code class="language-plaintext highlighter-rouge">:unsupported</code>: Homebrew’s compilation of the software is not supported by the upstream developers (e.g. upstream only supports macOS versions older than 10.15)</li> <li>
<code class="language-plaintext highlighter-rouge">:deprecated_upstream</code>: the project is deprecated upstream and no replacement is pointed to that we can use</li> <li>
<code class="language-plaintext highlighter-rouge">:versioned_formula</code>: the formula is a versioned formula and no longer <a href="versions">meets the requirements</a>.</li> <li>
<code class="language-plaintext highlighter-rouge">:checksum_mismatch</code>: the checksum of the source for the formula’s current version has changed since bottles were built and we cannot find a reputable source or statement justifying this</li> </ul> <p>These reasons can be specified by their symbols (the comments show the message that will be displayed to users):</p> <pre data-language="ruby"># Warning: &lt;formula&gt; has been deprecated because it is deprecated upstream!
deprecate! date: "2020-01-01", because: :deprecated_upstream</pre> <pre data-language="ruby"># Error: &lt;formula&gt; has been disabled because it does not build!
disable! date: "2020-01-01", because: :does_not_build</pre> <p>If these pre-existing reasons do not fit, a custom reason can be specified. Such reasons should be written to fit into the sentence <code class="language-plaintext highlighter-rouge">&lt;formula&gt; has been deprecated/disabled because it &lt;reason&gt;!</code>.</p> <p>A well-worded example of a custom reason would be:</p> <pre data-language="ruby"># Warning: &lt;formula&gt; has been deprecated because it fetches unversioned dependencies at runtime!
deprecate! date: "2020-01-01", because: "fetches unversioned dependencies at runtime"</pre> <p>A poorly-worded example of a custom reason would be:</p> <pre data-language="ruby"># Error: &lt;formula&gt; has been disabled because it invalid license!
disable! date: "2020-01-01", because: "invalid license"</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2009&ndash;present Homebrew contributors<br>Licensed under the BSD 2-Clause License.<br>
    <a href="https://docs.brew.sh/Deprecating-Disabling-and-Removing-Formulae" class="_attribution-link">https://docs.brew.sh/Deprecating-Disabling-and-Removing-Formulae</a>
  </p>
</div>
