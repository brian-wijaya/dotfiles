<h2 id="test-runner">Test runner
</h2> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v20.0.0</td> <td><p>The test runner is now stable.</p></td>
</tr> <tr>
<td>v18.0.0, v16.17.0</td> <td><p><span>Added in: v18.0.0, v16.17.0</span></p></td>
</tr> </tbody>
</table> </details> </div> 
<div class="api_stability api_stability_2">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 2</a> - Stable</div>
 <p><strong>Source Code:</strong> <a href="https://github.com/nodejs/node/blob/v25.0.0/lib/test.js">lib/test.js</a></p> <p>The <code>node:test</code> module facilitates the creation of JavaScript tests. To access it:</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import test from 'node:test';</pre></details><details><summary>CommonJS</summary><pre data-language="js">const test = require('node:test');</pre></details> <p>This module is only available under the <code>node:</code> scheme.</p> <p>Tests created via the <code>test</code> module consist of a single function that is processed in one of three ways:</p> <ol> <li>A synchronous function that is considered failing if it throws an exception, and is considered passing otherwise.</li> <li>A function that returns a <code>Promise</code> that is considered failing if the <code>Promise</code> rejects, and is considered passing if the <code>Promise</code> fulfills.</li> <li>A function that receives a callback function. If the callback receives any truthy value as its first argument, the test is considered failing. If a falsy value is passed as the first argument to the callback, the test is considered passing. If the test function receives a callback function and also returns a <code>Promise</code>, the test will fail.</li> </ol> <p>The following example illustrates how tests are written using the <code>test</code> module.</p> <pre data-language="js">test('synchronous passing test', (t) =&gt; {
  // This test passes because it does not throw an exception.
  assert.strictEqual(1, 1);
});

test('synchronous failing test', (t) =&gt; {
  // This test fails because it throws an exception.
  assert.strictEqual(1, 2);
});

test('asynchronous passing test', async (t) =&gt; {
  // This test passes because the Promise returned by the async
  // function is settled and not rejected.
  assert.strictEqual(1, 1);
});

test('asynchronous failing test', async (t) =&gt; {
  // This test fails because the Promise returned by the async
  // function is rejected.
  assert.strictEqual(1, 2);
});

test('failing test using Promises', (t) =&gt; {
  // Promises can be used directly as well.
  return new Promise((resolve, reject) =&gt; {
    setImmediate(() =&gt; {
      reject(new Error('this will cause the test to fail'));
    });
  });
});

test('callback passing test', (t, done) =&gt; {
  // done() is the callback function. When the setImmediate() runs, it invokes
  // done() with no arguments.
  setImmediate(done);
});

test('callback failing test', (t, done) =&gt; {
  // When the setImmediate() runs, done() is invoked with an Error object and
  // the test fails.
  setImmediate(() =&gt; {
    done(new Error('callback failure'));
  });
}); copy</pre> <p>If any tests fail, the process exit code is set to <code>1</code>.</p> <section><h3 id="subtests">Subtests
</h3> <p>The test context's <code>test()</code> method allows subtests to be created. It allows you to structure your tests in a hierarchical manner, where you can create nested tests within a larger test. This method behaves identically to the top level <code>test()</code> function. The following example demonstrates the creation of a top level test with two subtests.</p> <pre data-language="js">test('top level test', async (t) =&gt; {
  await t.test('subtest 1', (t) =&gt; {
    assert.strictEqual(1, 1);
  });

  await t.test('subtest 2', (t) =&gt; {
    assert.strictEqual(2, 2);
  });
}); copy</pre> <blockquote> <p><strong>Note:</strong> <code>beforeEach</code> and <code>afterEach</code> hooks are triggered between each subtest execution.</p> </blockquote> <p>In this example, <code>await</code> is used to ensure that both subtests have completed. This is necessary because tests do not wait for their subtests to complete, unlike tests created within suites. Any subtests that are still outstanding when their parent finishes are cancelled and treated as failures. Any subtest failures cause the parent test to fail.</p> </section><section><h3 id="skipping-tests">Skipping tests
</h3> <p>Individual tests can be skipped by passing the <code>skip</code> option to the test, or by calling the test context's <code>skip()</code> method as shown in the following example.</p> <pre data-language="js">// The skip option is used, but no message is provided.
test('skip option', { skip: true }, (t) =&gt; {
  // This code is never executed.
});

// The skip option is used, and a message is provided.
test('skip option with message', { skip: 'this is skipped' }, (t) =&gt; {
  // This code is never executed.
});

test('skip() method', (t) =&gt; {
  // Make sure to return here as well if the test contains additional logic.
  t.skip();
});

test('skip() method with message', (t) =&gt; {
  // Make sure to return here as well if the test contains additional logic.
  t.skip('this is skipped');
}); copy</pre> </section><section><h3 id="rerunning-failed-tests">Rerunning failed tests
</h3> <p>The test runner supports persisting the state of the run to a file, allowing the test runner to rerun failed tests without having to re-run the entire test suite. Use the <a href="cli#--test-rerun-failures"><code>--test-rerun-failures</code></a> command-line option to specify a file path where the state of the run is stored. if the state file does not exist, the test runner will create it. the state file is a JSON file that contains an array of run attempts. Each run attempt is an object mapping successful tests to the attempt they have passed in. The key identifying a test in this map is the test file path, with the line and column where the test is defined. in a case where a test defined in a specific location is run multiple times, for example within a function or a loop, a counter will be appended to the key, to disambiguate the test runs. note changing the order of test execution or the location of a test can lead the test runner to consider tests as passed on a previous attempt, meaning <code>--test-rerun-failures</code> should be used when tests run in a deterministic order.</p> <p>example of a state file:</p> <pre data-language="js">[
  {
    "test.js:10:5": { "passed_on_attempt": 0, "name": "test 1" },
  },
  {
    "test.js:10:5": { "passed_on_attempt": 0, "name": "test 1" },
    "test.js:20:5": { "passed_on_attempt": 1, "name": "test 2" }
  }
] copy</pre> <p>in this example, there are two run attempts, with two tests defined in <code>test.js</code>, the first test succeeded on the first attempt, and the second test succeeded on the second attempt.</p> <p>When the <code>--test-rerun-failures</code> option is used, the test runner will only run tests that have not yet passed.</p> <pre data-language="js">node --test-rerun-failures /path/to/state/file copy</pre> </section><section><h3 id="todo-tests">TODO tests
</h3> <p>Individual tests can be marked as flaky or incomplete by passing the <code>todo</code> option to the test, or by calling the test context's <code>todo()</code> method, as shown in the following example. These tests represent a pending implementation or bug that needs to be fixed. TODO tests are executed, but are not treated as test failures, and therefore do not affect the process exit code. If a test is marked as both TODO and skipped, the TODO option is ignored.</p> <pre data-language="js">// The todo option is used, but no message is provided.
test('todo option', { todo: true }, (t) =&gt; {
  // This code is executed, but not treated as a failure.
  throw new Error('this does not fail the test');
});

// The todo option is used, and a message is provided.
test('todo option with message', { todo: 'this is a todo test' }, (t) =&gt; {
  // This code is executed.
});

test('todo() method', (t) =&gt; {
  t.todo();
});

test('todo() method with message', (t) =&gt; {
  t.todo('this is a todo test and is not treated as a failure');
  throw new Error('this does not fail the test');
}); copy</pre> </section><section><h3 id="describe-and-it-aliases">
<code>describe()</code> and <code>it()</code> aliases
</h3> <p>Suites and tests can also be written using the <code>describe()</code> and <code>it()</code> functions. <a href="#describename-options-fn"><code>describe()</code></a> is an alias for <a href="#suitename-options-fn"><code>suite()</code></a>, and <a href="#itname-options-fn"><code>it()</code></a> is an alias for <a href="#testname-options-fn"><code>test()</code></a>.</p> <pre data-language="js">describe('A thing', () =&gt; {
  it('should work', () =&gt; {
    assert.strictEqual(1, 1);
  });

  it('should be ok', () =&gt; {
    assert.strictEqual(2, 2);
  });

  describe('a nested thing', () =&gt; {
    it('should work', () =&gt; {
      assert.strictEqual(3, 3);
    });
  });
}); copy</pre> <p><code>describe()</code> and <code>it()</code> are imported from the <code>node:test</code> module.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import { describe, it } from 'node:test';</pre></details><details><summary>CommonJS</summary><pre data-language="js">const { describe, it } = require('node:test');</pre></details> </section><section><h3 id="only-tests">
<code>only</code> tests
</h3> <p>If Node.js is started with the <a href="cli#--test-only"><code>--test-only</code></a> command-line option, or test isolation is disabled, it is possible to skip all tests except for a selected subset by passing the <code>only</code> option to the tests that should run. When a test with the <code>only</code> option is set, all subtests are also run. If a suite has the <code>only</code> option set, all tests within the suite are run, unless it has descendants with the <code>only</code> option set, in which case only those tests are run.</p> <p>When using <a href="#subtests">subtests</a> within a <code>test()</code>/<code>it()</code>, it is required to mark all ancestor tests with the <code>only</code> option to run only a selected subset of tests.</p> <p>The test context's <code>runOnly()</code> method can be used to implement the same behavior at the subtest level. Tests that are not executed are omitted from the test runner output.</p> <pre data-language="js">// Assume Node.js is run with the --test-only command-line option.
// The suite's 'only' option is set, so these tests are run.
test('this test is run', { only: true }, async (t) =&gt; {
  // Within this test, all subtests are run by default.
  await t.test('running subtest');

  // The test context can be updated to run subtests with the 'only' option.
  t.runOnly(true);
  await t.test('this subtest is now skipped');
  await t.test('this subtest is run', { only: true });

  // Switch the context back to execute all tests.
  t.runOnly(false);
  await t.test('this subtest is now run');

  // Explicitly do not run these tests.
  await t.test('skipped subtest 3', { only: false });
  await t.test('skipped subtest 4', { skip: true });
});

// The 'only' option is not set, so this test is skipped.
test('this test is not run', () =&gt; {
  // This code is not run.
  throw new Error('fail');
});

describe('a suite', () =&gt; {
  // The 'only' option is set, so this test is run.
  it('this test is run', { only: true }, () =&gt; {
    // This code is run.
  });

  it('this test is not run', () =&gt; {
    // This code is not run.
    throw new Error('fail');
  });
});

describe.only('a suite', () =&gt; {
  // The 'only' option is set, so this test is run.
  it('this test is run', () =&gt; {
    // This code is run.
  });

  it('this test is run', () =&gt; {
    // This code is run.
  });
}); copy</pre> </section><section><h3 id="filtering-tests-by-name">Filtering tests by name
</h3> <p>The <a href="cli#--test-name-pattern"><code>--test-name-pattern</code></a> command-line option can be used to only run tests whose name matches the provided pattern, and the <a href="cli#--test-skip-pattern"><code>--test-skip-pattern</code></a> option can be used to skip tests whose name matches the provided pattern. Test name patterns are interpreted as JavaScript regular expressions. The <code>--test-name-pattern</code> and <code>--test-skip-pattern</code> options can be specified multiple times in order to run nested tests. For each test that is executed, any corresponding test hooks, such as <code>beforeEach()</code>, are also run. Tests that are not executed are omitted from the test runner output.</p> <p>Given the following test file, starting Node.js with the <code>--test-name-pattern="test [1-3]"</code> option would cause the test runner to execute <code>test 1</code>, <code>test 2</code>, and <code>test 3</code>. If <code>test 1</code> did not match the test name pattern, then its subtests would not execute, despite matching the pattern. The same set of tests could also be executed by passing <code>--test-name-pattern</code> multiple times (e.g. <code>--test-name-pattern="test 1"</code>, <code>--test-name-pattern="test 2"</code>, etc.).</p> <pre data-language="js">test('test 1', async (t) =&gt; {
  await t.test('test 2');
  await t.test('test 3');
});

test('Test 4', async (t) =&gt; {
  await t.test('Test 5');
  await t.test('test 6');
}); copy</pre> <p>Test name patterns can also be specified using regular expression literals. This allows regular expression flags to be used. In the previous example, starting Node.js with <code>--test-name-pattern="/test [4-5]/i"</code> (or <code>--test-skip-pattern="/test [4-5]/i"</code>) would match <code>Test 4</code> and <code>Test 5</code> because the pattern is case-insensitive.</p> <p>To match a single test with a pattern, you can prefix it with all its ancestor test names separated by space, to ensure it is unique. For example, given the following test file:</p> <pre data-language="js">describe('test 1', (t) =&gt; {
  it('some test');
});

describe('test 2', (t) =&gt; {
  it('some test');
}); copy</pre> <p>Starting Node.js with <code>--test-name-pattern="test 1 some test"</code> would match only <code>some test</code> in <code>test 1</code>.</p> <p>Test name patterns do not change the set of files that the test runner executes.</p> <p>If both <code>--test-name-pattern</code> and <code>--test-skip-pattern</code> are supplied, tests must satisfy <strong>both</strong> requirements in order to be executed.</p> </section><section><h3 id="extraneous-asynchronous-activity">Extraneous asynchronous activity
</h3> <p>Once a test function finishes executing, the results are reported as quickly as possible while maintaining the order of the tests. However, it is possible for the test function to generate asynchronous activity that outlives the test itself. The test runner handles this type of activity, but does not delay the reporting of test results in order to accommodate it.</p> <p>In the following example, a test completes with two <code>setImmediate()</code> operations still outstanding. The first <code>setImmediate()</code> attempts to create a new subtest. Because the parent test has already finished and output its results, the new subtest is immediately marked as failed, and reported later to the <a href="test#class-testsstream" class="type">&lt;TestsStream&gt;</a>.</p> <p>The second <code>setImmediate()</code> creates an <code>uncaughtException</code> event. <code>uncaughtException</code> and <code>unhandledRejection</code> events originating from a completed test are marked as failed by the <code>test</code> module and reported as diagnostic warnings at the top level by the <a href="test#class-testsstream" class="type">&lt;TestsStream&gt;</a>.</p> <pre data-language="js">test('a test that creates asynchronous activity', (t) =&gt; {
  setImmediate(() =&gt; {
    t.test('subtest that is created too late', (t) =&gt; {
      throw new Error('error1');
    });
  });

  setImmediate(() =&gt; {
    throw new Error('error2');
  });

  // The test finishes after this line.
}); copy</pre> </section><section><h3 id="watch-mode">Watch mode
</h3> <div class="api_metadata"> <span>Added in: v19.2.0, v18.13.0</span> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a> - Experimental</div>
 <p>The Node.js test runner supports running in watch mode by passing the <code>--watch</code> flag:</p> <pre data-language="js">node --test --watch copy</pre> <p>In watch mode, the test runner will watch for changes to test files and their dependencies. When a change is detected, the test runner will rerun the tests affected by the change. The test runner will continue to run until the process is terminated.</p> </section><section><h3 id="global-setup-and-teardown">Global setup and teardown
</h3> <div class="api_metadata"> <span>Added in: v24.0.0</span> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1.0</a> - Early development</div>
 <p>The test runner supports specifying a module that will be evaluated before all tests are executed and can be used to setup global state or fixtures for tests. This is useful for preparing resources or setting up shared state that is required by multiple tests.</p> <p>This module can export any of the following:</p> <ul> <li>A <code>globalSetup</code> function which runs once before all tests start</li> <li>A <code>globalTeardown</code> function which runs once after all tests complete</li> </ul> <p>The module is specified using the <code>--test-global-setup</code> flag when running tests from the command line.</p> <details><summary>CommonJS</summary><pre data-language="js">// setup-module.js
async function globalSetup() {
  // Setup shared resources, state, or environment
  console.log('Global setup executed');
  // Run servers, create files, prepare databases, etc.
}

async function globalTeardown() {
  // Clean up resources, state, or environment
  console.log('Global teardown executed');
  // Close servers, remove files, disconnect from databases, etc.
}

module.exports = { globalSetup, globalTeardown };</pre></details><details open><summary>JavaScript modules</summary><pre data-language="js">// setup-module.mjs
export async function globalSetup() {
  // Setup shared resources, state, or environment
  console.log('Global setup executed');
  // Run servers, create files, prepare databases, etc.
}

export async function globalTeardown() {
  // Clean up resources, state, or environment
  console.log('Global teardown executed');
  // Close servers, remove files, disconnect from databases, etc.
}</pre></details> <p>If the global setup function throws an error, no tests will be run and the process will exit with a non-zero exit code. The global teardown function will not be called in this case.</p> </section><section><h3 id="running-tests-from-the-command-line">Running tests from the command line
</h3> <p>The Node.js test runner can be invoked from the command line by passing the <a href="cli#--test"><code>--test</code></a> flag:</p> <pre data-language="js">node --test copy</pre> <p>By default, Node.js will run all files matching these patterns:</p> <ul> <li><code>**/*.test.{cjs,mjs,js}</code></li> <li><code>**/*-test.{cjs,mjs,js}</code></li> <li><code>**/*_test.{cjs,mjs,js}</code></li> <li><code>**/test-*.{cjs,mjs,js}</code></li> <li><code>**/test.{cjs,mjs,js}</code></li> <li><code>**/test/**/*.{cjs,mjs,js}</code></li> </ul> <p>Unless <a href="cli#--no-experimental-strip-types"><code>--no-experimental-strip-types</code></a> is supplied, the following additional patterns are also matched:</p> <ul> <li><code>**/*.test.{cts,mts,ts}</code></li> <li><code>**/*-test.{cts,mts,ts}</code></li> <li><code>**/*_test.{cts,mts,ts}</code></li> <li><code>**/test-*.{cts,mts,ts}</code></li> <li><code>**/test.{cts,mts,ts}</code></li> <li><code>**/test/**/*.{cts,mts,ts}</code></li> </ul> <p>Alternatively, one or more glob patterns can be provided as the final argument(s) to the Node.js command, as shown below. Glob patterns follow the behavior of <a href="https://man7.org/linux/man-pages/man7/glob.7.html"><code>glob(7)</code></a>. The glob patterns should be enclosed in double quotes on the command line to prevent shell expansion, which can reduce portability across systems.</p> <pre data-language="js">node --test "**/*.test.js" "**/*.spec.js" copy</pre> <p>Matching files are executed as test files. More information on the test file execution can be found in the <a href="#test-runner-execution-model">test runner execution model</a> section.</p> <div> <h4 id="test-runner-execution-model">Test runner execution model
</h4> <p>When process-level test isolation is enabled, each matching test file is executed in a separate child process. The maximum number of child processes running at any time is controlled by the <a href="cli#--test-concurrency"><code>--test-concurrency</code></a> flag. If the child process finishes with an exit code of 0, the test is considered passing. Otherwise, the test is considered to be a failure. Test files must be executable by Node.js, but are not required to use the <code>node:test</code> module internally.</p> <p>Each test file is executed as if it was a regular script. That is, if the test file itself uses <code>node:test</code> to define tests, all of those tests will be executed within a single application thread, regardless of the value of the <code>concurrency</code> option of <a href="#testname-options-fn"><code>test()</code></a>.</p> <p>When process-level test isolation is disabled, each matching test file is imported into the test runner process. Once all test files have been loaded, the top level tests are executed with a concurrency of one. Because the test files are all run within the same context, it is possible for tests to interact with each other in ways that are not possible when isolation is enabled. For example, if a test relies on global state, it is possible for that state to be modified by a test originating from another file.</p> <div> <h5 id="child-process-option-inheritance">Child process option inheritance
</h5> <p>When running tests in process isolation mode (the default), spawned child processes inherit Node.js options from the parent process, including those specified in <a href="cli#--experimental-config-fileconfig">configuration files</a>. However, certain flags are filtered out to enable proper test runner functionality:</p> <ul> <li>
<code>--test</code> - Prevented to avoid recursive test execution</li> <li>
<code>--experimental-test-coverage</code> - Managed by the test runner</li> <li>
<code>--watch</code> - Watch mode is handled at the parent level</li> <li>
<code>--experimental-default-config-file</code> - Config file loading is handled by the parent</li> <li>
<code>--test-reporter</code> - Reporting is managed by the parent process</li> <li>
<code>--test-reporter-destination</code> - Output destinations are controlled by the parent</li> <li>
<code>--experimental-config-file</code> - Config file paths are managed by the parent</li> </ul> <p>All other Node.js options from command line arguments, environment variables, and configuration files are inherited by the child processes.</p> </div>
</div> </section><section><h3 id="collecting-code-coverage">Collecting code coverage
</h3> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1</a> - Experimental</div>
 <p>When Node.js is started with the <a href="cli#--experimental-test-coverage"><code>--experimental-test-coverage</code></a> command-line flag, code coverage is collected and statistics are reported once all tests have completed. If the <a href="cli#node_v8_coveragedir"><code>NODE_V8_COVERAGE</code></a> environment variable is used to specify a code coverage directory, the generated V8 coverage files are written to that directory. Node.js core modules and files within <code>node_modules/</code> directories are, by default, not included in the coverage report. However, they can be explicitly included via the <a href="cli#--test-coverage-include"><code>--test-coverage-include</code></a> flag. By default all the matching test files are excluded from the coverage report. Exclusions can be overridden by using the <a href="cli#--test-coverage-exclude"><code>--test-coverage-exclude</code></a> flag. If coverage is enabled, the coverage report is sent to any <a href="#test-reporters">test reporters</a> via the <code>'test:coverage'</code> event.</p> <p>Coverage can be disabled on a series of lines using the following comment syntax:</p> <pre data-language="js">/* node:coverage disable */
if (anAlwaysFalseCondition) {
  // Code in this branch will never be executed, but the lines are ignored for
  // coverage purposes. All lines following the 'disable' comment are ignored
  // until a corresponding 'enable' comment is encountered.
  console.log('this is never executed');
}
/* node:coverage enable */ copy</pre> <p>Coverage can also be disabled for a specified number of lines. After the specified number of lines, coverage will be automatically reenabled. If the number of lines is not explicitly provided, a single line is ignored.</p> <pre data-language="js">/* node:coverage ignore next */
if (anAlwaysFalseCondition) { console.log('this is never executed'); }

/* node:coverage ignore next 3 */
if (anAlwaysFalseCondition) {
  console.log('this is never executed');
} copy</pre> <div> <h4 id="coverage-reporters">Coverage reporters
</h4> <p>The tap and spec reporters will print a summary of the coverage statistics. There is also an lcov reporter that will generate an lcov file which can be used as an in depth coverage report.</p> <pre data-language="js">node --test --experimental-test-coverage --test-reporter=lcov --test-reporter-destination=lcov.info copy</pre> <ul> <li>No test results are reported by this reporter.</li> <li>This reporter should ideally be used alongside another reporter.</li> </ul> </div> </section><section><h3 id="mocking">Mocking
</h3> <p>The <code>node:test</code> module supports mocking during testing via a top-level <code>mock</code> object. The following example creates a spy on a function that adds two numbers together. The spy is then used to assert that the function was called as expected.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { mock, test } from 'node:test';

test('spies on a function', () =&gt; {
  const sum = mock.fn((a, b) =&gt; {
    return a + b;
  });

  assert.strictEqual(sum.mock.callCount(), 0);
  assert.strictEqual(sum(3, 4), 7);
  assert.strictEqual(sum.mock.callCount(), 1);

  const call = sum.mock.calls[0];
  assert.deepStrictEqual(call.arguments, [3, 4]);
  assert.strictEqual(call.result, 7);
  assert.strictEqual(call.error, undefined);

  // Reset the globally tracked mocks.
  mock.reset();
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">'use strict';
const assert = require('node:assert');
const { mock, test } = require('node:test');

test('spies on a function', () =&gt; {
  const sum = mock.fn((a, b) =&gt; {
    return a + b;
  });

  assert.strictEqual(sum.mock.callCount(), 0);
  assert.strictEqual(sum(3, 4), 7);
  assert.strictEqual(sum.mock.callCount(), 1);

  const call = sum.mock.calls[0];
  assert.deepStrictEqual(call.arguments, [3, 4]);
  assert.strictEqual(call.result, 7);
  assert.strictEqual(call.error, undefined);

  // Reset the globally tracked mocks.
  mock.reset();
});</pre></details> <p>The same mocking functionality is also exposed on the <a href="#class-testcontext"><code>TestContext</code></a> object of each test. The following example creates a spy on an object method using the API exposed on the <code>TestContext</code>. The benefit of mocking via the test context is that the test runner will automatically restore all mocked functionality once the test finishes.</p> <pre data-language="js">test('spies on an object method', (t) =&gt; {
  const number = {
    value: 5,
    add(a) {
      return this.value + a;
    },
  };

  t.mock.method(number, 'add');
  assert.strictEqual(number.add.mock.callCount(), 0);
  assert.strictEqual(number.add(3), 8);
  assert.strictEqual(number.add.mock.callCount(), 1);

  const call = number.add.mock.calls[0];

  assert.deepStrictEqual(call.arguments, [3]);
  assert.strictEqual(call.result, 8);
  assert.strictEqual(call.target, undefined);
  assert.strictEqual(call.this, number);
}); copy</pre> <div> <h4 id="timers">Timers
</h4> <p>Mocking timers is a technique commonly used in software testing to simulate and control the behavior of timers, such as <code>setInterval</code> and <code>setTimeout</code>, without actually waiting for the specified time intervals.</p> <p>Refer to the <a href="#class-mocktimers"><code>MockTimers</code></a> class for a full list of methods and features.</p> <p>This allows developers to write more reliable and predictable tests for time-dependent functionality.</p> <p>The example below shows how to mock <code>setTimeout</code>. Using <code>.enable({ apis: ['setTimeout'] });</code> it will mock the <code>setTimeout</code> functions in the <a href="timers">node:timers</a> and <a href="timers#timers-promises-api">node:timers/promises</a> modules, as well as from the Node.js global context.</p> <p><strong>Note:</strong> Destructuring functions such as <code>import { setTimeout } from 'node:timers'</code> is currently not supported by this API.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { mock, test } from 'node:test';

test('mocks setTimeout to be executed synchronously without having to actually wait for it', () =&gt; {
  const fn = mock.fn();

  // Optionally choose what to mock
  mock.timers.enable({ apis: ['setTimeout'] });
  setTimeout(fn, 9999);
  assert.strictEqual(fn.mock.callCount(), 0);

  // Advance in time
  mock.timers.tick(9999);
  assert.strictEqual(fn.mock.callCount(), 1);

  // Reset the globally tracked mocks.
  mock.timers.reset();

  // If you call reset mock instance, it will also reset timers instance
  mock.reset();
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { mock, test } = require('node:test');

test('mocks setTimeout to be executed synchronously without having to actually wait for it', () =&gt; {
  const fn = mock.fn();

  // Optionally choose what to mock
  mock.timers.enable({ apis: ['setTimeout'] });
  setTimeout(fn, 9999);
  assert.strictEqual(fn.mock.callCount(), 0);

  // Advance in time
  mock.timers.tick(9999);
  assert.strictEqual(fn.mock.callCount(), 1);

  // Reset the globally tracked mocks.
  mock.timers.reset();

  // If you call reset mock instance, it will also reset timers instance
  mock.reset();
});</pre></details> <p>The same mocking functionality is also exposed in the mock property on the <a href="#class-testcontext"><code>TestContext</code></a> object of each test. The benefit of mocking via the test context is that the test runner will automatically restore all mocked timers functionality once the test finishes.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();

  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout'] });
  setTimeout(fn, 9999);
  assert.strictEqual(fn.mock.callCount(), 0);

  // Advance in time
  context.mock.timers.tick(9999);
  assert.strictEqual(fn.mock.callCount(), 1);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();

  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout'] });
  setTimeout(fn, 9999);
  assert.strictEqual(fn.mock.callCount(), 0);

  // Advance in time
  context.mock.timers.tick(9999);
  assert.strictEqual(fn.mock.callCount(), 1);
});</pre></details> </div>
<div> <h4 id="dates">Dates
</h4> <p>The mock timers API also allows the mocking of the <code>Date</code> object. This is a useful feature for testing time-dependent functionality, or to simulate internal calendar functions such as <code>Date.now()</code>.</p> <p>The dates implementation is also part of the <a href="#class-mocktimers"><code>MockTimers</code></a> class. Refer to it for a full list of methods and features.</p> <p><strong>Note:</strong> Dates and timers are dependent when mocked together. This means that if you have both the <code>Date</code> and <code>setTimeout</code> mocked, advancing the time will also advance the mocked date as they simulate a single internal clock.</p> <p>The example below show how to mock the <code>Date</code> object and obtain the current <code>Date.now()</code> value.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('mocks the Date object', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['Date'] });
  // If not specified, the initial date will be based on 0 in the UNIX epoch
  assert.strictEqual(Date.now(), 0);

  // Advance in time will also advance the date
  context.mock.timers.tick(9999);
  assert.strictEqual(Date.now(), 9999);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('mocks the Date object', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['Date'] });
  // If not specified, the initial date will be based on 0 in the UNIX epoch
  assert.strictEqual(Date.now(), 0);

  // Advance in time will also advance the date
  context.mock.timers.tick(9999);
  assert.strictEqual(Date.now(), 9999);
});</pre></details> <p>If there is no initial epoch set, the initial date will be based on 0 in the Unix epoch. This is January 1st, 1970, 00:00:00 UTC. You can set an initial date by passing a <code>now</code> property to the <code>.enable()</code> method. This value will be used as the initial date for the mocked <code>Date</code> object. It can either be a positive integer, or another Date object.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('mocks the Date object with initial time', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['Date'], now: 100 });
  assert.strictEqual(Date.now(), 100);

  // Advance in time will also advance the date
  context.mock.timers.tick(200);
  assert.strictEqual(Date.now(), 300);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('mocks the Date object with initial time', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['Date'], now: 100 });
  assert.strictEqual(Date.now(), 100);

  // Advance in time will also advance the date
  context.mock.timers.tick(200);
  assert.strictEqual(Date.now(), 300);
});</pre></details> <p>You can use the <code>.setTime()</code> method to manually move the mocked date to another time. This method only accepts a positive integer.</p> <p><strong>Note:</strong> This method will execute any mocked timers that are in the past from the new time.</p> <p>In the below example we are setting a new time for the mocked date.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('sets the time of a date object', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['Date'], now: 100 });
  assert.strictEqual(Date.now(), 100);

  // Advance in time will also advance the date
  context.mock.timers.setTime(1000);
  context.mock.timers.tick(200);
  assert.strictEqual(Date.now(), 1200);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('sets the time of a date object', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['Date'], now: 100 });
  assert.strictEqual(Date.now(), 100);

  // Advance in time will also advance the date
  context.mock.timers.setTime(1000);
  context.mock.timers.tick(200);
  assert.strictEqual(Date.now(), 1200);
});</pre></details> <p>If you have any timer that's set to run in the past, it will be executed as if the <code>.tick()</code> method has been called. This is useful if you want to test time-dependent functionality that's already in the past.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('runs timers as setTime passes ticks', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
  const fn = context.mock.fn();
  setTimeout(fn, 1000);

  context.mock.timers.setTime(800);
  // Timer is not executed as the time is not yet reached
  assert.strictEqual(fn.mock.callCount(), 0);
  assert.strictEqual(Date.now(), 800);

  context.mock.timers.setTime(1200);
  // Timer is executed as the time is now reached
  assert.strictEqual(fn.mock.callCount(), 1);
  assert.strictEqual(Date.now(), 1200);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('runs timers as setTime passes ticks', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
  const fn = context.mock.fn();
  setTimeout(fn, 1000);

  context.mock.timers.setTime(800);
  // Timer is not executed as the time is not yet reached
  assert.strictEqual(fn.mock.callCount(), 0);
  assert.strictEqual(Date.now(), 800);

  context.mock.timers.setTime(1200);
  // Timer is executed as the time is now reached
  assert.strictEqual(fn.mock.callCount(), 1);
  assert.strictEqual(Date.now(), 1200);
});</pre></details> <p>Using <code>.runAll()</code> will execute all timers that are currently in the queue. This will also advance the mocked date to the time of the last timer that was executed as if the time has passed.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('runs timers as setTime passes ticks', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
  const fn = context.mock.fn();
  setTimeout(fn, 1000);
  setTimeout(fn, 2000);
  setTimeout(fn, 3000);

  context.mock.timers.runAll();
  // All timers are executed as the time is now reached
  assert.strictEqual(fn.mock.callCount(), 3);
  assert.strictEqual(Date.now(), 3000);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('runs timers as setTime passes ticks', (context) =&gt; {
  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
  const fn = context.mock.fn();
  setTimeout(fn, 1000);
  setTimeout(fn, 2000);
  setTimeout(fn, 3000);

  context.mock.timers.runAll();
  // All timers are executed as the time is now reached
  assert.strictEqual(fn.mock.callCount(), 3);
  assert.strictEqual(Date.now(), 3000);
});</pre></details> </div> </section><section><h3 id="snapshot-testing">Snapshot testing
</h3> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v23.4.0</td> <td><p>Snapshot testing is no longer experimental.</p></td>
</tr> <tr>
<td>v22.3.0</td> <td><p><span>Added in: v22.3.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <p>Snapshot tests allow arbitrary values to be serialized into string values and compared against a set of known good values. The known good values are known as snapshots, and are stored in a snapshot file. Snapshot files are managed by the test runner, but are designed to be human readable to aid in debugging. Best practice is for snapshot files to be checked into source control along with your test files.</p> <p>Snapshot files are generated by starting Node.js with the <a href="cli#--test-update-snapshots"><code>--test-update-snapshots</code></a> command-line flag. A separate snapshot file is generated for each test file. By default, the snapshot file has the same name as the test file with a <code>.snapshot</code> file extension. This behavior can be configured using the <code>snapshot.setResolveSnapshotPath()</code> function. Each snapshot assertion corresponds to an export in the snapshot file.</p> <p>An example snapshot test is shown below. The first time this test is executed, it will fail because the corresponding snapshot file does not exist.</p> <pre data-language="js">// test.js
suite('suite of snapshot tests', () =&gt; {
  test('snapshot test', (t) =&gt; {
    t.assert.snapshot({ value1: 1, value2: 2 });
    t.assert.snapshot(5);
  });
}); copy</pre> <p>Generate the snapshot file by running the test file with <code>--test-update-snapshots</code>. The test should pass, and a file named <code>test.js.snapshot</code> is created in the same directory as the test file. The contents of the snapshot file are shown below. Each snapshot is identified by the full name of test and a counter to differentiate between snapshots in the same test.</p> <pre data-language="js">exports[`suite of snapshot tests &gt; snapshot test 1`] = `
{
  "value1": 1,
  "value2": 2
}
`;

exports[`suite of snapshot tests &gt; snapshot test 2`] = `
5
`; copy</pre> <p>Once the snapshot file is created, run the tests again without the <code>--test-update-snapshots</code> flag. The tests should pass now.</p> </section><section><h3 id="test-reporters">Test reporters
</h3> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v23.0.0</td> <td><p>The default reporter on non-TTY stdout is changed from <code>tap</code> to <code>spec</code>, aligning with TTY stdout.</p></td>
</tr> <tr>
<td>v19.9.0, v18.17.0</td> <td><p>Reporters are now exposed at <code>node:test/reporters</code>.</p></td>
</tr> <tr>
<td>v19.6.0, v18.15.0</td> <td><p><span>Added in: v19.6.0, v18.15.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <p>The <code>node:test</code> module supports passing <a href="cli#--test-reporter"><code>--test-reporter</code></a> flags for the test runner to use a specific reporter.</p> <p>The following built-reporters are supported:</p> <ul> <li> <p><code>spec</code> The <code>spec</code> reporter outputs the test results in a human-readable format. This is the default reporter.</p> </li> <li> <p><code>tap</code> The <code>tap</code> reporter outputs the test results in the <a href="https://testanything.org/">TAP</a> format.</p> </li> <li> <p><code>dot</code> The <code>dot</code> reporter outputs the test results in a compact format, where each passing test is represented by a <code>.</code>, and each failing test is represented by a <code>X</code>.</p> </li> <li> <p><code>junit</code> The junit reporter outputs test results in a jUnit XML format</p> </li> <li> <p><code>lcov</code> The <code>lcov</code> reporter outputs test coverage when used with the <a href="cli#--experimental-test-coverage"><code>--experimental-test-coverage</code></a> flag.</p> </li> </ul> <p>The exact output of these reporters is subject to change between versions of Node.js, and should not be relied on programmatically. If programmatic access to the test runner's output is required, use the events emitted by the <a href="test#class-testsstream" class="type">&lt;TestsStream&gt;</a>.</p> <p>The reporters are available via the <code>node:test/reporters</code> module:</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import { tap, spec, dot, junit, lcov } from 'node:test/reporters';</pre></details><details><summary>CommonJS</summary><pre data-language="js">const { tap, spec, dot, junit, lcov } = require('node:test/reporters');</pre></details> <div> <h4 id="custom-reporters">Custom reporters
</h4> <p><a href="cli#--test-reporter"><code>--test-reporter</code></a> can be used to specify a path to custom reporter. A custom reporter is a module that exports a value accepted by <a href="stream#streamcomposestreams">stream.compose</a>. Reporters should transform events emitted by a <a href="test#class-testsstream" class="type">&lt;TestsStream&gt;</a></p> <p>Example of a custom reporter using <a href="stream#class-streamtransform" class="type">&lt;stream.Transform&gt;</a>:</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import { Transform } from 'node:stream';

const customReporter = new Transform({
  writableObjectMode: true,
  transform(event, encoding, callback) {
    switch (event.type) {
      case 'test:dequeue':
        callback(null, `test ${event.data.name} dequeued`);
        break;
      case 'test:enqueue':
        callback(null, `test ${event.data.name} enqueued`);
        break;
      case 'test:watch:drained':
        callback(null, 'test watch queue drained');
        break;
      case 'test:watch:restarted':
        callback(null, 'test watch restarted due to file change');
        break;
      case 'test:start':
        callback(null, `test ${event.data.name} started`);
        break;
      case 'test:pass':
        callback(null, `test ${event.data.name} passed`);
        break;
      case 'test:fail':
        callback(null, `test ${event.data.name} failed`);
        break;
      case 'test:plan':
        callback(null, 'test plan');
        break;
      case 'test:diagnostic':
      case 'test:stderr':
      case 'test:stdout':
        callback(null, event.data.message);
        break;
      case 'test:coverage': {
        const { totalLineCount } = event.data.summary.totals;
        callback(null, `total line count: ${totalLineCount}\n`);
        break;
      }
    }
  },
});

export default customReporter;</pre></details><details><summary>CommonJS</summary><pre data-language="js">const { Transform } = require('node:stream');

const customReporter = new Transform({
  writableObjectMode: true,
  transform(event, encoding, callback) {
    switch (event.type) {
      case 'test:dequeue':
        callback(null, `test ${event.data.name} dequeued`);
        break;
      case 'test:enqueue':
        callback(null, `test ${event.data.name} enqueued`);
        break;
      case 'test:watch:drained':
        callback(null, 'test watch queue drained');
        break;
      case 'test:watch:restarted':
        callback(null, 'test watch restarted due to file change');
        break;
      case 'test:start':
        callback(null, `test ${event.data.name} started`);
        break;
      case 'test:pass':
        callback(null, `test ${event.data.name} passed`);
        break;
      case 'test:fail':
        callback(null, `test ${event.data.name} failed`);
        break;
      case 'test:plan':
        callback(null, 'test plan');
        break;
      case 'test:diagnostic':
      case 'test:stderr':
      case 'test:stdout':
        callback(null, event.data.message);
        break;
      case 'test:coverage': {
        const { totalLineCount } = event.data.summary.totals;
        callback(null, `total line count: ${totalLineCount}\n`);
        break;
      }
    }
  },
});

module.exports = customReporter;</pre></details> <p>Example of a custom reporter using a generator function:</p> <details open><summary>JavaScript modules</summary><pre data-language="js">export default async function * customReporter(source) {
  for await (const event of source) {
    switch (event.type) {
      case 'test:dequeue':
        yield `test ${event.data.name} dequeued\n`;
        break;
      case 'test:enqueue':
        yield `test ${event.data.name} enqueued\n`;
        break;
      case 'test:watch:drained':
        yield 'test watch queue drained\n';
        break;
      case 'test:watch:restarted':
        yield 'test watch restarted due to file change\n';
        break;
      case 'test:start':
        yield `test ${event.data.name} started\n`;
        break;
      case 'test:pass':
        yield `test ${event.data.name} passed\n`;
        break;
      case 'test:fail':
        yield `test ${event.data.name} failed\n`;
        break;
      case 'test:plan':
        yield 'test plan\n';
        break;
      case 'test:diagnostic':
      case 'test:stderr':
      case 'test:stdout':
        yield `${event.data.message}\n`;
        break;
      case 'test:coverage': {
        const { totalLineCount } = event.data.summary.totals;
        yield `total line count: ${totalLineCount}\n`;
        break;
      }
    }
  }
}</pre></details><details><summary>CommonJS</summary><pre data-language="js">module.exports = async function * customReporter(source) {
  for await (const event of source) {
    switch (event.type) {
      case 'test:dequeue':
        yield `test ${event.data.name} dequeued\n`;
        break;
      case 'test:enqueue':
        yield `test ${event.data.name} enqueued\n`;
        break;
      case 'test:watch:drained':
        yield 'test watch queue drained\n';
        break;
      case 'test:watch:restarted':
        yield 'test watch restarted due to file change\n';
        break;
      case 'test:start':
        yield `test ${event.data.name} started\n`;
        break;
      case 'test:pass':
        yield `test ${event.data.name} passed\n`;
        break;
      case 'test:fail':
        yield `test ${event.data.name} failed\n`;
        break;
      case 'test:plan':
        yield 'test plan\n';
        break;
      case 'test:diagnostic':
      case 'test:stderr':
      case 'test:stdout':
        yield `${event.data.message}\n`;
        break;
      case 'test:coverage': {
        const { totalLineCount } = event.data.summary.totals;
        yield `total line count: ${totalLineCount}\n`;
        break;
      }
    }
  }
};</pre></details> <p>The value provided to <code>--test-reporter</code> should be a string like one used in an <code>import()</code> in JavaScript code, or a value provided for <a href="cli#--importmodule"><code>--import</code></a>.</p> </div>
<div> <h4 id="multiple-reporters">Multiple reporters
</h4> <p>The <a href="cli#--test-reporter"><code>--test-reporter</code></a> flag can be specified multiple times to report test results in several formats. In this situation it is required to specify a destination for each reporter using <a href="cli#--test-reporter-destination"><code>--test-reporter-destination</code></a>. Destination can be <code>stdout</code>, <code>stderr</code>, or a file path. Reporters and destinations are paired according to the order they were specified.</p> <p>In the following example, the <code>spec</code> reporter will output to <code>stdout</code>, and the <code>dot</code> reporter will output to <code>file.txt</code>:</p> <pre data-language="js">node --test-reporter=spec --test-reporter=dot --test-reporter-destination=stdout --test-reporter-destination=file.txt copy</pre> <p>When a single reporter is specified, the destination will default to <code>stdout</code>, unless a destination is explicitly provided.</p> </div> </section><section><h3 id="runoptions">
<code>run([options])</code>
</h3> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v24.7.0</td> <td><p>Added a rerunFailuresFilePath option.</p></td>
</tr> <tr>
<td>v23.0.0</td> <td><p>Added the <code>cwd</code> option.</p></td>
</tr> <tr>
<td>v23.0.0, v22.10.0</td> <td><p>Added coverage options.</p></td>
</tr> <tr>
<td>v22.8.0</td> <td><p>Added the <code>isolation</code> option.</p></td>
</tr> <tr>
<td>v22.6.0</td> <td><p>Added the <code>globPatterns</code> option.</p></td>
</tr> <tr>
<td>v22.0.0, v20.14.0</td> <td><p>Added the <code>forceExit</code> option.</p></td>
</tr> <tr>
<td>v20.1.0, v18.17.0</td> <td><p>Add a testNamePatterns option.</p></td>
</tr> <tr>
<td>v18.9.0, v16.19.0</td> <td><p><span>Added in: v18.9.0, v16.19.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <ul> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for running tests. The following properties are supported: <ul> <li>
<code>concurrency</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If a number is provided, then that many test processes would run in parallel, where each process corresponds to one test file. If <code>true</code>, it would run <code>os.availableParallelism() - 1</code> test files in parallel. If <code>false</code>, it would only run one test file at a time. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>cwd</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> Specifies the current working directory to be used by the test runner. Serves as the base path for resolving files as if <a href="#running-tests-from-the-command-line">running tests from the command line</a> from that directory. <strong>Default:</strong> <code>process.cwd()</code>.</li> <li>
<code>files</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array containing the list of files to run. <strong>Default:</strong> Same as <a href="#running-tests-from-the-command-line">running tests from the command line</a>.</li> <li>
<code>forceExit</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> Configures the test runner to exit the process once all known tests have finished executing even if the event loop would otherwise remain active. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>globPatterns</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array containing the list of glob patterns to match test files. This option cannot be used together with <code>files</code>. <strong>Default:</strong> Same as <a href="#running-tests-from-the-command-line">running tests from the command line</a>.</li> <li>
<code>inspectPort</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> Sets inspector port of test child process. This can be a number, or a function that takes no arguments and returns a number. If a nullish value is provided, each process gets its own port, incremented from the primary's <code>process.debugPort</code>. This option is ignored if the <code>isolation</code> option is set to <code>'none'</code> as no child processes are spawned. <strong>Default:</strong> <code>undefined</code>.</li> <li>
<code>isolation</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> Configures the type of test isolation. If set to <code>'process'</code>, each test file is run in a separate child process. If set to <code>'none'</code>, all test files run in the current process. <strong>Default:</strong> <code>'process'</code>.</li> <li>
<code>only</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If truthy, the test context will only run tests that have the <code>only</code> option set</li> <li>
<code>setup</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> A function that accepts the <code>TestsStream</code> instance and can be used to setup listeners before any tests are run. <strong>Default:</strong> <code>undefined</code>.</li> <li>
<code>execArgv</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of CLI flags to pass to the <code>node</code> executable when spawning the subprocesses. This option has no effect when <code>isolation</code> is <code>'none</code>'. <strong>Default:</strong> <code>[]</code>
</li> <li>
<code>argv</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of CLI flags to pass to each test file when spawning the subprocesses. This option has no effect when <code>isolation</code> is <code>'none'</code>. <strong>Default:</strong> <code>[]</code>.</li> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress test execution.</li> <li>
<code>testNamePatterns</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp" class="type">&lt;RegExp&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> A String, RegExp or a RegExp Array, that can be used to only run tests whose name matches the provided pattern. Test name patterns are interpreted as JavaScript regular expressions. For each test that is executed, any corresponding test hooks, such as <code>beforeEach()</code>, are also run. <strong>Default:</strong> <code>undefined</code>.</li> <li>
<code>testSkipPatterns</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp" class="type">&lt;RegExp&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> A String, RegExp or a RegExp Array, that can be used to exclude running tests whose name matches the provided pattern. Test name patterns are interpreted as JavaScript regular expressions. For each test that is executed, any corresponding test hooks, such as <code>beforeEach()</code>, are also run. <strong>Default:</strong> <code>undefined</code>.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the test execution will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> <li>
<code>watch</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> Whether to run in watch mode or not. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>shard</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Running tests in a specific shard. <strong>Default:</strong> <code>undefined</code>. <ul> <li>
<code>index</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> is a positive integer between 1 and <code>&lt;total&gt;</code> that specifies the index of the shard to run. This option is <em>required</em>.</li> <li>
<code>total</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> is a positive integer that specifies the total number of shards to split the test files to. This option is <em>required</em>.</li> </ul> </li> <li>
<code>rerunFailuresFilePath</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> A file path where the test runner will store the state of the tests to allow rerunning only the failed tests on a next run. see [Rerunning failed tests][] for more information. <strong>Default:</strong> <code>undefined</code>.</li> <li>
<code>coverage</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> enable <a href="#collecting-code-coverage">code coverage</a> collection. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>coverageExcludeGlobs</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> Excludes specific files from code coverage using a glob pattern, which can match both absolute and relative file paths. This property is only applicable when <code>coverage</code> was set to <code>true</code>. If both <code>coverageExcludeGlobs</code> and <code>coverageIncludeGlobs</code> are provided, files must meet <strong>both</strong> criteria to be included in the coverage report. <strong>Default:</strong> <code>undefined</code>.</li> <li>
<code>coverageIncludeGlobs</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> Includes specific files in code coverage using a glob pattern, which can match both absolute and relative file paths. This property is only applicable when <code>coverage</code> was set to <code>true</code>. If both <code>coverageExcludeGlobs</code> and <code>coverageIncludeGlobs</code> are provided, files must meet <strong>both</strong> criteria to be included in the coverage report. <strong>Default:</strong> <code>undefined</code>.</li> <li>
<code>lineCoverage</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> Require a minimum percent of covered lines. If code coverage does not reach the threshold specified, the process will exit with code <code>1</code>. <strong>Default:</strong> <code>0</code>.</li> <li>
<code>branchCoverage</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> Require a minimum percent of covered branches. If code coverage does not reach the threshold specified, the process will exit with code <code>1</code>. <strong>Default:</strong> <code>0</code>.</li> <li>
<code>functionCoverage</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> Require a minimum percent of covered functions. If code coverage does not reach the threshold specified, the process will exit with code <code>1</code>. <strong>Default:</strong> <code>0</code>.</li> </ul> </li> <li>Returns: <a href="test#class-testsstream" class="type">&lt;TestsStream&gt;</a>
</li> </ul> <p><strong>Note:</strong> <code>shard</code> is used to horizontally parallelize test running across machines or processes, ideal for large-scale executions across varied environments. It's incompatible with <code>watch</code> mode, tailored for rapid code iteration by automatically rerunning tests on file changes.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import { tap } from 'node:test/reporters';
import { run } from 'node:test';
import process from 'node:process';
import path from 'node:path';

run({ files: [path.resolve('./tests/test.js')] })
 .on('test:fail', () =&gt; {
   process.exitCode = 1;
 })
 .compose(tap)
 .pipe(process.stdout);</pre></details><details><summary>CommonJS</summary><pre data-language="js">const { tap } = require('node:test/reporters');
const { run } = require('node:test');
const path = require('node:path');

run({ files: [path.resolve('./tests/test.js')] })
 .on('test:fail', () =&gt; {
   process.exitCode = 1;
 })
 .compose(tap)
 .pipe(process.stdout);</pre></details> </section><section><h3 id="suitename-options-fn">
<code>suite([name][, options][, fn])</code>
</h3> <div class="api_metadata"> <span>Added in: v22.0.0, v20.13.0</span> </div> <ul> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The name of the suite, which is displayed when reporting test results. <strong>Default:</strong> The <code>name</code> property of <code>fn</code>, or <code>'&lt;anonymous&gt;'</code> if <code>fn</code> does not have a name.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Optional configuration options for the suite. This supports the same options as <code>test([name][, options][, fn])</code>.</li> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The suite function declaring nested tests and suites. The first argument to this function is a <a href="#class-suitecontext"><code>SuiteContext</code></a> object. <strong>Default:</strong> A no-op function.</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" class="type">&lt;Promise&gt;</a> Immediately fulfilled with <code>undefined</code>.</li> </ul> <p>The <code>suite()</code> function is imported from the <code>node:test</code> module.</p> </section><section><h3 id="suiteskipname-options-fn">
<code>suite.skip([name][, options][, fn])</code>
</h3> <div class="api_metadata"> <span>Added in: v22.0.0, v20.13.0</span> </div> <p>Shorthand for skipping a suite. This is the same as <a href="#suitename-options-fn"><code>suite([name], { skip: true }[, fn])</code></a>.</p> </section><section><h3 id="suitetodoname-options-fn">
<code>suite.todo([name][, options][, fn])</code>
</h3> <div class="api_metadata"> <span>Added in: v22.0.0, v20.13.0</span> </div> <p>Shorthand for marking a suite as <code>TODO</code>. This is the same as <a href="#suitename-options-fn"><code>suite([name], { todo: true }[, fn])</code></a>.</p> </section><section><h3 id="suiteonlyname-options-fn">
<code>suite.only([name][, options][, fn])</code>
</h3> <div class="api_metadata"> <span>Added in: v22.0.0, v20.13.0</span> </div> <p>Shorthand for marking a suite as <code>only</code>. This is the same as <a href="#suitename-options-fn"><code>suite([name], { only: true }[, fn])</code></a>.</p> </section><section><h3 id="testname-options-fn">
<code>test([name][, options][, fn])</code>
</h3> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v20.2.0, v18.17.0</td> <td><p>Added the <code>skip</code>, <code>todo</code>, and <code>only</code> shorthands.</p></td>
</tr> <tr>
<td>v18.8.0, v16.18.0</td> <td><p>Add a <code>signal</code> option.</p></td>
</tr> <tr>
<td>v18.7.0, v16.17.0</td> <td><p>Add a <code>timeout</code> option.</p></td>
</tr> <tr>
<td>v18.0.0, v16.17.0</td> <td><p><span>Added in: v18.0.0, v16.17.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <ul> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The name of the test, which is displayed when reporting test results. <strong>Default:</strong> The <code>name</code> property of <code>fn</code>, or <code>'&lt;anonymous&gt;'</code> if <code>fn</code> does not have a name.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the test. The following properties are supported: <ul> <li>
<code>concurrency</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If a number is provided, then that many tests would run in parallel within the application thread. If <code>true</code>, all scheduled asynchronous tests run concurrently within the thread. If <code>false</code>, only one test runs at a time. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>only</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If truthy, and the test context is configured to run <code>only</code> tests, then this test will be run. Otherwise, the test is skipped. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress test.</li> <li>
<code>skip</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> If truthy, the test is skipped. If a string is provided, that string is displayed in the test results as the reason for skipping the test. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>todo</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> If truthy, the test marked as <code>TODO</code>. If a string is provided, that string is displayed in the test results as the reason why the test is <code>TODO</code>. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the test will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> <li>
<code>plan</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of assertions and subtests expected to be run in the test. If the number of assertions run in the test does not match the number specified in the plan, the test will fail. <strong>Default:</strong> <code>undefined</code>.</li> </ul> </li> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The function under test. The first argument to this function is a <a href="#class-testcontext"><code>TestContext</code></a> object. If the test uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" class="type">&lt;Promise&gt;</a> Fulfilled with <code>undefined</code> once the test completes, or immediately if the test runs within a suite.</li> </ul> <p>The <code>test()</code> function is the value imported from the <code>test</code> module. Each invocation of this function results in reporting the test to the <a href="test#class-testsstream" class="type">&lt;TestsStream&gt;</a>.</p> <p>The <code>TestContext</code> object passed to the <code>fn</code> argument can be used to perform actions related to the current test. Examples include skipping the test, adding additional diagnostic information, or creating subtests.</p> <p><code>test()</code> returns a <code>Promise</code> that fulfills once the test completes. if <code>test()</code> is called within a suite, it fulfills immediately. The return value can usually be discarded for top level tests. However, the return value from subtests should be used to prevent the parent test from finishing first and cancelling the subtest as shown in the following example.</p> <pre data-language="js">test('top level test', async (t) =&gt; {
  // The setTimeout() in the following subtest would cause it to outlive its
  // parent test if 'await' is removed on the next line. Once the parent test
  // completes, it will cancel any outstanding subtests.
  await t.test('longer running subtest', async (t) =&gt; {
    return new Promise((resolve, reject) =&gt; {
      setTimeout(resolve, 1000);
    });
  });
}); copy</pre> <p>The <code>timeout</code> option can be used to fail the test if it takes longer than <code>timeout</code> milliseconds to complete. However, it is not a reliable mechanism for canceling tests because a running test might block the application thread and thus prevent the scheduled cancellation.</p> </section><section><h3 id="testskipname-options-fn">
<code>test.skip([name][, options][, fn])</code>
</h3> <p>Shorthand for skipping a test, same as <a href="#testname-options-fn"><code>test([name], { skip: true }[, fn])</code></a>.</p> </section><section><h3 id="testtodoname-options-fn">
<code>test.todo([name][, options][, fn])</code>
</h3> <p>Shorthand for marking a test as <code>TODO</code>, same as <a href="#testname-options-fn"><code>test([name], { todo: true }[, fn])</code></a>.</p> </section><section><h3 id="testonlyname-options-fn">
<code>test.only([name][, options][, fn])</code>
</h3> <p>Shorthand for marking a test as <code>only</code>, same as <a href="#testname-options-fn"><code>test([name], { only: true }[, fn])</code></a>.</p> </section><section><h3 id="describename-options-fn">
<code>describe([name][, options][, fn])</code>
</h3> <p>Alias for <a href="#suitename-options-fn"><code>suite()</code></a>.</p> <p>The <code>describe()</code> function is imported from the <code>node:test</code> module.</p> </section><section><h3 id="describeskipname-options-fn">
<code>describe.skip([name][, options][, fn])</code>
</h3> <p>Shorthand for skipping a suite. This is the same as <a href="#describename-options-fn"><code>describe([name], { skip: true }[, fn])</code></a>.</p> </section><section><h3 id="describetodoname-options-fn">
<code>describe.todo([name][, options][, fn])</code>
</h3> <p>Shorthand for marking a suite as <code>TODO</code>. This is the same as <a href="#describename-options-fn"><code>describe([name], { todo: true }[, fn])</code></a>.</p> </section><section><h3 id="describeonlyname-options-fn">
<code>describe.only([name][, options][, fn])</code>
</h3> <div class="api_metadata"> <span>Added in: v19.8.0, v18.15.0</span> </div> <p>Shorthand for marking a suite as <code>only</code>. This is the same as <a href="#describename-options-fn"><code>describe([name], { only: true }[, fn])</code></a>.</p> </section><section><h3 id="itname-options-fn">
<code>it([name][, options][, fn])</code>
</h3> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v19.8.0, v18.16.0</td> <td><p>Calling <code>it()</code> is now equivalent to calling <code>test()</code>.</p></td>
</tr> <tr>
<td>v18.6.0, v16.17.0</td> <td><p><span>Added in: v18.6.0, v16.17.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <p>Alias for <a href="#testname-options-fn"><code>test()</code></a>.</p> <p>The <code>it()</code> function is imported from the <code>node:test</code> module.</p> </section><section><h3 id="itskipname-options-fn">
<code>it.skip([name][, options][, fn])</code>
</h3> <p>Shorthand for skipping a test, same as <a href="#testname-options-fn"><code>it([name], { skip: true }[, fn])</code></a>.</p> </section><section><h3 id="ittodoname-options-fn">
<code>it.todo([name][, options][, fn])</code>
</h3> <p>Shorthand for marking a test as <code>TODO</code>, same as <a href="#testname-options-fn"><code>it([name], { todo: true }[, fn])</code></a>.</p> </section><section><h3 id="itonlyname-options-fn">
<code>it.only([name][, options][, fn])</code>
</h3> <div class="api_metadata"> <span>Added in: v19.8.0, v18.15.0</span> </div> <p>Shorthand for marking a test as <code>only</code>, same as <a href="#testname-options-fn"><code>it([name], { only: true }[, fn])</code></a>.</p> </section><section><h3 id="beforefn-options">
<code>before([fn][, options])</code>
</h3> <div class="api_metadata"> <span>Added in: v18.8.0, v16.18.0</span> </div> <ul> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The hook function. If the hook uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the hook. The following properties are supported: <ul> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress hook.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the hook will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> </ul> <p>This function creates a hook that runs before executing a suite.</p> <pre data-language="js">describe('tests', async () =&gt; {
  before(() =&gt; console.log('about to run some test'));
  it('is a subtest', () =&gt; {
    assert.ok('some relevant assertion here');
  });
}); copy</pre> </section><section><h3 id="afterfn-options">
<code>after([fn][, options])</code>
</h3> <div class="api_metadata"> <span>Added in: v18.8.0, v16.18.0</span> </div> <ul> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The hook function. If the hook uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the hook. The following properties are supported: <ul> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress hook.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the hook will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> </ul> <p>This function creates a hook that runs after executing a suite.</p> <pre data-language="js">describe('tests', async () =&gt; {
  after(() =&gt; console.log('finished running tests'));
  it('is a subtest', () =&gt; {
    assert.ok('some relevant assertion here');
  });
}); copy</pre> <p><strong>Note:</strong> The <code>after</code> hook is guaranteed to run, even if tests within the suite fail.</p> </section><section><h3 id="beforeeachfn-options">
<code>beforeEach([fn][, options])</code>
</h3> <div class="api_metadata"> <span>Added in: v18.8.0, v16.18.0</span> </div> <ul> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The hook function. If the hook uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the hook. The following properties are supported: <ul> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress hook.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the hook will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> </ul> <p>This function creates a hook that runs before each test in the current suite.</p> <pre data-language="js">describe('tests', async () =&gt; {
  beforeEach(() =&gt; console.log('about to run a test'));
  it('is a subtest', () =&gt; {
    assert.ok('some relevant assertion here');
  });
}); copy</pre> </section><section><h3 id="aftereachfn-options">
<code>afterEach([fn][, options])</code>
</h3> <div class="api_metadata"> <span>Added in: v18.8.0, v16.18.0</span> </div> <ul> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The hook function. If the hook uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the hook. The following properties are supported: <ul> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress hook.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the hook will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> </ul> <p>This function creates a hook that runs after each test in the current suite. The <code>afterEach()</code> hook is run even if the test fails.</p> <pre data-language="js">describe('tests', async () =&gt; {
  afterEach(() =&gt; console.log('finished running a test'));
  it('is a subtest', () =&gt; {
    assert.ok('some relevant assertion here');
  });
}); copy</pre> </section><section><h3 id="assert">
<code>assert</code>
</h3> <div class="api_metadata"> <span>Added in: v23.7.0, v22.14.0</span> </div> <p>An object whose methods are used to configure available assertions on the <code>TestContext</code> objects in the current process. The methods from <code>node:assert</code> and snapshot testing functions are available by default.</p> <p>It is possible to apply the same configuration to all files by placing common configuration code in a module preloaded with <code>--require</code> or <code>--import</code>.</p> <div> <h4 id="assertregistername-fn">
<code>assert.register(name, fn)</code>
</h4> <div class="api_metadata"> <span>Added in: v23.7.0, v22.14.0</span> </div> <p>Defines a new assertion function with the provided name and function. If an assertion already exists with the same name, it is overwritten.</p> </div> </section><section><h3 id="snapshot">
<code>snapshot</code>
</h3> <div class="api_metadata"> <span>Added in: v22.3.0</span> </div> <p>An object whose methods are used to configure default snapshot settings in the current process. It is possible to apply the same configuration to all files by placing common configuration code in a module preloaded with <code>--require</code> or <code>--import</code>.</p> <div> <h4 id="snapshotsetdefaultsnapshotserializersserializers">
<code>snapshot.setDefaultSnapshotSerializers(serializers)</code>
</h4> <div class="api_metadata"> <span>Added in: v22.3.0</span> </div> <ul> <li>
<code>serializers</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of synchronous functions used as the default serializers for snapshot tests.</li> </ul> <p>This function is used to customize the default serialization mechanism used by the test runner. By default, the test runner performs serialization by calling <code>JSON.stringify(value, null, 2)</code> on the provided value. <code>JSON.stringify()</code> does have limitations regarding circular structures and supported data types. If a more robust serialization mechanism is required, this function should be used.</p> </div>
<div> <h4 id="snapshotsetresolvesnapshotpathfn">
<code>snapshot.setResolveSnapshotPath(fn)</code>
</h4> <div class="api_metadata"> <span>Added in: v22.3.0</span> </div> <ul> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> A function used to compute the location of the snapshot file. The function receives the path of the test file as its only argument. If the test is not associated with a file (for example in the REPL), the input is undefined. <code>fn()</code> must return a string specifying the location of the snapshot snapshot file.</li> </ul> <p>This function is used to customize the location of the snapshot file used for snapshot testing. By default, the snapshot filename is the same as the entry point filename with a <code>.snapshot</code> file extension.</p> </div> </section><section><h3 id="class-mockfunctioncontext">Class: <code>MockFunctionContext</code>
</h3> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <p>The <code>MockFunctionContext</code> class is used to inspect or manipulate the behavior of mocks created via the <a href="#class-mocktracker"><code>MockTracker</code></a> APIs.</p> <div> <h4 id="ctxcalls">
<code>ctx.calls</code>
</h4> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <ul> <li>Type: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a>
</li> </ul> <p>A getter that returns a copy of the internal array used to track calls to the mock. Each entry in the array is an object with the following properties.</p> <ul> <li>
<code>arguments</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of the arguments passed to the mock function.</li> <li>
<code>error</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> If the mocked function threw then this property contains the thrown value. <strong>Default:</strong> <code>undefined</code>.</li> <li>
<code>result</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> The value returned by the mocked function.</li> <li>
<code>stack</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a> An <code>Error</code> object whose stack can be used to determine the callsite of the mocked function invocation.</li> <li>
<code>target</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> If the mocked function is a constructor, this field contains the class being constructed. Otherwise this will be <code>undefined</code>.</li> <li>
<code>this</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> The mocked function's <code>this</code> value.</li> </ul> </div>
<div> <h4 id="ctxcallcount">
<code>ctx.callCount()</code>
</h4> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <ul> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;integer&gt;</a> The number of times that this mock has been invoked.</li> </ul> <p>This function returns the number of times that this mock has been invoked. This function is more efficient than checking <code>ctx.calls.length</code> because <code>ctx.calls</code> is a getter that creates a copy of the internal call tracking array.</p> </div>
<div> <h4 id="ctxmockimplementationimplementation">
<code>ctx.mockImplementation(implementation)</code>
</h4> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <ul> <li>
<code>implementation</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The function to be used as the mock's new implementation.</li> </ul> <p>This function is used to change the behavior of an existing mock.</p> <p>The following example creates a mock function using <code>t.mock.fn()</code>, calls the mock function, and then changes the mock implementation to a different function.</p> <pre data-language="js">test('changes a mock behavior', (t) =&gt; {
  let cnt = 0;

  function addOne() {
    cnt++;
    return cnt;
  }

  function addTwo() {
    cnt += 2;
    return cnt;
  }

  const fn = t.mock.fn(addOne);

  assert.strictEqual(fn(), 1);
  fn.mock.mockImplementation(addTwo);
  assert.strictEqual(fn(), 3);
  assert.strictEqual(fn(), 5);
}); copy</pre> </div>
<div> <h4 id="ctxmockimplementationonceimplementation-oncall">
<code>ctx.mockImplementationOnce(implementation[, onCall])</code>
</h4> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <ul> <li>
<code>implementation</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The function to be used as the mock's implementation for the invocation number specified by <code>onCall</code>.</li> <li>
<code>onCall</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;integer&gt;</a> The invocation number that will use <code>implementation</code>. If the specified invocation has already occurred then an exception is thrown. <strong>Default:</strong> The number of the next invocation.</li> </ul> <p>This function is used to change the behavior of an existing mock for a single invocation. Once invocation <code>onCall</code> has occurred, the mock will revert to whatever behavior it would have used had <code>mockImplementationOnce()</code> not been called.</p> <p>The following example creates a mock function using <code>t.mock.fn()</code>, calls the mock function, changes the mock implementation to a different function for the next invocation, and then resumes its previous behavior.</p> <pre data-language="js">test('changes a mock behavior once', (t) =&gt; {
  let cnt = 0;

  function addOne() {
    cnt++;
    return cnt;
  }

  function addTwo() {
    cnt += 2;
    return cnt;
  }

  const fn = t.mock.fn(addOne);

  assert.strictEqual(fn(), 1);
  fn.mock.mockImplementationOnce(addTwo);
  assert.strictEqual(fn(), 3);
  assert.strictEqual(fn(), 4);
}); copy</pre> </div>
<div> <h4 id="ctxresetcalls">
<code>ctx.resetCalls()</code>
</h4> <div class="api_metadata"> <span>Added in: v19.3.0, v18.13.0</span> </div> <p>Resets the call history of the mock function.</p> </div>
<div> <h4 id="ctxrestore">
<code>ctx.restore()</code>
</h4> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <p>Resets the implementation of the mock function to its original behavior. The mock can still be used after calling this function.</p> </div> </section><section><h3 id="class-mockmodulecontext">Class: <code>MockModuleContext</code>
</h3> <div class="api_metadata"> <span>Added in: v22.3.0, v20.18.0</span> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1.0</a> - Early development</div>
 <p>The <code>MockModuleContext</code> class is used to manipulate the behavior of module mocks created via the <a href="#class-mocktracker"><code>MockTracker</code></a> APIs.</p> <div> <h4 id="ctxrestore_1">
<code>ctx.restore()</code>
</h4> <div class="api_metadata"> <span>Added in: v22.3.0, v20.18.0</span> </div> <p>Resets the implementation of the mock module.</p> </div> </section><section><h3 id="class-mockpropertycontext">Class: <code>MockPropertyContext</code>
</h3> <div class="api_metadata"> <span>Added in: v24.3.0, v22.20.0</span> </div> <p>The <code>MockPropertyContext</code> class is used to inspect or manipulate the behavior of property mocks created via the <a href="#class-mocktracker"><code>MockTracker</code></a> APIs.</p> <div> <h4 id="ctxaccesses">
<code>ctx.accesses</code>
</h4> <ul> <li>Type: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a>
</li> </ul> <p>A getter that returns a copy of the internal array used to track accesses (get/set) to the mocked property. Each entry in the array is an object with the following properties:</p> <ul> <li>
<code>type</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> Either <code>'get'</code> or <code>'set'</code>, indicating the type of access.</li> <li>
<code>value</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> The value that was read (for <code>'get'</code>) or written (for <code>'set'</code>).</li> <li>
<code>stack</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a> An <code>Error</code> object whose stack can be used to determine the callsite of the mocked function invocation.</li> </ul> </div>
<div> <h4 id="ctxaccesscount">
<code>ctx.accessCount()</code>
</h4> <ul> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;integer&gt;</a> The number of times that the property was accessed (read or written).</li> </ul> <p>This function returns the number of times that the property was accessed. This function is more efficient than checking <code>ctx.accesses.length</code> because <code>ctx.accesses</code> is a getter that creates a copy of the internal access tracking array.</p> </div>
<div> <h4 id="ctxmockimplementationvalue">
<code>ctx.mockImplementation(value)</code>
</h4> <ul> <li>
<code>value</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> The new value to be set as the mocked property value.</li> </ul> <p>This function is used to change the value returned by the mocked property getter.</p> </div>
<div> <h4 id="ctxmockimplementationoncevalue-onaccess">
<code>ctx.mockImplementationOnce(value[, onAccess])</code>
</h4> <ul> <li>
<code>value</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> The value to be used as the mock's implementation for the invocation number specified by <code>onAccess</code>.</li> <li>
<code>onAccess</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;integer&gt;</a> The invocation number that will use <code>value</code>. If the specified invocation has already occurred then an exception is thrown. <strong>Default:</strong> The number of the next invocation.</li> </ul> <p>This function is used to change the behavior of an existing mock for a single invocation. Once invocation <code>onAccess</code> has occurred, the mock will revert to whatever behavior it would have used had <code>mockImplementationOnce()</code> not been called.</p> <p>The following example creates a mock function using <code>t.mock.property()</code>, calls the mock property, changes the mock implementation to a different value for the next invocation, and then resumes its previous behavior.</p> <pre data-language="js">test('changes a mock behavior once', (t) =&gt; {
  const obj = { foo: 1 };

  const prop = t.mock.property(obj, 'foo', 5);

  assert.strictEqual(obj.foo, 5);
  prop.mock.mockImplementationOnce(25);
  assert.strictEqual(obj.foo, 25);
  assert.strictEqual(obj.foo, 5);
}); copy</pre> <div> <h5 id="caveat">Caveat
</h5> <p>For consistency with the rest of the mocking API, this function treats both property gets and sets as accesses. If a property set occurs at the same access index, the "once" value will be consumed by the set operation, and the mocked property value will be changed to the "once" value. This may lead to unexpected behavior if you intend the "once" value to only be used for a get operation.</p> </div>
</div>
<div> <h4 id="ctxresetaccesses">
<code>ctx.resetAccesses()</code>
</h4> <p>Resets the access history of the mocked property.</p> </div>
<div> <h4 id="ctxrestore_2">
<code>ctx.restore()</code>
</h4> <p>Resets the implementation of the mock property to its original behavior. The mock can still be used after calling this function.</p> </div> </section><section><h3 id="class-mocktracker">Class: <code>MockTracker</code>
</h3> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <p>The <code>MockTracker</code> class is used to manage mocking functionality. The test runner module provides a top level <code>mock</code> export which is a <code>MockTracker</code> instance. Each test also provides its own <code>MockTracker</code> instance via the test context's <code>mock</code> property.</p> <div> <h4 id="mockfnoriginal-implementation-options">
<code>mock.fn([original[, implementation]][, options])</code>
</h4> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <ul> <li>
<code>original</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> An optional function to create a mock on. <strong>Default:</strong> A no-op function.</li> <li>
<code>implementation</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> An optional function used as the mock implementation for <code>original</code>. This is useful for creating mocks that exhibit one behavior for a specified number of calls and then restore the behavior of <code>original</code>. <strong>Default:</strong> The function specified by <code>original</code>.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Optional configuration options for the mock function. The following properties are supported: <ul> <li>
<code>times</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;integer&gt;</a> The number of times that the mock will use the behavior of <code>implementation</code>. Once the mock function has been called <code>times</code> times, it will automatically restore the behavior of <code>original</code>. This value must be an integer greater than zero. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" class="type">&lt;Proxy&gt;</a> The mocked function. The mocked function contains a special <code>mock</code> property, which is an instance of <a href="#class-mockfunctioncontext"><code>MockFunctionContext</code></a>, and can be used for inspecting and changing the behavior of the mocked function.</li> </ul> <p>This function is used to create a mock function.</p> <p>The following example creates a mock function that increments a counter by one on each invocation. The <code>times</code> option is used to modify the mock behavior such that the first two invocations add two to the counter instead of one.</p> <pre data-language="js">test('mocks a counting function', (t) =&gt; {
  let cnt = 0;

  function addOne() {
    cnt++;
    return cnt;
  }

  function addTwo() {
    cnt += 2;
    return cnt;
  }

  const fn = t.mock.fn(addOne, addTwo, { times: 2 });

  assert.strictEqual(fn(), 2);
  assert.strictEqual(fn(), 4);
  assert.strictEqual(fn(), 5);
  assert.strictEqual(fn(), 6);
}); copy</pre> </div>
<div> <h4 id="mockgetterobject-methodname-implementation-options">
<code>mock.getter(object, methodName[, implementation][, options])</code>
</h4> <div class="api_metadata"> <span>Added in: v19.3.0, v18.13.0</span> </div> <p>This function is syntax sugar for <a href="#mockmethodobject-methodname-implementation-options"><code>MockTracker.method</code></a> with <code>options.getter</code> set to <code>true</code>.</p> </div>
<div> <h4 id="mockmethodobject-methodname-implementation-options">
<code>mock.method(object, methodName[, implementation][, options])</code>
</h4> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <ul> <li>
<code>object</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> The object whose method is being mocked.</li> <li>
<code>methodName</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Symbol_type" class="type">&lt;symbol&gt;</a> The identifier of the method on <code>object</code> to mock. If <code>object[methodName]</code> is not a function, an error is thrown.</li> <li>
<code>implementation</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> An optional function used as the mock implementation for <code>object[methodName]</code>. <strong>Default:</strong> The original method specified by <code>object[methodName]</code>.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Optional configuration options for the mock method. The following properties are supported: <ul> <li>
<code>getter</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If <code>true</code>, <code>object[methodName]</code> is treated as a getter. This option cannot be used with the <code>setter</code> option. <strong>Default:</strong> false.</li> <li>
<code>setter</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If <code>true</code>, <code>object[methodName]</code> is treated as a setter. This option cannot be used with the <code>getter</code> option. <strong>Default:</strong> false.</li> <li>
<code>times</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;integer&gt;</a> The number of times that the mock will use the behavior of <code>implementation</code>. Once the mocked method has been called <code>times</code> times, it will automatically restore the original behavior. This value must be an integer greater than zero. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" class="type">&lt;Proxy&gt;</a> The mocked method. The mocked method contains a special <code>mock</code> property, which is an instance of <a href="#class-mockfunctioncontext"><code>MockFunctionContext</code></a>, and can be used for inspecting and changing the behavior of the mocked method.</li> </ul> <p>This function is used to create a mock on an existing object method. The following example demonstrates how a mock is created on an existing object method.</p> <pre data-language="js">test('spies on an object method', (t) =&gt; {
  const number = {
    value: 5,
    subtract(a) {
      return this.value - a;
    },
  };

  t.mock.method(number, 'subtract');
  assert.strictEqual(number.subtract.mock.callCount(), 0);
  assert.strictEqual(number.subtract(3), 2);
  assert.strictEqual(number.subtract.mock.callCount(), 1);

  const call = number.subtract.mock.calls[0];

  assert.deepStrictEqual(call.arguments, [3]);
  assert.strictEqual(call.result, 2);
  assert.strictEqual(call.error, undefined);
  assert.strictEqual(call.target, undefined);
  assert.strictEqual(call.this, number);
}); copy</pre> </div>
<div> <h4 id="mockmodulespecifier-options">
<code>mock.module(specifier[, options])</code>
</h4> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v24.0.0, v22.17.0</td> <td><p>Support JSON modules.</p></td>
</tr> <tr>
<td>v22.3.0, v20.18.0</td> <td><p><span>Added in: v22.3.0, v20.18.0</span></p></td>
</tr> </tbody>
</table> </details> </div> 
<div class="api_stability api_stability_1">
<a href="https://nodejs.org/api/documentation.html#stability-index">Stability: 1.0</a> - Early development</div>
 <ul> <li>
<code>specifier</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="url#the-whatwg-url-api" class="type">&lt;URL&gt;</a> A string identifying the module to mock.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Optional configuration options for the mock module. The following properties are supported: <ul> <li>
<code>cache</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If <code>false</code>, each call to <code>require()</code> or <code>import()</code> generates a new mock module. If <code>true</code>, subsequent calls will return the same module mock, and the mock module is inserted into the CommonJS cache. <strong>Default:</strong> false.</li> <li>
<code>defaultExport</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> An optional value used as the mocked module's default export. If this value is not provided, ESM mocks do not include a default export. If the mock is a CommonJS or builtin module, this setting is used as the value of <code>module.exports</code>. If this value is not provided, CJS and builtin mocks use an empty object as the value of <code>module.exports</code>.</li> <li>
<code>namedExports</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> An optional object whose keys and values are used to create the named exports of the mock module. If the mock is a CommonJS or builtin module, these values are copied onto <code>module.exports</code>. Therefore, if a mock is created with both named exports and a non-object default export, the mock will throw an exception when used as a CJS or builtin module.</li> </ul> </li> <li>Returns: <a href="test#class-mockmodulecontext" class="type">&lt;MockModuleContext&gt;</a> An object that can be used to manipulate the mock.</li> </ul> <p>This function is used to mock the exports of ECMAScript modules, CommonJS modules, JSON modules, and Node.js builtin modules. Any references to the original module prior to mocking are not impacted. In order to enable module mocking, Node.js must be started with the <a href="cli#--experimental-test-module-mocks"><code>--experimental-test-module-mocks</code></a> command-line flag.</p> <p>The following example demonstrates how a mock is created for a module.</p> <pre data-language="js">test('mocks a builtin module in both module systems', async (t) =&gt; {
  // Create a mock of 'node:readline' with a named export named 'fn', which
  // does not exist in the original 'node:readline' module.
  const mock = t.mock.module('node:readline', {
    namedExports: { fn() { return 42; } },
  });

  let esmImpl = await import('node:readline');
  let cjsImpl = require('node:readline');

  // cursorTo() is an export of the original 'node:readline' module.
  assert.strictEqual(esmImpl.cursorTo, undefined);
  assert.strictEqual(cjsImpl.cursorTo, undefined);
  assert.strictEqual(esmImpl.fn(), 42);
  assert.strictEqual(cjsImpl.fn(), 42);

  mock.restore();

  // The mock is restored, so the original builtin module is returned.
  esmImpl = await import('node:readline');
  cjsImpl = require('node:readline');

  assert.strictEqual(typeof esmImpl.cursorTo, 'function');
  assert.strictEqual(typeof cjsImpl.cursorTo, 'function');
  assert.strictEqual(esmImpl.fn, undefined);
  assert.strictEqual(cjsImpl.fn, undefined);
}); copy</pre> </div>
<div> <h4 id="mockpropertyobject-propertyname-value">
<code>mock.property(object, propertyName[, value])</code>
</h4> <div class="api_metadata"> <span>Added in: v24.3.0, v22.20.0</span> </div> <ul> <li>
<code>object</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> The object whose value is being mocked.</li> <li>
<code>propertyName</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Symbol_type" class="type">&lt;symbol&gt;</a> The identifier of the property on <code>object</code> to mock.</li> <li>
<code>value</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> An optional value used as the mock value for <code>object[propertyName]</code>. <strong>Default:</strong> The original property value.</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy" class="type">&lt;Proxy&gt;</a> A proxy to the mocked object. The mocked object contains a special <code>mock</code> property, which is an instance of <a href="#class-mockpropertycontext"><code>MockPropertyContext</code></a>, and can be used for inspecting and changing the behavior of the mocked property.</li> </ul> <p>Creates a mock for a property value on an object. This allows you to track and control access to a specific property, including how many times it is read (getter) or written (setter), and to restore the original value after mocking.</p> <pre data-language="js">test('mocks a property value', (t) =&gt; {
  const obj = { foo: 42 };
  const prop = t.mock.property(obj, 'foo', 100);

  assert.strictEqual(obj.foo, 100);
  assert.strictEqual(prop.mock.accessCount(), 1);
  assert.strictEqual(prop.mock.accesses[0].type, 'get');
  assert.strictEqual(prop.mock.accesses[0].value, 100);

  obj.foo = 200;
  assert.strictEqual(prop.mock.accessCount(), 2);
  assert.strictEqual(prop.mock.accesses[1].type, 'set');
  assert.strictEqual(prop.mock.accesses[1].value, 200);

  prop.mock.restore();
  assert.strictEqual(obj.foo, 42);
}); copy</pre> </div>
<div> <h4 id="mockreset">
<code>mock.reset()</code>
</h4> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <p>This function restores the default behavior of all mocks that were previously created by this <code>MockTracker</code> and disassociates the mocks from the <code>MockTracker</code> instance. Once disassociated, the mocks can still be used, but the <code>MockTracker</code> instance can no longer be used to reset their behavior or otherwise interact with them.</p> <p>After each test completes, this function is called on the test context's <code>MockTracker</code>. If the global <code>MockTracker</code> is used extensively, calling this function manually is recommended.</p> </div>
<div> <h4 id="mockrestoreall">
<code>mock.restoreAll()</code>
</h4> <div class="api_metadata"> <span>Added in: v19.1.0, v18.13.0</span> </div> <p>This function restores the default behavior of all mocks that were previously created by this <code>MockTracker</code>. Unlike <code>mock.reset()</code>, <code>mock.restoreAll()</code> does not disassociate the mocks from the <code>MockTracker</code> instance.</p> </div>
<div> <h4 id="mocksetterobject-methodname-implementation-options">
<code>mock.setter(object, methodName[, implementation][, options])</code>
</h4> <div class="api_metadata"> <span>Added in: v19.3.0, v18.13.0</span> </div> <p>This function is syntax sugar for <a href="#mockmethodobject-methodname-implementation-options"><code>MockTracker.method</code></a> with <code>options.setter</code> set to <code>true</code>.</p> </div> </section><section><h3 id="class-mocktimers">Class: <code>MockTimers</code>
</h3> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v23.1.0</td> <td><p>The Mock Timers is now stable.</p></td>
</tr> <tr>
<td>v20.4.0, v18.19.0</td> <td><p><span>Added in: v20.4.0, v18.19.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <p>Mocking timers is a technique commonly used in software testing to simulate and control the behavior of timers, such as <code>setInterval</code> and <code>setTimeout</code>, without actually waiting for the specified time intervals.</p> <p>MockTimers is also able to mock the <code>Date</code> object.</p> <p>The <a href="#class-mocktracker"><code>MockTracker</code></a> provides a top-level <code>timers</code> export which is a <code>MockTimers</code> instance.</p> <div> <h4 id="timersenableenableoptions">
<code>timers.enable([enableOptions])</code>
</h4> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v21.2.0, v20.11.0</td> <td><p>Updated parameters to be an option object with available APIs and the default initial epoch.</p></td>
</tr> <tr>
<td>v20.4.0, v18.19.0</td> <td><p><span>Added in: v20.4.0, v18.19.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <p>Enables timer mocking for the specified timers.</p> <ul> <li>
<code>enableOptions</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Optional configuration options for enabling timer mocking. The following properties are supported: <ul> <li>
<code>apis</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An optional array containing the timers to mock. The currently supported timer values are <code>'setInterval'</code>, <code>'setTimeout'</code>, <code>'setImmediate'</code>, and <code>'Date'</code>. <strong>Default:</strong> <code>['setInterval', 'setTimeout', 'setImmediate', 'Date']</code>. If no array is provided, all time related APIs (<code>'setInterval'</code>, <code>'clearInterval'</code>, <code>'setTimeout'</code>, <code>'clearTimeout'</code>, <code>'setImmediate'</code>, <code>'clearImmediate'</code>, and <code>'Date'</code>) will be mocked by default.</li> <li>
<code>now</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" class="type">&lt;Date&gt;</a> An optional number or Date object representing the initial time (in milliseconds) to use as the value for <code>Date.now()</code>. <strong>Default:</strong> <code>0</code>.</li> </ul> </li> </ul> <p><strong>Note:</strong> When you enable mocking for a specific timer, its associated clear function will also be implicitly mocked.</p> <p><strong>Note:</strong> Mocking <code>Date</code> will affect the behavior of the mocked timers as they use the same internal clock.</p> <p>Example usage without setting initial time:</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import { mock } from 'node:test';
mock.timers.enable({ apis: ['setInterval'] });</pre></details><details><summary>CommonJS</summary><pre data-language="js">const { mock } = require('node:test');
mock.timers.enable({ apis: ['setInterval'] });</pre></details> <p>The above example enables mocking for the <code>setInterval</code> timer and implicitly mocks the <code>clearInterval</code> function. Only the <code>setInterval</code> and <code>clearInterval</code> functions from <a href="timers">node:timers</a>, <a href="timers#timers-promises-api">node:timers/promises</a>, and <code>globalThis</code> will be mocked.</p> <p>Example usage with initial time set</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import { mock } from 'node:test';
mock.timers.enable({ apis: ['Date'], now: 1000 });</pre></details><details><summary>CommonJS</summary><pre data-language="js">const { mock } = require('node:test');
mock.timers.enable({ apis: ['Date'], now: 1000 });</pre></details> <p>Example usage with initial Date object as time set</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import { mock } from 'node:test';
mock.timers.enable({ apis: ['Date'], now: new Date() });</pre></details><details><summary>CommonJS</summary><pre data-language="js">const { mock } = require('node:test');
mock.timers.enable({ apis: ['Date'], now: new Date() });</pre></details> <p>Alternatively, if you call <code>mock.timers.enable()</code> without any parameters:</p> <p>All timers (<code>'setInterval'</code>, <code>'clearInterval'</code>, <code>'setTimeout'</code>, <code>'clearTimeout'</code>, <code>'setImmediate'</code>, and <code>'clearImmediate'</code>) will be mocked. The <code>setInterval</code>, <code>clearInterval</code>, <code>setTimeout</code>, <code>clearTimeout</code>, <code>setImmediate</code>, and <code>clearImmediate</code> functions from <code>node:timers</code>, <code>node:timers/promises</code>, and <code>globalThis</code> will be mocked. As well as the global <code>Date</code> object.</p> </div>
<div> <h4 id="timersreset">
<code>timers.reset()</code>
</h4> <div class="api_metadata"> <span>Added in: v20.4.0, v18.19.0</span> </div> <p>This function restores the default behavior of all mocks that were previously created by this <code>MockTimers</code> instance and disassociates the mocks from the <code>MockTracker</code> instance.</p> <p><strong>Note:</strong> After each test completes, this function is called on the test context's <code>MockTracker</code>.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import { mock } from 'node:test';
mock.timers.reset();</pre></details><details><summary>CommonJS</summary><pre data-language="js">const { mock } = require('node:test');
mock.timers.reset();</pre></details> </div>
<div> <h4 id="timerssymboldispose">
<code>timers[Symbol.dispose]()</code>
</h4> <p>Calls <code>timers.reset()</code>.</p> </div>
<div> <h4 id="timerstickmilliseconds">
<code>timers.tick([milliseconds])</code>
</h4> <div class="api_metadata"> <span>Added in: v20.4.0, v18.19.0</span> </div> <p>Advances time for all mocked timers.</p> <ul> <li>
<code>milliseconds</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The amount of time, in milliseconds, to advance the timers. <strong>Default:</strong> <code>1</code>.</li> </ul> <p><strong>Note:</strong> This diverges from how <code>setTimeout</code> in Node.js behaves and accepts only positive numbers. In Node.js, <code>setTimeout</code> with negative numbers is only supported for web compatibility reasons.</p> <p>The following example mocks a <code>setTimeout</code> function and by using <code>.tick</code> advances in time triggering all pending timers.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();

  context.mock.timers.enable({ apis: ['setTimeout'] });

  setTimeout(fn, 9999);

  assert.strictEqual(fn.mock.callCount(), 0);

  // Advance in time
  context.mock.timers.tick(9999);

  assert.strictEqual(fn.mock.callCount(), 1);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();
  context.mock.timers.enable({ apis: ['setTimeout'] });

  setTimeout(fn, 9999);
  assert.strictEqual(fn.mock.callCount(), 0);

  // Advance in time
  context.mock.timers.tick(9999);

  assert.strictEqual(fn.mock.callCount(), 1);
});</pre></details> <p>Alternatively, the <code>.tick</code> function can be called many times</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();
  context.mock.timers.enable({ apis: ['setTimeout'] });
  const nineSecs = 9000;
  setTimeout(fn, nineSecs);

  const threeSeconds = 3000;
  context.mock.timers.tick(threeSeconds);
  context.mock.timers.tick(threeSeconds);
  context.mock.timers.tick(threeSeconds);

  assert.strictEqual(fn.mock.callCount(), 1);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();
  context.mock.timers.enable({ apis: ['setTimeout'] });
  const nineSecs = 9000;
  setTimeout(fn, nineSecs);

  const threeSeconds = 3000;
  context.mock.timers.tick(threeSeconds);
  context.mock.timers.tick(threeSeconds);
  context.mock.timers.tick(threeSeconds);

  assert.strictEqual(fn.mock.callCount(), 1);
});</pre></details> <p>Advancing time using <code>.tick</code> will also advance the time for any <code>Date</code> object created after the mock was enabled (if <code>Date</code> was also set to be mocked).</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();

  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
  setTimeout(fn, 9999);

  assert.strictEqual(fn.mock.callCount(), 0);
  assert.strictEqual(Date.now(), 0);

  // Advance in time
  context.mock.timers.tick(9999);
  assert.strictEqual(fn.mock.callCount(), 1);
  assert.strictEqual(Date.now(), 9999);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();
  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });

  setTimeout(fn, 9999);
  assert.strictEqual(fn.mock.callCount(), 0);
  assert.strictEqual(Date.now(), 0);

  // Advance in time
  context.mock.timers.tick(9999);
  assert.strictEqual(fn.mock.callCount(), 1);
  assert.strictEqual(Date.now(), 9999);
});</pre></details> <div> <h5 id="using-clear-functions">Using clear functions
</h5> <p>As mentioned, all clear functions from timers (<code>clearTimeout</code>, <code>clearInterval</code>,and <code>clearImmediate</code>) are implicitly mocked. Take a look at this example using <code>setTimeout</code>:</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();

  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout'] });
  const id = setTimeout(fn, 9999);

  // Implicitly mocked as well
  clearTimeout(id);
  context.mock.timers.tick(9999);

  // As that setTimeout was cleared the mock function will never be called
  assert.strictEqual(fn.mock.callCount(), 0);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('mocks setTimeout to be executed synchronously without having to actually wait for it', (context) =&gt; {
  const fn = context.mock.fn();

  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout'] });
  const id = setTimeout(fn, 9999);

  // Implicitly mocked as well
  clearTimeout(id);
  context.mock.timers.tick(9999);

  // As that setTimeout was cleared the mock function will never be called
  assert.strictEqual(fn.mock.callCount(), 0);
});</pre></details> </div>
<div> <h5 id="working-with-nodejs-timers-modules">Working with Node.js timers modules
</h5> <p>Once you enable mocking timers, <a href="timers">node:timers</a>, <a href="timers#timers-promises-api">node:timers/promises</a> modules, and timers from the Node.js global context are enabled:</p> <p><strong>Note:</strong> Destructuring functions such as <code>import { setTimeout } from 'node:timers'</code> is currently not supported by this API.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';
import nodeTimers from 'node:timers';
import nodeTimersPromises from 'node:timers/promises';

test('mocks setTimeout to be executed synchronously without having to actually wait for it', async (context) =&gt; {
  const globalTimeoutObjectSpy = context.mock.fn();
  const nodeTimerSpy = context.mock.fn();
  const nodeTimerPromiseSpy = context.mock.fn();

  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout'] });
  setTimeout(globalTimeoutObjectSpy, 9999);
  nodeTimers.setTimeout(nodeTimerSpy, 9999);

  const promise = nodeTimersPromises.setTimeout(9999).then(nodeTimerPromiseSpy);

  // Advance in time
  context.mock.timers.tick(9999);
  assert.strictEqual(globalTimeoutObjectSpy.mock.callCount(), 1);
  assert.strictEqual(nodeTimerSpy.mock.callCount(), 1);
  await promise;
  assert.strictEqual(nodeTimerPromiseSpy.mock.callCount(), 1);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');
const nodeTimers = require('node:timers');
const nodeTimersPromises = require('node:timers/promises');

test('mocks setTimeout to be executed synchronously without having to actually wait for it', async (context) =&gt; {
  const globalTimeoutObjectSpy = context.mock.fn();
  const nodeTimerSpy = context.mock.fn();
  const nodeTimerPromiseSpy = context.mock.fn();

  // Optionally choose what to mock
  context.mock.timers.enable({ apis: ['setTimeout'] });
  setTimeout(globalTimeoutObjectSpy, 9999);
  nodeTimers.setTimeout(nodeTimerSpy, 9999);

  const promise = nodeTimersPromises.setTimeout(9999).then(nodeTimerPromiseSpy);

  // Advance in time
  context.mock.timers.tick(9999);
  assert.strictEqual(globalTimeoutObjectSpy.mock.callCount(), 1);
  assert.strictEqual(nodeTimerSpy.mock.callCount(), 1);
  await promise;
  assert.strictEqual(nodeTimerPromiseSpy.mock.callCount(), 1);
});</pre></details> <p>In Node.js, <code>setInterval</code> from <a href="timers#timers-promises-api">node:timers/promises</a> is an <code>AsyncGenerator</code> and is also supported by this API:</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';
import nodeTimersPromises from 'node:timers/promises';
test('should tick five times testing a real use case', async (context) =&gt; {
  context.mock.timers.enable({ apis: ['setInterval'] });

  const expectedIterations = 3;
  const interval = 1000;
  const startedAt = Date.now();
  async function run() {
    const times = [];
    for await (const time of nodeTimersPromises.setInterval(interval, startedAt)) {
      times.push(time);
      if (times.length === expectedIterations) break;
    }
    return times;
  }

  const r = run();
  context.mock.timers.tick(interval);
  context.mock.timers.tick(interval);
  context.mock.timers.tick(interval);

  const timeResults = await r;
  assert.strictEqual(timeResults.length, expectedIterations);
  for (let it = 1; it &lt; expectedIterations; it++) {
    assert.strictEqual(timeResults[it - 1], startedAt + (interval * it));
  }
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');
const nodeTimersPromises = require('node:timers/promises');
test('should tick five times testing a real use case', async (context) =&gt; {
  context.mock.timers.enable({ apis: ['setInterval'] });

  const expectedIterations = 3;
  const interval = 1000;
  const startedAt = Date.now();
  async function run() {
    const times = [];
    for await (const time of nodeTimersPromises.setInterval(interval, startedAt)) {
      times.push(time);
      if (times.length === expectedIterations) break;
    }
    return times;
  }

  const r = run();
  context.mock.timers.tick(interval);
  context.mock.timers.tick(interval);
  context.mock.timers.tick(interval);

  const timeResults = await r;
  assert.strictEqual(timeResults.length, expectedIterations);
  for (let it = 1; it &lt; expectedIterations; it++) {
    assert.strictEqual(timeResults[it - 1], startedAt + (interval * it));
  }
});</pre></details> </div>
</div>
<div> <h4 id="timersrunall">
<code>timers.runAll()</code>
</h4> <div class="api_metadata"> <span>Added in: v20.4.0, v18.19.0</span> </div> <p>Triggers all pending mocked timers immediately. If the <code>Date</code> object is also mocked, it will also advance the <code>Date</code> object to the furthest timer's time.</p> <p>The example below triggers all pending timers immediately, causing them to execute without any delay.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('runAll functions following the given order', (context) =&gt; {
  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
  const results = [];
  setTimeout(() =&gt; results.push(1), 9999);

  // Notice that if both timers have the same timeout,
  // the order of execution is guaranteed
  setTimeout(() =&gt; results.push(3), 8888);
  setTimeout(() =&gt; results.push(2), 8888);

  assert.deepStrictEqual(results, []);

  context.mock.timers.runAll();
  assert.deepStrictEqual(results, [3, 2, 1]);
  // The Date object is also advanced to the furthest timer's time
  assert.strictEqual(Date.now(), 9999);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('runAll functions following the given order', (context) =&gt; {
  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
  const results = [];
  setTimeout(() =&gt; results.push(1), 9999);

  // Notice that if both timers have the same timeout,
  // the order of execution is guaranteed
  setTimeout(() =&gt; results.push(3), 8888);
  setTimeout(() =&gt; results.push(2), 8888);

  assert.deepStrictEqual(results, []);

  context.mock.timers.runAll();
  assert.deepStrictEqual(results, [3, 2, 1]);
  // The Date object is also advanced to the furthest timer's time
  assert.strictEqual(Date.now(), 9999);
});</pre></details> <p><strong>Note:</strong> The <code>runAll()</code> function is specifically designed for triggering timers in the context of timer mocking. It does not have any effect on real-time system clocks or actual timers outside of the mocking environment.</p> </div>
<div> <h4 id="timerssettimemilliseconds">
<code>timers.setTime(milliseconds)</code>
</h4> <div class="api_metadata"> <span>Added in: v21.2.0, v20.11.0</span> </div> <p>Sets the current Unix timestamp that will be used as reference for any mocked <code>Date</code> objects.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('runAll functions following the given order', (context) =&gt; {
  const now = Date.now();
  const setTime = 1000;
  // Date.now is not mocked
  assert.deepStrictEqual(Date.now(), now);

  context.mock.timers.enable({ apis: ['Date'] });
  context.mock.timers.setTime(setTime);
  // Date.now is now 1000
  assert.strictEqual(Date.now(), setTime);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('setTime replaces current time', (context) =&gt; {
  const now = Date.now();
  const setTime = 1000;
  // Date.now is not mocked
  assert.deepStrictEqual(Date.now(), now);

  context.mock.timers.enable({ apis: ['Date'] });
  context.mock.timers.setTime(setTime);
  // Date.now is now 1000
  assert.strictEqual(Date.now(), setTime);
});</pre></details> <div> <h5 id="dates-and-timers-working-together">Dates and Timers working together
</h5> <p>Dates and timer objects are dependent on each other. If you use <code>setTime()</code> to pass the current time to the mocked <code>Date</code> object, the set timers with <code>setTimeout</code> and <code>setInterval</code> will <strong>not</strong> be affected.</p> <p>However, the <code>tick</code> method <strong>will</strong> advanced the mocked <code>Date</code> object.</p> <details open><summary>JavaScript modules</summary><pre data-language="js">import assert from 'node:assert';
import { test } from 'node:test';

test('runAll functions following the given order', (context) =&gt; {
  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
  const results = [];
  setTimeout(() =&gt; results.push(1), 9999);

  assert.deepStrictEqual(results, []);
  context.mock.timers.setTime(12000);
  assert.deepStrictEqual(results, []);
  // The date is advanced but the timers don't tick
  assert.strictEqual(Date.now(), 12000);
});</pre></details><details><summary>CommonJS</summary><pre data-language="js">const assert = require('node:assert');
const { test } = require('node:test');

test('runAll functions following the given order', (context) =&gt; {
  context.mock.timers.enable({ apis: ['setTimeout', 'Date'] });
  const results = [];
  setTimeout(() =&gt; results.push(1), 9999);

  assert.deepStrictEqual(results, []);
  context.mock.timers.setTime(12000);
  assert.deepStrictEqual(results, []);
  // The date is advanced but the timers don't tick
  assert.strictEqual(Date.now(), 12000);
});</pre></details> </div>
</div> </section><section><h3 id="class-testsstream">Class: <code>TestsStream</code>
</h3> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v20.0.0, v19.9.0, v18.17.0</td> <td><p>added type to test:pass and test:fail events for when the test is a suite.</p></td>
</tr> <tr>
<td>v18.9.0, v16.19.0</td> <td><p><span>Added in: v18.9.0, v16.19.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <ul> <li>Extends <a href="stream#class-streamreadable" class="type">&lt;Readable&gt;</a>
</li> </ul> <p>A successful call to <a href="#runoptions"><code>run()</code></a> method will return a new <a href="test#class-testsstream" class="type">&lt;TestsStream&gt;</a> object, streaming a series of events representing the execution of the tests. <code>TestsStream</code> will emit events, in the order of the tests definition</p> <p>Some of the events are guaranteed to be emitted in the same order as the tests are defined, while others are emitted in the order that the tests execute.</p> <div> <h4 id="event-testcoverage">Event: <code>'test:coverage'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>summary</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> An object containing the coverage report. <ul> <li>
<code>files</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of coverage reports for individual files. Each report is an object with the following schema: <ul> <li>
<code>path</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The absolute path of the file.</li> <li>
<code>totalLineCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of lines.</li> <li>
<code>totalBranchCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of branches.</li> <li>
<code>totalFunctionCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of functions.</li> <li>
<code>coveredLineCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of covered lines.</li> <li>
<code>coveredBranchCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of covered branches.</li> <li>
<code>coveredFunctionCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of covered functions.</li> <li>
<code>coveredLinePercent</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The percentage of lines covered.</li> <li>
<code>coveredBranchPercent</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The percentage of branches covered.</li> <li>
<code>coveredFunctionPercent</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The percentage of functions covered.</li> <li>
<code>functions</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of functions representing function coverage. <ul> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The name of the function.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The line number where the function is defined.</li> <li>
<code>count</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of times the function was called.</li> </ul> </li> <li>
<code>branches</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of branches representing branch coverage. <ul> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The line number where the branch is defined.</li> <li>
<code>count</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of times the branch was taken.</li> </ul> </li> <li>
<code>lines</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of lines representing line numbers and the number of times they were covered. <ul> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The line number.</li> <li>
<code>count</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of times the line was covered.</li> </ul> </li> </ul> </li> <li>
<code>thresholds</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> An object containing whether or not the coverage for each coverage type. <ul> <li>
<code>function</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The function coverage threshold.</li> <li>
<code>branch</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The branch coverage threshold.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The line coverage threshold.</li> </ul> </li> <li>
<code>totals</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> An object containing a summary of coverage for all files. <ul> <li>
<code>totalLineCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of lines.</li> <li>
<code>totalBranchCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of branches.</li> <li>
<code>totalFunctionCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of functions.</li> <li>
<code>coveredLineCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of covered lines.</li> <li>
<code>coveredBranchCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of covered branches.</li> <li>
<code>coveredFunctionCount</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of covered functions.</li> <li>
<code>coveredLinePercent</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The percentage of lines covered.</li> <li>
<code>coveredBranchPercent</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The percentage of branches covered.</li> <li>
<code>coveredFunctionPercent</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The percentage of functions covered.</li> </ul> </li> <li>
<code>workingDirectory</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The working directory when code coverage began. This is useful for displaying relative path names in case the tests changed the working directory of the Node.js process.</li> </ul> </li> <li>
<code>nesting</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The nesting level of the test.</li> </ul> </li> </ul> <p>Emitted when code coverage is enabled and all tests have completed.</p> </div>
<div> <h4 id="event-testcomplete">Event: <code>'test:complete'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>column</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The column number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>details</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Additional execution metadata. <ul> <li>
<code>passed</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> Whether the test passed or not.</li> <li>
<code>duration_ms</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The duration of the test in milliseconds.</li> <li>
<code>error</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> An error wrapping the error thrown by the test if it did not pass. <ul> <li>
<code>cause</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a> The actual error thrown by the test.</li> </ul> </li> <li>
<code>type</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The type of the test, used to denote whether this is a suite.</li> </ul> </li> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The path of the test file, <code>undefined</code> if test was run through the REPL.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The line number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The test name.</li> <li>
<code>nesting</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The nesting level of the test.</li> <li>
<code>testNumber</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The ordinal number of the test.</li> <li>
<code>todo</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> Present if <a href="#contexttodomessage"><code>context.todo</code></a> is called</li> <li>
<code>skip</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> Present if <a href="#contextskipmessage"><code>context.skip</code></a> is called</li> </ul> </li> </ul> <p>Emitted when a test completes its execution. This event is not emitted in the same order as the tests are defined. The corresponding declaration ordered events are <code>'test:pass'</code> and <code>'test:fail'</code>.</p> </div>
<div> <h4 id="event-testdequeue">Event: <code>'test:dequeue'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>column</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The column number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The path of the test file, <code>undefined</code> if test was run through the REPL.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The line number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The test name.</li> <li>
<code>nesting</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The nesting level of the test.</li> <li>
<code>type</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The test type. Either <code>'suite'</code> or <code>'test'</code>.</li> </ul> </li> </ul> <p>Emitted when a test is dequeued, right before it is executed. This event is not guaranteed to be emitted in the same order as the tests are defined. The corresponding declaration ordered event is <code>'test:start'</code>.</p> </div>
<div> <h4 id="event-testdiagnostic">Event: <code>'test:diagnostic'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>column</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The column number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The path of the test file, <code>undefined</code> if test was run through the REPL.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The line number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>message</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The diagnostic message.</li> <li>
<code>nesting</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The nesting level of the test.</li> <li>
<code>level</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The severity level of the diagnostic message. Possible values are: <ul> <li>
<code>'info'</code>: Informational messages.</li> <li>
<code>'warn'</code>: Warnings.</li> <li>
<code>'error'</code>: Errors.</li> </ul> </li> </ul> </li> </ul> <p>Emitted when <a href="#contextdiagnosticmessage"><code>context.diagnostic</code></a> is called. This event is guaranteed to be emitted in the same order as the tests are defined.</p> </div>
<div> <h4 id="event-testenqueue">Event: <code>'test:enqueue'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>column</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The column number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The path of the test file, <code>undefined</code> if test was run through the REPL.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The line number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The test name.</li> <li>
<code>nesting</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The nesting level of the test.</li> <li>
<code>type</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The test type. Either <code>'suite'</code> or <code>'test'</code>.</li> </ul> </li> </ul> <p>Emitted when a test is enqueued for execution.</p> </div>
<div> <h4 id="event-testfail">Event: <code>'test:fail'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>column</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The column number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>details</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Additional execution metadata. <ul> <li>
<code>duration_ms</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The duration of the test in milliseconds.</li> <li>
<code>error</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a> An error wrapping the error thrown by the test. <ul> <li>
<code>cause</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error" class="type">&lt;Error&gt;</a> The actual error thrown by the test.</li> </ul> </li> <li>
<code>type</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The type of the test, used to denote whether this is a suite.</li> <li>
<code>attempt</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The attempt number of the test run, present only when using the <a href="cli#--test-rerun-failures"><code>--test-rerun-failures</code></a> flag.</li> </ul> </li> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The path of the test file, <code>undefined</code> if test was run through the REPL.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The line number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The test name.</li> <li>
<code>nesting</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The nesting level of the test.</li> <li>
<code>testNumber</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The ordinal number of the test.</li> <li>
<code>todo</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> Present if <a href="#contexttodomessage"><code>context.todo</code></a> is called</li> <li>
<code>skip</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> Present if <a href="#contextskipmessage"><code>context.skip</code></a> is called</li> </ul> </li> </ul> <p>Emitted when a test fails. This event is guaranteed to be emitted in the same order as the tests are defined. The corresponding execution ordered event is <code>'test:complete'</code>.</p> </div>
<div> <h4 id="event-testpass">Event: <code>'test:pass'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>column</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The column number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>details</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Additional execution metadata. <ul> <li>
<code>duration_ms</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The duration of the test in milliseconds.</li> <li>
<code>type</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The type of the test, used to denote whether this is a suite.</li> <li>
<code>attempt</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The attempt number of the test run, present only when using the <a href="cli#--test-rerun-failures"><code>--test-rerun-failures</code></a> flag.</li> <li>
<code>passed_on_attempt</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The attempt number the test passed on, present only when using the <a href="cli#--test-rerun-failures"><code>--test-rerun-failures</code></a> flag.</li> </ul> </li> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The path of the test file, <code>undefined</code> if test was run through the REPL.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The line number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The test name.</li> <li>
<code>nesting</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The nesting level of the test.</li> <li>
<code>testNumber</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The ordinal number of the test.</li> <li>
<code>todo</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> Present if <a href="#contexttodomessage"><code>context.todo</code></a> is called</li> <li>
<code>skip</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> Present if <a href="#contextskipmessage"><code>context.skip</code></a> is called</li> </ul> </li> </ul> <p>Emitted when a test passes. This event is guaranteed to be emitted in the same order as the tests are defined. The corresponding execution ordered event is <code>'test:complete'</code>.</p> </div>
<div> <h4 id="event-testplan">Event: <code>'test:plan'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>column</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The column number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The path of the test file, <code>undefined</code> if test was run through the REPL.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The line number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>nesting</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The nesting level of the test.</li> <li>
<code>count</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of subtests that have ran.</li> </ul> </li> </ul> <p>Emitted when all subtests have completed for a given test. This event is guaranteed to be emitted in the same order as the tests are defined.</p> </div>
<div> <h4 id="event-teststart">Event: <code>'test:start'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>column</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The column number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The path of the test file, <code>undefined</code> if test was run through the REPL.</li> <li>
<code>line</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The line number where the test is defined, or <code>undefined</code> if the test was run through the REPL.</li> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The test name.</li> <li>
<code>nesting</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The nesting level of the test.</li> </ul> </li> </ul> <p>Emitted when a test starts reporting its own and its subtests status. This event is guaranteed to be emitted in the same order as the tests are defined. The corresponding execution ordered event is <code>'test:dequeue'</code>.</p> </div>
<div> <h4 id="event-teststderr">Event: <code>'test:stderr'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The path of the test file.</li> <li>
<code>message</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The message written to <code>stderr</code>.</li> </ul> </li> </ul> <p>Emitted when a running test writes to <code>stderr</code>. This event is only emitted if <code>--test</code> flag is passed. This event is not guaranteed to be emitted in the same order as the tests are defined.</p> </div>
<div> <h4 id="event-teststdout">Event: <code>'test:stdout'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The path of the test file.</li> <li>
<code>message</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The message written to <code>stdout</code>.</li> </ul> </li> </ul> <p>Emitted when a running test writes to <code>stdout</code>. This event is only emitted if <code>--test</code> flag is passed. This event is not guaranteed to be emitted in the same order as the tests are defined.</p> </div>
<div> <h4 id="event-testsummary">Event: <code>'test:summary'</code>
</h4> <ul> <li>
<code>data</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> <ul> <li>
<code>counts</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> An object containing the counts of various test results. <ul> <li>
<code>cancelled</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of cancelled tests.</li> <li>
<code>failed</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of failed tests.</li> <li>
<code>passed</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of passed tests.</li> <li>
<code>skipped</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of skipped tests.</li> <li>
<code>suites</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of suites run.</li> <li>
<code>tests</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of tests run, excluding suites.</li> <li>
<code>todo</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of TODO tests.</li> <li>
<code>topLevel</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The total number of top level tests and suites.</li> </ul> </li> <li>
<code>duration_ms</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The duration of the test run in milliseconds.</li> <li>
<code>file</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Undefined_type" class="type">&lt;undefined&gt;</a> The path of the test file that generated the summary. If the summary corresponds to multiple files, this value is <code>undefined</code>.</li> <li>
<code>success</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> Indicates whether or not the test run is considered successful or not. If any error condition occurs, such as a failing test or unmet coverage threshold, this value will be set to <code>false</code>.</li> </ul> </li> </ul> <p>Emitted when a test run completes. This event contains metrics pertaining to the completed test run, and is useful for determining if a test run passed or failed. If process-level test isolation is used, a <code>'test:summary'</code> event is generated for each test file in addition to a final cumulative summary.</p> </div>
<div> <h4 id="event-testwatchdrained">Event: <code>'test:watch:drained'</code>
</h4> <p>Emitted when no more tests are queued for execution in watch mode.</p> </div>
<div> <h4 id="event-testwatchrestarted">Event: <code>'test:watch:restarted'</code>
</h4> <p>Emitted when one or more tests are restarted due to a file change in watch mode.</p> </div> </section><section><h3 id="class-testcontext">Class: <code>TestContext</code>
</h3> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v20.1.0, v18.17.0</td> <td><p>The <code>before</code> function was added to TestContext.</p></td>
</tr> <tr>
<td>v18.0.0, v16.17.0</td> <td><p><span>Added in: v18.0.0, v16.17.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <p>An instance of <code>TestContext</code> is passed to each test function in order to interact with the test runner. However, the <code>TestContext</code> constructor is not exposed as part of the API.</p> <div> <h4 id="contextbeforefn-options">
<code>context.before([fn][, options])</code>
</h4> <div class="api_metadata"> <span>Added in: v20.1.0, v18.17.0</span> </div> <ul> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The hook function. The first argument to this function is a <a href="#class-testcontext"><code>TestContext</code></a> object. If the hook uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the hook. The following properties are supported: <ul> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress hook.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the hook will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> </ul> <p>This function is used to create a hook running before subtest of the current test.</p> </div>
<div> <h4 id="contextbeforeeachfn-options">
<code>context.beforeEach([fn][, options])</code>
</h4> <div class="api_metadata"> <span>Added in: v18.8.0, v16.18.0</span> </div> <ul> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The hook function. The first argument to this function is a <a href="#class-testcontext"><code>TestContext</code></a> object. If the hook uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the hook. The following properties are supported: <ul> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress hook.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the hook will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> </ul> <p>This function is used to create a hook running before each subtest of the current test.</p> <pre data-language="js">test('top level test', async (t) =&gt; {
  t.beforeEach((t) =&gt; t.diagnostic(`about to run ${t.name}`));
  await t.test(
    'This is a subtest',
    (t) =&gt; {
      assert.ok('some relevant assertion here');
    },
  );
}); copy</pre> </div>
<div> <h4 id="contextafterfn-options">
<code>context.after([fn][, options])</code>
</h4> <div class="api_metadata"> <span>Added in: v19.3.0, v18.13.0</span> </div> <ul> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The hook function. The first argument to this function is a <a href="#class-testcontext"><code>TestContext</code></a> object. If the hook uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the hook. The following properties are supported: <ul> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress hook.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the hook will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> </ul> <p>This function is used to create a hook that runs after the current test finishes.</p> <pre data-language="js">test('top level test', async (t) =&gt; {
  t.after((t) =&gt; t.diagnostic(`finished running ${t.name}`));
  assert.ok('some relevant assertion here');
}); copy</pre> </div>
<div> <h4 id="contextaftereachfn-options">
<code>context.afterEach([fn][, options])</code>
</h4> <div class="api_metadata"> <span>Added in: v18.8.0, v16.18.0</span> </div> <ul> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The hook function. The first argument to this function is a <a href="#class-testcontext"><code>TestContext</code></a> object. If the hook uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the hook. The following properties are supported: <ul> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress hook.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the hook will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> </ul> </li> </ul> <p>This function is used to create a hook running after each subtest of the current test.</p> <pre data-language="js">test('top level test', async (t) =&gt; {
  t.afterEach((t) =&gt; t.diagnostic(`finished running ${t.name}`));
  await t.test(
    'This is a subtest',
    (t) =&gt; {
      assert.ok('some relevant assertion here');
    },
  );
}); copy</pre> </div>
<div> <h4 id="contextassert">
<code>context.assert</code>
</h4> <div class="api_metadata"> <span>Added in: v22.2.0, v20.15.0</span> </div> <p>An object containing assertion methods bound to <code>context</code>. The top-level functions from the <code>node:assert</code> module are exposed here for the purpose of creating test plans.</p> <pre data-language="js">test('test', (t) =&gt; {
  t.plan(1);
  t.assert.strictEqual(true, true);
}); copy</pre> <div> <h5 id="contextassertfilesnapshotvalue-path-options">
<code>context.assert.fileSnapshot(value, path[, options])</code>
</h5> <div class="api_metadata"> <span>Added in: v23.7.0, v22.14.0</span> </div> <ul> <li>
<code>value</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> A value to serialize to a string. If Node.js was started with the <a href="cli#--test-update-snapshots"><code>--test-update-snapshots</code></a> flag, the serialized value is written to <code>path</code>. Otherwise, the serialized value is compared to the contents of the existing snapshot file.</li> <li>
<code>path</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The file where the serialized <code>value</code> is written.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Optional configuration options. The following properties are supported: <ul> <li>
<code>serializers</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of synchronous functions used to serialize <code>value</code> into a string. <code>value</code> is passed as the only argument to the first serializer function. The return value of each serializer is passed as input to the next serializer. Once all serializers have run, the resulting value is coerced to a string. <strong>Default:</strong> If no serializers are provided, the test runner's default serializers are used.</li> </ul> </li> </ul> <p>This function serializes <code>value</code> and writes it to the file specified by <code>path</code>.</p> <pre data-language="js">test('snapshot test with default serialization', (t) =&gt; {
  t.assert.fileSnapshot({ value1: 1, value2: 2 }, './snapshots/snapshot.json');
}); copy</pre> <p>This function differs from <code>context.assert.snapshot()</code> in the following ways:</p> <ul> <li>The snapshot file path is explicitly provided by the user.</li> <li>Each snapshot file is limited to a single snapshot value.</li> <li>No additional escaping is performed by the test runner.</li> </ul> <p>These differences allow snapshot files to better support features such as syntax highlighting.</p> </div>
<div> <h5 id="contextassertsnapshotvalue-options">
<code>context.assert.snapshot(value[, options])</code>
</h5> <div class="api_metadata"> <span>Added in: v22.3.0</span> </div> <ul> <li>
<code>value</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Data_types" class="type">&lt;any&gt;</a> A value to serialize to a string. If Node.js was started with the <a href="cli#--test-update-snapshots"><code>--test-update-snapshots</code></a> flag, the serialized value is written to the snapshot file. Otherwise, the serialized value is compared to the corresponding value in the existing snapshot file.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Optional configuration options. The following properties are supported: <ul> <li>
<code>serializers</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array" class="type">&lt;Array&gt;</a> An array of synchronous functions used to serialize <code>value</code> into a string. <code>value</code> is passed as the only argument to the first serializer function. The return value of each serializer is passed as input to the next serializer. Once all serializers have run, the resulting value is coerced to a string. <strong>Default:</strong> If no serializers are provided, the test runner's default serializers are used.</li> </ul> </li> </ul> <p>This function implements assertions for snapshot testing.</p> <pre data-language="js">test('snapshot test with default serialization', (t) =&gt; {
  t.assert.snapshot({ value1: 1, value2: 2 });
});

test('snapshot test with custom serialization', (t) =&gt; {
  t.assert.snapshot({ value3: 3, value4: 4 }, {
    serializers: [(value) =&gt; JSON.stringify(value)],
  });
}); copy</pre> </div>
</div>
<div> <h4 id="contextdiagnosticmessage">
<code>context.diagnostic(message)</code>
</h4> <div class="api_metadata"> <span>Added in: v18.0.0, v16.17.0</span> </div> <ul> <li>
<code>message</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> Message to be reported.</li> </ul> <p>This function is used to write diagnostics to the output. Any diagnostic information is included at the end of the test's results. This function does not return a value.</p> <pre data-language="js">test('top level test', (t) =&gt; {
  t.diagnostic('A diagnostic message');
}); copy</pre> </div>
<div> <h4 id="contextfilepath">
<code>context.filePath</code>
</h4> <div class="api_metadata"> <span>Added in: v22.6.0, v20.16.0</span> </div> <p>The absolute path of the test file that created the current test. If a test file imports additional modules that generate tests, the imported tests will return the path of the root test file.</p> </div>
<div> <h4 id="contextfullname">
<code>context.fullName</code>
</h4> <div class="api_metadata"> <span>Added in: v22.3.0</span> </div> <p>The name of the test and each of its ancestors, separated by <code>&gt;</code>.</p> </div>
<div> <h4 id="contextname">
<code>context.name</code>
</h4> <div class="api_metadata"> <span>Added in: v18.8.0, v16.18.0</span> </div> <p>The name of the test.</p> </div>
<div> <h4 id="contextplancountoptions">
<code>context.plan(count[,options])</code>
</h4> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v23.9.0, v22.15.0</td> <td><p>Add the <code>options</code> parameter.</p></td>
</tr> <tr>
<td>v23.4.0, v22.13.0</td> <td><p>This function is no longer experimental.</p></td>
</tr> <tr>
<td>v22.2.0, v20.15.0</td> <td><p><span>Added in: v22.2.0, v20.15.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <ul> <li>
<code>count</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of assertions and subtests that are expected to run.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Additional options for the plan. <ul> <li>
<code>wait</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The wait time for the plan: <ul> <li>If <code>true</code>, the plan waits indefinitely for all assertions and subtests to run.</li> <li>If <code>false</code>, the plan performs an immediate check after the test function completes, without waiting for any pending assertions or subtests. Any assertions or subtests that complete after this check will not be counted towards the plan.</li> <li>If a number, it specifies the maximum wait time in milliseconds before timing out while waiting for expected assertions and subtests to be matched. If the timeout is reached, the test will fail. <strong>Default:</strong> <code>false</code>.</li> </ul> </li> </ul> </li> </ul> <p>This function is used to set the number of assertions and subtests that are expected to run within the test. If the number of assertions and subtests that run does not match the expected count, the test will fail.</p> <blockquote> <p>Note: To make sure assertions are tracked, <code>t.assert</code> must be used instead of <code>assert</code> directly.</p> </blockquote> <pre data-language="js">test('top level test', (t) =&gt; {
  t.plan(2);
  t.assert.ok('some relevant assertion here');
  t.test('subtest', () =&gt; {});
}); copy</pre> <p>When working with asynchronous code, the <code>plan</code> function can be used to ensure that the correct number of assertions are run:</p> <pre data-language="js">test('planning with streams', (t, done) =&gt; {
  function* generate() {
    yield 'a';
    yield 'b';
    yield 'c';
  }
  const expected = ['a', 'b', 'c'];
  t.plan(expected.length);
  const stream = Readable.from(generate());
  stream.on('data', (chunk) =&gt; {
    t.assert.strictEqual(chunk, expected.shift());
  });

  stream.on('end', () =&gt; {
    done();
  });
}); copy</pre> <p>When using the <code>wait</code> option, you can control how long the test will wait for the expected assertions. For example, setting a maximum wait time ensures that the test will wait for asynchronous assertions to complete within the specified timeframe:</p> <pre data-language="js">test('plan with wait: 2000 waits for async assertions', (t) =&gt; {
  t.plan(1, { wait: 2000 }); // Waits for up to 2 seconds for the assertion to complete.

  const asyncActivity = () =&gt; {
    setTimeout(() =&gt; {
      t.assert.ok(true, 'Async assertion completed within the wait time');
    }, 1000); // Completes after 1 second, within the 2-second wait time.
  };

  asyncActivity(); // The test will pass because the assertion is completed in time.
}); copy</pre> <p>Note: If a <code>wait</code> timeout is specified, it begins counting down only after the test function finishes executing.</p> </div>
<div> <h4 id="contextrunonlyshouldrunonlytests">
<code>context.runOnly(shouldRunOnlyTests)</code>
</h4> <div class="api_metadata"> <span>Added in: v18.0.0, v16.17.0</span> </div> <ul> <li>
<code>shouldRunOnlyTests</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> Whether or not to run <code>only</code> tests.</li> </ul> <p>If <code>shouldRunOnlyTests</code> is truthy, the test context will only run tests that have the <code>only</code> option set. Otherwise, all tests are run. If Node.js was not started with the <a href="cli#--test-only"><code>--test-only</code></a> command-line option, this function is a no-op.</p> <pre data-language="js">test('top level test', (t) =&gt; {
  // The test context can be set to run subtests with the 'only' option.
  t.runOnly(true);
  return Promise.all([
    t.test('this subtest is now skipped'),
    t.test('this subtest is run', { only: true }),
  ]);
}); copy</pre> </div>
<div> <h4 id="contextsignal">
<code>context.signal</code>
</h4> <div class="api_metadata"> <span>Added in: v18.7.0, v16.17.0</span> </div> <ul> <li>Type: <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a>
</li> </ul> <p>Can be used to abort test subtasks when the test has been aborted.</p> <pre data-language="js">test('top level test', async (t) =&gt; {
  await fetch('some/uri', { signal: t.signal });
}); copy</pre> </div>
<div> <h4 id="contextskipmessage">
<code>context.skip([message])</code>
</h4> <div class="api_metadata"> <span>Added in: v18.0.0, v16.17.0</span> </div> <ul> <li>
<code>message</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> Optional skip message.</li> </ul> <p>This function causes the test's output to indicate the test as skipped. If <code>message</code> is provided, it is included in the output. Calling <code>skip()</code> does not terminate execution of the test function. This function does not return a value.</p> <pre data-language="js">test('top level test', (t) =&gt; {
  // Make sure to return here as well if the test contains additional logic.
  t.skip('this is skipped');
}); copy</pre> </div>
<div> <h4 id="contexttodomessage">
<code>context.todo([message])</code>
</h4> <div class="api_metadata"> <span>Added in: v18.0.0, v16.17.0</span> </div> <ul> <li>
<code>message</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> Optional <code>TODO</code> message.</li> </ul> <p>This function adds a <code>TODO</code> directive to the test's output. If <code>message</code> is provided, it is included in the output. Calling <code>todo()</code> does not terminate execution of the test function. This function does not return a value.</p> <pre data-language="js">test('top level test', (t) =&gt; {
  // This test is marked as `TODO`
  t.todo('this is a todo');
}); copy</pre> </div>
<div> <h4 id="contexttestname-options-fn">
<code>context.test([name][, options][, fn])</code>
</h4> <div class="api_metadata"> <details class="changelog"><summary>History</summary> <table> <tbody>
<tr>
<th>Version</th>
<th>Changes</th>
</tr> <tr>
<td>v18.8.0, v16.18.0</td> <td><p>Add a <code>signal</code> option.</p></td>
</tr> <tr>
<td>v18.7.0, v16.17.0</td> <td><p>Add a <code>timeout</code> option.</p></td>
</tr> <tr>
<td>v18.0.0, v16.17.0</td> <td><p><span>Added in: v18.0.0, v16.17.0</span></p></td>
</tr> </tbody>
</table> </details> </div> <ul> <li>
<code>name</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> The name of the subtest, which is displayed when reporting test results. <strong>Default:</strong> The <code>name</code> property of <code>fn</code>, or <code>'&lt;anonymous&gt;'</code> if <code>fn</code> does not have a name.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> Configuration options for the subtest. The following properties are supported: <ul> <li>
<code>concurrency</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Null_type" class="type">&lt;null&gt;</a> If a number is provided, then that many tests would run in parallel within the application thread. If <code>true</code>, it would run all subtests in parallel. If <code>false</code>, it would only run one test at a time. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>null</code>.</li> <li>
<code>only</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> If truthy, and the test context is configured to run <code>only</code> tests, then this test will be run. Otherwise, the test is skipped. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>signal</code> <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a> Allows aborting an in-progress test.</li> <li>
<code>skip</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> If truthy, the test is skipped. If a string is provided, that string is displayed in the test results as the reason for skipping the test. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>todo</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Boolean_type" class="type">&lt;boolean&gt;</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#String_type" class="type">&lt;string&gt;</a> If truthy, the test marked as <code>TODO</code>. If a string is provided, that string is displayed in the test results as the reason why the test is <code>TODO</code>. <strong>Default:</strong> <code>false</code>.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> A number of milliseconds the test will fail after. If unspecified, subtests inherit this value from their parent. <strong>Default:</strong> <code>Infinity</code>.</li> <li>
<code>plan</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of assertions and subtests expected to be run in the test. If the number of assertions run in the test does not match the number specified in the plan, the test will fail. <strong>Default:</strong> <code>undefined</code>.</li> </ul> </li> <li>
<code>fn</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> The function under test. The first argument to this function is a <a href="#class-testcontext"><code>TestContext</code></a> object. If the test uses callbacks, the callback function is passed as the second argument. <strong>Default:</strong> A no-op function.</li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" class="type">&lt;Promise&gt;</a> Fulfilled with <code>undefined</code> once the test completes.</li> </ul> <p>This function is used to create subtests under the current test. This function behaves in the same fashion as the top level <a href="#testname-options-fn"><code>test()</code></a> function.</p> <pre data-language="js">test('top level test', async (t) =&gt; {
  await t.test(
    'This is a subtest',
    { only: false, skip: false, concurrency: 1, todo: false, plan: 1 },
    (t) =&gt; {
      t.assert.ok('some relevant assertion here');
    },
  );
}); copy</pre> </div>
<div> <h4 id="contextwaitforcondition-options">
<code>context.waitFor(condition[, options])</code>
</h4> <div class="api_metadata"> <span>Added in: v23.7.0, v22.14.0</span> </div> <ul> <li>
<code>condition</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" class="type">&lt;Function&gt;</a> | <a href="https://tc39.es/ecma262/#sec-async-function-constructor" class="type">&lt;AsyncFunction&gt;</a> An assertion function that is invoked periodically until it completes successfully or the defined polling timeout elapses. Successful completion is defined as not throwing or rejecting. This function does not accept any arguments, and is allowed to return any value.</li> <li>
<code>options</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object" class="type">&lt;Object&gt;</a> An optional configuration object for the polling operation. The following properties are supported: <ul> <li>
<code>interval</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The number of milliseconds to wait after an unsuccessful invocation of <code>condition</code> before trying again. <strong>Default:</strong> <code>50</code>.</li> <li>
<code>timeout</code> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Data_structures#Number_type" class="type">&lt;number&gt;</a> The poll timeout in milliseconds. If <code>condition</code> has not succeeded by the time this elapses, an error occurs. <strong>Default:</strong> <code>1000</code>.</li> </ul> </li> <li>Returns: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" class="type">&lt;Promise&gt;</a> Fulfilled with the value returned by <code>condition</code>.</li> </ul> <p>This method polls a <code>condition</code> function until that function either returns successfully or the operation times out.</p> </div> </section><section><h3 id="class-suitecontext">Class: <code>SuiteContext</code>
</h3> <div class="api_metadata"> <span>Added in: v18.7.0, v16.17.0</span> </div> <p>An instance of <code>SuiteContext</code> is passed to each suite function in order to interact with the test runner. However, the <code>SuiteContext</code> constructor is not exposed as part of the API.</p> <div> <h4 id="contextfilepath_1">
<code>context.filePath</code>
</h4> <div class="api_metadata"> <span>Added in: v22.6.0</span> </div> <p>The absolute path of the test file that created the current suite. If a test file imports additional modules that generate suites, the imported suites will return the path of the root test file.</p> </div>
<div> <h4 id="contextname_1">
<code>context.name</code>
</h4> <div class="api_metadata"> <span>Added in: v18.8.0, v16.18.0</span> </div> <p>The name of the suite.</p> </div>
<div> <h4 id="contextsignal_1">
<code>context.signal</code>
</h4> <div class="api_metadata"> <span>Added in: v18.7.0, v16.17.0</span> </div> <ul> <li>Type: <a href="globals#class-abortsignal" class="type">&lt;AbortSignal&gt;</a>
</li> </ul> <p>Can be used to abort test subtasks when the test has been aborted.</p>
</div></section><div class="_attribution">
  <p class="_attribution-p">
    &copy; Joyent, Inc. and other Node contributors<br>Licensed under the MIT License.<br>Node.js is a trademark of Joyent, Inc. and is used with its permission.<br>We are not endorsed by or affiliated with Joyent.<br>
    <a href="https://nodejs.org/api/test.html" class="_attribution-link">https://nodejs.org/api/test.html</a>
  </p>
</div>
