<div style="display:none;" hidden="true" aria-hidden="true">Are you an LLM? You can read better optimized documentation at /guide/backend-integration.md for this page in Markdown format</div>
<h1 id="backend-integration" tabindex="-1">Backend Integration </h1>
<div class="tip custom-block">
<strong class="custom-block-title">Note</strong><p>If you want to serve the HTML using a traditional backend (e.g. Rails, Laravel) but use Vite for serving assets, check for existing integrations listed in <a href="https://github.com/vitejs/awesome-vite#integrations-with-backends" target="_blank" rel="noreferrer">Awesome Vite</a>.</p>
<p>If you need a custom integration, you can follow the steps in this guide to configure it manually</p>
</div>
<ol>
<li>
<p>In your Vite config, configure the entry and enable build manifest:</p>
<div class="vp-code-block-title">
<div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vite.config.js">vite.config.js</span></div>
<div class="language-js">
<pre class="shiki shiki-themes github-light github-dark twoslash lsp" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">export default defineConfig({
  server: {
    cors: {
      // the origin you will be accessing via browser
      origin: 'http://my-backend.example.com',
    },
  },
  build: {
    // generate .vite/manifest.json in outDir
    manifest: true,
    rollupOptions: {
      // overwrite default .html entry
      input: '/path/to/main.js',
    },
  },
})</pre>
</div>
</div>
<p>If you haven't disabled the <a href="../config/build-options#build-polyfillmodulepreload">module preload polyfill</a>, you also need to import the polyfill in your entry</p>
<div class="language-js">
<pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">// add the beginning of your app entry
import 'vite/modulepreload-polyfill'</pre>
</div>
</li>
<li>
<p>For development, inject the following in your server's HTML template (substitute <code>http://localhost:5173</code> with the local URL Vite is running at):</p>
<div class="language-html">
<pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">&lt;!-- if development --&gt;
&lt;script type="module" src="http://localhost:5173/@vite/client"&gt;&lt;/script&gt;
&lt;script type="module" src="http://localhost:5173/main.js"&gt;&lt;/script&gt;</pre>
</div>
<p>In order to properly serve assets, you have two options:</p>
<ul>
<li>Make sure the server is configured to proxy static assets requests to the Vite server</li>
<li>Set <a href="../config/server-options#server-origin"><code>server.origin</code></a> so that generated asset URLs will be resolved using the back-end server URL instead of a relative path</li>
</ul>
<p>This is needed for assets such as images to load properly.</p>
<p>Note if you are using React with <code>@vitejs/plugin-react</code>, you'll also need to add this before the above scripts, since the plugin is not able to modify the HTML you are serving (substitute <code>http://localhost:5173</code> with the local URL Vite is running at):</p>
<div class="language-html">
<pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">&lt;script type="module"&gt;
  import RefreshRuntime from 'http://localhost:5173/@react-refresh'
  RefreshRuntime.injectIntoGlobalHook(window)
  window.$RefreshReg$ = () =&gt; {}
  window.$RefreshSig$ = () =&gt; (type) =&gt; type
  window.__vite_plugin_react_preamble_installed__ = true
&lt;/script&gt;</pre>
</div>
</li>
<li>
<p>For production: after running <code>vite build</code>, a <code>.vite/manifest.json</code> file will be generated alongside other asset files. An example manifest file looks like this:</p>
<div class="vp-code-block-title">
<div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title=".vite/manifest.json">.vite/manifest.json</span></div>
<div class="language-json">
<pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">{
  "_shared-B7PI925R.js": {
    "file": "assets/shared-B7PI925R.js",
    "name": "shared",
    "css": ["assets/shared-ChJ_j-JJ.css"]
  },
  "_shared-ChJ_j-JJ.css": {
    "file": "assets/shared-ChJ_j-JJ.css",
    "src": "_shared-ChJ_j-JJ.css"
  },
  "logo.svg": {
    "file": "assets/logo-BuPIv-2h.svg",
    "src": "logo.svg"
  },
  "baz.js": {
    "file": "assets/baz-B2H3sXNv.js",
    "name": "baz",
    "src": "baz.js",
    "isDynamicEntry": true
  },
  "views/bar.js": {
    "file": "assets/bar-gkvgaI9m.js",
    "name": "bar",
    "src": "views/bar.js",
    "isEntry": true,
    "imports": ["_shared-B7PI925R.js"],
    "dynamicImports": ["baz.js"]
  },
  "views/foo.js": {
    "file": "assets/foo-BRBmoGS9.js",
    "name": "foo",
    "src": "views/foo.js",
    "isEntry": true,
    "imports": ["_shared-B7PI925R.js"],
    "css": ["assets/foo-5UjPuW-k.css"]
  }
}</pre>
</div>
</div>
<p>The manifest has a <code>Record&lt;name, chunk&gt;</code> structure where each chunk follows the <code>ManifestChunk</code> interface:</p>
<div class="language-ts">
<pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">interface ManifestChunk {
  src?: string
  file: string
  css?: string[]
  assets?: string[]
  isEntry?: boolean
  name?: string
  names?: string[]
  isDynamicEntry?: boolean
  imports?: string[]
  dynamicImports?: string[]
}</pre>
</div>
<p>Each entry in the manifest represents one of the following:</p>
<ul>
<li>
<strong>Entry chunks</strong>: Generated from files specified in <a href="https://rollupjs.org/configuration-options/#input" target="_blank" rel="noreferrer"><code>build.rollupOptions.input</code></a>. These chunks have <code>isEntry: true</code> and their key is the relative src path from project root.</li>
<li>
<strong>Dynamic entry chunks</strong>: Generated from dynamic imports. These chunks have <code>isDynamicEntry: true</code> and their key is the relative src path from project root.</li>
<li>
<strong>Non-entry chunks</strong>: Their key is the base name of the generated file prefixed with <code>_</code>.</li>
<li>
<strong>Asset chunks</strong>: Generated from imported assets like images, fonts. Their key is the relative src path from project root.</li>
<li>
<strong>CSS files</strong>: When <a href="../config/build-options#build-csscodesplit"><code>build.cssCodeSplit</code></a> is <code>false</code>, a single CSS file is generated with the key <code>style.css</code>. When <code>build.cssCodeSplit</code> is not <code>false</code>, the key is generated similar to JS chunks (i.e. entry chunks will not have <code>_</code> prefix and non-entry chunks will have <code>_</code> prefix).</li>
</ul>
<p>Chunks will contain information on their static and dynamic imports (both are keys that map to the corresponding chunk in the manifest), and also their corresponding CSS and asset files (if any).</p>
</li>
<li>
<p>You can use this file to render links or preload directives with hashed filenames.</p>
<p>Here is an example HTML template to render the proper links. The syntax here is for explanation only, substitute with your server templating language. The <code>importedChunks</code> function is for illustration and isn't provided by Vite.</p>
<div class="language-html">
<pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">&lt;!-- if production --&gt;

&lt;!-- for cssFile of manifest[name].css --&gt;
&lt;link rel="stylesheet" href="/{{ cssFile }}" /&gt;

&lt;!-- for chunk of importedChunks(manifest, name) --&gt;
&lt;!-- for cssFile of chunk.css --&gt;
&lt;link rel="stylesheet" href="/{{ cssFile }}" /&gt;

&lt;script type="module" src="/{{ manifest[name].file }}"&gt;&lt;/script&gt;

&lt;!-- for chunk of importedChunks(manifest, name) --&gt;
&lt;link rel="modulepreload" href="/{{ chunk.file }}" /&gt;</pre>
</div>
<p>Specifically, a backend generating HTML should include the following tags given a manifest file and an entry point. Note that following this order is recommended for optimal performance:</p>
<ol>
<li>A <code>&lt;link rel="stylesheet"&gt;</code> tag for each file in the entry point chunk's <code>css</code> list (if it exists)</li>
<li>Recursively follow all chunks in the entry point's <code>imports</code> list and include a <code>&lt;link rel="stylesheet"&gt;</code> tag for each CSS file of each imported chunk's <code>css</code> list (if it exists).</li>
<li>A tag for the <code>file</code> key of the entry point chunk. This can be <code>&lt;script type="module"&gt;</code> for JavaScript, <code>&lt;link rel="stylesheet"&gt;</code> for CSS.</li>
<li>Optionally, <code>&lt;link rel="modulepreload"&gt;</code> tag for the <code>file</code> of each imported JavaScript chunk, again recursively following the imports starting from the entry point chunk.</li>
</ol>
<p>Following the above example manifest, for the entry point <code>views/foo.js</code> the following tags should be included in production:</p>
<div class="language-html">
<pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">&lt;link rel="stylesheet" href="assets/foo-5UjPuW-k.css" /&gt;
&lt;link rel="stylesheet" href="assets/shared-ChJ_j-JJ.css" /&gt;
&lt;script type="module" src="assets/foo-BRBmoGS9.js"&gt;&lt;/script&gt;
&lt;!-- optional --&gt;
&lt;link rel="modulepreload" href="assets/shared-B7PI925R.js" /&gt;</pre>
</div>
<p>While the following should be included for the entry point <code>views/bar.js</code>:</p>
<div class="language-html">
<pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">&lt;link rel="stylesheet" href="assets/shared-ChJ_j-JJ.css" /&gt;
&lt;script type="module" src="assets/bar-gkvgaI9m.js"&gt;&lt;/script&gt;
&lt;!-- optional --&gt;
&lt;link rel="modulepreload" href="assets/shared-B7PI925R.js" /&gt;</pre>
</div>
<div class="details custom-block">
<summary>Pseudo implementation of <code>importedChunks</code></summary><p>An example pseudo implementation of <code>importedChunks</code> in TypeScript (This will need to be adapted for your programming language and templating language):</p>
<div class="language-ts">
<pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr" data-language="javascript">import type { Manifest, ManifestChunk } from 'vite'

export default function importedChunks(
  manifest: Manifest,
  name: string,
): ManifestChunk[] {
  const seen = new Set&lt;string&gt;()

  function getImportedChunks(chunk: ManifestChunk): ManifestChunk[] {
    const chunks: ManifestChunk[] = []
    for (const file of chunk.imports ?? []) {
      const importee = manifest[file]
      if (seen.has(file)) {
        continue
      }
      seen.add(file)

      chunks.push(...getImportedChunks(importee))
      chunks.push(importee)
    }

    return chunks
  }

  return getImportedChunks(manifest[name])
}</pre>
</div>
</div>
</li>
</ol><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2019â€“present, Yuxi (Evan) You and Vite contributors<br>Licensed under the MIT License.<br>
    <a href="https://vite.dev/guide/backend-integration" class="_attribution-link">https://vite.dev/guide/backend-integration</a>
  </p>
</div>
