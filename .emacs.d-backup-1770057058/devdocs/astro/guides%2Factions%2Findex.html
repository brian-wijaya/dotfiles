<h1 id="_top" class="astro-62i6xxx4">Actions</h1> <div class="content-panel astro-2mug3n2c"> <div class="sl-container astro-2mug3n2c"> <div class="sl-markdown-content"> <p><span> <strong>Added in:</strong> <code>astro@4.15</code> </span></p> <p>Astro Actions allow you to define and call backend functions with type-safety. Actions perform data fetching, JSON parsing, and input validation for you. This can greatly reduce the amount of boilerplate needed compared to using an <a href="../endpoints/index">API endpoint</a>.</p> <p>Use actions instead of API endpoints for seamless communication between your client and server code and to:</p> <ul> <li>Automatically validate JSON and form data inputs using <a href="../../reference/modules/astro-zod/index">Zod validation</a>.</li> <li>Generate type-safe functions to call your backend from the client and even <a href="#call-actions-from-an-html-form-action">from HTML form actions</a>. No need for manual <code dir="auto">fetch()</code> calls.</li> <li>Standardize backend errors with the <a href="../../reference/modules/astro-actions/index#actionerror"><code dir="auto">ActionError</code></a> object.</li> </ul> <div class="sl-heading-wrapper level-h2">
<h2 id="basic-usage">Basic usage</h2>
<a class="sl-anchor-link" href="#basic-usage"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Basic usage”</span></a>
</div> <p>Actions are defined in a <code dir="auto">server</code> object exported from <code dir="auto">src/actions/index.ts</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { defineAction } from 'astro:actions';
import { z } from 'astro/zod';


export const server = {
  myAction: defineAction({ /* ... */ })
}</pre>

</div> <p>Your actions are available as functions from the <code dir="auto">astro:actions</code> module. Import <code dir="auto">actions</code> and call them client-side within a <a href="../framework-components/index">UI framework component</a>, <a href="#call-actions-from-an-html-form-action">a form POST request</a>, or by using a <code dir="auto">&lt;script&gt;</code> tag in an Astro component.</p> <p>When you call an action, it returns an object with either <code dir="auto">data</code> containing the JSON-serialized result, or <code dir="auto">error</code> containing thrown errors.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
---


&lt;script&gt;
import { actions } from 'astro:actions';


async () =&gt; {
  const { data, error } = await actions.myAction({ /* ... */ });
}
&lt;/script&gt;</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="write-your-first-action">Write your first action</h3>
<a class="sl-anchor-link" href="#write-your-first-action"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Write your first action”</span></a>
</div> <p>Follow these steps to define an action and call it in a <code dir="auto">script</code> tag in your Astro page.</p> <ol role="list" class="sl-steps"> <li> <p>Create a <code dir="auto">src/actions/index.ts</code> file and export a <code dir="auto">server</code> object.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">export const server = {
  // action declarations
}</pre>

</div> </li> <li> <p>Import the <code dir="auto">defineAction()</code> utility from <code dir="auto">astro:actions</code>, and the <code dir="auto">z</code> object from <code dir="auto">astro/zod</code>.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { defineAction } from 'astro:actions';
import { z } from 'astro/zod';


export const server = {
  // action declarations
}</pre>

</div> </li> <li> <p>Use the <code dir="auto">defineAction()</code> utility to define a <code dir="auto">getGreeting</code> action. The <code dir="auto">input</code> property will be used to validate input parameters with a <a href="../../reference/modules/astro-zod/index#common-data-type-validators">Zod schema</a> and the <code dir="auto">handler()</code> function includes the backend logic to run on the server.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { defineAction } from 'astro:actions';
import { z } from 'astro/zod';


export const server = {
  getGreeting: defineAction({
    input: z.object({
      name: z.string(),
    }),
    handler: async (input) =&gt; {
      return `Hello, ${input.name}!`
    }
  })
}</pre>

</div> </li> <li> <p>Create an Astro component with a button that will fetch a greeting using your <code dir="auto">getGreeting</code> action when clicked.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
---


&lt;button&gt;Get greeting&lt;/button&gt;


&lt;script&gt;
const button = document.querySelector('button');
button?.addEventListener('click', async () =&gt; {
  // Show alert pop-up with greeting from action
});
&lt;/script&gt;</pre>

</div> </li> <li> <p>To use your action, import <code dir="auto">actions</code> from <code dir="auto">astro:actions</code> and then call <code dir="auto">actions.getGreeting()</code> in the click handler. The <code dir="auto">name</code> option will be sent to your action’s <code dir="auto">handler()</code> on the server and, if there are no errors, the result will be available as the <code dir="auto">data</code> property.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
---


&lt;button&gt;Get greeting&lt;/button&gt;


&lt;script&gt;
import { actions } from 'astro:actions';


const button = document.querySelector('button');
button?.addEventListener('click', async () =&gt; {
  // Show alert pop-up with greeting from action
  const { data, error } = await actions.getGreeting({ name: "Houston" });
  if (!error) alert(data);
})
&lt;/script&gt;</pre>

</div> </li> </ol> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz">See the full Actions API documentation for details on <a href="../../reference/modules/astro-actions/index#defineaction"><code dir="auto">defineAction()</code></a> and its properties.</span> </div> <div class="sl-heading-wrapper level-h2">
<h2 id="organizing-actions">Organizing actions</h2>
<a class="sl-anchor-link" href="#organizing-actions"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Organizing actions”</span></a>
</div> <p>All actions in your project must be exported from the <code dir="auto">server</code> object in the <code dir="auto">src/actions/index.ts</code> file. You can define actions inline or you can move action definitions to separate files and import them. You can even group related functions in nested objects.</p> <p>For example, to colocate all of your user actions, you can create a <code dir="auto">src/actions/user.ts</code> file and nest the definitions of both <code dir="auto">getUser</code> and <code dir="auto">createUser</code> inside a single <code dir="auto">user</code> object.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/user.ts</span></div>
<pre data-language="ts">import { defineAction } from 'astro:actions';


export const user = {
  getUser: defineAction(/* ... */),
  createUser: defineAction(/* ... */),
}</pre>

</div> <p>Then, you can import this <code dir="auto">user</code> object into your <code dir="auto">src/actions/index.ts</code> file and add it as a top-level key to the <code dir="auto">server</code> object alongside any other actions:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { user } from './user';


export const server = {
  myAction: defineAction({ /* ... */ }),
  user,
}</pre>

</div> <p>Now, all of your user actions are callable from the <code dir="auto">actions.user</code> object:</p> <ul> <li><code dir="auto">actions.user.getUser()</code></li> <li><code dir="auto">actions.user.createUser()</code></li> </ul> <div class="sl-heading-wrapper level-h2">
<h2 id="handling-returned-data">Handling returned data</h2>
<a class="sl-anchor-link" href="#handling-returned-data"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Handling returned data”</span></a>
</div> <p>Actions return an object containing either <code dir="auto">data</code> with the type-safe return value of your <code dir="auto">handler()</code>, or an <code dir="auto">error</code> with any backend errors. Errors may come from validation errors on the <code dir="auto">input</code> property or thrown errors within the <code dir="auto">handler()</code>.</p> <p>Actions return a custom data format that can handle Dates, Maps, Sets, and URLs <a href="https://github.com/Rich-Harris/devalue">using the Devalue library</a>. Therefore, you can’t easily inspect the response from the network like you can with regular JSON. For debugging, you can instead inspect the <code dir="auto">data</code> object returned by actions.</p> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz"><a href="../../reference/modules/astro-actions/index#handler-property">See the <code dir="auto">handler()</code> API reference</a> for full details.</span> </div> <div class="sl-heading-wrapper level-h3">
<h3 id="checking-for-errors">Checking for errors</h3>
<a class="sl-anchor-link" href="#checking-for-errors"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Checking for errors”</span></a>
</div> <p>It’s best to check if an <code dir="auto">error</code> is present before using the <code dir="auto">data</code> property. This allows you to handle errors in advance and ensures <code dir="auto">data</code> is defined without an <code dir="auto">undefined</code> check.</p> <div class="expressive-code">

<pre data-language="ts">const { data, error } = await actions.example();


if (error) {
  // handle error cases
  return;
}
// use `data`</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="accessing-data-directly-without-an-error-check">Accessing <code dir="auto">data</code> directly without an error check</h3>
<a class="sl-anchor-link" href="#accessing-data-directly-without-an-error-check"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Accessing data directly without an error check”</span></a>
</div> <p>To skip error handling, for example while prototyping or using a library that will catch errors for you, use the <code dir="auto">.orThrow()</code> property on your action call to throw errors instead of returning an <code dir="auto">error</code>. This will return the action’s <code dir="auto">data</code> directly.</p> <p>This example calls a <code dir="auto">likePost()</code> action that returns the updated number of likes as a <code dir="auto">number</code> from the action <code dir="auto">handler</code>:</p> <div class="expressive-code">

<pre data-language="ts">const updatedLikes = await actions.likePost.orThrow({ postId: 'example' });
//    ^ type: number</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="handling-backend-errors-in-your-action">Handling backend errors in your action</h3>
<a class="sl-anchor-link" href="#handling-backend-errors-in-your-action"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Handling backend errors in your action”</span></a>
</div> <p>You can use the provided <code dir="auto">ActionError</code> to throw an error from your action <code dir="auto">handler()</code>, such as “not found” when a database entry is missing, or “unauthorized” when a user is not logged in. This has two main benefits over returning <code dir="auto">undefined</code>:</p> <ul> <li> <p>You can set a status code like <code dir="auto">404 - Not found</code> or <code dir="auto">401 - Unauthorized</code>. This improves debugging errors in both development and in production by letting you see the status code of each request.</p> </li> <li> <p>In your application code, all errors are passed to the <code dir="auto">error</code> object on an action result. This avoids the need for <code dir="auto">undefined</code> checks on data, and allows you to display targeted feedback to the user depending on what went wrong.</p> </li> </ul> <div class="sl-heading-wrapper level-h4">
<h4 id="creating-an-actionerror">Creating an <code dir="auto">ActionError</code>
</h4>
<a class="sl-anchor-link" href="#creating-an-actionerror"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Creating an ActionError”</span></a>
</div> <p>To throw an error, import the <a href="../../reference/modules/astro-actions/index#actionerror"><code dir="auto">ActionError()</code> class</a> from the <code dir="auto">astro:actions</code> module. Pass it a human-readable status <code dir="auto">code</code> (e.g. <code dir="auto">"NOT_FOUND"</code> or <code dir="auto">"BAD_REQUEST"</code>), and an optional <code dir="auto">message</code> to provide further information about the error.</p> <p>This example throws an error from a <code dir="auto">likePost</code> action when a user is not logged in, after checking a hypothetical “user-session” cookie for authentication:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { defineAction, ActionError } from "astro:actions";
import { z } from "astro/zod";


export const server = {
  likePost: defineAction({
    input: z.object({ postId: z.string() }),
    handler: async (input, ctx) =&gt; {
      if (!ctx.cookies.has('user-session')) {
        throw new ActionError({
          code: "UNAUTHORIZED",
          message: "User must be logged in.",
        });
      }
      // Otherwise, like the post
    },
  }),
};</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="handling-an-actionerror">Handling an <code dir="auto">ActionError</code>
</h4>
<a class="sl-anchor-link" href="#handling-an-actionerror"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Handling an ActionError”</span></a>
</div> <p>To handle this error, you can call the action from your application and check whether an <code dir="auto">error</code> property is present. This property will be of type <code dir="auto">ActionError</code> and will contain your <code dir="auto">code</code> and <code dir="auto">message</code>.</p> <p>In the following example, a <code dir="auto">LikeButton.tsx</code> component calls the <code dir="auto">likePost()</code> action when clicked. If an authentication error occurs, the <code dir="auto">error.code</code> attribute is used to determine whether to display a login link:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/LikeButton.tsx</span></div>
<pre data-language="tsx">import { actions } from 'astro:actions';
import { useState } from 'preact/hooks';


export function LikeButton({ postId }: { postId: string }) {
  const [showLogin, setShowLogin] = useState(false);
  return (
    &lt;&gt;
      {
        showLogin &amp;&amp; &lt;a href="/signin"&gt;Log in to like a post.&lt;/a&gt;
      }
      &lt;button onClick={async () =&gt; {
        const { data, error } = await actions.likePost({ postId });
        if (error?.code === 'UNAUTHORIZED') setShowLogin(true);
        // Early return for unexpected errors
        else if (error) return;
        // update likes
      }}&gt;
        Like
      &lt;/button&gt;
    &lt;/&gt;
  )
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="handling-client-redirects">Handling client redirects</h3>
<a class="sl-anchor-link" href="#handling-client-redirects"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Handling client redirects”</span></a>
</div> <p>When calling actions from the client, you can integrate with a client-side library like <code dir="auto">react-router</code>, or you can use Astro’s <a href="../view-transitions/index#trigger-navigation"><code dir="auto">navigate()</code> function</a> to redirect to a new page when an action succeeds.</p> <p>This example navigates to the homepage after a <code dir="auto">logout</code> action returns successfully:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/LogoutButton.tsx</span></div>
<pre data-language="tsx">import { actions } from 'astro:actions';
import { navigate } from 'astro:transitions/client';


export function LogoutButton() {
  return (
    &lt;button onClick={async () =&gt; {
      const { error } = await actions.logout();
      if (!error) navigate('/');
    }}&gt;
      Logout
    &lt;/button&gt;
  );
}</pre>

</div> <div class="sl-heading-wrapper level-h2">
<h2 id="accepting-form-data-from-an-action">Accepting form data from an action</h2>
<a class="sl-anchor-link" href="#accepting-form-data-from-an-action"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Accepting form data from an action”</span></a>
</div> <p>Actions accept JSON data by default. To accept form data from an HTML form, set <code dir="auto">accept: 'form'</code> in your <code dir="auto">defineAction()</code> call:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { defineAction } from 'astro:actions';
import { z } from 'astro/zod';


export const server = {
  comment: defineAction({
    accept: 'form',
    input: z.object(/* ... */),
    handler: async (input) =&gt; { /* ... */ },
  })
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="using-validators-with-form-inputs">Using validators with form inputs</h3>
<a class="sl-anchor-link" href="#using-validators-with-form-inputs"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Using validators with form inputs”</span></a>
</div> <p>When your action is <a href="../../reference/modules/astro-actions/index#accept-property">configured to accept form data</a>, you can use any Zod validators to validate your fields (e.g. <code dir="auto">z.coerce.date()</code> for date inputs). Extension functions including <code dir="auto">.refine()</code>, <code dir="auto">.transform()</code>, and <code dir="auto">.pipe()</code> are also supported on the <code dir="auto">z.object()</code> validator.</p> <p>Additionally, Astro provides special handling under the hood for your convenience to validate the following types of field inputs:</p> <ul> <li>Inputs of type <code dir="auto">number</code> can be validated using <code dir="auto">z.number()</code>
</li> <li>Inputs of type <code dir="auto">checkbox</code> can be validated using <code dir="auto">z.coerce.boolean()</code>
</li> <li>Inputs of type <code dir="auto">file</code> can be validated using <code dir="auto">z.instanceof(File)</code>
</li> <li>Multiple inputs of the same <code dir="auto">name</code> can be validated using <code dir="auto">z.array(/* validator */)</code>
</li> <li>All other inputs can be validated using <code dir="auto">z.string()</code>
</li> </ul> <p>When your form is submitted with empty inputs, the output type may not match your <code dir="auto">input</code> validator. Empty values are converted to <code dir="auto">null</code> except when validating arrays or booleans. For example, if an input of type <code dir="auto">text</code> is submitted with an empty value, the result will be <code dir="auto">null</code> instead of an empty string (<code dir="auto">""</code>).</p> <p>To apply a union of different validators, use the <code dir="auto">z.discriminatedUnion()</code> wrapper to narrow the type based on a specific form field. This example accepts a form submission to either “create” or “update” a user, using the form field with the name <code dir="auto">type</code> to determine which object to validate against:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { defineAction } from 'astro:actions';
import { z } from 'astro/zod';


export const server = {
  changeUser: defineAction({
    accept: 'form',
    input: z.discriminatedUnion('type', [
      z.object({
        // Matches when the `type` field has the value `create`
        type: z.literal('create'),
        name: z.string(),
        email: z.string().email(),
      }),
      z.object({
        // Matches when the `type` field has the value `update`
        type: z.literal('update'),
        id: z.number(),
        name: z.string(),
        email: z.string().email(),
      }),
    ]),
    async handler(input) {
      if (input.type === 'create') {
        // input is { type: 'create', name: string, email: string }
      } else {
        // input is { type: 'update', id: number, name: string, email: string }
      }
    },
  }),
};</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="validating-form-data">Validating form data</h3>
<a class="sl-anchor-link" href="#validating-form-data"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Validating form data”</span></a>
</div> <p>Actions will parse submitted form data to an object, using the value of each input’s <code dir="auto">name</code> attribute as the object keys. For example, a form containing <code dir="auto">&lt;input name="search"&gt;</code> will be parsed to an object like <code dir="auto">{ search: 'user input' }</code>. Your action’s <code dir="auto">input</code> schema will be used to validate this object.</p> <p>To receive the raw <code dir="auto">FormData</code> object in your action handler instead of a parsed object, omit the <code dir="auto">input</code> property in your action definition.</p> <p>The following example shows a validated newsletter registration form that accepts a user’s email and requires a “terms of service” agreement checkbox.</p> <ol role="list" class="sl-steps"> <li> <p>Create an HTML form component with unique <code dir="auto">name</code> attributes on each input:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/Newsletter.astro</span></div>
<pre data-language="astro">&lt;form&gt;
  &lt;label for="email"&gt;E-mail&lt;/label&gt;
  &lt;input id="email" required type="email" name="email" /&gt;
  &lt;label&gt;
    &lt;input required type="checkbox" name="terms"&gt;
    I agree to the terms of service
  &lt;/label&gt;
  &lt;button&gt;Sign up&lt;/button&gt;
&lt;/form&gt;</pre>

</div> </li> <li> <p>Define a <code dir="auto">newsletter</code> action to handle the submitted form. Validate the <code dir="auto">email</code> field using the <code dir="auto">z.string().email()</code> validator, and the <code dir="auto">terms</code> checkbox using <code dir="auto">z.boolean()</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { defineAction } from 'astro:actions';
import { z } from 'astro/zod';


export const server = {
  newsletter: defineAction({
    accept: 'form',
    input: z.object({
      email: z.string().email(),
      terms: z.boolean(),
    }),
    handler: async ({ email, terms }) =&gt; { /* ... */ },
  })
}</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz">See the <a href="../../reference/modules/astro-actions/index#input-validator"><code dir="auto">input</code> API reference</a> for all available form validators.</span> </div> </li> <li> <p>Add a <code dir="auto">&lt;script&gt;</code> to the HTML form to submit the user input. This example overrides the form’s default submit behavior to call <code dir="auto">actions.newsletter()</code>, and redirects to <code dir="auto">/confirmation</code> using the <code dir="auto">navigate()</code> function:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/Newsletter.astro</span></div>
<pre data-language="astro">&lt;form&gt;
7 collapsed lines
  &lt;label for="email"&gt;E-mail&lt;/label&gt;
  &lt;input id="email" required type="email" name="email" /&gt;
  &lt;label&gt;
    &lt;input required type="checkbox" name="terms"&gt;
    I agree to the terms of service
  &lt;/label&gt;
  &lt;button&gt;Sign up&lt;/button&gt;
&lt;/form&gt;


&lt;script&gt;
  import { actions } from 'astro:actions';
  import { navigate } from 'astro:transitions/client';


  const form = document.querySelector('form');
  form?.addEventListener('submit', async (event) =&gt; {
    event.preventDefault();
    const formData = new FormData(form);
    const { error } = await actions.newsletter(formData);
    if (!error) navigate('/confirmation');
  })
&lt;/script&gt;</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz">See <a href="#call-actions-from-an-html-form-action">“Call actions from an HTML form action”</a> for an alternative way to submit form data.</span> </div> </li> </ol> <div class="sl-heading-wrapper level-h3">
<h3 id="displaying-form-input-errors">Displaying form input errors</h3>
<a class="sl-anchor-link" href="#displaying-form-input-errors"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Displaying form input errors”</span></a>
</div> <p>You can validate form inputs before submission using <a href="https://developer.mozilla.org/en-US/docs/Learn/Forms/Form_validation#using_built-in_form_validation">native HTML form validation attributes</a> like <code dir="auto">required</code>, <code dir="auto">type="email"</code>, and <code dir="auto">pattern</code>. For more complex <code dir="auto">input</code> validation on the backend, you can use the provided <a href="../../reference/modules/astro-actions/index#isinputerror"><code dir="auto">isInputError()</code></a> utility function.</p> <p>To retrieve input errors, use the <code dir="auto">isInputError()</code> utility to check whether an error was caused by invalid input. Input errors contain a <code dir="auto">fields</code> object with messages for each input name that failed to validate. You can use these messages to prompt your user to correct their submission.</p> <p>The following example checks the error with <code dir="auto">isInputError()</code>, then checks whether the error is in the email field, before finally creating a message from the errors. You can use JavaScript DOM manipulation or your preferred UI framework to display this message to users.</p> <div class="expressive-code">

<pre data-language="js">import { actions, isInputError } from 'astro:actions';


const form = document.querySelector('form');
const formData = new FormData(form);
const { error } = await actions.newsletter(formData);
if (isInputError(error)) {
  // Handle input errors.
  if (error.fields.email) {
    const message = error.fields.email.join(', ');
  }
}</pre>

</div> <div class="sl-heading-wrapper level-h2">
<h2 id="call-actions-from-an-html-form-action">Call actions from an HTML form action</h2>
<a class="sl-anchor-link" href="#call-actions-from-an-html-form-action"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Call actions from an HTML form action”</span></a>
</div> <aside aria-label="Note" class="starlight-aside starlight-aside--note"><p class="starlight-aside__title" aria-hidden="true"><svg viewbox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M12 11C11.7348 11 11.4804 11.1054 11.2929 11.2929C11.1054 11.4804 11 11.7348 11 12V16C11 16.2652 11.1054 16.5196 11.2929 16.7071C11.4804 16.8946 11.7348 17 12 17C12.2652 17 12.5196 16.8946 12.7071 16.7071C12.8946 16.5196 13 16.2652 13 16V12C13 11.7348 12.8946 11.4804 12.7071 11.2929C12.5196 11.1054 12.2652 11 12 11ZM12.38 7.08C12.1365 6.97998 11.8635 6.97998 11.62 7.08C11.4973 7.12759 11.3851 7.19896 11.29 7.29C11.2017 7.3872 11.1306 7.49882 11.08 7.62C11.024 7.73868 10.9966 7.86882 11 8C10.9992 8.13161 11.0245 8.26207 11.0742 8.38391C11.124 8.50574 11.1973 8.61656 11.29 8.71C11.3872 8.79833 11.4988 8.86936 11.62 8.92C11.7715 8.98224 11.936 9.00632 12.099 8.99011C12.2619 8.97391 12.4184 8.91792 12.5547 8.82707C12.691 8.73622 12.8029 8.61328 12.8805 8.46907C12.9582 8.32486 12.9992 8.16378 13 8C12.9963 7.73523 12.8927 7.48163 12.71 7.29C12.6149 7.19896 12.5028 7.12759 12.38 7.08ZM12 2C10.0222 2 8.08879 2.58649 6.4443 3.6853C4.79981 4.78412 3.51809 6.3459 2.76121 8.17317C2.00433 10.0004 1.8063 12.0111 2.19215 13.9509C2.578 15.8907 3.53041 17.6725 4.92894 19.0711C6.32746 20.4696 8.10929 21.422 10.0491 21.8079C11.9889 22.1937 13.9996 21.9957 15.8268 21.2388C17.6541 20.4819 19.2159 19.2002 20.3147 17.5557C21.4135 15.9112 22 13.9778 22 12C22 10.6868 21.7413 9.38642 21.2388 8.17317C20.7363 6.95991 19.9997 5.85752 19.0711 4.92893C18.1425 4.00035 17.0401 3.26375 15.8268 2.7612C14.6136 2.25866 13.3132 2 12 2ZM12 20C10.4178 20 8.87104 19.5308 7.55544 18.6518C6.23985 17.7727 5.21447 16.5233 4.60897 15.0615C4.00347 13.5997 3.84504 11.9911 4.15372 10.4393C4.4624 8.88743 5.22433 7.46197 6.34315 6.34315C7.46197 5.22433 8.88743 4.4624 10.4393 4.15372C11.9911 3.84504 13.5997 4.00346 15.0615 4.60896C16.5233 5.21447 17.7727 6.23984 18.6518 7.55544C19.5308 8.87103 20 10.4177 20 12C20 14.1217 19.1572 16.1566 17.6569 17.6569C16.1566 19.1571 14.1217 20 12 20Z"></path></svg>Note</p>
<div class="starlight-aside__content"><p>Pages must be on-demand rendered when calling actions using a form action. <a href="../on-demand-rendering/index#enabling-on-demand-rendering">Ensure prerendering is disabled on the page</a> before using this API.</p></div></aside> <p>You can enable zero-JS form submissions with standard attributes on any <code dir="auto">&lt;form&gt;</code> element. Form submissions without client-side JavaScript may be useful both as a fallback for when JavaScript fails to load, or if you prefer to handle forms entirely from the server.</p> <p>Calling <a href="../../reference/api-reference/index#getactionresult">Astro.getActionResult()</a> on the server returns the result of your form submission (<code dir="auto">data</code> or <code dir="auto">error</code>), and can be used to dynamically redirect, handle form errors, update the UI, and more.</p> <p>To call an action from an HTML form, add <code dir="auto">method="POST"</code> to your <code dir="auto">&lt;form&gt;</code>, then set the form’s <code dir="auto">action</code> attribute using your action, for example <code dir="auto">action={actions.logout}</code>. This will set the <code dir="auto">action</code> attribute to use a query string that is handled by the server automatically.</p> <p>For example, this Astro component calls the <code dir="auto">logout</code> action when the button is clicked and reloads the current page:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/LogoutButton.astro</span></div>
<pre data-language="astro">---
import { actions } from 'astro:actions';
---


&lt;form method="POST" action={actions.logout}&gt;
  &lt;button&gt;Log out&lt;/button&gt;
&lt;/form&gt;</pre>

</div> <p>Additional attributes on the <code dir="auto">&lt;form&gt;</code> element may be necessary for proper schema validation with Zod. For example, to include file uploads, add <code dir="auto">enctype="multipart/form-data"</code> to ensure that files are sent in a format correctly recognized by <code dir="auto">z.instanceof(File)</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/components/FileUploadForm.astro</span></div>
<pre data-language="astro">---
import { actions } from 'astro:actions';
---
&lt;form method="POST" action={actions.upload} enctype="multipart/form-data" &gt;
  &lt;label for="file"&gt;Upload File&lt;/label&gt;
  &lt;input type="file" id="file" name="file" /&gt;
  &lt;button type="submit"&gt;Submit&lt;/button&gt;
&lt;/form&gt;</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="redirect-on-action-success">Redirect on action success</h3>
<a class="sl-anchor-link" href="#redirect-on-action-success"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Redirect on action success”</span></a>
</div> <p>If you need to redirect to a new route on success, you can use an action’s result on the server. A common example is creating a product record and redirecting to the new product’s page, e.g. <code dir="auto">/products/[id]</code>.</p> <p>For example, say you have a <code dir="auto">createProduct</code> action that returns the generated product id:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { defineAction } from 'astro:actions';
import { z } from 'astro/zod';


export const server = {
  createProduct: defineAction({
    accept: 'form',
    input: z.object({ /* ... */ }),
    handler: async (input) =&gt; {
      const product = await persistToDatabase(input);
      return { id: product.id };
    },
  })
}</pre>

</div> <p>You can retrieve the action result from your Astro component by calling <code dir="auto">Astro.getActionResult()</code>. This returns an object containing <code dir="auto">data</code> or <code dir="auto">error</code> properties when an action is called, or <code dir="auto">undefined</code> if the action was not called during this request.</p> <p>Use the <code dir="auto">data</code> property to construct a URL to use with <code dir="auto">Astro.redirect()</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/products/create.astro</span></div>
<pre data-language="astro">---
import { actions } from 'astro:actions';


const result = Astro.getActionResult(actions.createProduct);
if (result &amp;&amp; !result.error) {
  return Astro.redirect(`/products/${result.data.id}`);
}
---


&lt;form method="POST" action={actions.createProduct}&gt;
  &lt;!--...--&gt;
&lt;/form&gt;</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="handle-form-action-errors">Handle form action errors</h3>
<a class="sl-anchor-link" href="#handle-form-action-errors"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Handle form action errors”</span></a>
</div> <p>Calling <code dir="auto">Astro.getActionResult()</code> in the Astro component containing your form gives you access to the <code dir="auto">data</code> and <code dir="auto">error</code> objects for custom error handling.</p> <p>The following example displays a general failure message when a <code dir="auto">newsletter</code> action fails:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
import { actions } from 'astro:actions';


const result = Astro.getActionResult(actions.newsletter);
---


{result?.error &amp;&amp; (
  &lt;p class="error"&gt;Unable to sign up. Please try again later.&lt;/p&gt;
)}
&lt;form method="POST" action={actions.newsletter}&gt;
  &lt;label&gt;
    E-mail
    &lt;input required type="email" name="email" /&gt;
  &lt;/label&gt;
  &lt;button&gt;Sign up&lt;/button&gt;
&lt;/form&gt;</pre>

</div> <p>For more customization, you can <a href="#displaying-form-input-errors">use the <code dir="auto">isInputError()</code> utility</a> to check whether an error is caused by invalid input.</p> <p>The following example renders an error banner under the <code dir="auto">email</code> input field when an invalid email is submitted:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
import { actions, isInputError } from 'astro:actions';


const result = Astro.getActionResult(actions.newsletter);
const inputErrors = isInputError(result?.error) ? result.error.fields : {};
---


&lt;form method="POST" action={actions.newsletter}&gt;
  &lt;label&gt;
    E-mail
    &lt;input required type="email" name="email" aria-describedby="error" /&gt;
  &lt;/label&gt;
  {inputErrors.email &amp;&amp; &lt;p id="error"&gt;{inputErrors.email.join(',')}&lt;/p&gt;}
  &lt;button&gt;Sign up&lt;/button&gt;
&lt;/form&gt;</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="preserve-input-values-on-error">Preserve input values on error</h4>
<a class="sl-anchor-link" href="#preserve-input-values-on-error"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Preserve input values on error”</span></a>
</div> <p>Inputs will be cleared whenever a form is submitted. To persist input values, you can <a href="../view-transitions/index#enabling-view-transitions-spa-mode">enable view transitions</a> and apply the <code dir="auto">transition:persist</code> directive to each input:</p> <div class="expressive-code">

<pre data-language="astro">&lt;input transition:persist required type="email" name="email" /&gt;</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="update-the-ui-with-a-form-action-result">Update the UI with a form action result</h3>
<a class="sl-anchor-link" href="#update-the-ui-with-a-form-action-result"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Update the UI with a form action result”</span></a>
</div> <p>To use an action’s return value to display a notification to the user on success, pass the action to <code dir="auto">Astro.getActionResult()</code>. Use the returned <code dir="auto">data</code> property to render the UI you want to display.</p> <p>This example uses the <code dir="auto">productName</code> property returned by an <code dir="auto">addToCart</code> action to show a success message.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/products/[slug].astro</span></div>
<pre data-language="astro">---
import { actions } from 'astro:actions';


const result = Astro.getActionResult(actions.addToCart);
---


{result &amp;&amp; !result.error &amp;&amp; (
  &lt;p class="success"&gt;Added {result.data.productName} to cart&lt;/p&gt;
)}


&lt;!--...--&gt;</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="advanced-persist-action-results-with-a-session">Advanced: Persist action results with a session</h3>
<a class="sl-anchor-link" href="#advanced-persist-action-results-with-a-session"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Advanced: Persist action results with a session”</span></a>
</div> <p><span> <strong>Added in:</strong> <code>astro@5.0.0</code> </span></p> <p>Action results are displayed as a POST submission. This means that the result will be reset to <code dir="auto">undefined</code> when a user closes and revisits the page. The user will also see a “confirm form resubmission?” dialog if they attempt to refresh the page.</p> <p>To customize this behavior, you can add middleware to handle the result of the action manually. You may choose to persist the action result using a cookie or session storage.</p> <p>Start by <a href="../middleware/index">creating a middleware file</a> and importing <a href="../../reference/modules/astro-actions/index#getactioncontext">the <code dir="auto">getActionContext()</code> utility</a> from <code dir="auto">astro:actions</code>. This function returns an <code dir="auto">action</code> object with information about the incoming action request, including the action handler and whether the action was called from an HTML form. <code dir="auto">getActionContext()</code> also returns the <code dir="auto">setActionResult()</code> and <code dir="auto">serializeActionResult()</code> functions to programmatically set the value returned by <code dir="auto">Astro.getActionResult()</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/middleware.ts</span></div>
<pre data-language="ts">import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';


export const onRequest = defineMiddleware(async (context, next) =&gt; {
  const { action, setActionResult, serializeActionResult } = getActionContext(context);
  if (action?.calledFrom === 'form') {
    const result = await action.handler();
    // ... handle the action result
    setActionResult(action.name, serializeActionResult(result));
  }
  return next();
});</pre>

</div> <p>A common practice to persist HTML form results is the <a href="https://en.wikipedia.org/wiki/Post/Redirect/Get">POST / Redirect / GET pattern</a>. This redirect removes the “confirm form resubmission?” dialog when the page is refreshed, and allows action results to be persisted throughout the user’s session.</p> <p>This example applies the POST / Redirect / GET pattern to all form submissions using session storage with the <a href="../integrations-guide/netlify/index">Netlify server adapter</a> installed. Action results are written to a session store using <a href="https://docs.netlify.com/blobs/overview/">Netlify Blob</a>, and retrieved after a redirect using a session ID:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/middleware.ts</span></div>
<pre data-language="ts">import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';
import { randomUUID } from "node:crypto";
import { getStore } from "@netlify/blobs";


export const onRequest = defineMiddleware(async (context, next) =&gt; {
  // Skip requests for prerendered pages
  if (context.isPrerendered) return next();


  const { action, setActionResult, serializeActionResult } =
    getActionContext(context);
  // Create a Blob store to persist action results with Netlify Blob
  const actionStore = getStore("action-session");


  // If an action result was forwarded as a cookie, set the result
  // to be accessible from `Astro.getActionResult()`
  const sessionId = context.cookies.get("action-session-id")?.value;
  const session = sessionId
    ? await actionStore.get(sessionId, {
        type: "json",
      })
    : undefined;


  if (session) {
    setActionResult(session.actionName, session.actionResult);


    // Optional: delete the session after the page is rendered.
    // Feel free to implement your own persistence strategy
    await actionStore.delete(sessionId);
    context.cookies.delete("action-session-id");
    return next();
  }


  // If an action was called from an HTML form action,
  // call the action handler and redirect to the destination page
  if (action?.calledFrom === "form") {
    const actionResult = await action.handler();


    // Persist the action result using session storage
    const sessionId = randomUUID();
    await actionStore.setJSON(sessionId, {
      actionName: action.name,
      actionResult: serializeActionResult(actionResult),
    });


    // Pass the session ID as a cookie
    // to be retrieved after redirecting to the page
    context.cookies.set("action-session-id", sessionId);


    // Redirect back to the previous page on error
    if (actionResult.error) {
      const referer = context.request.headers.get("Referer");
      if (!referer) {
        throw new Error(
          "Internal: Referer unexpectedly missing from Action POST request.",
        );
      }
      return context.redirect(referer);
    }
    // Redirect to the destination page on success
    return context.redirect(context.originPathname);
  }


  return next();
});</pre>

</div> <div class="sl-heading-wrapper level-h2">
<h2 id="security-when-using-actions">Security when using actions</h2>
<a class="sl-anchor-link" href="#security-when-using-actions"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Security when using actions”</span></a>
</div> <p>Actions are accessible as public endpoints based on the name of the action. For example, the action <code dir="auto">blog.like()</code> will be accessible from <code dir="auto">/_actions/blog.like</code>. This is useful for unit testing action results and debugging production errors. However, this means you <strong>must</strong> use same authorization checks that you would consider for API endpoints and on-demand rendered pages.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="authorize-users-from-an-action-handler">Authorize users from an action handler</h3>
<a class="sl-anchor-link" href="#authorize-users-from-an-action-handler"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Authorize users from an action handler”</span></a>
</div> <p>To authorize action requests, add an authentication check to your action handler. You may want to use <a href="../authentication/index">an authentication library</a> to handle session management and user information.</p> <p>Actions expose <a href="../../reference/modules/astro-actions/index#actionapicontext">a subset of the <code dir="auto">APIContext</code> object</a> to access properties passed from middleware using <code dir="auto">context.locals</code>. When a user is not authorized, you can raise an <code dir="auto">ActionError</code> with the <code dir="auto">UNAUTHORIZED</code> code:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { defineAction, ActionError } from 'astro:actions';


export const server = {
  getUserSettings: defineAction({
    handler: async (_input, context) =&gt; {
      if (!context.locals.user) {
        throw new ActionError({ code: 'UNAUTHORIZED' });
      }
      return { /* data on success */ };
    }
  })
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="gate-actions-from-middleware">Gate actions from middleware</h3>
<a class="sl-anchor-link" href="#gate-actions-from-middleware"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Gate actions from middleware”</span></a>
</div> <p><span> <strong>Added in:</strong> <code>astro@5.0.0</code> </span></p> <p>Astro recommends authorizing user sessions from your action handler to respect permission levels and rate-limiting on a per-action basis. However, you can also gate requests to all actions (or a subset of actions) from middleware.</p> <p>Use the <a href="../../reference/modules/astro-actions/index#getactioncontext"><code dir="auto">getActionContext()</code> function</a> from your middleware to retrieve information about any inbound action requests. This includes the action name and whether that action was called using a client-side remote procedure call (RPC) function (e.g. <code dir="auto">actions.blog.like()</code>) or an HTML form.</p> <p>The following example rejects all action requests that do not have a valid session token. If the check fails, a “Forbidden” response is returned. Note: this method ensures that actions are only accessible when a session is present, but is <em>not</em> a substitute for secure authorization.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/middleware.ts</span></div>
<pre data-language="ts">import { defineMiddleware } from 'astro:middleware';
import { getActionContext } from 'astro:actions';


export const onRequest = defineMiddleware(async (context, next) =&gt; {
  const { action } = getActionContext(context);
  // Check if the action was called from a client-side function
  if (action?.calledFrom === 'rpc') {
    // If so, check for a user session token
    if (!context.cookies.has('user-session')) {
      return new Response('Forbidden', { status: 403 });
    }
  }


  context.cookies.set('user-session', /* session token */);
  return next();
});</pre>

</div> <div class="sl-heading-wrapper level-h2">
<h2 id="call-actions-from-astro-components-and-server-endpoints">Call actions from Astro components and server endpoints</h2>
<a class="sl-anchor-link" href="#call-actions-from-astro-components-and-server-endpoints"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Call actions from Astro components and server endpoints”</span></a>
</div> <p>You can call actions directly from Astro component scripts using the <code dir="auto">Astro.callAction()</code> wrapper (or <code dir="auto">context.callAction()</code> when using a <a href="../endpoints/index#server-endpoints-api-routes">server endpoint</a>). This is common to reuse logic from your actions in other server code.</p> <p>Pass the action as the first argument and any input parameters as the second argument. This returns the same <code dir="auto">data</code> and <code dir="auto">error</code> objects you receive when calling actions on the client:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/products.astro</span></div>
<pre data-language="astro">---
import { actions } from 'astro:actions';


const searchQuery = Astro.url.searchParams.get('search');
if (searchQuery) {
  const { data, error } = await Astro.callAction(actions.findProduct, { query: searchQuery });
  // handle result
}
---</pre>

</div> <span id="docsearch-lvl0" hidden>Learn</span> </div> <div class="hide-when-toc-is-visible astro-o5o7wsh2"> <div class="container astro-zwxhm4ix" lang="en" dir="ltr" data-algolia-exclude> <aside aria-labelledby="learn-astro-course-1" class="astro-zwxhm4ix"> <div class="graphics astro-zwxhm4ix"> <img src="data:image/webp;base64,UklGRuQBAABXRUJQVlA4WAoAAAAQAAAARwAARwAAQUxQSBIAAAABD9D/iAgICRKm+z+aIvqfLgxWUDggrAEAANANAJ0BKkgASAA+bSyQRiQvI6EwtOwB4A2JYwDG7ApEmQTzrdjsTkQzIBD+xzUh0lK3EX6+lo0SCwRPGsgIGouWHJ2/nnSC9HGXEl2gpNNAYWRIW6VJ/K32YOrQKSEuKouno9R49M0eHE5iXb3aonSnft3gbtsAAP7w1R/RCOMR3YSO8dX6PK4mdXb+xC9xMW1jRYuDmnAY9270+m9BomJwqQ3dS4e/wb3PBG6f3XR0+vwd1aCpD6/39Q3FfzrpzNkiA3GXnChlpsJimbR9u+t3F/W1NvSBwbqU3GLXZQFNLWH1SKzuq+KfhFypeOnfRiBH6+kzyNj+Sr84yQmVvisMqHD24nmzW7XfBHlC2NvstZ+VChFGkasDLlfX5EEomwykq/uSu9zggr/z8g984C2ffX5fZWkhLaquVhVD5XOLiMnVhGhSt/hiuogfyH0+d8eN1XWUESYvySWIQRk4O3AgPqjYBgx/FfSWMMt/q8FCgeKPiFzuTksEY6gSwOPtQlvtY8Hzpb30kv5b6/8GtspkOOxWaYugHtREhWXRs0GNMszhFvbgbNIQ3gAA" alt="Scrimba" loading="lazy" decoding="async" fetchpriority="auto" width="72" height="72" class="scrimba-bubble astro-zwxhm4ix"> <img src="data:image/webp;base64,UklGRvoDAABXRUJQVlA4IO4DAAAwEwCdASpIAEgAPmkskkWkIqGY/AV0QAaEoAw21BVt60ZuePWKZ7zbq872zZ/BpVOcprJG6rUF6VCYw1xb+cknsA2zq7LlFTOPhOQtATm7HQCmwZKYCP2/dKDnOQt7NjOTAyXsaLlh+zawtCgXbADYXiJ78rCNCSRmA0/LsXRb2sQPi+1njYrG+r/+veKiFtqbnBkd8NcaO7yBLmepdcRhtsAA/vI7s9UG/cHtR7mErbfZieOcsg2DNyNpmynibwMFtVQef5zaA7TMoJGeF8ZOcgdG8Er7tclM1e6nPNHl69JJXCAPZvnxCxpO2uTtDJrodA26cvmxQQRG1osnWaQL8gzEfbb9AymNt0YwkidzbpO68jtwhcVB/Khj7HiXSxGx8URFmy2UtH8+xdlks6V8fP0pT6zmOMagal1b9Jf762OX75NigFcpE9SWLHPhSly+paFUghIpZd7ss4todtwb6mRTt9gLt12PZuOYcmgID8tePqFSru9ZkPVhc5jgFSDU1WaHvTxmRlqcsvuDwfCy7z357VyaavcFutcm7Nep/gdnZzsOn8I+eCrn8bvqakVt5w04DvVvqXoUkKOrw5DPMJrSR812/a6uheTmYgQMvhX7B4hIauWJp4kGPY+WS80BIeWjCAJmOgcjGATirHcyVBl5FsqjCDEUuEiPJdDgAeLvOiPdfRO4fsJd59FulhfX7OfqSz+wwD4sX6CG+7ByT5TVKoiE2jP5MNDz0yzDYuFsA7FNW8nV/U7qJAjgunKSmMMWnmN0U9/9qgYf3s1DilDDsu+FRNKwbHBXxslf6FzG3Rrc3zDAFJ+NsdudY4oHjnczojMc3supGmXFnQsfGZCHPQxn40mO9HsI1oKHH4RJ/dXss6sljuPOmx8YmrGlqBkpnmskLUM2j8p+6kMkCyYyhu+kAtDc8dCxhqbYn8yxHrGePRLyWeYzHj5qloBC+QY3fxoUYTfrSI2ZRGJ8EFp87vEPa+79jTG6fhKPVFxXq388UgLsm2KMRsa0wDXZUXSj4J7qzc7639E9TbdX8i7vu2zlw/4Innob9+Q+He4ic1y7Cw9V4TaFGAHKYJA3Ehpxob31bguhmHdlSkl0dHBTGk/LVrpMowPKfHj2cKw9XsJH7mMS0N1q1vOM4izTLT2AZtLzEfoUDe0qanVJpROTrsm/xrv9H0nzqX3eGHloUpwYGI770bMf3EnYYxl90jeYEdq8PiuFqEbpZDGDEP7j40ukUnQvULXa9UmRGSEIbov/GuSB7ne4hikpbd+KINukzOFouwlpM787dgH6+Ur8DqoBunjMA2wARrTdAi1rbnQAoKiCqw4YAAAA" alt loading="lazy" decoding="async" fetchpriority="auto" width="72" height="72" class="astro-zwxhm4ix"> </div> <h2 id="learn-astro-course-1" class="astro-zwxhm4ix"> <strong class="astro-zwxhm4ix">Learn Astro</strong> with James Q Quick </h2> <p class="astro-zwxhm4ix">Build your first site with 35 interactive Scrimba lessons</p> <a class="sl-link-button not-content primary cta astro-zwxhm4ix astro-n3qr5j5k" href="https://scrimba.com/intro-to-astro-c00ar0fi5u?via=astro" data-scrimba-cta="true"> Get 20% off </a> </aside> </div>  </div>   </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/guides/actions/" class="_attribution-link">https://docs.astro.build/en/guides/actions/</a>
  </p>
</div>
