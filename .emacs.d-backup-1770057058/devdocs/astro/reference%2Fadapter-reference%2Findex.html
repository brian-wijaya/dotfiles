<h1 id="_top" class="astro-62i6xxx4">Astro Adapter API</h1> <div class="content-panel astro-2mug3n2c"> <div class="sl-container astro-2mug3n2c"> <div class="sl-markdown-content"> <p>Astro is designed to make it easy to deploy to any cloud provider for on-demand rendering, also known as server-side rendering (SSR). This ability is provided by <strong>adapters</strong>, which are <a href="../integrations-reference/index">integrations</a>. See the <a href="../../guides/on-demand-rendering/index">on-demand rendering guide</a> to learn how to use an existing adapter.</p> <div class="sl-heading-wrapper level-h2">
<h2 id="what-is-an-adapter">What is an adapter?</h2>
<a class="sl-anchor-link" href="#what-is-an-adapter"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “What is an adapter?”</span></a>
</div> <p>An adapter is a special kind of <a href="../integrations-reference/index">integration</a> that provides an entrypoint for server rendering at request time. An adapter has access to the full Integration API and does two things:</p> <ul> <li>Implements host-specific APIs for handling requests.</li> <li>Configures the build according to host conventions.</li> </ul> <div class="sl-heading-wrapper level-h2">
<h2 id="building-an-adapter">Building an adapter</h2>
<a class="sl-anchor-link" href="#building-an-adapter"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Building an adapter”</span></a>
</div> <p>Create an integration and call the <code dir="auto">setAdapter()</code> function in the <a href="../integrations-reference/index#astroconfigdone"><code dir="auto">astro:config:done</code></a> hook. This allows you to define a server entrypoint and the features supported by your adapter.</p> <p>The following example creates an adapter with a server entrypoint and stable support for Astro static output:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            staticOutput: 'stable'
          }
        });
      },
    },
  };
}</pre>

</div> <p>The <code dir="auto">setAdapter()</code> function accepts an object containing the following properties:</p> <div class="sl-heading-wrapper level-h3">
<h3 id="name"><code dir="auto">name</code></h3>
<a class="sl-anchor-link" href="#name"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “name”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">string</code></p> <p>Defines a unique name for your adapter. This will be used for logging.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="serverentrypoint"><code dir="auto">serverEntrypoint</code></h3>
<a class="sl-anchor-link" href="#serverentrypoint"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “serverEntrypoint”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">string | URL</code></p> <p>Defines the entrypoint for on-demand rendering.</p> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz">Learn more about <a href="#building-a-server-entrypoint">building a server entrypoint</a>.</span> </div> <div class="sl-heading-wrapper level-h3">
<h3 id="supportedastrofeatures"><code dir="auto">supportedAstroFeatures</code></h3>
<a class="sl-anchor-link" href="#supportedastrofeatures"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “supportedAstroFeatures”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">AstroAdapterFeatureMap</code><br></p>
<span> <strong>Added in:</strong> <code>astro@3.0.0</code> </span> <p>A map of Astro’s built-in features supported by the adapter. This allows Astro to determine which features an adapter supports, so appropriate error messages can be provided.</p> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz">Discover the <a href="#astro-features">available Astro features</a> that an adapter can configure.</span> </div> <div class="sl-heading-wrapper level-h3">
<h3 id="adapterfeatures"><code dir="auto">adapterFeatures</code></h3>
<a class="sl-anchor-link" href="#adapterfeatures"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “adapterFeatures”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">AstroAdapterFeatures</code><br></p>
<span> <strong>Added in:</strong> <code>astro@3.0.0</code> </span> <p>An object that specifies which <a href="#adapter-features">adapter features that change the build output</a> are supported by the adapter.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="args"><code dir="auto">args</code></h3>
<a class="sl-anchor-link" href="#args"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “args”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">any</code></p> <p>A JSON-serializable value that will be passed to the adapter’s server entrypoint at runtime. This is useful to pass an object containing build-time configuration (e.g. paths, secrets) to your server runtime code.</p> <p>The following example defines an <code dir="auto">args</code> object with a property that identifies where assets generated by Astro are located:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          args: {
            assets: config.build.assets
          }
        });
      },
    },
  };
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="client"><code dir="auto">client</code></h3>
<a class="sl-anchor-link" href="#client"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “client”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">{ internalFetchHeaders?: Record&lt;string, string&gt; | () =&gt; Record&lt;string, string&gt;; assetQueryParams?: URLSearchParams; }</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.15.0</code> </span> <p>A configuration object for Astro’s client-side code.</p> <div class="sl-heading-wrapper level-h4">
<h4 id="internalfetchheaders"><code dir="auto">internalFetchHeaders</code></h4>
<a class="sl-anchor-link" href="#internalfetchheaders"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “internalFetchHeaders”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">Record&lt;string, string&gt; | () =&gt; Record&lt;string, string&gt;</code></p> <p>Defines the headers to inject into Astro’s internal fetch calls (e.g. Actions, View Transitions, Server Islands, Prefetch). This can be an object of headers or a function that returns headers.</p> <p>The following example retrieves a <code dir="auto">DEPLOY_ID</code> from the environment variables and, if provided, returns an object with the header name as key and the deploy id as value:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          client: {
            internalFetchHeaders: () =&gt; {
              const deployId = process.env.DEPLOY_ID;
              return deployId ? { 'Your-Header-ID': deployId } : {};
            },
          },
        });
      },
    },
  };
}</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="assetqueryparams"><code dir="auto">assetQueryParams</code></h4>
<a class="sl-anchor-link" href="#assetqueryparams"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “assetQueryParams”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">URLSearchParams</code></p> <p>Defines the query parameters to append to all asset URLs (e.g. images, stylesheets, scripts). This is useful for adapters that need to track deployment versions or other metadata.</p> <p>The following example retrieves a <code dir="auto">DEPLOY_ID</code> from the environment variables and, if provided, returns an object with a custom search parameter name as key and the deploy id as value:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          client: {
            assetQueryParams: process.env.DEPLOY_ID
              ? new URLSearchParams({ yourParam: process.env.DEPLOY_ID })
              : undefined,
          },
        });
      },
    },
  };
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="exports"><code dir="auto">exports</code></h3>
<a class="sl-anchor-link" href="#exports"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “exports”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">string[]</code></p> <p>Defines an array of named exports to use in conjunction with the <a href="#createexports"><code dir="auto">createExports()</code> function</a> of your server entrypoint.</p> <p>The following example assumes that <code dir="auto">createExports()</code> provides an export named <code dir="auto">handler</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          exports: ['handler']
        });
      },
    },
  };
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="previewentrypoint"><code dir="auto">previewEntrypoint</code></h3>
<a class="sl-anchor-link" href="#previewentrypoint"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “previewEntrypoint”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">string | URL</code><br></p>
<span> <strong>Added in:</strong> <code>astro@1.5.0</code> </span> <p>Defines the path or ID of a module in the adapter’s package that is responsible for starting up the built server when <code dir="auto">astro preview</code> is run.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ config, setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          previewEntrypoint: '@example/my-adapter/preview.js',
        });
      },
    },
  };
}</pre>

</div> <div class="sl-heading-wrapper level-h2">
<h2 id="building-a-server-entrypoint">Building a server entrypoint</h2>
<a class="sl-anchor-link" href="#building-a-server-entrypoint"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Building a server entrypoint”</span></a>
</div> <p>You will need to create a file that executes during server-side requests to enable on-demand rendering with your particular host. Astro’s adapter API attempts to work with any type of host and gives a flexible way to conform to the host APIs.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="createexports"><code dir="auto">createExports()</code></h3>
<a class="sl-anchor-link" href="#createexports"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “createExports()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(manifest: SSRManifest, options: any) =&gt; Record&lt;string, any&gt;</code></p> <p>An exported function that takes an SSR manifest as its first argument and an object containing your adapter <a href="#args"><code dir="auto">args</code></a> as its second argument. This should provide the exports required by your host.</p> <p>For example, some serverless hosts expect you to export an <code dir="auto">handler()</code> function. With the adapter API, you achieve this by implementing <code dir="auto">createExports()</code> in your server entrypoint:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter/server.js</span></div>
<pre data-language="js">import { App } from 'astro/app';


export function createExports(manifest) {
  const app = new App(manifest);


  const handler = (event, context) =&gt; {
    // ...
  };


  return { handler };
}</pre>

</div> <p>And then in your integration, where you call <code dir="auto">setAdapter()</code>, provide this name in <a href="#exports"><code dir="auto">exports</code></a>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          exports: ['handler'],
        });
      },
    },
  };
}</pre>

</div> <p>You can access the <a href="#args"><code dir="auto">args</code></a> defined by your adapter through the second argument of <code dir="auto">createExports()</code>. This can be useful when you need to access build-time configuration in your server entrypoint. For example, your server might need to identify where assets generated by Astro are located:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter/server.js</span></div>
<pre data-language="js">import { App } from 'astro/app';


export function createExports(manifest, args) {
  const assetsPath = args.assets;


  const handler = (event, context) =&gt; {
    // ...
  };


  return { handler };
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="start"><code dir="auto">start()</code></h3>
<a class="sl-anchor-link" href="#start"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “start()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(manifest: SSRManifest, options: any) =&gt; Record&lt;string, any&gt;</code></p> <p>An exported function that takes an SSR manifest as its first argument and an object containing your adapter <a href="#args"><code dir="auto">args</code></a> as its second argument.</p> <p>Some hosts expect you to <em>start</em> the server yourselves, for example, by listening to a port. For these types of hosts, the adapter API allows you to export a <code dir="auto">start()</code> function, which will be called when the bundle script is run.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter/server.js</span></div>
<pre data-language="js">import { App } from 'astro/app';


export function start(manifest) {
  const app = new App(manifest);


  addEventListener('fetch', event =&gt; {
    // ...
  });
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="astroapp"><code dir="auto">astro/app</code></h3>
<a class="sl-anchor-link" href="#astroapp"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “astro/app”</span></a>
</div> <p>This module is used for rendering pages that have been prebuilt through <code dir="auto">astro build</code>. Astro uses the standard <a href="https://developer.mozilla.org/en-US/docs/Web/API/Request"><code dir="auto">Request</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response"><code dir="auto">Response</code></a> objects. Hosts that have a different API for request/response should convert to these types in their adapter.</p> <p>The <code dir="auto">App</code> constructor accepts a required SSR manifest argument, and optionally an argument to enable or disable streaming, defaulting to <code dir="auto">true</code>.</p> <div class="expressive-code">

<pre data-language="js">import { App } from 'astro/app';
import http from 'http';


export function start(manifest) {
  const app = new App(manifest);


  addEventListener('fetch', event =&gt; {
    event.respondWith(
      app.render(event.request)
    );
  });
}</pre>

</div> <p>The following methods are provided:</p> <div class="sl-heading-wrapper level-h4">
<h4 id="apprender"><code dir="auto">app.render()</code></h4>
<a class="sl-anchor-link" href="#apprender"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “app.render()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(request: Request, options?: RenderOptions) =&gt; Promise&lt;Response&gt;</code></p> <p>A method that accepts a required <code dir="auto">request</code> argument and an optional <code dir="auto">RenderOptions</code> object. This calls the Astro page that matches the request, renders it, and returns a promise to a <a href="https://developer.mozilla.org/en-US/docs/Web/API/Response"><code dir="auto">Response</code></a> object. This also works for API routes that do not render pages.</p> <div class="expressive-code">

<pre data-language="js">const response = await app.render(request);</pre>

</div> <div class="sl-heading-wrapper level-h5">
<h5 id="renderoptions"><code dir="auto">RenderOptions</code></h5>
<a class="sl-anchor-link" href="#renderoptions"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “RenderOptions”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">{addCookieHeader?: boolean; clientAddress?: string; locals?: object; prerenderedErrorPageFetch?: (url: ErrorPagePath) =&gt; Promise&lt;Response&gt;; routeData?: RouteData;}</code></p> <p>An object that controls the rendering and contains the following properties:</p> <div class="sl-heading-wrapper level-h6">
<h6 id="addcookieheader"><code dir="auto">addCookieHeader</code></h6>
<a class="sl-anchor-link" href="#addcookieheader"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “addCookieHeader”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">boolean</code><br> <strong>Default:</strong> <code dir="auto">false</code></p> <p>Whether or not to automatically add all cookies written by <code dir="auto">Astro.cookie.set()</code> to the response headers.</p> <p>When set to <code dir="auto">true</code>, they will be added to the <code dir="auto">Set-Cookie</code> header of the response as comma-separated key-value pairs. You can use the standard <code dir="auto">response.headers.getSetCookie()</code> API to read them individually. When set to <code dir="auto">false</code>(default), the cookies will only be available from <a href="#appgetsetcookiefromresponse"><code dir="auto">App.getSetCookieFromResponse(response)</code></a>.</p> <div class="expressive-code">

<pre data-language="js">const response = await app.render(request, { addCookieHeader: true });</pre>

</div> <div class="sl-heading-wrapper level-h6">
<h6 id="clientaddress"><code dir="auto">clientAddress</code></h6>
<a class="sl-anchor-link" href="#clientaddress"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “clientAddress”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">string</code><br> <strong>Default:</strong> <code dir="auto">request[Symbol.for("astro.clientAddress")]</code></p> <p>The client IP address that will be made available as <a href="../api-reference/index#clientaddress"><code dir="auto">Astro.clientAddress</code></a> in pages, and as <code dir="auto">ctx.clientAddress</code> in API routes and middleware.</p> <p>The example below reads the <code dir="auto">x-forwarded-for</code> header and passes it as <code dir="auto">clientAddress</code>. This value becomes available to the user as <code dir="auto">Astro.clientAddress</code>.</p> <div class="expressive-code">

<pre data-language="js">const clientAddress = request.headers.get("x-forwarded-for");
const response = await app.render(request, { clientAddress });</pre>

</div> <div class="sl-heading-wrapper level-h6">
<h6 id="locals"><code dir="auto">locals</code></h6>
<a class="sl-anchor-link" href="#locals"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “locals”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">object</code></p> <p>The <a href="../api-reference/index#locals"><code dir="auto">context.locals</code> object</a> used to store and access information during the lifecycle of a request.</p> <p>The example below reads a header named <code dir="auto">x-private-header</code>, attempts to parse it as an object and pass it to <code dir="auto">locals</code>, which can then be passed to any <a href="../../guides/middleware/index">middleware function</a>.</p> <div class="expressive-code">

<pre data-language="js">const privateHeader = request.headers.get("x-private-header");
let locals = {};
try {
  if (privateHeader) {
    locals = JSON.parse(privateHeader);
  }
} finally {
  const response = await app.render(request, { locals });
}</pre>

</div> <div class="sl-heading-wrapper level-h6">
<h6 id="prerenderederrorpagefetch"><code dir="auto">prerenderedErrorPageFetch()</code></h6>
<a class="sl-anchor-link" href="#prerenderederrorpagefetch"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “prerenderedErrorPageFetch()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(url: ErrorPagePath) =&gt; Promise&lt;Response&gt;</code><br> <strong>Default:</strong> <code dir="auto">fetch</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.6.0</code> </span> <p>A function that allows you to provide custom implementations for fetching prerendered error pages.</p> <p>This is used to override the default <code dir="auto">fetch()</code> behavior, for example, when <code dir="auto">fetch()</code> is unavailable or when you cannot call the server from itself.</p> <p>The following example reads <code dir="auto">500.html</code> and <code dir="auto">404.html</code> from disk instead of performing an HTTP call:</p> <div class="expressive-code">

<pre data-language="ts">return app.render(request, {
  prerenderedErrorPageFetch: async (url: string): Promise&lt;Response&gt; =&gt; {
    if (url.includes("/500")) {
      const content = await fs.promises.readFile("500.html", "utf-8");
      return new Response(content, {
        status: 500,
        headers: { "Content-Type": "text/html" },
      });
    }


    const content = await fs.promises.readFile("404.html", "utf-8");
    return new Response(content, {
      status: 404,
      headers: { "Content-Type": "text/html" },
    });
  }
});</pre>

</div> <p>If not provided, Astro will fallback to its default behavior for fetching error pages.</p> <div class="sl-heading-wrapper level-h6">
<h6 id="routedata"><code dir="auto">routeData</code></h6>
<a class="sl-anchor-link" href="#routedata"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “routeData”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">RouteData</code><br> <strong>Default:</strong> <code dir="auto">app.match(request)</code></p> <p>Provides a value for <a href="../integrations-reference/index#integrationroutedata-type-reference"><code dir="auto">integrationRouteData</code></a> if you already know the route to render. Doing so will bypass the internal call to <a href="#appmatch"><code dir="auto">app.match()</code></a> to determine the route to render.</p> <div class="expressive-code">

<pre data-language="js">const routeData = app.match(request);
if (routeData) {
  return app.render(request, { routeData });
} else {
  /* adapter-specific 404 response */
  return new Response(..., { status: 404 });
}</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="appmatch"><code dir="auto">app.match()</code></h4>
<a class="sl-anchor-link" href="#appmatch"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “app.match()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(request: Request, allowPrerenderedRoutes = false) =&gt; RouteData | undefined</code></p> <p>Determines if a request is matched by the Astro app’s routing rules.</p> <div class="expressive-code">

<pre data-language="js">if(app.match(request)) {
  const response = await app.render(request);
}</pre>

</div> <p>You can usually call <code dir="auto">app.render(request)</code> without using <code dir="auto">.match</code> because Astro handles 404s if you provide a <code dir="auto">404.astro</code> file. Use <code dir="auto">app.match(request)</code> if you want to handle 404s in a different way.</p> <p>By default, prerendered routes aren’t returned, even if they are matched. You can change this behavior by using <code dir="auto">true</code> as the second argument.</p> <div class="sl-heading-wrapper level-h4">
<h4 id="appgetadapterlogger"><code dir="auto">app.getAdapterLogger()</code></h4>
<a class="sl-anchor-link" href="#appgetadapterlogger"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “app.getAdapterLogger()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">() =&gt; AstroIntegrationLogger</code><br></p>
<span> <strong>Added in:</strong> <code>astro@v3.0.0</code> </span> <p>Returns an <a href="../integrations-reference/index#astrointegrationlogger">instance of the Astro logger</a> available to the adapter’s runtime environment.</p> <div class="expressive-code">

<pre data-language="js">const logger = app.getAdapterLogger();
try {
  /* Some logic that can throw */
} catch {
  logger.error("Your custom error message using Astro logger.");
}</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="appgetalloweddomains"><code dir="auto">app.getAllowedDomains()</code></h4>
<a class="sl-anchor-link" href="#appgetalloweddomains"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “app.getAllowedDomains()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">() =&gt; Partial&lt;RemotePattern&gt;[] | undefined</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.14.2</code> </span> <p>Returns a list of permitted host patterns for incoming requests when using on-demand rendering <a href="../configuration-reference/index#securityalloweddomains">as defined in the user configuration</a>.</p> <div class="sl-heading-wrapper level-h4">
<h4 id="appremovebase"><code dir="auto">app.removeBase()</code></h4>
<a class="sl-anchor-link" href="#appremovebase"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “app.removeBase()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(pathname: string) =&gt; string</code><br></p>
<span> <strong>Added in:</strong> <code>astro@1.6.4</code> </span> <p>Removes the base from the given path. This is useful when you need to look up assets from the filesystem.</p> <div class="sl-heading-wrapper level-h4">
<h4 id="appsetcookieheaders"><code dir="auto">app.setCookieHeaders()</code></h4>
<a class="sl-anchor-link" href="#appsetcookieheaders"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “app.setCookieHeaders()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(response: Response) =&gt; Generator&lt;string, string[], any&gt;</code><br></p>
<span> <strong>Added in:</strong> <code>astro@1.4.0</code> </span> <p>Returns a generator that yields individual cookie header values from a <code dir="auto">Response</code> object. This is used to properly handle multiple cookies that may have been set during request processing.</p> <p>The following example appends a <code dir="auto">Set-Cookie</code> header for each header obtained from a response:</p> <div class="expressive-code">

<pre data-language="js">for (const setCookieHeader of app.setCookieHeaders(response)) {
  response.headers.append('Set-Cookie', setCookieHeader);
}</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="appgetsetcookiefromresponse"><code dir="auto">App.getSetCookieFromResponse()</code></h4>
<a class="sl-anchor-link" href="#appgetsetcookiefromresponse"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “App.getSetCookieFromResponse()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(response: Response) =&gt; Generator&lt;string, string[]&gt;</code><br></p>
<span> <strong>Added in:</strong> <code>astro@4.2.0</code> </span> <p>Returns a generator that yields individual cookie header values from a <code dir="auto">Response</code> object. This works in the same way as <a href="#appsetcookieheaders"><code dir="auto">app.setCookieHeaders()</code></a>, but can be used at any time as it is a static method.</p> <p>The following example appends a <code dir="auto">Set-Cookie</code> header for each header obtained from a response:</p> <div class="expressive-code">

<pre data-language="js">for (const cookie of App.getSetCookieFromResponse(response)) {
  response.headers.append('Set-Cookie', cookie);
}</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="appvalidateforwardedhost"><code dir="auto">App.validateForwardedHost()</code></h4>
<a class="sl-anchor-link" href="#appvalidateforwardedhost"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “App.validateForwardedHost()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(forwardedHost: string, allowedDomains?: Partial&lt;RemotePattern&gt;[], protocol?: string = 'https') =&gt; boolean</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.14.2</code> </span> <p>Checks whether a <code dir="auto">forwardedHost</code> matches any of the given <a href="../configuration-reference/index#securityalloweddomains"><code dir="auto">allowedDomains</code></a>. This static method accepts a third argument that allows you to override the host protocol, defaulting to <code dir="auto">https</code>.</p> <p>The following example retrieves the <code dir="auto">forwardedHost</code> from the headers and checks if the host matches an allowed domain:</p> <div class="expressive-code">

<pre data-language="js">export function start(manifest) {
  addEventListener('fetch', (event) =&gt; {
    const forwardedHost = event.request.headers.get('X-Forwarded-Host');
    if (App.validateForwardedHost(forwardedHost, manifest.allowedDomains)) {
      /* do something */
    }
  });
}</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="appsanitizehost"><code dir="auto">App.sanitizeHost()</code></h4>
<a class="sl-anchor-link" href="#appsanitizehost"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “App.sanitizeHost()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(hostname: string | undefined) =&gt; string | undefined</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.15.5</code> </span> <p>Validates a hostname by rejecting any name containing path separators. When a hostname is invalid, this static method will return <code dir="auto">undefined</code>.</p> <p>The following example retrieves the <code dir="auto">forwardedHost</code> from the headers and sanitizes it:</p> <div class="expressive-code">

<pre data-language="js">export function start(manifest) {
  addEventListener('fetch', (event) =&gt; {
    const forwardedHost = event.request.headers.get('X-Forwarded-Host');
    const sanitized = App.sanitizeHost(forwardedHost);
  });
}</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="appvalidateforwardedheaders"><code dir="auto">App.validateForwardedHeaders()</code></h4>
<a class="sl-anchor-link" href="#appvalidateforwardedheaders"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “App.validateForwardedHeaders()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(forwardedProtocol?: string, forwardedHost?: string, forwardedPort?: string, allowedDomains?: Partial&lt;RemotePattern&gt;[]) =&gt; { protocol?: string; host?: string; port?: string }</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.15.5</code> </span> <p>Validates the forwarded protocol, host, and port against the <code dir="auto">allowedDomains</code>. This static method returns validated values or <code dir="auto">undefined</code> for rejected headers.</p> <p>The following example validates the forwarded headers against the authorized domains defined in the received manifest:</p> <div class="expressive-code">

<pre data-language="js">export function start(manifest) {
  addEventListener('fetch', (event) =&gt; {
    const validated = App.validateForwardedHeaders(
      request.headers.get('X-Forwarded-Proto') ?? undefined,
      request.headers.get('X-Forwarded-Host') ?? undefined,
      request.headers.get('X-Forwarded-Port') ?? undefined,
      manifest.allowedDomains,
    );
  });
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="astroappnode"><code dir="auto">astro/app/node</code></h3>
<a class="sl-anchor-link" href="#astroappnode"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “astro/app/node”</span></a>
</div> <p>Just like <a href="#astroapp"><code dir="auto">astro/app</code></a>, this module is used for rendering pages that have been prebuilt through <code dir="auto">astro build</code>. This allows you to create a <code dir="auto">NodeApp</code> providing all the methods available from <code dir="auto">App</code> and additional methods useful for Node environments.</p> <p>The <code dir="auto">NodeApp</code> constructor accepts a required SSR manifest argument, and optionally an argument to enable or disable streaming, defaulting to <code dir="auto">true</code>.</p> <div class="expressive-code">

<pre data-language="js">import { NodeApp } from 'astro/app/node';
import http from 'http';


export function start(manifest) {
  const nodeApp = new NodeApp(manifest);


  addEventListener('fetch', event =&gt; {
    event.respondWith(
      nodeApp.render(event.request)
    );
  });
}</pre>

</div> <p>The following additional methods are provided:</p> <div class="sl-heading-wrapper level-h4">
<h4 id="nodeapprender"><code dir="auto">nodeApp.render()</code></h4>
<a class="sl-anchor-link" href="#nodeapprender"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “nodeApp.render()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(request: NodeRequest | Request, options?: RenderOptions) =&gt; Promise&lt;Response&gt;</code><br></p>
<span> <strong>Added in:</strong> <code>astro@4.0.0</code> </span> <p>Extends <a href="#apprender"><code dir="auto">app.render()</code></a> to also accept <a href="https://nodejs.org/api/http.html#class-httpincomingmessage">Node.js <code dir="auto">IncomingMessage</code></a> objects in addition to standard <code dir="auto">Request</code> objects as the first argument. The second argument is an optional object allowing you to <a href="#renderoptions">control the rendering</a>.</p> <div class="expressive-code">

<pre data-language="js">const response = await nodeApp.render(request);</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="nodeappmatch"><code dir="auto">nodeApp.match()</code></h4>
<a class="sl-anchor-link" href="#nodeappmatch"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “nodeApp.match()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(req: NodeRequest | Request, allowPrerenderedRoutes?: boolean) =&gt; RouteData | undefined</code></p> <p>Extends <a href="#appmatch"><code dir="auto">app.match()</code></a> to also accept <a href="https://nodejs.org/api/http.html#class-httpincomingmessage">Node.js <code dir="auto">IncomingMessage</code></a> objects in addition to standard <code dir="auto">Request</code> objects.</p> <div class="expressive-code">

<pre data-language="js">if(nodeApp.match(request)) {
  const response = await nodeApp.render(request);
}</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="nodeappheadersmap"><code dir="auto">nodeApp.headersMap</code></h4>
<a class="sl-anchor-link" href="#nodeappheadersmap"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “nodeApp.headersMap”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">NodeAppHeadersJson | undefined</code><br> <strong>Default:</strong> <code dir="auto">undefined</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.11.0</code> </span> <p>An array containing the headers configuration. Each entry maps a pathname to a list of headers that should be applied for that route. This is useful for applying headers such as CSP directives to prerendered routes.</p> <div class="sl-heading-wrapper level-h4">
<h4 id="nodeappsetheadersmap"><code dir="auto">nodeApp.setHeadersMap()</code></h4>
<a class="sl-anchor-link" href="#nodeappsetheadersmap"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “nodeApp.setHeadersMap()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(headers: NodeAppHeadersJson) =&gt; void</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.11.0</code> </span> <p>Loads <a href="#nodeappheadersmap">headers configuration</a> into the <code dir="auto">NodeApp</code> instance.</p> <div class="expressive-code">

<pre data-language="js">nodeApp.setHeadersMap([
  {
    pathname: "/blog",
    headers: [
      { key: "Content-Security-Policy", value: "default-src 'self'" },
    ]
  }
]);</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="nodeappcreaterequest"><code dir="auto">NodeApp.createRequest()</code></h4>
<a class="sl-anchor-link" href="#nodeappcreaterequest"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “NodeApp.createRequest()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(req: NodeRequest, options?: { skipBody?: boolean; allowedDomains?: Partial&lt;RemotePattern&gt;[]; }) =&gt; Request</code><br></p>
<span> <strong>Added in:</strong> <code>astro@4.2.0</code> </span> <p>Converts a NodeJS <code dir="auto">IncomingMessage</code> into a standard <code dir="auto">Request</code> object. This static method accepts an optional object as the second argument, allowing you to define if the body should be ignored, defaulting to <code dir="auto">false</code>, and the <a href="../configuration-reference/index#securityalloweddomains"><code dir="auto">allowedDomains</code></a>.</p> <p>The following example creates a <code dir="auto">Request</code> and passes it to <code dir="auto">app.render()</code>:</p> <div class="expressive-code">

<pre data-language="js">import { NodeApp } from 'astro/app/node';
import { createServer } from 'node:http';


const server = createServer(async (req, res) =&gt; {
  const request = NodeApp.createRequest(req);
  const response = await app.render(request);
})</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="nodeappwriteresponse"><code dir="auto">NodeApp.writeResponse()</code></h4>
<a class="sl-anchor-link" href="#nodeappwriteresponse"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “NodeApp.writeResponse()”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">(source: Response, destination: ServerResponse) =&gt; Promise&lt;ServerResponse&lt;IncomingMessage&gt; | undefined&gt;</code><br></p>
<span> <strong>Added in:</strong> <code>astro@4.2.0</code> </span> <p>Streams a web-standard <code dir="auto">Response</code> into a NodeJS server response. This static method takes a <code dir="auto">Response</code> object and the initial <code dir="auto">ServerResponse</code> before returning a promise of a <code dir="auto">ServerResponse</code> object.</p> <p>The following example creates a <code dir="auto">Request</code>, passes it to <code dir="auto">app.render()</code>, and writes the response:</p> <div class="expressive-code">

<pre data-language="js">import { NodeApp } from 'astro/app/node';
import { createServer } from 'node:http';


const server = createServer(async (req, res) =&gt; {
  const request = NodeApp.createRequest(req);
  const response = await app.render(request);
  await NodeApp.writeResponse(response, res);
})</pre>

</div> <div class="sl-heading-wrapper level-h2">
<h2 id="astro-features">Astro features</h2>
<a class="sl-anchor-link" href="#astro-features"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Astro features”</span></a>
</div> <p>Astro features are a way for an adapter to tell Astro whether they are able to support a feature, and also the adapter’s level of support.</p> <p>When using these properties, Astro will:</p> <ul> <li>run specific validation;</li> <li>emit contextual information to the logs;</li> </ul> <p>These operations are run based on the features supported or not supported, their level of support, the <a href="#suppress">desired amount of logging</a>, and the user’s own configuration.</p> <p>The following configuration tells Astro that this adapter has experimental support for the Sharp-powered built-in image service:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            sharpImageService: 'experimental'
          }
        });
      },
    },
  };
}</pre>

</div> <p>If the Sharp image service is used, Astro will log a warning and error to the terminal based on your adapter’s support:</p> <div class="expressive-code">

<pre data-language="plaintext">[@example/my-adapter] The feature is experimental and subject to issues or changes.


[@example/my-adapter] The currently selected adapter `@example/my-adapter` is not compatible with the service "Sharp". Your project will NOT be able to build.</pre>

</div> <p>A message can additionally be provided to give more context to the user:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            sharpImageService: {
              support: 'limited',
              message: 'This adapter has limited support for Sharp. Certain features may not work as expected.'
            }
          }
        });
      },
    },
  };
}</pre>

</div> <p>This object contains the following configurable features:</p> <div class="sl-heading-wrapper level-h3">
<h3 id="staticoutput"><code dir="auto">staticOutput</code></h3>
<a class="sl-anchor-link" href="#staticoutput"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “staticOutput”</span></a>
</div> 
<p><strong>Type:</strong> <a href="#adaptersupport"><code dir="auto">AdapterSupport</code></a></p> <p>Defines whether the adapter is able to serve static pages.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="hybridoutput"><code dir="auto">hybridOutput</code></h3>
<a class="sl-anchor-link" href="#hybridoutput"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “hybridOutput”</span></a>
</div> 
<p><strong>Type:</strong> <a href="#adaptersupport"><code dir="auto">AdapterSupport</code></a></p> <p>Defines whether the adapter is able to serve sites that include a mix of static and on-demand rendered pages.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="serveroutput"><code dir="auto">serverOutput</code></h3>
<a class="sl-anchor-link" href="#serveroutput"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “serverOutput”</span></a>
</div> 
<p><strong>Type:</strong> <a href="#adaptersupport"><code dir="auto">AdapterSupport</code></a></p> <p>Defines whether the adapter is able to serve on-demand rendered pages.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="i18ndomains"><code dir="auto">i18nDomains</code></h3>
<a class="sl-anchor-link" href="#i18ndomains"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “i18nDomains”</span></a>
</div> 
<p><strong>Type:</strong> <a href="#adaptersupport"><code dir="auto">AdapterSupport</code></a><br></p>
<span> <strong>Added in:</strong> <code>astro@4.3.0</code> </span> <p>Defines whether the adapter is able to support i18n domains.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="envgetsecret"><code dir="auto">envGetSecret</code></h3>
<a class="sl-anchor-link" href="#envgetsecret"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “envGetSecret”</span></a>
</div> 
<p><strong>Type:</strong> <a href="#adaptersupport"><code dir="auto">AdapterSupport</code></a><br></p>
<span> <strong>Added in:</strong> <code>astro@4.10.0</code> </span> <p>Defines whether the adapter is able to support <code dir="auto">getSecret()</code> exported from <a href="../modules/astro-env/index"><code dir="auto">astro:env/server</code></a>. When enabled, this feature allows your adapter to retrieve secrets configured by users in <code dir="auto">env.schema</code>.</p> <p>The following example enables the feature by passing <a href="#adaptersupportskind">a valid <code dir="auto">AdapterSupportsKind</code> value</a> to the adapter:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            envGetSecret: 'stable'
          }
        });
      },
    },
  };
}</pre>

</div> <p>The <code dir="auto">astro/env/setup</code> module allows you to provide an implementation for <code dir="auto">getSecret()</code>. In <a href="#building-a-server-entrypoint">your server entrypoint</a>, call <code dir="auto">setGetEnv()</code> as soon as possible:</p> <div class="expressive-code">

<pre data-language="js">import { App } from 'astro/app';
import { setGetEnv } from "astro/env/setup"


setGetEnv((key) =&gt; process.env[key])


export function createExports(manifest) {
  const app = new App(manifest);


  const handler = (event, context) =&gt; {
    // ...
  };


  return { handler };
}</pre>

</div> <p>If the adapter supports secrets, be sure to call <code dir="auto">setGetEnv()</code> before <code dir="auto">getSecret()</code> when environment variables are tied to the request:</p> <div class="expressive-code">

<pre data-language="js">import type { SSRManifest } from 'astro';
import { App } from 'astro/app';
import { setGetEnv } from 'astro/env/setup';
import { createGetEnv } from '../utils/env.js';


type Env = {
  [key: string]: unknown;
};


export function createExports(manifest: SSRManifest) {
  const app = new App(manifest);


  const fetch = async (request: Request, env: Env) =&gt; {
    setGetEnv(createGetEnv(env));


    const response = await app.render(request);


    return response;
  };


  return { default: { fetch } };
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="sharpimageservice"><code dir="auto">sharpImageService</code></h3>
<a class="sl-anchor-link" href="#sharpimageservice"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “sharpImageService”</span></a>
</div> 
<p><strong>Type:</strong> <a href="#adaptersupport"><code dir="auto">AdapterSupport</code></a><br></p>
<span> <strong>Added in:</strong> <code>astro@5.0.0</code> </span> <p>Defines whether the adapter supports image transformation using the built-in Sharp image service.</p> <div class="sl-heading-wrapper level-h2">
<h2 id="adapter-features">Adapter features</h2>
<a class="sl-anchor-link" href="#adapter-features"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Adapter features”</span></a>
</div> <p>A set of features that changes the output of the emitted files. When an adapter opts in to these features, they will get additional information inside specific hooks and must implement the proper logic to handle the different output.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="edgemiddleware"><code dir="auto">edgeMiddleware</code></h3>
<a class="sl-anchor-link" href="#edgemiddleware"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “edgeMiddleware”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">boolean</code></p> <p>Defines whether any on-demand rendering middleware code will be bundled when built.</p> <p>When enabled, this prevents middleware code from being bundled and imported by all pages during the build:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          adapterFeatures: {
            edgeMiddleware: true
          }
        });
      },
    },
  };
}</pre>

</div> <p>Then, consume the hook <a href="../integrations-reference/index#astrobuildssr"><code dir="auto">astro:build:ssr</code></a>, which will give you a <code dir="auto">middlewareEntryPoint</code>, an <code dir="auto">URL</code> to the physical file on the file system.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          adapterFeatures: {
            edgeMiddleware: true
          }
        });
      },


      'astro:build:ssr': ({ middlewareEntryPoint }) =&gt; {
        // remember to check if this property exits, it will be `undefined` if the adapter doesn't opt in to the feature
        if (middlewareEntryPoint) {
          createEdgeMiddleware(middlewareEntryPoint)
        }
      }
    },
  };
}


function createEdgeMiddleware(middlewareEntryPoint) {
  // emit a new physical file using your bundler
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="buildoutput"><code dir="auto">buildOutput</code></h3>
<a class="sl-anchor-link" href="#buildoutput"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “buildOutput”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">"static" | "server"</code><br> <strong>Default:</strong> <code dir="auto">"server"</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.0.0</code> </span> <p>Allows you to force a specific output shape for the build. This can be useful for adapters that only work with a specific output type. For example, your adapter might expect a static website, but uses an adapter to create host-specific files. Defaults to <code dir="auto">server</code> if not specified.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          adapterFeatures: {
            buildOutput: 'static'
          }
        });
      },
    },
  };
}</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="experimentalstaticheaders"><code dir="auto">experimentalStaticHeaders</code></h3>
<a class="sl-anchor-link" href="#experimentalstaticheaders"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “experimentalStaticHeaders”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">boolean</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.9.3</code> </span> <p>Whether or not the adapter provides experimental support for setting response headers for static pages. When this feature is enabled, Astro will return a map of the <code dir="auto">Headers</code> emitted by the static pages. This map <code dir="auto">experimentalRouteToHeaders</code> is available in the <a href="../integrations-reference/index#astrobuildgenerated"><code dir="auto">astro:build:generated</code> hook</a> for generating files such as a <code dir="auto">_headers</code> that allows you to make changes to the default HTTP header.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          adapterFeatures: {
            experimentalStaticHeaders: true,
          },
        });
      },
      'astro:build:generated': ({ experimentalRouteToHeaders }) =&gt; {
        // use `experimentalRouteToHeaders` to generate a configuration file
        // for your virtual host of choice
      },
    },
  };
}</pre>

</div> <p>The value of the headers might change based on the features enabled/used by the application. For example, if <a href="../experimental-flags/csp/index">CSP is enabled</a>, the <code dir="auto">&lt;meta http-equiv="content-security-policy"&gt;</code> element is not added to the static page. Instead, its <code dir="auto">content</code> is available in the <code dir="auto">experimentalRouteToHeaders</code> map.</p> <div class="sl-heading-wrapper level-h2">
<h2 id="adapter-types-reference">Adapter types reference</h2>
<a class="sl-anchor-link" href="#adapter-types-reference"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Adapter types reference”</span></a>
</div> <div class="sl-heading-wrapper level-h3">
<h3 id="adaptersupport"><code dir="auto">AdapterSupport</code></h3>
<a class="sl-anchor-link" href="#adaptersupport"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “AdapterSupport”</span></a>
</div> 
<p><strong>Type:</strong> <code><a href="#adaptersupport">AdapterSupportsKind</a> | <a href="#adaptersupportwithmessage">AdapterSupportWithMessage</a></code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.0.0</code> </span> <p>A union of valid formats to describe the support level for a feature.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="adaptersupportskind"><code dir="auto">AdapterSupportsKind</code></h3>
<a class="sl-anchor-link" href="#adaptersupportskind"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “AdapterSupportsKind”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">"deprecated" | "experimental" | "limited" | "stable" | "unsupported"</code></p> <p>Defines the level of support for a feature by your adapter:</p> <ul> <li>Use <code dir="auto">"deprecated"</code> when your adapter deprecates support for a feature before removing it completely in a future version.</li> <li>Use <code dir="auto">"experimental"</code> when your adapter adds support for a feature, but issues or breaking changes are expected.</li> <li>Use <code dir="auto">"limited"</code> when your adapter only supports a subset of the full feature.</li> <li>Use <code dir="auto">"stable"</code> when the feature is fully supported by your adapter.</li> <li>Use <code dir="auto">"unsupported"</code> to warn users that they may encounter build issues in their project, as this feature is not supported by your adapter.</li> </ul> <div class="sl-heading-wrapper level-h3">
<h3 id="adaptersupportwithmessage"><code dir="auto">AdapterSupportWithMessage</code></h3>
<a class="sl-anchor-link" href="#adaptersupportwithmessage"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “AdapterSupportWithMessage”</span></a>
</div> <p><span> <strong>Added in:</strong> <code>astro@5.0.0</code> </span></p> <p>An object that allows you to define a support level for a feature and a message to be logged in the user console. This object contains the following properties:</p> <div class="sl-heading-wrapper level-h4">
<h4 id="support"><code dir="auto">support</code></h4>
<a class="sl-anchor-link" href="#support"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “support”</span></a>
</div> 
<p><strong>Type:</strong> <code>Exclude&lt;<a href="#adaptersupportskind">AdapterSupportsKind</a>, “stable”&gt;</code></p> <p>Defines the level of support for a feature by your adapter.</p> <div class="sl-heading-wrapper level-h4">
<h4 id="message"><code dir="auto">message</code></h4>
<a class="sl-anchor-link" href="#message"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “message”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">string</code></p> <p>Defines a custom message to log regarding the support of a feature by your adapter.</p> <div class="sl-heading-wrapper level-h4">
<h4 id="suppress"><code dir="auto">suppress</code></h4>
<a class="sl-anchor-link" href="#suppress"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “suppress”</span></a>
</div> 
<p><strong>Type:</strong> <code dir="auto">"default" | "all"</code><br></p>
<span> <strong>Added in:</strong> <code>astro@5.9.0</code> </span> <p>An option to prevent showing some or all logged messages about an adapter’s support for a feature.</p> <p>If Astro’s default log message is redundant, or confusing to the user in combination with your <a href="#message">custom <code dir="auto">message</code></a>, you can use <code dir="auto">suppress: "default"</code> to suppress the default message and only log your message:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            sharpImageService: {
              support: 'limited',
              message: 'The adapter has limited support for Sharp. It will be used for images during build time, but will not work at runtime.',
              suppress: 'default' // custom message is more detailed than the default
            }
          }
        });
      },
    },
  };
}</pre>

</div> <p>You can also use <code dir="auto">suppress: "all"</code> to suppress all messages about support for the feature. This is useful when these messages are unhelpful to users in a specific context, such as when they have a configuration setting that means they are not using that feature. For example, you can choose to prevent logging any messages about Sharp support from your adapter:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-adapter.mjs</span></div>
<pre data-language="js">export default function createIntegration() {
  return {
    name: '@example/my-adapter',
    hooks: {
      'astro:config:done': ({ setAdapter }) =&gt; {
        setAdapter({
          name: '@example/my-adapter',
          serverEntrypoint: '@example/my-adapter/server.js',
          supportedAstroFeatures: {
            sharpImageService: {
              support: 'limited',
              message: 'This adapter has limited support for Sharp. Certain features may not work as expected.',
              suppress: 'all'
            }
          }
        });
      },
    },
  };
}</pre>

</div> <div class="sl-heading-wrapper level-h2">
<h2 id="allow-installation-via-astro-add">Allow installation via <code dir="auto">astro add</code>
</h2>
<a class="sl-anchor-link" href="#allow-installation-via-astro-add"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled “Allow installation via astro add”</span></a>
</div> <p><a href="../cli-reference/index#astro-add">The <code dir="auto">astro add</code> command</a> allows users to easily add integrations and adapters to their project. To allow your adapter to be installed with this command, <strong>add <code dir="auto">astro-adapter</code> to the <code dir="auto">keywords</code> field in your <code dir="auto">package.json</code></strong>:</p> <div class="expressive-code">

<pre data-language="json">{
  "name": "example",
  "keywords": ["astro-adapter"],
}</pre>

</div> <p>Once you <a href="https://docs.npmjs.com/cli/v8/commands/npm-publish">publish your adapter to npm</a>, running <code dir="auto">astro add example</code> will install your package with any peer dependencies specified in your <code dir="auto">package.json</code> and instruct users to update their project config manually.</p> <span id="docsearch-lvl0" hidden>Reference</span> </div> <div class="hide-when-toc-is-visible astro-o5o7wsh2"> <div class="container astro-6x7bp2qc" lang="en" dir="ltr" data-algolia-exclude> <aside aria-labelledby="learn-astro-course-1" class="astro-6x7bp2qc"> <img src="data:image/webp;base64,UklGRvIQAABXRUJQVlA4WAoAAAAQAAAAgQAAhAAAQUxQSC0DAAABoBvbmtzMeVNjavtC+LS7UAbw5GmgBIaIYABTO5ABOwDpByMYKAGxMxgEoCp8CajYliyV+jNIAk2gP61OREwAckiV8w52cz2IqqrYRGUzBr1PAKjsCjuocj7o8rp2k6r2NnA9iKb32aOyGYM+NoAq5ylT1I1etyiqqvWxzQ43g+jGfWbGoHss8uJ1l56y4vahL7JS7cRlhOvTTnwmymYMul96n3Iw6c5f5MDtzQF49vzZvuq9+bc+/fzbrz7eS9dXBVDu7fcff/n1z9++vOLa9VvzqqqiWfzjp3YQVVW/tekqt5vz/xHgWow7BM3zpmq1j3M1bQkhU7Kp0Tqq3GRdpdneEOdLg3eHkh7EVTOIZn8a+6pIQ24KamjwjtchqLGChM6aIUVpTZkCYosgaW+LS8O2cBp4SzwSt5YcUpElnArejp+RvLLjkI6CFQEPdFYMD6CTFcd0taiZckhTejV14nV0VHMHXtEFNVjaJaWo0XK4xV4NHxhAp8Z3QGtdC8DZ1uPaWzbiJoldQrfAwSph3C+tKrC0tanFcmdRj7XenhGrSawRWgcOtggjhdg3qbETrTuqucOqTg3uVlRq8mERB5vCZwtY1Oj5/XuTmv2Gbh3V8OFGp6Z3ACo1/gA4644AWAyLvsTNWoyKl5e4z71JsSMs5pM58cxYXYspcS6RtBU7Lh1S82jFEyH9yQqHB4oVlwdUamUs053M0HMyVjsvlKo2JLapvCHqE7FaGilNa4r2acQWn6RQW2OZ4mSMuhRizSUBj5MhMcb5Na8DQGXjfMhcjPHy5viqIDy0qPpxylScn15VjM1KjmbCtvOEfwfOW/P/X5LRdTuJvTvPMcZdBe+aggAg7GMGACobd77EGOPm3NBUjIX9Prqr21Q2r49bW827iLwki34PZ2S23UF8mRsKa8IWODfwy0JLsk64npc9Ibvlop4ADmuEAXZxQfwiPwj3POO6WFPgmk/xzowMu1tTibvtshZ3qzneeMpReRVaLO2X9Fhaz6oaixzBq/aE5ad7I5azizojy71nrKXpltAKgIeXeUrKciWMhGQGiqAaGLbXqhWs73v8DQQAVlA4IJ4NAAAQOQCdASqCAIUAPm0ulEakIiIhKfFNQIANiWoGWBdGb9AP0A8QD8AP0A/gCYQo4/HdWxu/yPnDWL+7/jv+t+6DvpjzdoGTX1Q+Yb+rXTc8xn7Pfr17u3+o9Uv9d9Qb+Y/7T0h/Yg9Any2f3Q+Db90v3Y9rbqAOE8/w3bJ/gPEHx7+3/b/+r86B6b7wfqPOnwH+QuoF+QfzP/I/mDw7AA/zv+i/5vw69Vm9e/4PHo0AP0Z6Jf/T52vrX2Ef5n/af+aw/gTPTU/vLqKfCV8mH5T6U/PmrHeKP4iwI0pGgGIOTwR8GHgNdHTpJ4Q+dNhyfO5imVdCwpBnMq35ttJBnEiM3iZsv5SQktXSwEBbBLD0IG1RmGuGCbaAWSgDGuxMwa6/CsrGIDhuHKp80v5X7AjIQXItjUjkNPZjuQgJjI84s0My4ljxQIEaS65ayH50oCYbwLJtrOzqIes8gjW6AZMjGH/zRyozx9+RD4Mug1jNa/y/XAcE/8mX4+tN3f1aV56pkfC/AJQ780+e/i7lrvwEXqbRU3SpqAzfFPz1ZYL965jgtUqEsc5JZwJMf+O2KqIlgpVcTf7gSBf3DI0KttHzHq/r4iurh+Bi+K4XwcC1KGAA/v5HgnxTjiLf9rueWoIV3ZKnAcWdiQk+8JKA3dxQvlK8YSqal2d0CCOfXQ1xnpiaaNbwpWproUytNP/Z+c4HKicI9XY0dPfjI9F2xPXSEJ1/Mdxwr0jwadiphU+HVPJ/wisObIruUydsXIKrT7rho1+xSIIGnlIBiS7ZWbTkFzgImxBvCt4Rzr8xY9khTZRzBfGdNR8P562aVSSSbl2TqCI1uRRKt1H65eU9WgqsRmsOTaVqojHjYNeivXv78UWtckYKpC2aezZKEi0EbUV2knUAz15G43k461s8rKE2Oer2FXlxgoXctt9NwAPV3qe3t8usyEA90CXTl2taJUQXglWmhOyudhMigXzOSh8b77qVEA7SK0bAGtftHqKcw4CD6+gW87cebJnpxUWk9GMVzH7yb8p0jFqjfn3PmsSnZEQakQ1LlqNFT1fSGU263Y8ZetifSEKngPxo/a/8mOXvx+IW5eom9gfOQB6JZSy+yQWv41ePupkGZ4aJvMDgLqY1ouaq8Njyje/96essb78xkNUOxdm5jJQyDHVOuugL8zphd05AgDvfcHF5NhQh8OT1iXnrUusn/NEHuWRjTM5o0aAYjm+7j+ZMEBD2ldvsX4xft/8BWvbyCOcNGPI15Tnr/NDfmrWvqdP/XCXTw6ESgVr5KMW3GX1fTKioVOs9k6s9I6TpP5YynXNP4P2eCkN0IFbx+uzeehFsx9UVSWuwlBEsHd5Caj2rDhH7qUeG0N9sDCcUE3kcYqtVE81QJ3M6a9fayJ4ZxxSx03a7kIPZiWk3a53cqGWsJ9KIxxjwHgBeHP4yOg6Xvp9PuJfi/8cpUp4JPERIAD75aRe7TThr50j8xGIMwl0xCZquxC//mgCf0MsNOAWFddw8j0Jftq2n9jb+zOUO4v7TQMHc7sYAN7Ct1/nKB/V1PjFO9RpfPiunpUOGh+pq/PrwECAWI0FqZzUWbDS8Shg+6AvCvc5/tPBJVcyRKlep6IYJvB7DWH3aWSoJK1/317/JpcvO3obA3FX9Dn48TbG3fxvgvT63lcbZZ/apnKQp+5tWTmns9wXc/N+WYByjnbgI3sM79BbnVS6oB1+JflbfTGdFWeFPO3RP+2EWAzIPutF4S/pYtzOTNPOzCpgS+BfcMcv/H4NqOP630Ep7otKnEoljvQ33bhFw90L4V6cGdsw5/jWV1Z+HxOj8OC4wMRM8P/0iHBjuwB5oYpPs59z2MyX4ty4BXthtcS0X9LMIR/horHXiBsu+yAGkNmAapUB3ovAPtSZ44HksTqQEX0N00QTslHAetwDAH59SjUPCnAupeAZXdCioRW4RH8Hu81X7eovGrTKs88/l+nICbNdFI/EU+bajYP/i5IngzJVrUlzDtgqX8rSh1ARS/4XC+8aGOu+i+Z9ch0204ah8KA3TJtKU4ax1s7prBo/+wVuoOfZbZgo6/MrxL/KzKDr/9Ppf/9Qnj+Js5hjLYtNPLBAh+lx+KoW4xN+S0muI60C62TECJty8ChdStMHK0vsqXBS52Empg2XazUORL8ihrKqwFQHGYaxvLbysp8dJIFtuiICAx5640v51e0rowenxMsHiLRjQQ/6PG2ZC9kId0S+6o7GaNlpniPO73wSYGBwPZs6FnG5DfW7qutSL++TLH7/xlVqnArmWFUAVP5xpE5EZNKHUa3xRRAAQxoof1EOUbu3PAboBRIMWyuIAcGvCEBiefErl2tu+zSu8BcZcBUuLIPKZ6PqQqXYTNOMFmTZ1N+aB1T11nChDM16lDTcwXE2fC+X9UOVpiywDSej4o1w+V4kg20vMfgOlb92neCr0iWVHw4v8cZG8uyAz1D8Mwpej5VkRtGLV4MqQmQSJVbdh/YAZOFdqZEmioZhJNEraPswZXryMCr8k2e+2Kr21u3DMLdCSt6KsIqIDSqIoesZ/USj/FQf1YMu3DEVGJxFqz9QqA/BmEYd9UqFjsjA0WqF86gbe/MfULl+nya3FXYynm3EK4/Z9YvQAccfFEZjRId4RuorhLwLXgGIJLsSSeMi3aNZWY7QgTFAeOAJTWB5rnuP+LgsQ9JfvUGt6/4uDBozO/ezxRsZkr7BcHNkT9nj6BcJ6WZdh8GMeuvUeB7jxE/gNgD4ACL3ZU/8NGo0qAf7L2lcTy3dlFKkCPoBFpuegSDl/UimIMze66lN4C6Jdt5JyWsi8B1JftvKPvHlVoNtrV/aOdgdBpVQ4sRv55eKLyLtnt+STASUC9+NwngGFDUzOjO0zuL/9ZaWY7yXWihY7puWtVJRK4kcrwZWhcV7rRJJHsc14cI2KcgT140ESNAD3koA9U6nbEgJ4HVubC0AbnoVHKUZ6tkimIvldCLQZeETQZyb71r2RrGsfNVil8GpwLFNh0sRFBpA0yXmB2HRfhPsAMGWrjlrgbDKbbETNmjfX3k8lLSZSP9PsEWmNy3CmTxJxq2wcXcX1Lc4a51pxdOWFvZU+mt0tPhAqDIcFB/5JvWDBQgIbvp50ku3vG7EnC3dRF0kLxN8V7mFfdGHs9pzUO2N+/5e9f89/uFjB3iIOZNBuRkA0sGpva3LlZ5/ABHgMLLJeDTawhs6NUbde0dzbsvHLlmqDGbby48E2dP8T973BESg4EpjjGPor4oIM+n+hXfnJEZlb2pmoYBkH1UzBbp8GrDPgzsSHB4WgJv8ejcJ7azEAtLTaaBrr3QjuVWZOk0xePT/Ej8KuLqv/iVAu3uWbGiZGUTszgRbVvFgiDmhF9ZMBPip3GoSel1O2hR3wO2w5J0U4WohjPKE6EnTW8ObQOr9x85s5I+etJHX3C8WMTJIaRTHoQTIyVwpY2Hq+LgPdOQP4FN/3oLu/UHWzRx1WdjyXwuw14+YSY1aX51LYGg82H1jgF/9eg4KZ5JCkcC5BbxPzjZwuyOZoSuxCZVtUT2Wz90HOQ/Sw7/8MTBS4Ia+/w4ovMo/WBWmdsii8d0KhMILwUouq8o4nHzxr8o8ubBZLtIMkDYTaOZ5GjKJOEKT6tUS+Ft+TWPMv57yV0gfDWZ2+j8r/lvxC1AsmNns6IPImLIsZVLJH08i1kb1Rc0GCec/Xpn0J4PpfH+RfaYlyUIrWr7BJCkWpz7NTlNLWyrnF9VmwjIOBgerx2lXbf3zyRwg+Fj6M9Hks5GW9pw6o/baxr9ANg7963+HAU7qga6FOTCc03t/60u4ADG2UO7kIjOLoZvJow2Vqv5qWlerTRX0QamZ3QG42eZC2QO+wQ8o42wyiLmcP895sNS9jPH0cKw3sUcrrdMorEv+6z4sbN1RYoe9bgyg6r5LB3CenKcTJVz/zgFYn2piU5COjFR5CojGncJMSjktcQTL+UFoZuwM/BLWI3ieJu5BTGGMaVPfwItVkvzWdobB9twbPMi/v283FD8D/X/JoGhU4CmGPaejcYacF0WUBclBoe+5b2bt0Z4mMjGvB18NUAam941jMZSw2WLI/6hE2jqg4Qk1L7DxuWQwSNqCNHYQyG0OG3RRUrYAnVg/8hQu8+4T0emlY6a+pclJL2VMkgFpbQ4dqkiO4Ib722cE5x3yNpgC3MAKeb8QpeqIBs25V7u+aBMRiQtkUf0TBpoatngyDSw6p73APq+LE7SQilTbAyAACOiPdWCOPck/6B7uf3M3YYmd8sFf2LPw5aA1DE6TgaCbuAyxIDbJEv31kZtBX1+pOYzOZMUyzLkw1/B6p3yykaUIwzCug1DsUm1oilXADOJ0y66BosB7eeBtbkM707OcPsNhX6Crok3rDYbglTeZUzQ/XTZ1twRpo9jlgJi6VI+LxioF+M1JY5YkFitFbZvqXghwWP5CVa9XseyuMA1h2vNP07TUsMfYADJG6j8iv7qYX3cTJEAdWKNsnqMpZHMpjFt1/bjbWINaFQ80KA4BePAD/0yUljxmO6mZ12JxxcI7z7xECgEfWQMMaWRUma8+nVWgAAKGf/9tWDQD+abzdX8RW4R2tnutVQ9nvMGwc5YugGXzUbDrmACTSTqR+32qjypHrITBkUaAAAAA=" alt loading="lazy" decoding="async" fetchpriority="auto" width="130" height="133" class="astro-6x7bp2qc"> <h2 id="learn-astro-course-1" class="astro-6x7bp2qc">Learn Astro with <strong class="astro-6x7bp2qc">Coding in Public</strong>
</h2> <p class="sl-flex astro-6x7bp2qc"> <span class="sl-flex astro-6x7bp2qc" style="gap: 0.25rem; align-items: center;"> <svg fill="currentColor" viewbox="0 0 18 18" aria-hidden="true" class="astro-6x7bp2qc"> <path d="M12 7.7 8.25 5.53A1.5 1.5 0 0 0 6 6.83v4.34a1.5 1.5 0 0 0 2.25 1.3L12 10.3a1.5 1.5 0 0 0 0-2.6ZM11.25 9 7.5 11.17V6.83L11.25 9ZM9 1.5a7.5 7.5 0 1 0 0 15 7.5 7.5 0 0 0 0-15ZM9 15A6 6 0 1 1 9 3a6 6 0 0 1 0 12Z" class="astro-6x7bp2qc"></path> </svg> <span class="astro-6x7bp2qc">150+ video lessons</span> </span> <span class="astro-6x7bp2qc">•</span> <span class="astro-6x7bp2qc">Astro v5 ready</span> </p> <a class="sl-link-button not-content primary cta astro-6x7bp2qc astro-n3qr5j5k" href="https://learnastro.dev?code=ASTRO_HOLIDAY_PROMO" data-learn-astro-cta="true"> <span class="astro-6x7bp2qc"><strong class="astro-6x7bp2qc">Price Drop!</strong> Get 33% off</span> </a> </aside> </div>  </div>   </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/reference/adapter-reference/" class="_attribution-link">https://docs.astro.build/en/reference/adapter-reference/</a>
  </p>
</div>
