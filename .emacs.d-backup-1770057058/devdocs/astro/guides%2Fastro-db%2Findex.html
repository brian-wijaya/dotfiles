<h1 id="_top" class="astro-62i6xxx4">Astro DB</h1> <div class="content-panel astro-2mug3n2c"> <div class="sl-container astro-2mug3n2c"> <div class="sl-markdown-content"> <p>Astro DB is a fully-managed SQL database designed for the Astro ecosystem. Develop locally in Astro and deploy to any libSQL-compatible database.</p> <p>Astro DB is a complete solution to configuring, developing, and querying your data. A local database is created in <code dir="auto">.astro/content.db</code> whenever you run <code dir="auto">astro dev</code> to manage your data without the need for Docker or a network connection.</p> <div class="sl-heading-wrapper level-h2">
<h2 id="installation">Installation</h2>
<a class="sl-anchor-link" href="#installation"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúInstallation‚Äù</span></a>
</div> <p>Install the <a href="../integrations-guide/db/index"><code dir="auto">@astrojs/db</code> integration</a> using the built-in <code dir="auto">astro add</code> command:</p>  <starlight-tabs data-sync-key="package-managers" class="astro-xtbw65nk"> <div class="tablist-wrapper not-content astro-xtbw65nk"> <ul role="tablist" class="astro-xtbw65nk"> <li role="presentation" class="tab astro-xtbw65nk"> <a role="tab" href="#tab-panel-2100" id="tab-2100" aria-selected="true" tabindex="0" class="astro-xtbw65nk"> npm </a> </li>
<li role="presentation" class="tab astro-xtbw65nk"> <a role="tab" href="#tab-panel-2101" id="tab-2101" aria-selected="false" tabindex="-1" class="astro-xtbw65nk"> pnpm </a> </li>
<li role="presentation" class="tab astro-xtbw65nk"> <a role="tab" href="#tab-panel-2102" id="tab-2102" aria-selected="false" tabindex="-1" class="astro-xtbw65nk"> Yarn </a> </li> </ul> </div> <div id="tab-panel-2100" aria-labelledby="tab-2100" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">npx astro add db</pre>

</div> </div> <div id="tab-panel-2101" aria-labelledby="tab-2101" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">pnpm astro add db</pre>

</div> </div> <div id="tab-panel-2102" aria-labelledby="tab-2102" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">yarn astro add db</pre>

</div> </div> <starlight-tabs-restore class="astro-xtbw65nk"></starlight-tabs-restore> </starlight-tabs>  <div class="sl-heading-wrapper level-h2">
<h2 id="define-your-database">Define your database</h2>
<a class="sl-anchor-link" href="#define-your-database"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúDefine your database‚Äù</span></a>
</div> <p>Installing <code dir="auto">@astrojs/db</code> with the <code dir="auto">astro add</code> command will automatically create a <code dir="auto">db/config.ts</code> file in your project where you will define your database tables:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/config.ts</span></div>
<pre data-language="ts">import { defineDb } from 'astro:db';


export default defineDb({
  tables: { },
})</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="tables">Tables</h3>
<a class="sl-anchor-link" href="#tables"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúTables‚Äù</span></a>
</div> <p>Data in Astro DB is stored using SQL tables. Tables structure your data into rows and columns, where columns enforce the type of each row value.</p> <p>Define your tables in your <code dir="auto">db/config.ts</code> file by providing the structure of the data in your existing libSQL database, or the data you will collect in a new database. This will allow Astro to generate a TypeScript interface to query that table from your project. The result is full TypeScript support when you access your data with property autocompletion and type-checking.</p> <p>To configure a database table, import and use the <code dir="auto">defineTable()</code> and <code dir="auto">column</code> utilities from <code dir="auto">astro:db</code>. Then, define a name (case-sensitive) for your table and the type of data in each column.</p> <p>This example configures a <code dir="auto">Comment</code> table with required text columns for <code dir="auto">author</code> and <code dir="auto">body</code>. Then, makes it available to your project through the <code dir="auto">defineDb()</code> export.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/config.ts</span></div>
<pre data-language="ts">import { defineDb, defineTable, column } from 'astro:db';


const Comment = defineTable({
  columns: {
    author: column.text(),
    body: column.text(),
  }
})


export default defineDb({
  tables: { Comment },
})</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz">See the <a href="../integrations-guide/db/index#table-configuration-reference">table configuration reference</a> for a complete reference of table options.</span> </div> <div class="sl-heading-wrapper level-h3">
<h3 id="columns">Columns</h3>
<a class="sl-anchor-link" href="#columns"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúColumns‚Äù</span></a>
</div> <p>Astro DB supports the following column types:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/config.ts</span></div>
<pre data-language="ts">import { defineTable, column } from 'astro:db';


const Comment = defineTable({
  columns: {
    // A string of text.
    author: column.text(),
    // A whole integer value.
    likes: column.number(),
    // A true or false value.
    flagged: column.boolean(),
    // Date/time values queried as JavaScript Date objects.
    published: column.date(),
    // An untyped JSON object.
    metadata: column.json(),
  }
});</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz">See the <a href="../integrations-guide/db/index#table-configuration-reference">table columns reference</a> for more details.</span> </div> <div class="sl-heading-wrapper level-h3">
<h3 id="table-references">Table References</h3>
<a class="sl-anchor-link" href="#table-references"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúTable References‚Äù</span></a>
</div> <p>Relationships between tables are a common pattern in database design. For example, a <code dir="auto">Blog</code> table may be closely related to other tables of <code dir="auto">Comment</code>, <code dir="auto">Author</code>, and <code dir="auto">Category</code>.</p> <p>You can define these relations between tables and save them into your database schema using <strong>reference columns</strong>. To establish a relationship, you will need:</p> <ul> <li>An <strong>identifier column</strong> on the referenced table. This is usually an <code dir="auto">id</code> column with the <code dir="auto">primaryKey</code> property.</li> <li>A column on the base table to <strong>store the referenced <code dir="auto">id</code></strong>. This uses the <code dir="auto">references</code> property to establish a relationship.</li> </ul> <p>This example shows a <code dir="auto">Comment</code> table‚Äôs <code dir="auto">authorId</code> column referencing an <code dir="auto">Author</code> table‚Äôs <code dir="auto">id</code> column.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/config.ts</span></div>
<pre data-language="ts">const Author = defineTable({
  columns: {
    id: column.number({ primaryKey: true }),
    name: column.text(),
  }
});


const Comment = defineTable({
  columns: {
    authorId: column.number({ references: () =&gt; Author.columns.id }),
    body: column.text(),
  }
});</pre>

</div> <div class="sl-heading-wrapper level-h2">
<h2 id="seed-your-database-for-development">Seed your database for development</h2>
<a class="sl-anchor-link" href="#seed-your-database-for-development"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúSeed your database for development‚Äù</span></a>
</div> <p>In development, Astro will use your DB config to generate local types according to your schemas. These will be generated fresh from your seed file each time the dev server is started, and will allow you to query and work with the shape of your data with type safety and autocompletion.</p> <p>You will not have access to production data during development unless you <a href="#connecting-to-remote-databases">connect to a remote database</a> during development. This protects your data while allowing you to test and develop with a working database with type-safety.</p> <p>To seed development data for testing and debugging into your Astro project, create a <code dir="auto">db/seed.ts</code> file. Import both the <code dir="auto">db</code> object and your tables defined in <code dir="auto">astro:db</code>. <code dir="auto">insert</code> some initial data into each table. This development data should match the form of both your database schema and production data.</p> <p>The following example defines two rows of development data for a <code dir="auto">Comment</code> table, and an <code dir="auto">Author</code> table:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/seed.ts</span></div>
<pre data-language="ts">import { db, Comment, Author } from 'astro:db';


export default async function() {
  await db.insert(Author).values([
    { id: 1, name: "Kasim" },
    { id: 2, name: "Mina" },
  ]);


  await db.insert(Comment).values([
    { authorId: 1, body: 'Hope you like Astro DB!' },
    { authorId: 2, body: 'Enjoy!'},
  ])
}</pre>

</div> <p>Your development server will automatically restart your database whenever this file changes, regenerating your types and seeding this development data from <code dir="auto">seed.ts</code> fresh each time.</p> <div class="sl-heading-wrapper level-h2">
<h2 id="connect-a-libsql-database-for-production">Connect a libSQL database for production</h2>
<a class="sl-anchor-link" href="#connect-a-libsql-database-for-production"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúConnect a libSQL database for production‚Äù</span></a>
</div> <p>Astro DB can connect to any local libSQL database or to any server that exposes the libSQL remote protocol, whether managed or self-hosted.</p> <p>To connect Astro DB to a libSQL database, set the following environment variables obtained from your database provider:</p> <ul> <li>
<code dir="auto">ASTRO_DB_REMOTE_URL</code>: the connection URL to the location of your local or remote libSQL DB. This may include <a href="#remote-url-configuration-options">URL configuration options</a> such as sync and encryption as parameters.</li> <li>
<code dir="auto">ASTRO_DB_APP_TOKEN</code>: the auth token to your libSQL server. This is required for remote databases, and not needed for <a href="#url-scheme-and-host">local DBs like files or in-memory</a> databases</li> </ul> <p>Depending on your service, you may have access to a CLI or web UI to retrieve these values. The following section will demonstrate connecting to Turso and setting these values as an example, but you are free to use any provider.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="getting-started-with-turso">Getting started with Turso</h3>
<a class="sl-anchor-link" href="#getting-started-with-turso"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúGetting started with Turso‚Äù</span></a>
</div> <p>Turso is the company behind <a href="https://github.com/tursodatabase/libsql">libSQL</a>, the open-source fork of SQLite that powers Astro DB. They provide a fully managed libSQL database platform and are fully compatible with Astro.</p> <p>The steps below will guide you through the process of installing the Turso CLI, logging in (or signing up), creating a new database, getting the required environmental variables, and pushing the schema to the remote database.</p> <ol role="list" class="sl-steps"> <li> <p>Install the <a href="https://docs.turso.tech/cli/installation">Turso CLI</a>.</p> </li> <li> <p><a href="https://docs.turso.tech/cli/authentication">Log in or sign up</a> to Turso.</p> </li> <li> <p>Create a new database. In this example the database name is <code dir="auto">andromeda</code>.</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">turso db create andromeda</pre>

</div> </li> <li> <p>Run the <code dir="auto">show</code> command to see information about the newly created database:</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">turso db show andromeda</pre>

</div> <p>Copy the <code dir="auto">URL</code> value and set it as the value for <code dir="auto">ASTRO_DB_REMOTE_URL</code>.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">.env</span></div>
<pre data-language="dotenv">ASTRO_DB_REMOTE_URL=libsql://andromeda-houston.turso.io</pre>

</div> </li> <li> <p>Create a new token to authenticate requests to the database:</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">turso db tokens create andromeda</pre>

</div> <p>Copy the output of the command and set it as the value for <code dir="auto">ASTRO_DB_APP_TOKEN</code>.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">.env</span></div>
<pre data-language="dotenv">ASTRO_DB_REMOTE_URL=libsql://andromeda-houston.turso.io
ASTRO_DB_APP_TOKEN=eyJhbGciOiJF...3ahJpTkKDw</pre>

</div> </li> <li> <p>Push your DB schema and metadata to the new Turso database.</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">astro db push --remote</pre>

</div> </li> <li> <p>Congratulations, now you have a database connected! Give yourself a break. üëæ</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">turso relax</pre>

</div> </li> </ol> <p>To explore more features of Turso, check out the <a href="https://docs.turso.tech">Turso docs</a>.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="connecting-to-remote-databases">Connecting to remote databases</h3>
<a class="sl-anchor-link" href="#connecting-to-remote-databases"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúConnecting to remote databases‚Äù</span></a>
</div> <p>Astro DB allows you to connect to both local and remote databases. By default, Astro uses a local database file for <code dir="auto">dev</code> and <code dir="auto">build</code> commands, recreating tables and inserting development seed data each time.</p> <p>To connect to a hosted remote database, use the <code dir="auto">--remote</code> flag. This flag enables both readable and writable access to your remote database, allowing you to <a href="#insert">accept and persist user data</a> in production environments.</p> <p>Configure your build command to use the <code dir="auto">--remote</code> flag:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">package.json</span></div>
<pre data-language="json">{
  "scripts": {
    "build": "astro build --remote"
  }
}</pre>

</div> <p>You can also use the flag directly in the command line:</p> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="bash"># Build with a remote connection
astro build --remote


# Develop with a remote connection
astro dev --remote</pre>

</div> <aside aria-label="Caution" class="starlight-aside starlight-aside--caution"><p class="starlight-aside__title" aria-hidden="true"><svg viewbox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M12 16C11.8022 16 11.6089 16.0587 11.4444 16.1686C11.28 16.2784 11.1518 16.4346 11.0761 16.6173C11.0004 16.8001 10.9806 17.0011 11.0192 17.1951C11.0578 17.3891 11.153 17.5673 11.2929 17.7071C11.4327 17.847 11.6109 17.9422 11.8049 17.9808C11.9989 18.0194 12.2 17.9996 12.3827 17.9239C12.5654 17.8482 12.7216 17.72 12.8315 17.5556C12.9413 17.3911 13 17.1978 13 17C13 16.7348 12.8946 16.4805 12.7071 16.2929C12.5196 16.1054 12.2652 16 12 16ZM22.67 17.47L14.62 3.47003C14.3598 3.00354 13.9798 2.61498 13.5192 2.3445C13.0586 2.07401 12.5341 1.9314 12 1.9314C11.4659 1.9314 10.9414 2.07401 10.4808 2.3445C10.0202 2.61498 9.64019 3.00354 9.38 3.47003L1.38 17.47C1.11079 17.924 0.966141 18.441 0.960643 18.9688C0.955144 19.4966 1.089 20.0166 1.34868 20.4761C1.60837 20.9356 1.9847 21.3185 2.43968 21.5861C2.89466 21.8536 3.41218 21.9964 3.94 22H20.06C20.5921 22.0053 21.1159 21.8689 21.5779 21.6049C22.0399 21.341 22.4234 20.9589 22.689 20.4978C22.9546 20.0368 23.0928 19.5134 23.0895 18.9814C23.0862 18.4493 22.9414 17.9277 22.67 17.47ZM20.94 19.47C20.8523 19.626 20.7245 19.7556 20.5697 19.8453C20.4149 19.935 20.2389 19.9815 20.06 19.98H3.94C3.76111 19.9815 3.5851 19.935 3.43032 19.8453C3.27553 19.7556 3.14765 19.626 3.06 19.47C2.97223 19.318 2.92602 19.1456 2.92602 18.97C2.92602 18.7945 2.97223 18.622 3.06 18.47L11.06 4.47003C11.1439 4.30623 11.2714 4.16876 11.4284 4.07277C11.5855 3.97678 11.766 3.92599 11.95 3.92599C12.134 3.92599 12.3145 3.97678 12.4716 4.07277C12.6286 4.16876 12.7561 4.30623 12.84 4.47003L20.89 18.47C20.9892 18.6199 21.0462 18.7937 21.055 18.9732C21.0638 19.1527 21.0241 19.3312 20.94 19.49V19.47ZM12 8.00003C11.7348 8.00003 11.4804 8.10538 11.2929 8.29292C11.1054 8.48046 11 8.73481 11 9.00003V13C11 13.2652 11.1054 13.5196 11.2929 13.7071C11.4804 13.8947 11.7348 14 12 14C12.2652 14 12.5196 13.8947 12.7071 13.7071C12.8946 13.5196 13 13.2652 13 13V9.00003C13 8.73481 12.8946 8.48046 12.7071 8.29292C12.5196 8.10538 12.2652 8.00003 12 8.00003Z"></path></svg>Caution</p>
<div class="starlight-aside__content"><p>Be careful when using <code dir="auto">--remote</code> in development. This connects to your live production database, and all changes (inserts, updates, deletions) will be persisted.</p></div></aside> <p>The <code dir="auto">--remote</code> flag uses the connection to the remote DB both locally during the build and on the server. Ensure you set the necessary environment variables in both your local development environment and your deployment platform. Additionally, you may need to <a href="../integrations-guide/db/index#mode">configure web mode</a> for non-Node.js runtimes such as Cloudflare Workers or Deno.</p> <p>When deploying your Astro DB project, make sure your deployment platform‚Äôs build command is set to <code dir="auto">npm run build</code> (or the equivalent for your package manager) to utilize the <code dir="auto">--remote</code> flag configured in your <code dir="auto">package.json</code>.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="remote-url-configuration-options">Remote URL configuration options</h3>
<a class="sl-anchor-link" href="#remote-url-configuration-options"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúRemote URL configuration options‚Äù</span></a>
</div> <p>The <code dir="auto">ASTRO_DB_REMOTE_URL</code> environment variable configures the location of your database as well as other options like sync and encryption.</p> <div class="sl-heading-wrapper level-h4">
<h4 id="url-scheme-and-host">URL scheme and host</h4>
<a class="sl-anchor-link" href="#url-scheme-and-host"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúURL scheme and host‚Äù</span></a>
</div> <p>libSQL supports both HTTP and WebSockets as the transport protocol for a remote server. It also supports using a local file or an in-memory DB. Those can be configured using the following URL schemes in the connection URL:</p> <ul> <li>
<code dir="auto">memory:</code> will use an in-memory DB. The host must be empty in this case.</li> <li>
<code dir="auto">file:</code> will use a local file. The host is the path to the file (<code dir="auto">file:path/to/file.db</code>).</li> <li>
<code dir="auto">libsql:</code> will use a remote server through the protocol preferred by the library (this might be different across versions). The host is the address of the server (<code dir="auto">libsql://your.server.io</code>).</li> <li>
<code dir="auto">http:</code> will use a remote server through HTTP. <code dir="auto">https:</code> can be used to enable a secure connection. The host is the same as for <code dir="auto">libsql:</code>.</li> <li>
<code dir="auto">ws:</code> will use a remote server through WebSockets. <code dir="auto">wss:</code> can be used to enable a secure connection. The host is the same as for <code dir="auto">libsql:</code>.</li> </ul> <p>Details of the libSQL connection (e.g. encryption key, replication, sync interval) can be configured as query parameters in the remote connection URL.</p> <p>For example, to have an encrypted local file work as an embedded replica to a libSQL server, you can set the following environment variables:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">.env</span></div>
<pre data-language="dotenv">ASTRO_DB_REMOTE_URL=file://local-copy.db?encryptionKey=your-encryption-key&amp;syncInterval=60&amp;syncUrl=libsql%3A%2F%2Fyour.server.io
ASTRO_DB_APP_TOKEN=token-to-your-remote-url</pre>

</div> <aside aria-label="Caution" class="starlight-aside starlight-aside--caution"><p class="starlight-aside__title" aria-hidden="true"><svg viewbox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M12 16C11.8022 16 11.6089 16.0587 11.4444 16.1686C11.28 16.2784 11.1518 16.4346 11.0761 16.6173C11.0004 16.8001 10.9806 17.0011 11.0192 17.1951C11.0578 17.3891 11.153 17.5673 11.2929 17.7071C11.4327 17.847 11.6109 17.9422 11.8049 17.9808C11.9989 18.0194 12.2 17.9996 12.3827 17.9239C12.5654 17.8482 12.7216 17.72 12.8315 17.5556C12.9413 17.3911 13 17.1978 13 17C13 16.7348 12.8946 16.4805 12.7071 16.2929C12.5196 16.1054 12.2652 16 12 16ZM22.67 17.47L14.62 3.47003C14.3598 3.00354 13.9798 2.61498 13.5192 2.3445C13.0586 2.07401 12.5341 1.9314 12 1.9314C11.4659 1.9314 10.9414 2.07401 10.4808 2.3445C10.0202 2.61498 9.64019 3.00354 9.38 3.47003L1.38 17.47C1.11079 17.924 0.966141 18.441 0.960643 18.9688C0.955144 19.4966 1.089 20.0166 1.34868 20.4761C1.60837 20.9356 1.9847 21.3185 2.43968 21.5861C2.89466 21.8536 3.41218 21.9964 3.94 22H20.06C20.5921 22.0053 21.1159 21.8689 21.5779 21.6049C22.0399 21.341 22.4234 20.9589 22.689 20.4978C22.9546 20.0368 23.0928 19.5134 23.0895 18.9814C23.0862 18.4493 22.9414 17.9277 22.67 17.47ZM20.94 19.47C20.8523 19.626 20.7245 19.7556 20.5697 19.8453C20.4149 19.935 20.2389 19.9815 20.06 19.98H3.94C3.76111 19.9815 3.5851 19.935 3.43032 19.8453C3.27553 19.7556 3.14765 19.626 3.06 19.47C2.97223 19.318 2.92602 19.1456 2.92602 18.97C2.92602 18.7945 2.97223 18.622 3.06 18.47L11.06 4.47003C11.1439 4.30623 11.2714 4.16876 11.4284 4.07277C11.5855 3.97678 11.766 3.92599 11.95 3.92599C12.134 3.92599 12.3145 3.97678 12.4716 4.07277C12.6286 4.16876 12.7561 4.30623 12.84 4.47003L20.89 18.47C20.9892 18.6199 21.0462 18.7937 21.055 18.9732C21.0638 19.1527 21.0241 19.3312 20.94 19.49V19.47ZM12 8.00003C11.7348 8.00003 11.4804 8.10538 11.2929 8.29292C11.1054 8.48046 11 8.73481 11 9.00003V13C11 13.2652 11.1054 13.5196 11.2929 13.7071C11.4804 13.8947 11.7348 14 12 14C12.2652 14 12.5196 13.8947 12.7071 13.7071C12.8946 13.5196 13 13.2652 13 13V9.00003C13 8.73481 12.8946 8.48046 12.7071 8.29292C12.5196 8.10538 12.2652 8.00003 12 8.00003Z"></path></svg>Caution</p>
<div class="starlight-aside__content">
<p>Using a database file is an advanced feature, and care should be taken when deploying to prevent overriding your database and losing your production data.</p>
<p>Additionally, this method will not work in serverless deployments, as the file system is not persisted in those environments.</p>
</div></aside> <div class="sl-heading-wrapper level-h4">
<h4 id="encryptionkey"><code dir="auto">encryptionKey</code></h4>
<a class="sl-anchor-link" href="#encryptionkey"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúencryptionKey‚Äù</span></a>
</div> <p>libSQL has native support for encrypted databases. Passing this search parameter will enable encryption using the given key:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">.env</span></div>
<pre data-language="dotenv">ASTRO_DB_REMOTE_URL=file:path/to/file.db?encryptionKey=your-encryption-key</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="syncurl"><code dir="auto">syncUrl</code></h4>
<a class="sl-anchor-link" href="#syncurl"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúsyncUrl‚Äù</span></a>
</div> <p>Embedded replicas are a feature of libSQL clients that creates a full synchronized copy of your database on a local file or in memory for ultra-fast reads. Writes are sent to a remote database defined on the <code dir="auto">syncUrl</code> and synchronized with the local copy.</p> <p>Use this property to pass a separate connection URL to turn the database into an embedded replica of another database. This should only be used with the schemes <code dir="auto">file:</code> and <code dir="auto">memory:</code>. The parameter must be URL encoded.</p> <p>For example, to have an in-memory embedded replica of a database on <code dir="auto">libsql://your.server.io</code>, you can set the connection URL as such:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">.env</span></div>
<pre data-language="dotenv">ASTRO_DB_REMOTE_URL=memory:?syncUrl=libsql%3A%2F%2Fyour.server.io</pre>

</div> <div class="sl-heading-wrapper level-h4">
<h4 id="syncinterval"><code dir="auto">syncInterval</code></h4>
<a class="sl-anchor-link" href="#syncinterval"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúsyncInterval‚Äù</span></a>
</div> <p>Interval between embedded replica synchronizations in seconds. By default it only synchronizes on startup and after writes.</p> <p>This property is only used when <code dir="auto">syncUrl</code> is also set. For example, to set an in-memory embedded replica to synchronize every minute set the following environment variable:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">.env</span></div>
<pre data-language="dotenv">ASTRO_DB_REMOTE_URL=memory:?syncUrl=libsql%3A%2F%2Fyour.server.io&amp;syncInterval=60</pre>

</div> <div class="sl-heading-wrapper level-h2">
<h2 id="query-your-database">Query your database</h2>
<a class="sl-anchor-link" href="#query-your-database"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúQuery your database‚Äù</span></a>
</div> <p>You can query your database from any <a href="../../basics/astro-pages/index#astro-pages">Astro page</a>, <a href="../endpoints/index">endpoint</a>, or <a href="../actions/index">action</a> in your project using the provided <code dir="auto">db</code> ORM and query builder.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="drizzle-orm">Drizzle ORM</h3>
<a class="sl-anchor-link" href="#drizzle-orm"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúDrizzle ORM‚Äù</span></a>
</div> <div class="expressive-code">

<pre data-language="ts">import { db } from 'astro:db';</pre>

</div> <p>Astro DB includes a built-in <a href="https://orm.drizzle.team/">Drizzle ORM</a> client. There is no setup or manual configuration required to use the client. The Astro DB <code dir="auto">db</code> client is automatically configured to communicate with your database (local or remote) when you run Astro. It uses your exact database schema definition for type-safe SQL queries with TypeScript errors when you reference a column or table that doesn‚Äôt exist.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="select">Select</h3>
<a class="sl-anchor-link" href="#select"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúSelect‚Äù</span></a>
</div> <p>The following example selects all rows of a <code dir="auto">Comment</code> table. This returns the complete array of seeded development data from <code dir="auto">db/seed.ts</code> which is then available for use in your page template:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
import { db, Comment } from 'astro:db';


const comments = await db.select().from(Comment);
---


&lt;h2&gt;Comments&lt;/h2&gt;


{
  comments.map(({ author, body }) =&gt; (
    &lt;article&gt;
      &lt;p&gt;Author: {author}&lt;/p&gt;
      &lt;p&gt;{body}&lt;/p&gt;
    &lt;/article&gt;
  ))
}</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz">See the <a href="https://orm.drizzle.team/docs/select">Drizzle <code dir="auto">select()</code> API reference</a> for a complete overview.</span> </div> <div class="sl-heading-wrapper level-h3">
<h3 id="insert">Insert</h3>
<a class="sl-anchor-link" href="#insert"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúInsert‚Äù</span></a>
</div> <p>To accept user input, such as handling form requests and inserting data into your remote hosted database, configure your Astro project for <a href="../on-demand-rendering/index">on-demand rendering</a> and <a href="../on-demand-rendering/index#add-an-adapter">add an adapter</a> for your deployment environment.</p> <p>This example inserts a row into a <code dir="auto">Comment</code> table based on a parsed form POST request:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
import { db, Comment } from 'astro:db';


if (Astro.request.method === 'POST') {
  // Parse form data
  const formData = await Astro.request.formData();
  const author = formData.get('author');
  const body = formData.get('body');
  if (typeof author === 'string' &amp;&amp; typeof body === 'string') {
    // Insert form data into the Comment table
    await db.insert(Comment).values({ author, body });
  }
}


// Render the new list of comments on each request
const comments = await db.select().from(Comment);
---


&lt;form method="POST" style="display: grid"&gt;
  &lt;label for="author"&gt;Author&lt;/label&gt;
  &lt;input id="author" name="author" /&gt;


  &lt;label for="body"&gt;Body&lt;/label&gt;
  &lt;textarea id="body" name="body"&gt;&lt;/textarea&gt;


  &lt;button type="submit"&gt;Submit&lt;/button&gt;
&lt;/form&gt;


&lt;!-- Render `comments` --&gt;</pre>

</div> <p>You can also use <a href="../actions/index">Astro actions</a> to insert data into an Astro DB table. The following example inserts a row into a <code dir="auto">Comment</code> table using an action:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/actions/index.ts</span></div>
<pre data-language="ts">import { db, Comment } from 'astro:db';
import { defineAction } from 'astro:actions';
import { z } from 'astro/zod';


export const server = {
  addComment: defineAction({
    // Actions include type safety with Zod, removing the need
    // to check if typeof {value} === 'string' in your pages
    input: z.object({
      author: z.string(),
      body: z.string(),
    }),
    handler: async (input) =&gt; {
      const updatedComments = await db
        .insert(Comment)
        .values(input)
        .returning(); // Return the updated comments
      return updatedComments;
    },
  }),
};</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz"><p>See the <a href="https://orm.drizzle.team/docs/insert">Drizzle <code dir="auto">insert()</code> API reference</a> for a complete overview.</p></span> </div> <div class="sl-heading-wrapper level-h3">
<h3 id="delete">Delete</h3>
<a class="sl-anchor-link" href="#delete"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúDelete‚Äù</span></a>
</div> <p>You can also query your database from an API endpoint. This example deletes a row from a <code dir="auto">Comment</code> table by the <code dir="auto">id</code> parameter:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/api/comments/[id].ts</span></div>
<pre data-language="ts">import type { APIRoute } from "astro";
import { db, Comment, eq } from 'astro:db';


export const DELETE: APIRoute = async (ctx) =&gt; {
  await db.delete(Comment).where(eq(Comment.id, ctx.params.id ));
  return new Response(null, { status: 204 });
}</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz"><p>See the <a href="https://orm.drizzle.team/docs/delete">Drizzle <code dir="auto">delete()</code> API reference</a> for a complete overview.</p></span> </div> <div class="sl-heading-wrapper level-h3">
<h3 id="filtering">Filtering</h3>
<a class="sl-anchor-link" href="#filtering"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúFiltering‚Äù</span></a>
</div> <p>To query for table results by a specific property, use <a href="https://orm.drizzle.team/docs/select#partial-select">Drizzle options for partial selects</a>. For example, add <a href="https://orm.drizzle.team/docs/select#filtering">a <code dir="auto">.where()</code> call</a> to your <code dir="auto">select()</code> query and pass the comparison you want to make.</p> <p>The following example queries for all rows in a <code dir="auto">Comment</code> table that contain the phrase ‚ÄúAstro DB.‚Äù Use <a href="https://orm.drizzle.team/docs/operators#like">the <code dir="auto">like()</code> operator</a> to check if a phrase is present within the <code dir="auto">body</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
import { db, Comment, like } from 'astro:db';


const comments = await db.select().from(Comment).where(
    like(Comment.body, '%Astro DB%')
);
---</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="drizzle-utilities">Drizzle utilities</h3>
<a class="sl-anchor-link" href="#drizzle-utilities"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúDrizzle utilities‚Äù</span></a>
</div> <p>All Drizzle utilities for building queries are exposed from the <code dir="auto">astro:db</code> module. This includes:</p> <ul> <li>
<a href="https://orm.drizzle.team/docs/operators">Filter operators</a> like <code dir="auto">eq()</code> and <code dir="auto">gt()</code>
</li> <li>
<a href="https://orm.drizzle.team/docs/select#aggregations-helpers">Aggregation helpers</a> like <code dir="auto">count()</code>
</li> <li>
<a href="https://orm.drizzle.team/docs/sql">The <code dir="auto">sql</code> helper</a> for writing raw SQL queries</li> </ul> <div class="expressive-code">

<pre data-language="ts">import { eq, gt, count, sql } from 'astro:db';</pre>

</div> <div class="sl-heading-wrapper level-h3">
<h3 id="relationships">Relationships</h3>
<a class="sl-anchor-link" href="#relationships"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúRelationships‚Äù</span></a>
</div> <p>You can query related data from multiple tables using a SQL join. To create a join query, extend your <code dir="auto">db.select()</code> statement with a join operator. Each function accepts a table to join with and a condition to match rows between the two tables.</p> <p>This example uses an <code dir="auto">innerJoin()</code> function to join <code dir="auto">Comment</code> authors with their related <code dir="auto">Author</code> information based on the <code dir="auto">authorId</code> column. This returns an array of objects with each <code dir="auto">Author</code> and <code dir="auto">Comment</code> row as top-level properties:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">src/pages/index.astro</span></div>
<pre data-language="astro">---
import { db, eq, Comment, Author } from 'astro:db';


const comments = await db.select()
  .from(Comment)
  .innerJoin(Author, eq(Comment.authorId, Author.id));
---


&lt;h2&gt;Comments&lt;/h2&gt;


{
  comments.map(({ Author, Comment }) =&gt; (
    &lt;article&gt;
      &lt;p&gt;Author: {Author.name}&lt;/p&gt;
      &lt;p&gt;{Comment.body}&lt;/p&gt;
    &lt;/article&gt;
  ))
}</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz"><p>See the <a href="https://orm.drizzle.team/docs/joins#join-types">Drizzle join reference</a> for all available join operators and config options.</p></span> </div> <div class="sl-heading-wrapper level-h3">
<h3 id="batch-transactions">Batch Transactions</h3>
<a class="sl-anchor-link" href="#batch-transactions"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúBatch Transactions‚Äù</span></a>
</div> <p>All remote database queries are made as a network request. You may need to ‚Äúbatch‚Äù queries together into a single transaction when making a large number of queries, or to have automatic rollbacks if any query fails.</p> <p>This example seeds multiple rows in a single request using the <code dir="auto">db.batch()</code> method:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/seed.ts</span></div>
<pre data-language="ts">import { db, Author, Comment } from 'astro:db';


export default async function () {
  const queries = [];
  // Seed 100 sample comments into your remote database
  // with a single network request.
  for (let i = 0; i &lt; 100; i++) {
    queries.push(db.insert(Comment).values({ body: `Test comment ${i}` }));
  }
  await db.batch(queries);
}</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz"><p>See the <a href="https://orm.drizzle.team/docs/batch-api">Drizzle <code dir="auto">db.batch()</code></a> docs for more details.</p></span> </div> <div class="sl-heading-wrapper level-h2">
<h2 id="pushing-changes-to-your-database">Pushing changes to your database</h2>
<a class="sl-anchor-link" href="#pushing-changes-to-your-database"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúPushing changes to your database‚Äù</span></a>
</div> <p>You can push changes made during development to your database.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="pushing-table-schemas">Pushing table schemas</h3>
<a class="sl-anchor-link" href="#pushing-table-schemas"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúPushing table schemas‚Äù</span></a>
</div> <p>Your table schema may change over time as your project grows. You can safely test configuration changes locally and push to your remote database when you deploy.</p> <p>You can push your local schema changes to your remote database via the CLI using the <code dir="auto">astro db push --remote</code> command:</p> <starlight-tabs data-sync-key="package-managers" class="astro-xtbw65nk"> <div class="tablist-wrapper not-content astro-xtbw65nk"> <ul role="tablist" class="astro-xtbw65nk"> <li role="presentation" class="tab astro-xtbw65nk"> <a role="tab" href="#tab-panel-2103" id="tab-2103" aria-selected="true" tabindex="0" class="astro-xtbw65nk"> npm </a> </li>
<li role="presentation" class="tab astro-xtbw65nk"> <a role="tab" href="#tab-panel-2104" id="tab-2104" aria-selected="false" tabindex="-1" class="astro-xtbw65nk"> pnpm </a> </li>
<li role="presentation" class="tab astro-xtbw65nk"> <a role="tab" href="#tab-panel-2105" id="tab-2105" aria-selected="false" tabindex="-1" class="astro-xtbw65nk"> Yarn </a> </li> </ul> </div> <div id="tab-panel-2103" aria-labelledby="tab-2103" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">npm run astro db push --remote</pre>

</div> </div> <div id="tab-panel-2104" aria-labelledby="tab-2104" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">pnpm astro db push --remote</pre>

</div> </div> <div id="tab-panel-2105" aria-labelledby="tab-2105" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">yarn astro db push --remote</pre>

</div> </div> <starlight-tabs-restore class="astro-xtbw65nk"></starlight-tabs-restore> </starlight-tabs> <p>This command will verify that your local changes can be made without data loss and, if necessary, suggest how to safely make changes to your schema in order to resolve conflicts.</p> <div class="sl-heading-wrapper level-h4">
<h4 id="pushing-breaking-schema-changes">Pushing breaking schema changes</h4>
<a class="sl-anchor-link" href="#pushing-breaking-schema-changes"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúPushing breaking schema changes‚Äù</span></a>
</div> <aside aria-label="Caution" class="starlight-aside starlight-aside--caution"><p class="starlight-aside__title" aria-hidden="true"><svg viewbox="0 0 24 24" width="16" height="16" fill="currentColor" class="starlight-aside__icon"><path d="M12 16C11.8022 16 11.6089 16.0587 11.4444 16.1686C11.28 16.2784 11.1518 16.4346 11.0761 16.6173C11.0004 16.8001 10.9806 17.0011 11.0192 17.1951C11.0578 17.3891 11.153 17.5673 11.2929 17.7071C11.4327 17.847 11.6109 17.9422 11.8049 17.9808C11.9989 18.0194 12.2 17.9996 12.3827 17.9239C12.5654 17.8482 12.7216 17.72 12.8315 17.5556C12.9413 17.3911 13 17.1978 13 17C13 16.7348 12.8946 16.4805 12.7071 16.2929C12.5196 16.1054 12.2652 16 12 16ZM22.67 17.47L14.62 3.47003C14.3598 3.00354 13.9798 2.61498 13.5192 2.3445C13.0586 2.07401 12.5341 1.9314 12 1.9314C11.4659 1.9314 10.9414 2.07401 10.4808 2.3445C10.0202 2.61498 9.64019 3.00354 9.38 3.47003L1.38 17.47C1.11079 17.924 0.966141 18.441 0.960643 18.9688C0.955144 19.4966 1.089 20.0166 1.34868 20.4761C1.60837 20.9356 1.9847 21.3185 2.43968 21.5861C2.89466 21.8536 3.41218 21.9964 3.94 22H20.06C20.5921 22.0053 21.1159 21.8689 21.5779 21.6049C22.0399 21.341 22.4234 20.9589 22.689 20.4978C22.9546 20.0368 23.0928 19.5134 23.0895 18.9814C23.0862 18.4493 22.9414 17.9277 22.67 17.47ZM20.94 19.47C20.8523 19.626 20.7245 19.7556 20.5697 19.8453C20.4149 19.935 20.2389 19.9815 20.06 19.98H3.94C3.76111 19.9815 3.5851 19.935 3.43032 19.8453C3.27553 19.7556 3.14765 19.626 3.06 19.47C2.97223 19.318 2.92602 19.1456 2.92602 18.97C2.92602 18.7945 2.97223 18.622 3.06 18.47L11.06 4.47003C11.1439 4.30623 11.2714 4.16876 11.4284 4.07277C11.5855 3.97678 11.766 3.92599 11.95 3.92599C12.134 3.92599 12.3145 3.97678 12.4716 4.07277C12.6286 4.16876 12.7561 4.30623 12.84 4.47003L20.89 18.47C20.9892 18.6199 21.0462 18.7937 21.055 18.9732C21.0638 19.1527 21.0241 19.3312 20.94 19.49V19.47ZM12 8.00003C11.7348 8.00003 11.4804 8.10538 11.2929 8.29292C11.1054 8.48046 11 8.73481 11 9.00003V13C11 13.2652 11.1054 13.5196 11.2929 13.7071C11.4804 13.8947 11.7348 14 12 14C12.2652 14 12.5196 13.8947 12.7071 13.7071C12.8946 13.5196 13 13.2652 13 13V9.00003C13 8.73481 12.8946 8.48046 12.7071 8.29292C12.5196 8.10538 12.2652 8.00003 12 8.00003Z"></path></svg>Caution</p>
<div class="starlight-aside__content"><p><strong>This will destroy your database</strong>. Only perform this command if you do not need your production data.</p></div></aside> <p>If you must change your table schema in a way that is incompatible with your existing data hosted on your remote database, you will need to reset your production database.</p> <p>To push a table schema update that includes a breaking change, add the <code dir="auto">--force-reset</code> flag to reset all production data:</p> <starlight-tabs data-sync-key="package-managers" class="astro-xtbw65nk"> <div class="tablist-wrapper not-content astro-xtbw65nk"> <ul role="tablist" class="astro-xtbw65nk"> <li role="presentation" class="tab astro-xtbw65nk"> <a role="tab" href="#tab-panel-2106" id="tab-2106" aria-selected="true" tabindex="0" class="astro-xtbw65nk"> npm </a> </li>
<li role="presentation" class="tab astro-xtbw65nk"> <a role="tab" href="#tab-panel-2107" id="tab-2107" aria-selected="false" tabindex="-1" class="astro-xtbw65nk"> pnpm </a> </li>
<li role="presentation" class="tab astro-xtbw65nk"> <a role="tab" href="#tab-panel-2108" id="tab-2108" aria-selected="false" tabindex="-1" class="astro-xtbw65nk"> Yarn </a> </li> </ul> </div> <div id="tab-panel-2106" aria-labelledby="tab-2106" role="tabpanel"> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">npm run astro db push --remote --force-reset</pre>

</div> </div> <div id="tab-panel-2107" aria-labelledby="tab-2107" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">pnpm astro db push --remote --force-reset</pre>

</div> </div> <div id="tab-panel-2108" aria-labelledby="tab-2108" role="tabpanel" hidden> <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">yarn astro db push --remote --force-reset</pre>

</div> </div> <starlight-tabs-restore class="astro-xtbw65nk"></starlight-tabs-restore> </starlight-tabs> <div class="sl-heading-wrapper level-h3">
<h3 id="renaming-tables">Renaming tables</h3>
<a class="sl-anchor-link" href="#renaming-tables"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúRenaming tables‚Äù</span></a>
</div> <p>It is possible to rename a table after pushing your schema to your remote database.</p> <p>If you <strong>do not have any important production data</strong>, then you can <a href="#pushing-breaking-schema-changes">reset your database</a> using the <code dir="auto">--force-reset</code> flag. This flag will drop all of the tables in the database and create new ones so that it matches your current schema exactly.</p> <p>To rename a table while preserving your production data, you must perform a series of non-breaking changes to push your local schema to your remote database safely.</p> <p>The following example renames a table from <code dir="auto">Comment</code> to <code dir="auto">Feedback</code>:</p> <ol role="list" class="sl-steps"> <li> <p>In your database config file, add the <code dir="auto">deprecated: true</code> property to the table you want to rename:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/config.ts</span></div>
<pre data-language="ts">const Comment = defineTable({
  deprecated: true,
  columns: {
    author: column.text(),
    body: column.text(),
  }
});</pre>

</div> </li> <li> <p>Add a new table schema (matching the existing table‚Äôs properties exactly) with the new name:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/config.ts</span></div>
<pre data-language="ts">const Comment = defineTable({
  deprecated: true,
  columns: {
    author: column.text(),
    body: column.text(),
  }
});
const Feedback = defineTable({
  columns: {
    author: column.text(),
    body: column.text(),
  }
});</pre>

</div> </li> <li> <p><a href="#pushing-table-schemas">Push to your remote database</a> with <code dir="auto">astro db push --remote</code>. This will add the new table and mark the old as deprecated.</p> </li> <li> <p>Update any of your local project code to use the new table instead of the old table. You might need to migrate data to the new table as well.</p> </li> <li> <p>Once you are confident that the old table is no longer used in your project, you can remove the schema from your <code dir="auto">config.ts</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/config.ts</span></div>
<pre data-language="ts">const Comment = defineTable({
  deprecated: true,
  columns: {
    author: column.text(),
    body: column.text(),
  }
});


const Feedback = defineTable({
  columns: {
    author: column.text(),
    body: column.text(),
  }
});</pre>

</div> </li> <li> <p>Push to your remote database again with <code dir="auto">astro db push --remote</code>. The old table will be dropped, leaving only the new, renamed table.</p> </li> </ol> <div class="sl-heading-wrapper level-h3">
<h3 id="pushing-table-data">Pushing table data</h3>
<a class="sl-anchor-link" href="#pushing-table-data"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúPushing table data‚Äù</span></a>
</div> <p>You may need to push data to your remote database for seeding or data migrations. You can author a <code dir="auto">.ts</code> file with the <code dir="auto">astro:db</code> module to write type-safe queries. Then, execute the file against your remote database using the command <code dir="auto">astro db execute &lt;file-path&gt; --remote</code>:</p> <p>The following Comments can be seeded using the command <code dir="auto">astro db execute db/seed.ts --remote</code>:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">db/seed.ts</span></div>
<pre data-language="ts">import { Comment } from 'astro:db';


export default async function () {
  await db.insert(Comment).values([
    { authorId: 1, body: 'Hope you like Astro DB!' },
    { authorId: 2, body: 'Enjoy!' },
  ])
}</pre>

</div> <div class="read-more astro-szj46hnz"> <svg aria-hidden="true" class="icon astro-szj46hnz astro-eytsx3ik" width="16" height="16" viewbox="0 0 24 24" fill="currentColor" style="--sl-icon-size: 1em;"><path d="M21.17 2.06A13.1 13.1 0 0 0 19 1.87a12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2 13.1 13.1 0 0 0-2.17.19 1 1 0 0 0-.83 1v12a1 1 0 0 0 1.17 1 10.9 10.9 0 0 1 8.25 1.91l.12.07h.11a.91.91 0 0 0 .7 0h.11l.12-.07A10.899 10.899 0 0 1 20.83 16 1 1 0 0 0 22 15V3a1 1 0 0 0-.83-.94ZM11 15.35a12.87 12.87 0 0 0-6-1.48H4v-10c.333-.02.667-.02 1 0a10.86 10.86 0 0 1 6 1.8v9.68Zm9-1.44h-1a12.87 12.87 0 0 0-6 1.48V5.67a10.86 10.86 0 0 1 6-1.8c.333-.02.667-.02 1 0v10.04Zm1.17 4.15a13.098 13.098 0 0 0-2.17-.19 12.94 12.94 0 0 0-7 2.05 12.94 12.94 0 0 0-7-2.05c-.727.003-1.453.066-2.17.19A1 1 0 0 0 2 19.21a1 1 0 0 0 1.17.79 10.9 10.9 0 0 1 8.25 1.91 1 1 0 0 0 1.16 0A10.9 10.9 0 0 1 20.83 20a1 1 0 0 0 1.17-.79 1 1 0 0 0-.83-1.15Z"></path></svg> <span class="astro-szj46hnz"><p>See the <a href="../integrations-guide/db/index#astro-db-cli-reference">CLI reference</a> for a complete list of commands.</p></span> </div> <div class="sl-heading-wrapper level-h2">
<h2 id="building-astro-db-integrations">Building Astro DB integrations</h2>
<a class="sl-anchor-link" href="#building-astro-db-integrations"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúBuilding Astro DB integrations‚Äù</span></a>
</div> <p><a href="../../reference/integrations-reference/index">Astro integrations</a> can extend user projects with additional Astro DB tables and seed data.</p> <p>Use the <code dir="auto">extendDb()</code> method in the <code dir="auto">astro:db:setup</code> hook to register additional Astro DB config and seed files. The <code dir="auto">defineDbIntegration()</code> helper provides TypeScript support and auto-complete for the <code dir="auto">astro:db:setup</code> hook.</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-integration/index.ts</span></div>
<pre data-language="js">import { defineDbIntegration } from '@astrojs/db/utils';


export default function MyIntegration() {
  return defineDbIntegration({
    name: 'my-astro-db-powered-integration',
    hooks: {
      'astro:db:setup': ({ extendDb }) =&gt; {
        extendDb({
          configEntrypoint: '@astronaut/my-package/config',
          seedEntrypoint: '@astronaut/my-package/seed',
        });
      },
      // Other integration hooks...
    },
  });
}</pre>

</div> <p>Integration <a href="#define-your-database">config</a> and <a href="#seed-your-database-for-development">seed</a> files follow the same format as their user-defined equivalents.</p> <div class="sl-heading-wrapper level-h3">
<h3 id="type-safe-operations-in-integrations">Type safe operations in integrations</h3>
<a class="sl-anchor-link" href="#type-safe-operations-in-integrations"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúType safe operations in integrations‚Äù</span></a>
</div> <p>While working on integrations, you may not be able to benefit from Astro‚Äôs generated table types exported from <code dir="auto">astro:db</code>. For full type safety, use the <code dir="auto">asDrizzleTable()</code> utility to create a table reference object you can use for database operations.</p> <p>For example, given an integration setting up the following <code dir="auto">Pets</code> database table:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-integration/config.ts</span></div>
<pre data-language="js">import { defineDb, defineTable, column } from 'astro:db';


export const Pets = defineTable({
  columns: {
    name: column.text(),
    species: column.text(),
  },
});


export default defineDb({ tables: { Pets } });</pre>

</div> <p>The seed file can import <code dir="auto">Pets</code> and use <code dir="auto">asDrizzleTable()</code> to insert rows into your table with type checking:</p> <div class="expressive-code">
<div class="_pre-heading"><span class="title">my-integration/seed.ts</span></div>
<pre data-language="js">import { asDrizzleTable } from '@astrojs/db/utils';
import { db } from 'astro:db';
import { Pets } from './config';


export default async function() {
  const typeSafePets = asDrizzleTable('Pets', Pets);


  await db.insert(typeSafePets).values([
    { name: 'Palomita', species: 'cat' },
    { name: 'Pan', species: 'dog' },
  ]);
}</pre>

</div> <p>The value returned by <code dir="auto">asDrizzleTable('Pets', Pets)</code> is equivalent to <code dir="auto">import { Pets } from 'astro:db'</code>, but is available even when Astro‚Äôs type generation can‚Äôt run. You can use it in any integration code that needs to query or insert into the database.</p> <div class="sl-heading-wrapper level-h2">
<h2 id="migrate-from-astro-studio-to-turso">Migrate from Astro Studio to Turso</h2>
<a class="sl-anchor-link" href="#migrate-from-astro-studio-to-turso"><span aria-hidden="true" class="sl-anchor-icon"><svg width="16" height="16" viewbox="0 0 24 24"><path fill="currentcolor" d="m12.11 15.39-3.88 3.88a2.52 2.52 0 0 1-3.5 0 2.47 2.47 0 0 1 0-3.5l3.88-3.88a1 1 0 0 0-1.42-1.42l-3.88 3.89a4.48 4.48 0 0 0 6.33 6.33l3.89-3.88a1 1 0 1 0-1.42-1.42Zm8.58-12.08a4.49 4.49 0 0 0-6.33 0l-3.89 3.88a1 1 0 0 0 1.42 1.42l3.88-3.88a2.52 2.52 0 0 1 3.5 0 2.47 2.47 0 0 1 0 3.5l-3.88 3.88a1 1 0 1 0 1.42 1.42l3.88-3.89a4.49 4.49 0 0 0 0-6.33ZM8.83 15.17a1 1 0 0 0 1.1.22 1 1 0 0 0 .32-.22l4.92-4.92a1 1 0 0 0-1.42-1.42l-4.92 4.92a1 1 0 0 0 0 1.42Z"></path></svg></span><span class="sr-only">Section titled ‚ÄúMigrate from Astro Studio to Turso‚Äù</span></a>
</div> <ol role="list" class="sl-steps"> <li>In the <a href="https://studio.astro.build/">Studio dashboard</a>, navigate to the project you wish to migrate. In the settings tab, use the ‚ÄúExport Database‚Äù button to download a dump of your database.</li> <li>Follow the official instructions to <a href="https://docs.turso.tech/cli/installation">install the Turso CLI</a> and <a href="https://docs.turso.tech/cli/authentication">sign up or log in</a> to your Turso account.</li> <li>Create a new database on Turso using the <code dir="auto">turso db create</code> command. <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">turso db create [database-name]</pre>

</div> </li> <li>Fetch the database URL using the Turso CLI, and use it as the environment variable <code dir="auto">ASTRO_DB_REMOTE_URL</code>. <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">turso db show [database-name]</pre>

</div> <div class="expressive-code">

<pre data-language="dotenv">ASTRO_DB_REMOTE_URL=[your-database-url]</pre>

</div> </li> <li>Create a token to access your database, and use it as the environment variable <code dir="auto">ASTRO_DB_APP_TOKEN</code>. <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">turso db tokens create [database-name]</pre>

</div> <div class="expressive-code">

<pre data-language="dotenv">ASTRO_DB_APP_TOKEN=[your-app-token]</pre>

</div> </li> <li>Push your DB schema and metadata to the new Turso database. <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">astro db push --remote</pre>

</div> </li> <li>Import the database dump from step 1 into your new Turso DB. <div class="expressive-code">
<div class="_pre-heading">
<span class="sr-only">Terminal window</span>
</div>
<pre data-language="sh">turso db shell [database-name] &lt; ./path/to/dump.sql</pre>

</div> </li> <li>Once you have confirmed your project connects to the new database, you can safely delete the project from Astro Studio.</li> </ol> <span id="docsearch-lvl0" hidden>Learn</span> </div> <div class="hide-when-toc-is-visible astro-o5o7wsh2"> <div class="container astro-zwxhm4ix" lang="en" dir="ltr" data-algolia-exclude> <aside aria-labelledby="learn-astro-course-1" class="astro-zwxhm4ix"> <div class="graphics astro-zwxhm4ix"> <img src="data:image/webp;base64,UklGRuQBAABXRUJQVlA4WAoAAAAQAAAARwAARwAAQUxQSBIAAAABD9D/iAgICRKm+z+aIvqfLgxWUDggrAEAANANAJ0BKkgASAA+bSyQRiQvI6EwtOwB4A2JYwDG7ApEmQTzrdjsTkQzIBD+xzUh0lK3EX6+lo0SCwRPGsgIGouWHJ2/nnSC9HGXEl2gpNNAYWRIW6VJ/K32YOrQKSEuKouno9R49M0eHE5iXb3aonSnft3gbtsAAP7w1R/RCOMR3YSO8dX6PK4mdXb+xC9xMW1jRYuDmnAY9270+m9BomJwqQ3dS4e/wb3PBG6f3XR0+vwd1aCpD6/39Q3FfzrpzNkiA3GXnChlpsJimbR9u+t3F/W1NvSBwbqU3GLXZQFNLWH1SKzuq+KfhFypeOnfRiBH6+kzyNj+Sr84yQmVvisMqHD24nmzW7XfBHlC2NvstZ+VChFGkasDLlfX5EEomwykq/uSu9zggr/z8g984C2ffX5fZWkhLaquVhVD5XOLiMnVhGhSt/hiuogfyH0+d8eN1XWUESYvySWIQRk4O3AgPqjYBgx/FfSWMMt/q8FCgeKPiFzuTksEY6gSwOPtQlvtY8Hzpb30kv5b6/8GtspkOOxWaYugHtREhWXRs0GNMszhFvbgbNIQ3gAA" alt="Scrimba" loading="lazy" decoding="async" fetchpriority="auto" width="72" height="72" class="scrimba-bubble astro-zwxhm4ix"> <img src="data:image/webp;base64,UklGRvoDAABXRUJQVlA4IO4DAAAwEwCdASpIAEgAPmkskkWkIqGY/AV0QAaEoAw21BVt60ZuePWKZ7zbq872zZ/BpVOcprJG6rUF6VCYw1xb+cknsA2zq7LlFTOPhOQtATm7HQCmwZKYCP2/dKDnOQt7NjOTAyXsaLlh+zawtCgXbADYXiJ78rCNCSRmA0/LsXRb2sQPi+1njYrG+r/+veKiFtqbnBkd8NcaO7yBLmepdcRhtsAA/vI7s9UG/cHtR7mErbfZieOcsg2DNyNpmynibwMFtVQef5zaA7TMoJGeF8ZOcgdG8Er7tclM1e6nPNHl69JJXCAPZvnxCxpO2uTtDJrodA26cvmxQQRG1osnWaQL8gzEfbb9AymNt0YwkidzbpO68jtwhcVB/Khj7HiXSxGx8URFmy2UtH8+xdlks6V8fP0pT6zmOMagal1b9Jf762OX75NigFcpE9SWLHPhSly+paFUghIpZd7ss4todtwb6mRTt9gLt12PZuOYcmgID8tePqFSru9ZkPVhc5jgFSDU1WaHvTxmRlqcsvuDwfCy7z357VyaavcFutcm7Nep/gdnZzsOn8I+eCrn8bvqakVt5w04DvVvqXoUkKOrw5DPMJrSR812/a6uheTmYgQMvhX7B4hIauWJp4kGPY+WS80BIeWjCAJmOgcjGATirHcyVBl5FsqjCDEUuEiPJdDgAeLvOiPdfRO4fsJd59FulhfX7OfqSz+wwD4sX6CG+7ByT5TVKoiE2jP5MNDz0yzDYuFsA7FNW8nV/U7qJAjgunKSmMMWnmN0U9/9qgYf3s1DilDDsu+FRNKwbHBXxslf6FzG3Rrc3zDAFJ+NsdudY4oHjnczojMc3supGmXFnQsfGZCHPQxn40mO9HsI1oKHH4RJ/dXss6sljuPOmx8YmrGlqBkpnmskLUM2j8p+6kMkCyYyhu+kAtDc8dCxhqbYn8yxHrGePRLyWeYzHj5qloBC+QY3fxoUYTfrSI2ZRGJ8EFp87vEPa+79jTG6fhKPVFxXq388UgLsm2KMRsa0wDXZUXSj4J7qzc7639E9TbdX8i7vu2zlw/4Innob9+Q+He4ic1y7Cw9V4TaFGAHKYJA3Ehpxob31bguhmHdlSkl0dHBTGk/LVrpMowPKfHj2cKw9XsJH7mMS0N1q1vOM4izTLT2AZtLzEfoUDe0qanVJpROTrsm/xrv9H0nzqX3eGHloUpwYGI770bMf3EnYYxl90jeYEdq8PiuFqEbpZDGDEP7j40ukUnQvULXa9UmRGSEIbov/GuSB7ne4hikpbd+KINukzOFouwlpM787dgH6+Ur8DqoBunjMA2wARrTdAi1rbnQAoKiCqw4YAAAA" alt loading="lazy" decoding="async" fetchpriority="auto" width="72" height="72" class="astro-zwxhm4ix"> </div> <h2 id="learn-astro-course-1" class="astro-zwxhm4ix"> <strong class="astro-zwxhm4ix">Learn Astro</strong> with James Q Quick </h2> <p class="astro-zwxhm4ix">Build your first site with 35 interactive Scrimba lessons</p> <a class="sl-link-button not-content primary cta astro-zwxhm4ix astro-n3qr5j5k" href="https://scrimba.com/intro-to-astro-c00ar0fi5u?via=astro" data-scrimba-cta="true"> Get 20% off </a> </aside> </div>  </div>   </div> </div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021 Fred K. Schott<br>Licensed under the MIT License.<br>
    <a href="https://docs.astro.build/en/guides/astro-db/" class="_attribution-link">https://docs.astro.build/en/guides/astro-db/</a>
  </p>
</div>
