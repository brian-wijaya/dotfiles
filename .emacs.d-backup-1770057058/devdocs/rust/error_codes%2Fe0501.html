<h1 id="error-code-e0501">Error code E0501</h1> <p>A mutable variable is used but it is already captured by a closure.</p> <p>Erroneous code example:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
fn inside_closure(x: &amp;mut i32) {
    // Actions which require unique access
}

fn outside_closure(x: &amp;mut i32) {
    // Actions which require unique access
}

fn foo(a: &amp;mut i32) {
    let mut bar = || {
        inside_closure(a)
    };
    outside_closure(a); // error: cannot borrow `*a` as mutable because previous
                        //        closure requires unique access.
    bar();
}
}</pre> <p>This error indicates that a mutable variable is used while it is still captured by a closure. Because the closure has borrowed the variable, it is not available until the closure goes out of scope.</p> <p>Note that a capture will either move or borrow a variable, but in this situation, the closure is borrowing the variable. Take a look at the chapter on <a href="https://doc.rust-lang.org/stable/rust-by-example/fn/closures/capture.html">Capturing</a> in Rust By Example for more information.</p> <p>To fix this error, you can finish using the closure before using the captured variable:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
fn inside_closure(x: &amp;mut i32) {}
fn outside_closure(x: &amp;mut i32) {}

fn foo(a: &amp;mut i32) {
    let mut bar = || {
        inside_closure(a)
    };
    bar();
    // borrow on `a` ends.
    outside_closure(a); // ok!
}
}</pre> <p>Or you can pass the variable as a parameter to the closure:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
fn inside_closure(x: &amp;mut i32) {}
fn outside_closure(x: &amp;mut i32) {}

fn foo(a: &amp;mut i32) {
    let mut bar = |s: &amp;mut i32| {
        inside_closure(s)
    };
    outside_closure(a);
    bar(a);
}
}</pre> <p>It may be possible to define the closure later:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
fn inside_closure(x: &amp;mut i32) {}
fn outside_closure(x: &amp;mut i32) {}

fn foo(a: &amp;mut i32) {
    outside_closure(a);
    let mut bar = || {
        inside_closure(a)
    };
    bar();
}
}</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/error_codes/E0501.html" class="_attribution-link">https://doc.rust-lang.org/error_codes/E0501.html</a>
  </p>
</div>
