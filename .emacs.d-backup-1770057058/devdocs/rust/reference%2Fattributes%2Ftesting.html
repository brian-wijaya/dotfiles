 <h1 id="testing-attributes">Testing attributes</h1> <p>The following <a href="../attributes">attributes</a> are used for specifying functions for performing tests. Compiling a crate in “test” mode enables building the test functions along with a test harness for executing the tests. Enabling the test mode also enables the <a href="../conditional-compilation#test"><code>test</code> conditional compilation option</a>.</p>   <h2 id="the-test-attribute">The <code id="">test</code> attribute</h2>  <p>The <em><code>test</code> <a href="../attributes">attribute</a></em> marks a function to be executed as a test.</p> <div class="alert alert-example"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>Example</p> <pre data-language="rust">#![allow(unused)]
fn main() {
pub fn add(left: u64, right: u64) -&gt; u64 { left + right }
#[test]
fn it_works() {
    let result = add(2, 2);
    assert_eq!(result, 4);
}
}</pre> </blockquote> </div>  <p>The <code>test</code> attribute uses the <a href="../attributes#grammar-MetaWord">MetaWord</a> syntax.</p>  <p>The <code>test</code> attribute may only be applied to <a href="../glossary#free-item">free functions</a> that are monomorphic, that take no arguments, and where the return type implements the <a href="../../std/process/trait.termination"><code>Termination</code></a> trait.</p> <div class="alert alert-note"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p> <p>Some of types that implement the <a href="../../std/process/trait.termination"><code>Termination</code></a> trait include:</p> <ul> <li><code>()</code></li> <li><code>Result&lt;T, E&gt; where T: Termination, E: Debug</code></li> </ul> </blockquote> </div>  <p>Only the first use of <code>test</code> on a function has effect.</p> <div class="alert alert-note"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p> <p><code>rustc</code> lints against any use following the first. This may become an error in the future.</p> </blockquote> </div>   <p>The <code>test</code> attribute is exported from the standard library prelude as <a href="https://doc.rust-lang.org/core/macros/builtin/attr.test.html"><code>std::prelude::v1::test</code></a>.</p>  <p>These functions are only compiled when in test mode.</p> <div class="alert alert-note"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p> <p>The test mode is enabled by passing the <code>--test</code> argument to <code>rustc</code> or using <code>cargo test</code>.</p> </blockquote> </div>  <p>The test harness calls the returned value’s <a href="../../std/process/trait.termination#tymethod.report"><code>report</code></a> method, and classifies the test as passed or failed depending on whether the resulting <a href="../../std/process/struct.exitcode"><code>ExitCode</code></a> represents successful termination. In particular:</p> <ul> <li>Tests that return <code>()</code> pass as long as they terminate and do not panic.</li> <li>Tests that return a <code>Result&lt;(), E&gt;</code> pass as long as they return <code>Ok(())</code>.</li> <li>Tests that return <code>ExitCode::SUCCESS</code> pass, and tests that return <code>ExitCode::FAILURE</code> fail.</li> <li>Tests that do not terminate neither pass nor fail.</li> </ul> <div class="alert alert-example"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>Example</p> <pre data-language="rust">#![allow(unused)]
fn main() {
use std::io;
fn setup_the_thing() -&gt; io::Result&lt;i32&gt; { Ok(1) }
fn do_the_thing(s: &amp;i32) -&gt; io::Result&lt;()&gt; { Ok(()) }
#[test]
fn test_the_thing() -&gt; io::Result&lt;()&gt; {
    let state = setup_the_thing()?; // expected to succeed
    do_the_thing(&amp;state)?;          // expected to succeed
    Ok(())
}
}</pre> </blockquote> </div>   <h2 id="the-ignore-attribute">The <code id="">ignore</code> attribute</h2>  <p>The <em><code>ignore</code> <a href="../attributes">attribute</a></em> can be used with the <a href="testing#r-attributes.testing.test"><code>test</code> attribute</a> to tell the test harness to not execute that function as a test.</p> <div class="alert alert-example"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>Example</p> <pre data-language="rust">#![allow(unused)]
fn main() {
#[test]
#[ignore]
fn check_thing() {
    // …
}
}</pre> </blockquote> </div> <div class="alert alert-note"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p> <p>The <code>rustc</code> test harness supports the <code>--include-ignored</code> flag to force ignored tests to be run.</p> </blockquote> </div>  <p>The <code>ignore</code> attribute uses the <a href="../attributes#grammar-MetaWord">MetaWord</a> and <a href="../attributes#grammar-MetaNameValueStr">MetaNameValueStr</a> syntaxes.</p>  <p>The <a href="../attributes#grammar-MetaNameValueStr">MetaNameValueStr</a> form of the <code>ignore</code> attribute provides a way to specify a reason why the test is ignored.</p> <div class="alert alert-example"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>Example</p> <pre data-language="rust">#![allow(unused)]
fn main() {
#[test]
#[ignore = "not yet implemented"]
fn mytest() {
    // …
}
}</pre> </blockquote> </div>  <p>The <code>ignore</code> attribute may only be applied to functions annotated with the <code>test</code> attribute.</p> <div class="alert alert-note"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p> <p><code>rustc</code> ignores use in other positions but lints against it. This may become an error in the future.</p> </blockquote> </div>  <p>Only the first use of <code>ignore</code> on a function has effect.</p> <div class="alert alert-note"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p> <p><code>rustc</code> lints against any use following the first. This may become an error in the future.</p> </blockquote> </div>  <p>Ignored tests are still compiled when in test mode, but they are not executed.</p>   <h2 id="the-should_panic-attribute">The <code id="">should_panic</code> attribute</h2>  <p>The <em><code>should_panic</code> <a href="../attributes">attribute</a></em> causes a test to pass only if the <a href="testing#r-attributes.testing.test">test function</a> to which the attribute is applied panics.</p> <div class="alert alert-example"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>Example</p> <pre data-language="rust">#![allow(unused)]
fn main() {
#[test]
#[should_panic(expected = "values don't match")]
fn mytest() {
    assert_eq!(1, 2, "values don't match");
}
}</pre> </blockquote> </div>  <p>The <code>should_panic</code> attribute has these forms:</p> <ul> <li> <p><a href="../attributes#grammar-MetaWord">MetaWord</a></p> <div class="alert alert-example"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>Example</p> <pre data-language="rust">#![allow(unused)]
fn main() {
#[test]
#[should_panic]
fn mytest() { panic!("error: some message, and more"); }
}</pre> </blockquote> </div> </li> <li> <p><a href="../attributes#grammar-MetaNameValueStr">MetaNameValueStr</a> — The given string must appear within the panic message for the test to pass.</p> <div class="alert alert-example"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>Example</p> <pre data-language="rust">#![allow(unused)]
fn main() {
#[test]
#[should_panic = "some message"]
fn mytest() { panic!("error: some message, and more"); }
}</pre> </blockquote> </div> </li> <li> <p><a href="../attributes#grammar-MetaListNameValueStr">MetaListNameValueStr</a> — As with the <a href="../attributes#grammar-MetaNameValueStr">MetaNameValueStr</a> syntax, the given string must appear within the panic message.</p> <div class="alert alert-example"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0ZM1.5 8a6.5 6.5 0 1 0 13 0 6.5 6.5 0 0 0-13 0Zm4.879-2.773 4.264 2.559a.25.25 0 0 1 0 .428l-4.264 2.559A.25.25 0 0 1 6 10.559V5.442a.25.25 0 0 1 .379-.215Z"></path></svg>Example</p> <pre data-language="rust">#![allow(unused)]
fn main() {
#[test]
#[should_panic(expected = "some message")]
fn mytest() { panic!("error: some message, and more"); }
}</pre> </blockquote> </div> </li> </ul>  <p>The <code>should_panic</code> attribute may only be applied to functions annotated with the <code>test</code> attribute.</p> <div class="alert alert-note"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p> <p><code>rustc</code> ignores use in other positions but lints against it. This may become an error in the future.</p> </blockquote> </div>  <p>Only the first use of <code>should_panic</code> on a function has effect.</p> <div class="alert alert-note"> <blockquote> <p class="alert-title"><svg viewbox="0 0 16 16" width="18" height="18"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg>Note</p> <p><code>rustc</code> lints against any use following the first with a future-compatibility warning. This may become an error in the future.</p> </blockquote> </div>  <p>When the <a href="../attributes#grammar-MetaNameValueStr">MetaNameValueStr</a> form or the <a href="../attributes#grammar-MetaListNameValueStr">MetaListNameValueStr</a> form with the <code>expected</code> key is used, the given string must appear somewhere within the panic message for the test to pass.</p>  <p>The return type of the test function must be <code>()</code>.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/reference/attributes/testing.html" class="_attribution-link">https://doc.rust-lang.org/reference/attributes/testing.html</a>
  </p>
</div>
