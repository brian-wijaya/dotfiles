 <h1 id="closure-expressions">Closure expressions</h1>  <div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-ClosureExpression"><a href="closure-expr#railroad-ClosureExpression">ClosureExpression</a></span> → <br>
    <code class="grammar-literal">async</code><sup>?</sup>​<sup class="footnote-reference" id="fr-cl-async-edition-1"><a href="#footnote-cl-async-edition">1</a></sup> <br>
    <code class="grammar-literal">move</code><sup>?</sup> <br>
    ( <code class="grammar-literal">||</code> | <code class="grammar-literal">|</code> <span class="grammar-text"><a href="closure-expr#grammar-ClosureParameters">ClosureParameters</a></span><sup>?</sup> <code class="grammar-literal">|</code> ) <br>
    ( <span class="grammar-text"><a href="../expressions#grammar-Expression">Expression</a></span> | <code class="grammar-literal">-&gt;</code> <span class="grammar-text"><a href="../types#grammar-TypeNoBounds">TypeNoBounds</a></span> <span class="grammar-text"><a href="block-expr#grammar-BlockExpression">BlockExpression</a></span> )</p>
<p><span class="grammar-text grammar-production" id="grammar-ClosureParameters"><a href="closure-expr#railroad-ClosureParameters">ClosureParameters</a></span> → <span class="grammar-text"><a href="closure-expr#grammar-ClosureParam">ClosureParam</a></span> ( <code class="grammar-literal">,</code> <span class="grammar-text"><a href="closure-expr#grammar-ClosureParam">ClosureParam</a></span> )<sup>*</sup> <code class="grammar-literal">,</code><sup>?</sup></p>
<p><span class="grammar-text grammar-production" id="grammar-ClosureParam"><a href="closure-expr#railroad-ClosureParam">ClosureParam</a></span> → <span class="grammar-text"><a href="../attributes#grammar-OuterAttribute">OuterAttribute</a></span><sup>*</sup> <span class="grammar-text"><a href="../patterns#grammar-PatternNoTopAlt">PatternNoTopAlt</a></span> ( <code class="grammar-literal">:</code> <span class="grammar-text"><a href="../types#grammar-Type">Type</a></span> )<sup>?</sup></p>

<details class="grammar-railroad grammar-hidden"><summary>Syntax diagram</summary> <div style="width: 466px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClosureExpression">
<svg class="railroad" viewbox="0 0 466 320" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <rect class="railroad_canvas" height="100%" width="100%"></rect> <g class="verticalgrid"> <a class="link" xlink:href="closure-expr#grammar-ClosureExpression"> <text class="comment" x="74" y="25"> ClosureExpression</text> </a> <g class="sequence"> <path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5"></path> <g class="stack"> <path d=" M 35 66 h 12"></path> <path d=" M 155 66 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -108 m 57 0 l 5 -5 m 0 10 l -5 -5 m -57 0 a 12 12 0 0 0 -12 12 v 12 v 0 a 12 12 0 0 0 12 12 h 0"></path> <g class="sequence"> <g class="optional"> <path d=" M 47 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 60 m -27 0 l -5 -5 m 0 10 l 5 -5 m 27 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="terminal"> <rect height="22" rx="10" ry="10" width="60" x="71" y="55"></rect> <text x="101" y="71"> async</text> </g> </g> </g> <path d=" M 147 126 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 h -100 m 53 0 l 5 -5 m 0 10 l -5 -5 m -53 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0"></path> <g class="sequence"> <g class="optional"> <path d=" M 47 126 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 52 m -23 0 l -5 -5 m 0 10 l 5 -5 m 23 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="terminal"> <rect height="22" rx="10" ry="10" width="52" x="71" y="115"></rect> <text x="97" y="131"> move</text> </g> </g> </g> <path d=" M 375 174 a 12 12 0 0 1 12 12 v 44 a 12 12 0 0 1 -12 12 h -328 m 167 0 l 5 -5 m 0 10 l -5 -5 m -167 0 a 12 12 0 0 0 -12 12 v 0 v 0 a 12 12 0 0 0 12 12 h 0"></path> <g class="sequence"> <g class="choice"> <path d=" M 47 174 h 24 m 36 0 h 268 m -131 0 l -5 -5 m 0 10 l 5 -5 m 131 0"></path> <g class="terminal"> <rect height="22" rx="10" ry="10" width="36" x="71" y="163"></rect> <text x="89" y="179"> ||</text> </g> <path d=" M 47 174 a 12 12 0 0 1 12 12 v 9 m 304 0 v -9 a 12 12 0 0 1 12 -12"></path> <path d=" M 59 195 v 12 a 12 12 0 0 0 12 12 m 280 0 h 0 a 12 12 0 0 0 12 -12 v -12"></path> <g class="sequence"> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="71" y="208"></rect> <text x="85" y="224"> |</text> </g> <g class="optional"> <path d=" M 109 219 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <a class="link" xlink:href="closure-expr#railroad-ClosureParameters"> <g class="nonterminal"> <rect height="22" width="156" x="133" y="208"></rect> <text x="211" y="224"> ClosureParameters</text> </g> </a> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="323" y="208"></rect> <text x="337" y="224"> |</text> </g> <path d=" M 99 219 h 10"></path> <path d=" M 313 219 h 10"></path> </g> </g> </g> <path d=" M 407 266 h 0 a 12 12 0 0 0 12 -12 v -176 m 0 91 l -5 5 m 10 0 l -5 -5 m 0 -91 a 12 12 0 0 1 12 -12"></path> <g class="sequence"> <g class="choice"> <path d=" M 47 266 h 24 m 100 0 h 236 m -115 0 l -5 -5 m 0 10 l 5 -5 m 115 0"></path> <a class="link" xlink:href="../expressions#railroad-Expression"> <g class="nonterminal"> <rect height="22" width="100" x="71" y="255"></rect> <text x="121" y="271"> Expression</text> </g> </a> <path d=" M 47 266 a 12 12 0 0 1 12 12 v 9 m 336 0 v -9 a 12 12 0 0 1 12 -12"></path> <path d=" M 59 287 v 0 a 12 12 0 0 0 12 12 m 312 0 h 0 a 12 12 0 0 0 12 -12 v 0"></path> <g class="sequence"> <g class="terminal"> <rect height="22" rx="10" ry="10" width="36" x="71" y="288"></rect> <text x="89" y="304"> -&gt;</text> </g> <a class="link" xlink:href="../types#railroad-TypeNoBounds"> <g class="nonterminal"> <rect height="22" width="116" x="117" y="288"></rect> <text x="175" y="304"> TypeNoBounds</text> </g> </a> <a class="link" xlink:href="block-expr#railroad-BlockExpression"> <g class="nonterminal"> <rect height="22" width="140" x="243" y="288"></rect> <text x="313" y="304"> BlockExpression</text> </g> </a> <path d=" M 107 299 h 10"></path> <path d=" M 233 299 h 10"></path> </g> </g> </g> </g> <path d=" M 441 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5"></path> <path d=" M 25 66 h 10"></path> <path d=" M 431 66 h 10"></path> </g> </g> </svg> </div> <div style="width: 508px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClosureParameters">
<svg class="railroad" viewbox="0 0 508 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <rect class="railroad_canvas" height="100%" width="100%"></rect> <g class="verticalgrid"> <a class="link" xlink:href="closure-expr#grammar-ClosureParameters"> <text class="comment" x="74" y="25"> ClosureParameters</text> </a> <g class="sequence"> <path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5"></path> <g class="sequence"> <a class="link" xlink:href="closure-expr#railroad-ClosureParam"> <g class="nonterminal"> <rect height="22" width="116" x="35" y="55"></rect> <text x="93" y="71"> ClosureParam</text> </g> </a> <g class="optional"> <path d=" M 161 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 178 m -86 0 l -5 -5 m 0 10 l 5 -5 m 86 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="repeat"> <path d=" M 185 66 h 12 m 154 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -154 m 80 0 l 5 -5 m 0 10 l -5 -5 m -80 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12"></path>  <g class="sequence"> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="197" y="55"></rect> <text x="211" y="71"> ,</text> </g> <a class="link" xlink:href="closure-expr#railroad-ClosureParam"> <g class="nonterminal"> <rect height="22" width="116" x="235" y="55"></rect> <text x="293" y="71"> ClosureParam</text> </g> </a> <path d=" M 225 66 h 10"></path> </g> </g> </g> <g class="optional"> <path d=" M 397 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 28 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="421" y="55"></rect> <text x="435" y="71"> ,</text> </g> </g> <path d=" M 151 66 h 10"></path> <path d=" M 387 66 h 10"></path> </g> <path d=" M 483 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5"></path> <path d=" M 25 66 h 10"></path> <path d=" M 473 66 h 10"></path> </g> </g> </svg> </div> <div style="width: 572px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-ClosureParam">
<svg class="railroad" viewbox="0 0 572 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <rect class="railroad_canvas" height="100%" width="100%"></rect> <g class="verticalgrid"> <a class="link" xlink:href="closure-expr#grammar-ClosureParam"> <text class="comment" x="57" y="25"> ClosureParam</text> </a> <g class="sequence"> <path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5"></path> <g class="sequence"> <g class="optional"> <path d=" M 35 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 156 m -75 0 l -5 -5 m 0 10 l 5 -5 m 75 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="repeat"> <path d=" M 59 66 h 12 m 132 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -132 m 69 0 l 5 -5 m 0 10 l -5 -5 m -69 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12"></path>  <a class="link" xlink:href="../attributes#railroad-OuterAttribute"> <g class="nonterminal"> <rect height="22" width="132" x="71" y="55"></rect> <text x="137" y="71"> OuterAttribute</text> </g> </a> </g> </g> <a class="link" xlink:href="../patterns#railroad-PatternNoTopAlt"> <g class="nonterminal"> <rect height="22" width="140" x="249" y="55"></rect> <text x="319" y="71"> PatternNoTopAlt</text> </g> </a> <g class="optional"> <path d=" M 399 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 90 m -42 0 l -5 -5 m 0 10 l 5 -5 m 42 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="sequence"> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="423" y="55"></rect> <text x="437" y="71"> :</text> </g> <a class="link" xlink:href="../types#railroad-Type"> <g class="nonterminal"> <rect height="22" width="52" x="461" y="55"></rect> <text x="487" y="71"> Type</text> </g> </a> <path d=" M 451 66 h 10"></path> </g> </g> <path d=" M 239 66 h 10"></path> <path d=" M 389 66 h 10"></path> </g> <path d=" M 547 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5"></path> <path d=" M 25 66 h 10"></path> <path d=" M 537 66 h 10"></path> </g> </g> </svg> </div> </details>
</div>   <p>A <em>closure expression</em>, also known as a lambda expression or a lambda, defines a <a href="../types/closure">closure type</a> and evaluates to a value of that type. The syntax for a closure expression is an optional <code>async</code> keyword, an optional <code>move</code> keyword, then a pipe-symbol-delimited (<code>|</code>) comma-separated list of <a href="../patterns">patterns</a>, called the <em>closure parameters</em> each optionally followed by a <code>:</code> and a type, then an optional <code>-&gt;</code> and type, called the <em>return type</em>, and then an expression, called the <em>closure body operand</em>.</p>  <p>The optional type after each pattern is a type annotation for the pattern.</p>  <p>If there is a return type, the closure body must be a <a href="block-expr">block</a>.</p>  <p>A closure expression denotes a function that maps a list of parameters onto the expression that follows the parameters. Just like a <a href="../statements#let-statements"><code>let</code> binding</a>, the closure parameters are irrefutable <a href="../patterns">patterns</a>, whose type annotation is optional and will be inferred from context if not given.</p>  <p>Each closure expression has a unique, anonymous type.</p>  <p>Significantly, closure expressions <em>capture their environment</em>, which regular <a href="../items/functions">function definitions</a> do not.</p>  <p>Without the <code>move</code> keyword, the closure expression <a href="../types/closure#capture-modes">infers how it captures each variable from its environment</a>, preferring to capture by shared reference, effectively borrowing all outer variables mentioned inside the closure’s body.</p>  <p>If needed the compiler will infer that instead mutable references should be taken, or that the values should be moved or copied (depending on their type) from the environment.</p>  <p>A closure can be forced to capture its environment by copying or moving values by prefixing it with the <code>move</code> keyword. This is often used to ensure that the closure’s lifetime is <code>'static</code>.</p>  <h2 id="closure-trait-implementations">Closure trait implementations</h2> <p>Which traits the closure type implement depends on how variables are captured, the types of the captured variables, and the presence of <code>async</code>. See the <a href="../types/closure#call-traits-and-coercions">call traits and coercions</a> chapter for how and when a closure implements <code>Fn</code>, <code>FnMut</code>, and <code>FnOnce</code>. The closure type implements <a href="../special-types-and-traits#send"><code>Send</code></a> and <a href="../special-types-and-traits#sync"><code>Sync</code></a> if the type of every captured variable also implements the trait.</p>  <h2 id="async-closures">Async closures</h2>  <p>Closures marked with the <code>async</code> keyword indicate that they are asynchronous in an analogous way to an <a href="../items/functions#r-items.fn.async">async function</a>.</p>  <p>Calling the async closure does not perform any work, but instead evaluates to a value that implements <a href="https://doc.rust-lang.org/core/future/future/trait.Future.html"><code>Future</code></a> that corresponds to the computation of the body of the closure.</p> <pre data-language="rust">#![allow(unused)]
fn main() {
async fn takes_async_callback(f: impl AsyncFn(u64)) {
    f(0).await;
    f(1).await;
}

async fn example() {
    takes_async_callback(async |i| {
        core::future::ready(i).await;
        println!("done with {i}.");
    }).await;
}
}</pre>  <div class="alert alert-edition"> <blockquote> <p class="alert-title"><span class="alert-title-edition">2018</span> Edition differences</p> <p>Async closures are only available beginning with Rust 2018.</p> </blockquote> </div> <h2 id="example">Example</h2> <p>In this example, we define a function <code>ten_times</code> that takes a higher-order function argument, and we then call it with a closure expression as an argument, followed by a closure expression that moves values from its environment.</p> <pre data-language="rust">#![allow(unused)]
fn main() {
fn ten_times&lt;F&gt;(f: F) where F: Fn(i32) {
    for index in 0..10 {
        f(index);
    }
}

ten_times(|j| println!("hello, {}", j));
// With type annotations
ten_times(|j: i32| -&gt; () { println!("hello, {}", j) });

let word = "konnichiwa".to_owned();
ten_times(move |j| println!("{}, {}", word, j));
}</pre> <h2 id="attributes-on-closure-parameters">Attributes on closure parameters</h2>  <p>Attributes on closure parameters follow the same rules and restrictions as <a href="../items/functions#attributes-on-function-parameters">regular function parameters</a>.</p>  <ol class="footnote-definition">
<li id="footnote-cl-async-edition"> <p>The <code>async</code> qualifier is not allowed in the 2015 edition. <a href="#fr-cl-async-edition-1">↩</a></p> </li> </ol><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/reference/expressions/closure-expr.html" class="_attribution-link">https://doc.rust-lang.org/reference/expressions/closure-expr.html</a>
  </p>
</div>
