 <h1 id="macros">Macros</h1>  <p>The functionality and syntax of Rust can be extended with custom definitions called macros. They are given names, and invoked through a consistent syntax: <code>some_extension!(...)</code>.</p> <p>There are two ways to define new macros:</p> <ul> <li>
<a href="macros-by-example">Macros by Example</a> define new syntax in a higher-level, declarative way.</li> <li>
<a href="procedural-macros">Procedural Macros</a> define function-like macros, custom derives, and custom attributes using functions that operate on input tokens.</li> </ul>  <h2 id="macro-invocation">Macro Invocation</h2>  <div class="grammar-container">
<p><strong><sup>Syntax</sup></strong>
<br>
<span class="grammar-text grammar-production" id="grammar-MacroInvocation"><a href="macros#railroad-MacroInvocation">MacroInvocation</a></span> → <br>
    <span class="grammar-text"><a href="paths#grammar-SimplePath">SimplePath</a></span> <code class="grammar-literal">!</code> <span class="grammar-text"><a href="macros#grammar-DelimTokenTree">DelimTokenTree</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-DelimTokenTree"><a href="macros#railroad-DelimTokenTree">DelimTokenTree</a></span> → <br>
      <code class="grammar-literal">(</code> <span class="grammar-text"><a href="macros#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <code class="grammar-literal">)</code> <br>
    | <code class="grammar-literal">[</code> <span class="grammar-text"><a href="macros#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <code class="grammar-literal">]</code> <br>
    | <code class="grammar-literal">{</code> <span class="grammar-text"><a href="macros#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <code class="grammar-literal">}</code></p>
<p><span class="grammar-text grammar-production" id="grammar-TokenTree"><a href="macros#railroad-TokenTree">TokenTree</a></span> → <br>
    <span class="grammar-text"><a href="tokens#grammar-Token">Token</a></span><sub class="grammar-text">except <a href="tokens#r-lex.token.delim">delimiters</a></sub> | <span class="grammar-text"><a href="macros#grammar-DelimTokenTree">DelimTokenTree</a></span></p>
<p><span class="grammar-text grammar-production" id="grammar-MacroInvocationSemi"><a href="macros#railroad-MacroInvocationSemi">MacroInvocationSemi</a></span> → <br>
      <span class="grammar-text"><a href="paths#grammar-SimplePath">SimplePath</a></span> <code class="grammar-literal">!</code> <code class="grammar-literal">(</code> <span class="grammar-text"><a href="macros#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <code class="grammar-literal">)</code> <code class="grammar-literal">;</code> <br>
    | <span class="grammar-text"><a href="paths#grammar-SimplePath">SimplePath</a></span> <code class="grammar-literal">!</code> <code class="grammar-literal">[</code> <span class="grammar-text"><a href="macros#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <code class="grammar-literal">]</code> <code class="grammar-literal">;</code> <br>
    | <span class="grammar-text"><a href="paths#grammar-SimplePath">SimplePath</a></span> <code class="grammar-literal">!</code> <code class="grammar-literal">{</code> <span class="grammar-text"><a href="macros#grammar-TokenTree">TokenTree</a></span><sup>*</sup> <code class="grammar-literal">}</code></p>

<details class="grammar-railroad grammar-hidden"><summary>Syntax diagram</summary> <div style="width: 350px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroInvocation">
<svg class="railroad" viewbox="0 0 350 74" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <rect class="railroad_canvas" height="100%" width="100%"></rect> <g class="verticalgrid"> <a class="link" xlink:href="macros#grammar-MacroInvocation"> <text class="comment" x="67" y="25"> MacroInvocation</text> </a> <g class="sequence"> <path d=" M 10 53 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5"></path> <g class="sequence"> <a class="link" xlink:href="paths#railroad-SimplePath"> <g class="nonterminal"> <rect height="22" width="100" x="35" y="42"></rect> <text x="85" y="58"> SimplePath</text> </g> </a> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="145" y="42"></rect> <text x="159" y="58"> !</text> </g> <a class="link" xlink:href="macros#railroad-DelimTokenTree"> <g class="nonterminal"> <rect height="22" width="132" x="183" y="42"></rect> <text x="249" y="58"> DelimTokenTree</text> </g> </a> <path d=" M 135 53 h 10"></path> <path d=" M 173 53 h 10"></path> </g> <path d=" M 325 53 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5"></path> <path d=" M 25 53 h 10"></path> <path d=" M 315 53 h 10"></path> </g> </g> </svg> </div> <div style="width: 358px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-DelimTokenTree">
<svg class="railroad" viewbox="0 0 358 216" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <rect class="railroad_canvas" height="100%" width="100%"></rect> <g class="verticalgrid"> <a class="link" xlink:href="macros#grammar-DelimTokenTree"> <text class="comment" x="64" y="25"> DelimTokenTree</text> </a> <g class="sequence"> <path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5"></path> <g class="choice"> <path d=" M 35 66 h 24 m 240 0 h 24"></path> <g class="sequence"> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="59" y="55"></rect> <text x="73" y="71"> (</text> </g> <g class="optional"> <path d=" M 97 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="repeat"> <path d=" M 121 66 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12"></path>  <a class="link" xlink:href="macros#railroad-TokenTree"> <g class="nonterminal"> <rect height="22" width="92" x="133" y="55"></rect> <text x="179" y="71"> TokenTree</text> </g> </a> </g> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="271" y="55"></rect> <text x="285" y="71"> )</text> </g> <path d=" M 87 66 h 10"></path> <path d=" M 261 66 h 10"></path> </g> <path d=" M 35 66 a 12 12 0 0 1 12 12 v 22 m 264 0 v -22 a 12 12 0 0 1 12 -12"></path> <path d=" M 47 112 v 46 m 264 0 v -46"></path> <path d=" M 47 100 v 12 a 12 12 0 0 0 12 12 m 240 0 h 0 a 12 12 0 0 0 12 -12 v -12"></path> <g class="sequence"> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="59" y="113"></rect> <text x="73" y="129"> [</text> </g> <g class="optional"> <path d=" M 97 124 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="repeat"> <path d=" M 121 124 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12"></path>  <a class="link" xlink:href="macros#railroad-TokenTree"> <g class="nonterminal"> <rect height="22" width="92" x="133" y="113"></rect> <text x="179" y="129"> TokenTree</text> </g> </a> </g> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="271" y="113"></rect> <text x="285" y="129"> ]</text> </g> <path d=" M 87 124 h 10"></path> <path d=" M 261 124 h 10"></path> </g> <path d=" M 47 158 v 12 a 12 12 0 0 0 12 12 m 240 0 h 0 a 12 12 0 0 0 12 -12 v -12"></path> <g class="sequence"> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="59" y="171"></rect> <text x="73" y="187"> {</text> </g> <g class="optional"> <path d=" M 97 182 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="repeat"> <path d=" M 121 182 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12"></path>  <a class="link" xlink:href="macros#railroad-TokenTree"> <g class="nonterminal"> <rect height="22" width="92" x="133" y="171"></rect> <text x="179" y="187"> TokenTree</text> </g> </a> </g> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="271" y="171"></rect> <text x="285" y="187"> }</text> </g> <path d=" M 87 182 h 10"></path> <path d=" M 261 182 h 10"></path> </g> </g> <path d=" M 333 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5"></path> <path d=" M 25 66 h 10"></path> <path d=" M 323 66 h 10"></path> </g> </g> </svg> </div> <div style="width: 263px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-TokenTree">
<svg class="railroad" viewbox="0 0 263 151" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <rect class="railroad_canvas" height="100%" width="100%"></rect> <g class="verticalgrid"> <a class="link" xlink:href="macros#grammar-TokenTree"> <text class="comment" x="46" y="25"> TokenTree</text> </a> <g class="sequence"> <path d=" M 10 89 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5"></path> <g class="choice"> <path d=" M 35 89 h 24 m 145 0 h 24"></path> <g class="sequence"> <g class="labeledbox"> <rect height="66" width="145" x="59" y="42"></rect> <path d=" M 59 89 h 8 m 60 0 h 77 m -35 0 l -5 -5 m 0 10 l 5 -5 m 35 0"></path> <text class="comment" x="131" y="65"> except delimiters</text> <a class="link" xlink:href="tokens#railroad-Token"> <g class="nonterminal"> <rect height="22" width="60" x="67" y="78"></rect> <text x="97" y="94"> Token</text> </g> </a> </g> </g> <path d=" M 35 89 a 12 12 0 0 1 12 12 v 17 m 169 0 v -17 a 12 12 0 0 1 12 -12"></path> <path d=" M 47 118 v 0 a 12 12 0 0 0 12 12 m 132 0 h 13 a 12 12 0 0 0 12 -12 v 0"></path> <a class="link" xlink:href="macros#railroad-DelimTokenTree"> <g class="nonterminal"> <rect height="22" width="132" x="59" y="119"></rect> <text x="125" y="135"> DelimTokenTree</text> </g> </a> </g> <path d=" M 238 89 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5"></path> <path d=" M 25 89 h 10"></path> <path d=" M 228 89 h 10"></path> </g> </g> </svg> </div> <div style="width: 544px; height: auto; max-width: 100%; max-height: 100%" class="railroad-production" id="railroad-MacroInvocationSemi">
<svg class="railroad" viewbox="0 0 544 216" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"> <rect class="railroad_canvas" height="100%" width="100%"></rect> <g class="verticalgrid"> <a class="link" xlink:href="macros#grammar-MacroInvocationSemi"> <text class="comment" x="81" y="25"> MacroInvocationSemi</text> </a> <g class="sequence"> <path d=" M 10 66 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5 m 10 0 h 5"></path> <g class="choice"> <path d=" M 35 66 h 24 m 426 0 h 24"></path> <g class="sequence"> <a class="link" xlink:href="paths#railroad-SimplePath"> <g class="nonterminal"> <rect height="22" width="100" x="59" y="55"></rect> <text x="109" y="71"> SimplePath</text> </g> </a> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="169" y="55"></rect> <text x="183" y="71"> !</text> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="207" y="55"></rect> <text x="221" y="71"> (</text> </g> <g class="optional"> <path d=" M 245 66 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="repeat"> <path d=" M 269 66 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12"></path>  <a class="link" xlink:href="macros#railroad-TokenTree"> <g class="nonterminal"> <rect height="22" width="92" x="281" y="55"></rect> <text x="327" y="71"> TokenTree</text> </g> </a> </g> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="419" y="55"></rect> <text x="433" y="71"> )</text> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="457" y="55"></rect> <text x="471" y="71"> ;</text> </g> <path d=" M 159 66 h 10"></path> <path d=" M 197 66 h 10"></path> <path d=" M 235 66 h 10"></path> <path d=" M 409 66 h 10"></path> <path d=" M 447 66 h 10"></path> </g> <path d=" M 35 66 a 12 12 0 0 1 12 12 v 22 m 450 0 v -22 a 12 12 0 0 1 12 -12"></path> <path d=" M 47 112 v 46 m 450 0 v -46"></path> <path d=" M 47 100 v 12 a 12 12 0 0 0 12 12 m 426 0 h 0 a 12 12 0 0 0 12 -12 v -12"></path> <g class="sequence"> <a class="link" xlink:href="paths#railroad-SimplePath"> <g class="nonterminal"> <rect height="22" width="100" x="59" y="113"></rect> <text x="109" y="129"> SimplePath</text> </g> </a> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="169" y="113"></rect> <text x="183" y="129"> !</text> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="207" y="113"></rect> <text x="221" y="129"> [</text> </g> <g class="optional"> <path d=" M 245 124 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="repeat"> <path d=" M 269 124 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12"></path>  <a class="link" xlink:href="macros#railroad-TokenTree"> <g class="nonterminal"> <rect height="22" width="92" x="281" y="113"></rect> <text x="327" y="129"> TokenTree</text> </g> </a> </g> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="419" y="113"></rect> <text x="433" y="129"> ]</text> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="457" y="113"></rect> <text x="471" y="129"> ;</text> </g> <path d=" M 159 124 h 10"></path> <path d=" M 197 124 h 10"></path> <path d=" M 235 124 h 10"></path> <path d=" M 409 124 h 10"></path> <path d=" M 447 124 h 10"></path> </g> <path d=" M 47 158 v 12 a 12 12 0 0 0 12 12 m 388 0 h 38 a 12 12 0 0 0 12 -12 v -12"></path> <g class="sequence"> <a class="link" xlink:href="paths#railroad-SimplePath"> <g class="nonterminal"> <rect height="22" width="100" x="59" y="171"></rect> <text x="109" y="187"> SimplePath</text> </g> </a> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="169" y="171"></rect> <text x="183" y="187"> !</text> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="207" y="171"></rect> <text x="221" y="187"> {</text> </g> <g class="optional"> <path d=" M 245 182 h 24 m -24 0 a 12 12 0 0 0 12 -12 v 0 a 12 12 0 0 1 12 -12 h 116 m -55 0 l -5 -5 m 0 10 l 5 -5 m 55 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 0 12 12 h -24"></path> <g class="repeat"> <path d=" M 269 182 h 12 m 92 0 h 12 m -12 0 a 12 12 0 0 1 12 12 v 0 a 12 12 0 0 1 -12 12 m 0 0 h -92 m 49 0 l 5 -5 m 0 10 l -5 -5 m -49 0 a 12 12 0 0 1 -12 -12 v 0 a 12 12 0 0 1 12 -12"></path>  <a class="link" xlink:href="macros#railroad-TokenTree"> <g class="nonterminal"> <rect height="22" width="92" x="281" y="171"></rect> <text x="327" y="187"> TokenTree</text> </g> </a> </g> </g> <g class="terminal"> <rect height="22" rx="10" ry="10" width="28" x="419" y="171"></rect> <text x="433" y="187"> }</text> </g> <path d=" M 159 182 h 10"></path> <path d=" M 197 182 h 10"></path> <path d=" M 235 182 h 10"></path> <path d=" M 409 182 h 10"></path> </g> </g> <path d=" M 519 66 h 5 a 5 5 0 0 1 5 -5 a 5 5 0 0 1 5 5 a 5 5 0 0 1 -5 5 a 5 5 0 0 1 -5 -5"></path> <path d=" M 25 66 h 10"></path> <path d=" M 509 66 h 10"></path> </g> </g> </svg> </div> </details>
</div>   <p>A macro invocation expands a macro at compile time and replaces the invocation with the result of the macro. Macros may be invoked in the following situations:</p>  <ul> <li>
<a href="expressions">Expressions</a> and <a href="statements">statements</a>
</li> </ul>  <ul> <li><a href="patterns">Patterns</a></li> </ul>  <ul> <li><a href="types">Types</a></li> </ul>  <ul> <li>
<a href="items">Items</a> including <a href="items/associated-items">associated items</a>
</li> </ul>  <ul> <li>
<a href="macros-by-example"><code>macro_rules</code></a> transcribers</li> </ul>  <ul> <li><a href="items/external-blocks">External blocks</a></li> </ul>  <p>When used as an item or a statement, the <a href="macros#grammar-MacroInvocationSemi">MacroInvocationSemi</a> form is used where a semicolon is required at the end when not using curly braces. <a href="visibility-and-privacy">Visibility qualifiers</a> are never allowed before a macro invocation or <a href="macros-by-example"><code>macro_rules</code></a> definition.</p> <pre data-language="rust">#![allow(unused)]
fn main() {
// Used as an expression.
let x = vec![1,2,3];

// Used as a statement.
println!("Hello!");

// Used in a pattern.
macro_rules! pat {
    ($i:ident) =&gt; (Some($i))
}

if let pat!(x) = Some(1) {
    assert_eq!(x, 1);
}

// Used in a type.
macro_rules! Tuple {
    { $A:ty, $B:ty } =&gt; { ($A, $B) };
}

type N2 = Tuple!(i32, i32);

// Used as an item.
use std::cell::RefCell;
thread_local!(static FOO: RefCell&lt;u32&gt; = RefCell::new(1));

// Used as an associated item.
macro_rules! const_maker {
    ($t:ty, $v:tt) =&gt; { const CONST: $t = $v; };
}
trait T {
    const_maker!{i32, 7}
}

// Macro calls within macros.
macro_rules! example {
    () =&gt; { println!("Macro call in a macro!") };
}
// Outer macro `example` is expanded, then inner macro `println` is expanded.
example!();
}</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/reference/macros.html" class="_attribution-link">https://doc.rust-lang.org/reference/macros.html</a>
  </p>
</div>
