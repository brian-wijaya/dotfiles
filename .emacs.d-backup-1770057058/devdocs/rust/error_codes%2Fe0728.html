<h1 id="error-code-e0728">Error code E0728</h1> <p><a href="../std/keyword.await"><code>await</code></a> has been used outside <a href="../std/keyword.async"><code>async</code></a> function or <a href="../std/keyword.async"><code>async</code></a> block.</p> <p>Erroneous code example:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
use std::pin::Pin;
use std::future::Future;
use std::task::{Context, Poll};

struct WakeOnceThenComplete(bool);

fn wake_and_yield_once() -&gt; WakeOnceThenComplete {
    WakeOnceThenComplete(false)
}

impl Future for WakeOnceThenComplete {
    type Output = ();
    fn poll(mut self: Pin&lt;&amp;mut Self&gt;, cx: &amp;mut Context&lt;'_&gt;) -&gt; Poll&lt;()&gt; {
        if self.0 {
            Poll::Ready(())
        } else {
            cx.waker().wake_by_ref();
            self.0 = true;
            Poll::Pending
        }
    }
}

fn foo() {
    wake_and_yield_once().await // `await` is used outside `async` context
}
}</pre> <p><a href="../std/keyword.await"><code>await</code></a> is used to suspend the current computation until the given future is ready to produce a value. So it is legal only within an <a href="../std/keyword.async"><code>async</code></a> context, like an <code>async</code> function or an <code>async</code> block.</p> <pre data-language="rust">#![allow(unused)]
fn main() {
use std::pin::Pin;
use std::future::Future;
use std::task::{Context, Poll};

struct WakeOnceThenComplete(bool);

fn wake_and_yield_once() -&gt; WakeOnceThenComplete {
    WakeOnceThenComplete(false)
}

impl Future for WakeOnceThenComplete {
    type Output = ();
    fn poll(mut self: Pin&lt;&amp;mut Self&gt;, cx: &amp;mut Context&lt;'_&gt;) -&gt; Poll&lt;()&gt; {
        if self.0 {
            Poll::Ready(())
        } else {
            cx.waker().wake_by_ref();
            self.0 = true;
            Poll::Pending
        }
    }
}

async fn foo() {
    wake_and_yield_once().await // `await` is used within `async` function
}

fn bar(x: u8) -&gt; impl Future&lt;Output = u8&gt; {
    async move {
        wake_and_yield_once().await; // `await` is used within `async` block
        x
    }
}
}</pre><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/error_codes/E0728.html" class="_attribution-link">https://doc.rust-lang.org/error_codes/E0728.html</a>
  </p>
</div>
