<h1 id="error-code-e0387">Error code E0387</h1> <h4 id="note-this-error-code-is-no-longer-emitted-by-the-compiler">Note: this error code is no longer emitted by the compiler.</h4> <p>This error occurs when an attempt is made to mutate or mutably reference data that a closure has captured immutably.</p> <p>Erroneous code example:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
// Accepts a function or a closure that captures its environment immutably.
// Closures passed to foo will not be able to mutate their closed-over state.
fn foo&lt;F: Fn()&gt;(f: F) { }

// Attempts to mutate closed-over data. Error message reads:
// `cannot assign to data in a captured outer variable...`
fn mutable() {
    let mut x = 0u32;
    foo(|| x = 2);
}

// Attempts to take a mutable reference to closed-over data. Error message
// reads: `cannot borrow data mutably in a captured outer variable...`
fn mut_addr() {
    let mut x = 0u32;
    foo(|| { let y = &amp;mut x; });
}
}</pre> <p>The problem here is that foo is defined as accepting a parameter of type <code>Fn</code>. Closures passed into foo will thus be inferred to be of type <code>Fn</code>, meaning that they capture their context immutably.</p> <p>If the definition of <code>foo</code> is under your control, the simplest solution is to capture the data mutably. This can be done by defining <code>foo</code> to take FnMut rather than Fn:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
fn foo&lt;F: FnMut()&gt;(f: F) { }
}</pre> <p>Alternatively, we can consider using the <code>Cell</code> and <code>RefCell</code> types to achieve interior mutability through a shared reference. Our example's <code>mutable</code> function could be redefined as below:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
use std::cell::Cell;

fn foo&lt;F: Fn()&gt;(f: F) { }

fn mutable() {
    let x = Cell::new(0u32);
    foo(|| x.set(2));
}
}</pre> <p>You can read more in the API documentation for <a href="../std/cell/index">Cell</a>.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/error_codes/E0387.html" class="_attribution-link">https://doc.rust-lang.org/error_codes/E0387.html</a>
  </p>
</div>
