<h1 id="error-code-e0713">Error code E0713</h1> <p>This error occurs when an attempt is made to borrow state past the end of the lifetime of a type that implements the <code>Drop</code> trait.</p> <p>Erroneous code example:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
pub struct S&lt;'a&gt; { data: &amp;'a mut String }

impl&lt;'a&gt; Drop for S&lt;'a&gt; {
    fn drop(&amp;mut self) { self.data.push_str("being dropped"); }
}

fn demo&lt;'a&gt;(s: S&lt;'a&gt;) -&gt; &amp;'a mut String { let p = &amp;mut *s.data; p }
}</pre> <p>Here, <code>demo</code> tries to borrow the string data held within its argument <code>s</code> and then return that borrow. However, <code>S</code> is declared as implementing <code>Drop</code>.</p> <p>Structs implementing the <code>Drop</code> trait have an implicit destructor that gets called when they go out of scope. This destructor gets exclusive access to the fields of the struct when it runs.</p> <p>This means that when <code>s</code> reaches the end of <code>demo</code>, its destructor gets exclusive access to its <code>&amp;mut</code>-borrowed string data. allowing another borrow of that string data (<code>p</code>), to exist across the drop of <code>s</code> would be a violation of the principle that <code>&amp;mut</code>-borrows have exclusive, unaliased access to their referenced data.</p> <p>This error can be fixed by changing <code>demo</code> so that the destructor does not run while the string-data is borrowed; for example by taking <code>S</code> by reference:</p> <pre data-language="rust">#![allow(unused)]
fn main() {
pub struct S&lt;'a&gt; { data: &amp;'a mut String }

impl&lt;'a&gt; Drop for S&lt;'a&gt; {
    fn drop(&amp;mut self) { self.data.push_str("being dropped"); }
}

fn demo&lt;'a&gt;(s: &amp;'a mut S&lt;'a&gt;) -&gt; &amp;'a mut String { let p = &amp;mut *(*s).data; p }
}</pre> <p>Note that this approach needs a reference to S with lifetime <code>'a</code>. Nothing shorter than <code>'a</code> will suffice: a shorter lifetime would imply that after <code>demo</code> finishes executing, something else (such as the destructor!) could access <code>s.data</code> after the end of that shorter lifetime, which would again violate the <code>&amp;mut</code>-borrow's exclusive access.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2010 The Rust Project Developers<br>Licensed under the Apache License, Version 2.0 or the MIT license, at your option.<br>
    <a href="https://doc.rust-lang.org/error_codes/E0713.html" class="_attribution-link">https://doc.rust-lang.org/error_codes/E0713.html</a>
  </p>
</div>
