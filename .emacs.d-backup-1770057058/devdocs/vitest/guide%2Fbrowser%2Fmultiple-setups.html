<h1 id="multiple-setups" tabindex="-1">Multiple Setups </h1>
<p>Since Vitest 3, you can specify several different browser setups using the new <a href="config#browser-instances"><code>browser.instances</code></a> option.</p>
<p>The main advatage of using the <code>browser.instances</code> over the <a href="../workspace">workspace</a> is improved caching. Every project will use the same Vite server meaning the file transform and <a href="https://vite.dev/guide/dep-pre-bundling.html" target="_blank" rel="noreferrer">dependency pre-bundling</a> has to happen only once.</p>
<h2 id="several-browsers" tabindex="-1">Several Browsers </h2>
<p>You can use the <code>browser.instances</code> field to specify options for different browsers. For example, if you want to run the same tests in different browsers, the minimal configuration will look like this:</p>
<div class="vp-code-block-title">
<div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vitest.config.ts">vitest.config.ts</span></div>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { defineConfig } from 'vitest/config'
export default defineConfig({
  test: {
    browser: {
      enabled: true,
      provider: 'playwright',
      headless: true,
      instances: [
        { browser: 'chromium' },
        { browser: 'firefox' },
        { browser: 'webkit' },
      ],
    },
  },
})</pre>
</div>
</div>
<h2 id="different-setups" tabindex="-1">Different Setups </h2>
<p>You can also specify different config options independently from the browser (although, the instances <em>can</em> also have <code>browser</code> fields):</p>
<div class="vp-code-group vp-adaptive-theme">
<div class="tabs">
<input type="radio" name="group-yBV4t" id="tab-eSMhrWu" checked><label data-title="vitest.config.ts" for="tab-eSMhrWu">vitest.config.ts</label><input type="radio" name="group-yBV4t" id="tab-JgY3LtO"><label data-title="example.test.ts" for="tab-JgY3LtO">example.test.ts</label>
</div>
<div class="blocks">
<div class="language-ts vp-adaptive-theme active">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { defineConfig } from 'vitest/config'
export default defineConfig({
  test: {
    browser: {
      enabled: true,
      provider: 'playwright',
      headless: true,
      instances: [
        {
          browser: 'chromium',
          name: 'chromium-1',
          setupFiles: ['./ratio-setup.ts'],
          provide: {
            ratio: 1,
          }
        },
        {
          browser: 'chromium',
          name: 'chromium-2',
          provide: {
            ratio: 2,
          }
        },
      ],
    },
  },
})</pre>
</div>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { expect, inject, test } from 'vitest'
import { globalSetupModifier } from './example.js'

test('ratio works', () =&gt; {
  expect(inject('ratio') * globalSetupModifier).toBe(14)
})</pre>
</div>
</div>
</div>
<p>In this example Vitest will run all tests in <code>chromium</code> browser, but execute a <code>'./ratio-setup.ts'</code> file only in the first configuration and inject a different <code>ratio</code> value depending on the <a href="../../config/index#provide"><code>provide</code> field</a>.</p>
<div class="warning custom-block">
<strong class="custom-block-title">WARNING</strong><p>Note that you need to define the custom <code>name</code> value if you are using the same browser name because Vitest will assign the <code>browser</code> as the project name otherwise.</p>
</div>
<h2 id="filtering" tabindex="-1">Filtering </h2>
<p>You can filter what projects to run with the <a href="../cli#project"><code>--project</code> flag</a>. Vitest will automatically assign the browser name as a project name if it is not assigned manually. If the root config already has a name, Vitest will merge them: <code>custom</code> -&gt; <code>custom (browser)</code>.</p>
<div class="language-shell vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">$ vitest --project=chromium</pre>
</div>
<div class="vp-code-group vp-adaptive-theme">
<div class="tabs">
<input type="radio" name="group-KrWOe" id="tab-d_7Lwjk" checked><label data-title="default" for="tab-d_7Lwjk">default</label><input type="radio" name="group-KrWOe" id="tab-fUORB50"><label data-title="custom" for="tab-fUORB50">custom</label>
</div>
<div class="blocks">
<div class="language-ts vp-adaptive-theme active">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">export default defineConfig({
  test: {
    browser: {
      instances: [
        // name: chromium
        { browser: 'chromium' },
        // name: custom
        { browser: 'firefox', name: 'custom' },
      ]
    }
  }
})</pre>
</div>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">export default defineConfig({
  test: {
    name: 'custom',
    browser: {
      instances: [
        // name: custom (chromium)
        { browser: 'chromium' },
        // name: manual
        { browser: 'firefox', name: 'manual' },
      ]
    }
  }
})</pre>
</div>
</div>
</div>
<div class="warning custom-block">
<strong class="custom-block-title">WARNING</strong><p>Vitest cannot run multiple instances that have <code>headless</code> mode set to <code>false</code> (the default behaviour). During development, you can select what project to run in your terminal:</p>
<div class="language-shell vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">? Found multiple projects that run browser tests in headed mode: "chromium", "firefox".
Vitest cannot run multiple headed browsers at the same time. Select a single project
to run or cancel and run tests with "headless: true" option. Note that you can also
start tests with --browser=name or --project=name flag. › - Use arrow-keys. Return to submit.
❯   chromium
    firefox</pre>
</div>
<p>If you have several non-headless projects in CI (i.e. the <code>headless: false</code> is set manually in the config and not overriden in CI env), Vitest will fail the run and won't start any tests.</p>
<p>The ability to run tests in headless mode is not affected by this. You can still run all instances in parallel as long as they don't have <code>headless: false</code>.</p>
</div><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021-Present Anthony Fu<br>&copy; 2021-Present Matias Capeletto<br>Licensed under the MIT License.<br>
    <a href="https://vitest.dev/guide/browser/multiple-setups" class="_attribution-link">https://vitest.dev/guide/browser/multiple-setups</a>
  </p>
</div>
