<h1 id="testproject" tabindex="-1">TestProject <span class="VPBadge info">3.0.0+ </span> </h1>
<ul><li>
<strong>Alias</strong>: <code>WorkspaceProject</code> before 3.0.0</li></ul>
<div class="warning custom-block">
<strong class="custom-block-title">WARNING</strong><p>This guide describes the advanced Node.js API. If you just want to create a workspace, follow the <a href="../../guide/workspace">"Workspace"</a> guide.</p>
</div>
<h2 id="name" tabindex="-1">name </h2>
<p>The name is a unique string assigned by the user or interpreted by Vitest. If user did not provide a name, Vitest tries to load a <code>package.json</code> in the root of the project and takes the <code>name</code> property from there. If there is no <code>package.json</code>, Vitest uses the name of the folder by default. Inline projects use numbers as the name (converted to string).</p>
<div class="vp-code-group vp-adaptive-theme">
<div class="tabs">
<input type="radio" name="group-5RjsO" id="tab-CwTZa6r" checked><label data-title="node.js" for="tab-CwTZa6r">node.js</label><input type="radio" name="group-5RjsO" id="tab-9y8Wqmt"><label data-title="vitest.workspace.js" for="tab-9y8Wqmt">vitest.workspace.js</label>
</div>
<div class="blocks">
<div class="language-ts vp-adaptive-theme active">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { createVitest } from 'vitest/node'

const vitest = await createVitest('test')
vitest.projects.map(p =&gt; p.name) === [
  '@pkg/server',
  'utils',
  '2',
  'custom'
]</pre>
</div>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">export default [
  './packages/server', // has package.json with "@pkg/server"
  './utils', // doesn't have a package.json file
  {
    // doesn't customize the name
    test: {
      pool: 'threads',
    },
  },
  {
    // customized the name
    test: {
      name: 'custom',
    },
  },
]</pre>
</div>
</div>
</div>
<div class="info custom-block">
<strong class="custom-block-title">INFO</strong><p>If the <a href="vitest#getroottestproject">root project</a> is not part of a user workspace, its <code>name</code> will not be resolved.</p>
</div>
<h2 id="vitest" tabindex="-1">vitest </h2>
<p><code>vitest</code> references the global <a href="vitest"><code>Vitest</code></a> process.</p>
<h2 id="serializedconfig" tabindex="-1">serializedConfig </h2>
<p>This is the config that test processes receive. Vitest <a href="https://github.com/vitest-dev/vitest/blob/main/packages/vitest/src/node/config/serializeConfig.ts" target="_blank" rel="noreferrer">serializes config</a> manually by removing all functions and properties that are not possible to serialize. Since this value is available in both tests and node, its type is exported from the main entry point.</p>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import type { SerializedConfig } from 'vitest'

const config: SerializedConfig = vitest.projects[0].serializedConfig</pre>
</div>
<div class="warning custom-block">
<strong class="custom-block-title">WARNING</strong><p>The <code>serializedConfig</code> property is a getter. Every time it's accessed Vitest serializes the config again in case it was changed. This also means that it always returns a different reference:</p>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">project.serializedConfig === project.serializedConfig // ❌</pre>
</div>
</div>
<h2 id="globalconfig" tabindex="-1">globalConfig </h2>
<p>The test config that <a href="vitest"><code>Vitest</code></a> was initialized with. If this is the <a href="vitest#getroottestproject">root project</a>, <code>globalConfig</code> and <code>config</code> will reference the same object. This config is useful for values that cannot be set on the project level, like <code>coverage</code> or <code>reporters</code>.</p>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import type { ResolvedConfig } from 'vitest/node'

vitest.config === vitest.projects[0].globalConfig</pre>
</div>
<h2 id="config" tabindex="-1">config </h2>
<p>This is the project's resolved test config.</p>
<h2 id="vite" tabindex="-1">vite </h2>
<p>This is project's <a href="https://vite.dev/guide/api-javascript#vitedevserver" target="_blank" rel="noreferrer"><code>ViteDevServer</code></a>. All projects have their own Vite servers.</p>
<h2 id="browser" tabindex="-1">browser </h2>
<p>This value will be set only if tests are running in the browser. If <code>browser</code> is enabled, but tests didn't run yet, this will be <code>undefined</code>. If you need to check if the project supports browser tests, use <code>project.isBrowserEnabled()</code> method.</p>
<div class="warning custom-block">
<strong class="custom-block-title">WARNING</strong><p>The browser API is even more experimental and doesn't follow SemVer. The browser API will be standardized separately from the rest of the APIs.</p>
</div>
<h2 id="provide" tabindex="-1">provide </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function provide&lt;T extends keyof ProvidedContext &amp; string&gt;(
  key: T,
  value: ProvidedContext[T],
): void</pre>
</div>
<p>A way to provide custom values to tests in addition to <a href="../../config/index#provide"><code>config.provide</code></a> field. All values are validated with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/structuredClone" target="_blank" rel="noreferrer"><code>structuredClone</code></a> before they are stored, but the values on <code>providedContext</code> themselves are not cloned.</p>
<div class="vp-code-group vp-adaptive-theme">
<div class="tabs">
<input type="radio" name="group-JetU7" id="tab-ci7ryKQ" checked><label data-title="node.js" for="tab-ci7ryKQ">node.js</label><input type="radio" name="group-JetU7" id="tab-0emij0m"><label data-title="test.spec.js" for="tab-0emij0m">test.spec.js</label>
</div>
<div class="blocks">
<div class="language-ts vp-adaptive-theme active">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { createVitest } from 'vitest/node'

const vitest = await createVitest('test')
const project = vitest.projects.find(p =&gt; p.name === 'custom')
project.provide('key', 'value')
await vitest.start()</pre>
</div>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { inject } from 'vitest'
const value = inject('key')</pre>
</div>
</div>
</div>
<p>The values can be provided dynamicaly. Provided value in tests will be updated on their next run.</p>
<div class="tip custom-block">
<strong class="custom-block-title">TIP</strong><p>This method is also available to <a href="../../config/index#globalsetup">global setup files</a> for cases where you cannot use the public API:</p>
<div class="language-js vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">export default function setup({ provide }) {
  provide('wsPort', 3000)
}</pre>
</div>
</div>
<h2 id="getprovidedcontext" tabindex="-1">getProvidedContext </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function getProvidedContext(): ProvidedContext</pre>
</div>
<p>This returns the context object. Every project also inherits the global context set by <code>vitest.provide</code>.</p>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { createVitest } from 'vitest/node'

const vitest = await createVitest('test')
vitest.provide('global', true)
const project = vitest.projects.find(p =&gt; p.name === 'custom')
project.provide('key', 'value')

// { global: true, key: 'value' }
const context = project.getProvidedContext()</pre>
</div>
<div class="tip custom-block">
<strong class="custom-block-title">TIP</strong><p>Project context values will always override root project's context.</p>
</div>
<h2 id="createspecification" tabindex="-1">createSpecification </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function createSpecification(
  moduleId: string,
  locations?: number[],
): TestSpecification</pre>
</div>
<p>Create a <a href="test-specification">test specification</a> that can be used in <a href="vitest#runtestspecifications"><code>vitest.runTestSpecifications</code></a>. Specification scopes the test file to a specific <code>project</code> and test <code>locations</code> (optional). Test <a href="test-case#location">locations</a> are code lines where the test is defined in the source code. If locations are provided, Vitest will only run tests defined on those lines. Note that if <a href="../../config/index#testnamepattern"><code>testNamePattern</code></a> is defined, then it will also be applied.</p>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { createVitest } from 'vitest/node'
import { resolve } from 'node:path/posix'

const vitest = await createVitest('test')
const project = vitest.projects[0]
const specification = project.createSpecification(
  resolve('./example.test.ts'),
  [20, 40], // optional test lines
)
await vitest.runTestSpecifications([specification])</pre>
</div>
<div class="warning custom-block">
<strong class="custom-block-title">WARNING</strong><p><code>createSpecification</code> expects resolved <a href="test-specification#moduleid">module ID</a>. It doesn't auto-resolve the file or check that it exists on the file system.</p>
<p>Also note that <code>project.createSpecification</code> always returns a new instance.</p>
</div>
<h2 id="isrootproject" tabindex="-1">isRootProject </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function isRootProject(): boolean</pre>
</div>
<p>Checks if the current project is the root project. You can also get the root project by calling <a href="#getrootproject"><code>vitest.getRootProject()</code></a>.</p>
<h2 id="globtestfiles" tabindex="-1">globTestFiles </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function globTestFiles(filters?: string[]): {
  /**
   * Test files that match the filters.
   */
  testFiles: string[]
  /**
   * Typecheck test files that match the filters. This will be empty unless `typecheck.enabled` is `true`.
   */
  typecheckTestFiles: string[]
}</pre>
</div>
<p>Globs all test files. This function returns an object with regular tests and typecheck tests.</p>
<p>This method accepts <code>filters</code>. Filters can only a part of the file path, unlike in other methods on the <a href="vitest"><code>Vitest</code></a> instance:</p>
<div class="language-js vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">project.globTestFiles(['foo']) // ✅
project.globTestFiles(['basic/foo.js:10']) // ❌</pre>
</div>
<div class="tip custom-block">
<strong class="custom-block-title">TIP</strong><p>Vitest uses <a href="https://www.npmjs.com/package/fast-glob" target="_blank" rel="noreferrer">fast-glob</a> to find test files. <code>test.dir</code>, <code>test.root</code>, <code>root</code> or <code>process.cwd()</code> define the <code>cwd</code> option.</p>
<p>This method looks at several config options:</p>
<ul>
<li>
<code>test.include</code>, <code>test.exclude</code> to find regular test files</li>
<li>
<code>test.includeSource</code>, <code>test.exclude</code> to find in-source tests</li>
<li>
<code>test.typecheck.include</code>, <code>test.typecheck.exclude</code> to find typecheck tests</li>
</ul>
</div>
<h2 id="matchestestglob" tabindex="-1">matchesTestGlob </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function matchesTestGlob(
  moduleId: string,
  source?: () =&gt; string
): boolean</pre>
</div>
<p>This method checks if the file is a regular test file. It uses the same config properties that <code>globTestFiles</code> uses for validation.</p>
<p>This method also accepts a second parameter, which is the source code. This is used to validate if the file is an in-source test. If you are calling this method several times for several projects it is recommended to read the file once and pass it down directly. If the file is not a test file, but matches the <code>includeSource</code> glob, Vitest will synchronously read the file unless the <code>source</code> is provided.</p>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import { createVitest } from 'vitest/node'
import { resolve } from 'node:path/posix'

const vitest = await createVitest('test')
const project = vitest.projects[0]

project.matchesTestGlob(resolve('./basic.test.ts')) // true
project.matchesTestGlob(resolve('./basic.ts')) // false
project.matchesTestGlob(resolve('./basic.ts'), () =&gt; `
if (import.meta.vitest) {
  // ...
}
`) // true if `includeSource` is set</pre>
</div>
<h2 id="import" tabindex="-1">import </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function import&lt;T&gt;(moduleId: string): Promise&lt;T&gt;</pre>
</div>
<p>Import a file using Vite module runner. The file will be transformed by Vite with provided project's config and executed in a separate context. Note that <code>moduleId</code> will be relative to the <code>config.root</code>.</p>
<div class="danger custom-block">
<strong class="custom-block-title">DANGER</strong><p><code>project.import</code> reuses Vite's module graph, so importing the same module using a regular import will return a different module:</p>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">import * as staticExample from './example.js'
const dynamicExample = await project.import('./example.js')

dynamicExample !== staticExample // ✅</pre>
</div>
</div>
<div class="info custom-block">
<strong class="custom-block-title">INFO</strong><p>Internally, Vitest uses this method to import global setups, custom coverage providers, workspace file, and custom reporters, meaning all of them share the same module graph as long as they belong to the same Vite server.</p>
</div>
<h2 id="ontestsrerun" tabindex="-1">onTestsRerun </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function onTestsRerun(cb: OnTestsRerunHandler): void</pre>
</div>
<p>This is a shorthand for <a href="vitest#ontestsrerun"><code>project.vitest.onTestsRerun</code></a>. It accepts a callback that will be awaited when the tests have been scheduled to rerun (usually, due to a file change).</p>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">project.onTestsRerun((specs) =&gt; {
  console.log(specs)
})</pre>
</div>
<h2 id="isbrowserenabled" tabindex="-1">isBrowserEnabled </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function isBrowserEnabled(): boolean</pre>
</div>
<p>Returns <code>true</code> if this project runs tests in the browser.</p>
<h2 id="close" tabindex="-1">close </h2>
<div class="language-ts vp-adaptive-theme">
<pre class="shiki shiki-themes github-light github-dark vp-code" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" data-language="javascript">function close(): Promise&lt;void&gt;</pre>
</div>
<p>Closes the project and all associated resources. This can only be called once; the closing promise is cached until the server restarts. If the resources are needed again, create a new project.</p>
<p>In detail, this method closes the Vite server, stops the typechecker service, closes the browser if it's running, deletes the temporary directory that holds the source code, and resets the provided context.</p><div class="_attribution">
  <p class="_attribution-p">
    &copy; 2021-Present Anthony Fu<br>&copy; 2021-Present Matias Capeletto<br>Licensed under the MIT License.<br>
    <a href="https://vitest.dev/advanced/api/test-project" class="_attribution-link">https://vitest.dev/advanced/api/test-project</a>
  </p>
</div>
