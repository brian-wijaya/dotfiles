<h1>no-await-in-loop</h1> 
<p>Disallow <code>await</code> inside of loops</p>   <p>Performing an operation on each element of an iterable is a common task. However, performing an <code>await</code> as part of each operation may indicate that the program is not taking full advantage of the parallelization benefits of <code>async</code>/<code>await</code>.</p> <p>Often, the code can be refactored to create all the promises at once, then get access to the results using <code>Promise.all()</code> (or one of the other <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise#promise_concurrency">promise concurrency methods</a>). Otherwise, each successive operation will not start until the previous one has completed.</p> <p>Concretely, the following function could be refactored as shown:</p> <div class="code-wrapper"> <pre class="language-js line-numbers-mode"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">things</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> thing <span class="token keyword">of</span> things<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Bad: each loop iteration is delayed until the entire asynchronous operation completes</span>
    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token function">doAsyncWork</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> results<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <button class="copy-btn" aria-labelledby="copy-button-label"> <span hidden id="copy-button-label">Copy code to clipboard</span>  </button> </div> <div class="code-wrapper"> <pre class="language-js line-numbers-mode"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">things</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> thing <span class="token keyword">of</span> things<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Good: all asynchronous operations are immediately started.</span>
    promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">doAsyncWork</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Now that all the asynchronous operations are running, here we wait until they all complete.</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> results<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <button class="copy-btn" aria-labelledby="copy-button-label"> <span hidden id="copy-button-label">Copy code to clipboard</span>  </button> </div> <p>This can be beneficial for subtle error-handling reasons as well. Given an array of promises that might reject, sequential awaiting puts the program at risk of unhandled promise rejections. The exact behavior of unhandled rejections depends on the environment running your code, but they are generally considered harmful regardless. In Node.js, for example, <a href="https://nodejs.org/api/cli.html#--unhandled-rejectionsmode">unhandled rejections cause a program to terminate</a> unless configured otherwise.</p> <div class="code-wrapper"> <pre class="language-js line-numbers-mode"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> arrayOfPromises <span class="token operator">=</span> <span class="token function">somethingThatCreatesAnArrayOfPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> promise <span class="token keyword">of</span> arrayOfPromises<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Bad: if any of the promises reject, an exception is thrown, and</span>
        <span class="token comment">// subsequent loop iterations will not run. Therefore, rejections later</span>
        <span class="token comment">// in the array will become unhandled rejections that cannot be caught</span>
        <span class="token comment">// by a caller.</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token keyword">await</span> promise<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <button class="copy-btn" aria-labelledby="copy-button-label"> <span hidden id="copy-button-label">Copy code to clipboard</span>  </button> </div> <div class="code-wrapper"> <pre class="language-js line-numbers-mode"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> arrayOfPromises <span class="token operator">=</span> <span class="token function">somethingThatCreatesAnArrayOfPromises</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Good: Any rejections will cause a single exception to be thrown here,</span>
    <span class="token comment">// which may be caught and handled by the caller.</span>
    <span class="token keyword">const</span> arrayOfValues <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>arrayOfPromises<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> value <span class="token keyword">of</span> arrayOfValues<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <button class="copy-btn" aria-labelledby="copy-button-label"> <span hidden id="copy-button-label">Copy code to clipboard</span>  </button> </div> <h2 id="rule-details" tabindex="-1">Rule Details</h2> <p>This rule disallows the use of <code>await</code> within loop bodies.</p> <h2 id="examples" tabindex="-1">Examples</h2> <p>Examples of <strong>correct</strong> code for this rule:</p> <div class="correct"> <a class="c-btn c-btn--secondary c-btn--playground" href="https://eslint.org/play#eyJ0ZXh0IjoiLyplc2xpbnQgbm8tYXdhaXQtaW4tbG9vcDogXCJlcnJvclwiKi9cblxuYXN5bmMgZnVuY3Rpb24gZm9vKHRoaW5ncykge1xuICBjb25zdCBwcm9taXNlcyA9IFtdO1xuICBmb3IgKGNvbnN0IHRoaW5nIG9mIHRoaW5ncykge1xuICAgIC8vIEdvb2Q6IGFsbCBhc3luY2hyb25vdXMgb3BlcmF0aW9ucyBhcmUgaW1tZWRpYXRlbHkgc3RhcnRlZC5cbiAgICBwcm9taXNlcy5wdXNoKGRvQXN5bmNXb3JrKHRoaW5nKSk7XG4gIH1cbiAgLy8gTm93IHRoYXQgYWxsIHRoZSBhc3luY2hyb25vdXMgb3BlcmF0aW9ucyBhcmUgcnVubmluZywgaGVyZSB3ZSB3YWl0IHVudGlsIHRoZXkgYWxsIGNvbXBsZXRlLlxuICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpO1xuICByZXR1cm4gcmVzdWx0cztcbn0ifQ==" target="_blank"> Open in Playground </a><pre class="language-js line-numbers-mode"><code><span class="token comment">/*eslint no-await-in-loop: "error"*/</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">things</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> promises <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> thing <span class="token keyword">of</span> things<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Good: all asynchronous operations are immediately started.</span>
    promises<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">doAsyncWork</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// Now that all the asynchronous operations are running, here we wait until they all complete.</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promises<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> results<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<p>Examples of <strong>incorrect</strong> code for this rule:</p> <div class="incorrect"> <a class="c-btn c-btn--secondary c-btn--playground" href="https://eslint.org/play#eyJ0ZXh0IjoiLyplc2xpbnQgbm8tYXdhaXQtaW4tbG9vcDogXCJlcnJvclwiKi9cblxuYXN5bmMgZnVuY3Rpb24gZm9vKHRoaW5ncykge1xuICBjb25zdCByZXN1bHRzID0gW107XG4gIGZvciAoY29uc3QgdGhpbmcgb2YgdGhpbmdzKSB7XG4gICAgLy8gQmFkOiBlYWNoIGxvb3AgaXRlcmF0aW9uIGlzIGRlbGF5ZWQgdW50aWwgdGhlIGVudGlyZSBhc3luY2hyb25vdXMgb3BlcmF0aW9uIGNvbXBsZXRlc1xuICAgIHJlc3VsdHMucHVzaChhd2FpdCBkb0FzeW5jV29yayh0aGluZykpO1xuICB9XG4gIHJldHVybiByZXN1bHRzO1xufSJ9" target="_blank"> Open in Playground </a><pre class="language-js line-numbers-mode"><code><span class="token comment">/*eslint no-await-in-loop: "error"*/</span>

<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">things</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> thing <span class="token keyword">of</span> things<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Bad: each loop iteration is delayed until the entire asynchronous operation completes</span>
    results<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token eslint-marked eslint-message-id-1" title="Unexpected `await` inside a loop."><span class="token keyword">await</span> <span class="token function">doAsyncWork</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> results<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
</div>
<h2 id="when-not-to-use-it" tabindex="-1">When Not To Use It</h2> <p>In many cases the iterations of a loop are not actually independent of each other, and awaiting in the loop is correct. As a few examples:</p> <ul> <li> <p>The output of one iteration might be used as the input to another.</p> <div class="code-wrapper"> <pre class="language-js line-numbers-mode"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">loopIterationsDependOnEachOther</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> previousResult <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">doSomething</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> previousResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">someCondition</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> previousResult<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            previousResult <span class="token operator">=</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <button class="copy-btn" aria-labelledby="copy-button-label"> <span hidden id="copy-button-label">Copy code to clipboard</span>  </button> </div> </li> <li> <p>Loops may be used to retry asynchronous operations that were unsuccessful.</p> <div class="code-wrapper"> <pre class="language-js line-numbers-mode"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">retryUpTo10Times</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> wasSuccessful <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">tryToDoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>wasSuccessful<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token string">'succeeded!'</span><span class="token punctuation">;</span>
        <span class="token comment">// wait to try again.</span>
        <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token string">'failed!'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <button class="copy-btn" aria-labelledby="copy-button-label"> <span hidden id="copy-button-label">Copy code to clipboard</span>  </button> </div> </li> <li> <p>Loops may be used to prevent your code from sending an excessive amount of requests in parallel.</p> <div class="code-wrapper"> <pre class="language-js line-numbers-mode"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">makeUpdatesToRateLimitedApi</span><span class="token punctuation">(</span><span class="token parameter">thingsToUpdate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// we'll exceed our rate limit if we make all the network calls in parallel.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> thing <span class="token keyword">of</span> thingsToUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token function">updateThingWithRateLimitedApi</span><span class="token punctuation">(</span>thing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <button class="copy-btn" aria-labelledby="copy-button-label"> <span hidden id="copy-button-label">Copy code to clipboard</span>  </button> </div> </li> </ul> <p>In such cases it makes sense to use <code>await</code> within a loop and it is recommended to disable the rule via a standard ESLint disable comment.</p> <h2 id="version">Version</h2> <p>This rule was introduced in ESLint v3.12.0.</p> <h2 id="resources">Resources</h2> <ul> <li><a href="https://github.com/eslint/eslint/blob/main/lib/rules/no-await-in-loop.js">Rule source</a></li> <li><a href="https://github.com/eslint/eslint/blob/main/tests/lib/rules/no-await-in-loop.js">Tests source</a></li> </ul><div class="_attribution">
  <p class="_attribution-p">
    &copy; OpenJS Foundation and other contributors<br>Licensed under the MIT License.<br>
    <a href="https://eslint.org/docs/latest/rules/no-await-in-loop" class="_attribution-link">https://eslint.org/docs/latest/rules/no-await-in-loop</a>
  </p>
</div>
